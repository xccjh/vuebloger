<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>rxjs心得总结 | 邹先生博客记录</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/vuebloger/img/logo.jpeg">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.2/jquery.fancybox.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.2/jquery.fancybox.min.css">
    <meta name="description" content="">
    
    <link rel="preload" href="/vuebloger/assets/css/0.styles.fe21bc1b.css" as="style"><link rel="preload" href="/vuebloger/assets/js/app.ff1851b0.js" as="script"><link rel="preload" href="/vuebloger/assets/js/5.82db9be2.js" as="script"><link rel="preload" href="/vuebloger/assets/js/1.b1b3586e.js" as="script"><link rel="preload" href="/vuebloger/assets/js/61.2fa2f12b.js" as="script"><link rel="preload" href="/vuebloger/assets/js/45.c7e679aa.js" as="script"><link rel="prefetch" href="/vuebloger/assets/js/10.9366c20a.js"><link rel="prefetch" href="/vuebloger/assets/js/100.f9c81c91.js"><link rel="prefetch" href="/vuebloger/assets/js/101.7126df67.js"><link rel="prefetch" href="/vuebloger/assets/js/102.7b0b5c91.js"><link rel="prefetch" href="/vuebloger/assets/js/103.3a347b66.js"><link rel="prefetch" href="/vuebloger/assets/js/104.41ae4a00.js"><link rel="prefetch" href="/vuebloger/assets/js/105.6a70dc69.js"><link rel="prefetch" href="/vuebloger/assets/js/106.50c1d88f.js"><link rel="prefetch" href="/vuebloger/assets/js/107.0feed423.js"><link rel="prefetch" href="/vuebloger/assets/js/108.8328d523.js"><link rel="prefetch" href="/vuebloger/assets/js/109.4e943ce3.js"><link rel="prefetch" href="/vuebloger/assets/js/11.628619fa.js"><link rel="prefetch" href="/vuebloger/assets/js/110.13d20afe.js"><link rel="prefetch" href="/vuebloger/assets/js/111.6e97ed73.js"><link rel="prefetch" href="/vuebloger/assets/js/112.fa0e2770.js"><link rel="prefetch" href="/vuebloger/assets/js/113.1e6f233f.js"><link rel="prefetch" href="/vuebloger/assets/js/114.a88867f5.js"><link rel="prefetch" href="/vuebloger/assets/js/115.b1c3d0fb.js"><link rel="prefetch" href="/vuebloger/assets/js/116.b46d05a4.js"><link rel="prefetch" href="/vuebloger/assets/js/117.29fe34be.js"><link rel="prefetch" href="/vuebloger/assets/js/118.18318789.js"><link rel="prefetch" href="/vuebloger/assets/js/119.15cdfaff.js"><link rel="prefetch" href="/vuebloger/assets/js/12.3ca2d200.js"><link rel="prefetch" href="/vuebloger/assets/js/120.62f5e332.js"><link rel="prefetch" href="/vuebloger/assets/js/121.ed9983c7.js"><link rel="prefetch" href="/vuebloger/assets/js/122.a64862b2.js"><link rel="prefetch" href="/vuebloger/assets/js/123.b6a853f2.js"><link rel="prefetch" href="/vuebloger/assets/js/124.96c37bca.js"><link rel="prefetch" href="/vuebloger/assets/js/125.70cc34a1.js"><link rel="prefetch" href="/vuebloger/assets/js/126.93ce61e5.js"><link rel="prefetch" href="/vuebloger/assets/js/127.896ee524.js"><link rel="prefetch" href="/vuebloger/assets/js/128.79a4a28a.js"><link rel="prefetch" href="/vuebloger/assets/js/129.0031f4aa.js"><link rel="prefetch" href="/vuebloger/assets/js/13.9cf5f312.js"><link rel="prefetch" href="/vuebloger/assets/js/130.7149e01d.js"><link rel="prefetch" href="/vuebloger/assets/js/131.b2230aa8.js"><link rel="prefetch" href="/vuebloger/assets/js/132.2a27084d.js"><link rel="prefetch" href="/vuebloger/assets/js/133.7bb8bb62.js"><link rel="prefetch" href="/vuebloger/assets/js/134.5be08a03.js"><link rel="prefetch" href="/vuebloger/assets/js/135.2a1f50de.js"><link rel="prefetch" href="/vuebloger/assets/js/136.08ea1c36.js"><link rel="prefetch" href="/vuebloger/assets/js/137.17b4c62c.js"><link rel="prefetch" href="/vuebloger/assets/js/138.79668cff.js"><link rel="prefetch" href="/vuebloger/assets/js/139.a1bd118f.js"><link rel="prefetch" href="/vuebloger/assets/js/14.c45907da.js"><link rel="prefetch" href="/vuebloger/assets/js/140.6bc4ea26.js"><link rel="prefetch" href="/vuebloger/assets/js/15.19528e37.js"><link rel="prefetch" href="/vuebloger/assets/js/16.0a4c588b.js"><link rel="prefetch" href="/vuebloger/assets/js/17.46428cf9.js"><link rel="prefetch" href="/vuebloger/assets/js/18.370e2967.js"><link rel="prefetch" href="/vuebloger/assets/js/19.da16ff18.js"><link rel="prefetch" href="/vuebloger/assets/js/20.5cf90bce.js"><link rel="prefetch" href="/vuebloger/assets/js/21.6b044372.js"><link rel="prefetch" href="/vuebloger/assets/js/22.594fb529.js"><link rel="prefetch" href="/vuebloger/assets/js/23.bea9c4b4.js"><link rel="prefetch" href="/vuebloger/assets/js/24.140dfb31.js"><link rel="prefetch" href="/vuebloger/assets/js/25.66b474cc.js"><link rel="prefetch" href="/vuebloger/assets/js/26.6ca3f4e4.js"><link rel="prefetch" href="/vuebloger/assets/js/27.7fd3849e.js"><link rel="prefetch" href="/vuebloger/assets/js/28.812b9c1b.js"><link rel="prefetch" href="/vuebloger/assets/js/29.7428e1de.js"><link rel="prefetch" href="/vuebloger/assets/js/30.f1dd8cb0.js"><link rel="prefetch" href="/vuebloger/assets/js/31.4c286435.js"><link rel="prefetch" href="/vuebloger/assets/js/32.5dc1ff63.js"><link rel="prefetch" href="/vuebloger/assets/js/33.b285ebc4.js"><link rel="prefetch" href="/vuebloger/assets/js/34.22e8f912.js"><link rel="prefetch" href="/vuebloger/assets/js/35.e1370f0f.js"><link rel="prefetch" href="/vuebloger/assets/js/36.1def93e3.js"><link rel="prefetch" href="/vuebloger/assets/js/37.33075dd6.js"><link rel="prefetch" href="/vuebloger/assets/js/38.6b5d329e.js"><link rel="prefetch" href="/vuebloger/assets/js/39.72720f4b.js"><link rel="prefetch" href="/vuebloger/assets/js/4.4e73fd8a.js"><link rel="prefetch" href="/vuebloger/assets/js/40.7b23c4e2.js"><link rel="prefetch" href="/vuebloger/assets/js/41.f9ed4683.js"><link rel="prefetch" href="/vuebloger/assets/js/42.f87f4fc4.js"><link rel="prefetch" href="/vuebloger/assets/js/43.f8c37bf0.js"><link rel="prefetch" href="/vuebloger/assets/js/44.3017b8c4.js"><link rel="prefetch" href="/vuebloger/assets/js/46.a0f9b5ed.js"><link rel="prefetch" href="/vuebloger/assets/js/47.9618e937.js"><link rel="prefetch" href="/vuebloger/assets/js/48.36da818d.js"><link rel="prefetch" href="/vuebloger/assets/js/49.4796a25a.js"><link rel="prefetch" href="/vuebloger/assets/js/50.bbd015f4.js"><link rel="prefetch" href="/vuebloger/assets/js/51.70f40739.js"><link rel="prefetch" href="/vuebloger/assets/js/52.9f2436f0.js"><link rel="prefetch" href="/vuebloger/assets/js/53.63fd33fe.js"><link rel="prefetch" href="/vuebloger/assets/js/54.64b9c844.js"><link rel="prefetch" href="/vuebloger/assets/js/55.5cbbffe6.js"><link rel="prefetch" href="/vuebloger/assets/js/56.5258665c.js"><link rel="prefetch" href="/vuebloger/assets/js/57.e657137f.js"><link rel="prefetch" href="/vuebloger/assets/js/58.1d7b0d12.js"><link rel="prefetch" href="/vuebloger/assets/js/59.20043f9b.js"><link rel="prefetch" href="/vuebloger/assets/js/6.05f243c5.js"><link rel="prefetch" href="/vuebloger/assets/js/60.081fb113.js"><link rel="prefetch" href="/vuebloger/assets/js/62.09c5c38e.js"><link rel="prefetch" href="/vuebloger/assets/js/63.689f3eb7.js"><link rel="prefetch" href="/vuebloger/assets/js/64.66e2f1ab.js"><link rel="prefetch" href="/vuebloger/assets/js/65.8d34bb31.js"><link rel="prefetch" href="/vuebloger/assets/js/66.d78540ff.js"><link rel="prefetch" href="/vuebloger/assets/js/67.33cda9ef.js"><link rel="prefetch" href="/vuebloger/assets/js/68.0aed1128.js"><link rel="prefetch" href="/vuebloger/assets/js/69.f8cc4eae.js"><link rel="prefetch" href="/vuebloger/assets/js/7.1c4cfcbe.js"><link rel="prefetch" href="/vuebloger/assets/js/70.9b6b1900.js"><link rel="prefetch" href="/vuebloger/assets/js/71.1b3eaf50.js"><link rel="prefetch" href="/vuebloger/assets/js/72.5ca5f535.js"><link rel="prefetch" href="/vuebloger/assets/js/73.339cf981.js"><link rel="prefetch" href="/vuebloger/assets/js/74.02173a86.js"><link rel="prefetch" href="/vuebloger/assets/js/75.eb1c893f.js"><link rel="prefetch" href="/vuebloger/assets/js/76.4f9cb1d7.js"><link rel="prefetch" href="/vuebloger/assets/js/77.67043e2d.js"><link rel="prefetch" href="/vuebloger/assets/js/78.0728b42c.js"><link rel="prefetch" href="/vuebloger/assets/js/79.51abba0a.js"><link rel="prefetch" href="/vuebloger/assets/js/8.f3194aa0.js"><link rel="prefetch" href="/vuebloger/assets/js/80.e22fcdf1.js"><link rel="prefetch" href="/vuebloger/assets/js/81.77b43dba.js"><link rel="prefetch" href="/vuebloger/assets/js/82.7ba99b81.js"><link rel="prefetch" href="/vuebloger/assets/js/83.d696c564.js"><link rel="prefetch" href="/vuebloger/assets/js/84.63c5793e.js"><link rel="prefetch" href="/vuebloger/assets/js/85.b690ea30.js"><link rel="prefetch" href="/vuebloger/assets/js/86.7daa8941.js"><link rel="prefetch" href="/vuebloger/assets/js/87.f69763e9.js"><link rel="prefetch" href="/vuebloger/assets/js/88.c36cd2bd.js"><link rel="prefetch" href="/vuebloger/assets/js/89.9c06ba83.js"><link rel="prefetch" href="/vuebloger/assets/js/9.f25900b9.js"><link rel="prefetch" href="/vuebloger/assets/js/90.be92f7c5.js"><link rel="prefetch" href="/vuebloger/assets/js/91.8b9ede61.js"><link rel="prefetch" href="/vuebloger/assets/js/92.43680632.js"><link rel="prefetch" href="/vuebloger/assets/js/93.9c55c667.js"><link rel="prefetch" href="/vuebloger/assets/js/94.b8d136a2.js"><link rel="prefetch" href="/vuebloger/assets/js/95.a6eb9f9d.js"><link rel="prefetch" href="/vuebloger/assets/js/96.d3eb99ed.js"><link rel="prefetch" href="/vuebloger/assets/js/97.f9d36625.js"><link rel="prefetch" href="/vuebloger/assets/js/98.8968e5b2.js"><link rel="prefetch" href="/vuebloger/assets/js/99.8a9dcc2a.js"><link rel="prefetch" href="/vuebloger/assets/js/vendors~docsearch.439e457f.js">
    <link rel="stylesheet" href="/vuebloger/assets/css/0.styles.fe21bc1b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/vuebloger/" class="home-link router-link-active"><img src="/vuebloger/img/logo.jpeg" alt="邹先生博客记录" class="logo"> <span class="site-name can-hide">邹先生博客记录</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/vuebloger/timeLine/" class="nav-link">首页</a></div><div class="nav-item"><a href="/vuebloger/technology/" class="nav-link router-link-active">技术</a></div><div class="nav-item"><a href="/vuebloger/life/" class="nav-link">生活</a></div><div class="nav-item"><a href="/vuebloger/workplace/" class="nav-link">职场</a></div><div class="nav-item"><a href="/vuebloger/bake/" class="nav-link">备忘</a></div><div class="nav-item"><a href="/vuebloger/tags/" class="nav-link">标签库</a></div><div class="nav-item"><a href="/vuebloger/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/vuebloger/massage/" class="nav-link">留言板</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">链接</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://gitee.com/xccjh/projects" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://nextjs.frontendx.cn/docs/#%E5%AE%89%E8%A3%85" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Nextjs
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://zh.nuxtjs.org/guide/installation" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Nuxtjs
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://angularjs.org/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  AngularJS
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://reactnative.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ReactNative
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://element-cn.eleme.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ElementUI
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://youzan.github.io/vant/#/zh-CN/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Vant
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://developer.mozilla.org/zh-CN/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  MDN
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://www.fontawesome.com.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Fontawesome
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://developers.weixin.qq.com/miniprogram/dev/index.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  MiniProgram
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://reacttraining.com/react-router/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  react-router-dom
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://webpack.js.org/concepts/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  webpack
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.babeljs.cn/docs/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  babel
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://eslint.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  eslint
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.swiper.com.cn/api/index.html/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  swiper
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://momentjs.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  momentjs
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.runoob.com/linux/linux-shell.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  shell
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://lodash.com/docs/4.17.15#template" target="_blank" rel="noopener noreferrer" class="nav-link external">
  lodash
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://koa.bootcss.com/#links" target="_blank" rel="noopener noreferrer" class="nav-link external">
  koa
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://jestjs.io/docs/en/getting-started" target="_blank" rel="noopener noreferrer" class="nav-link external">
  jest
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://aui.github.io/art-template/zh-cn/docs/index.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  art-template
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://ejs.bootcss.com/#docs" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ejs
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.layui.com/doc/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  layui
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://antv-g2.gitee.io/zh/examples/gallery" target="_blank" rel="noopener noreferrer" class="nav-link external">
  G2
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.echartsjs.com/zh/option.html#title" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ECharts
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.vagrantup.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  vagrant
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://docs.docker.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  docker
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="/vuebloger/technology/ https:/www.runoob.com/redis/redis-tutorial.html" class="nav-link">redis</a></li><li class="dropdown-item"><!----> <a href="https://www.runoob.com/mysql/mysql-tutorial.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  mysql
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://leafletjs.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  leaflet
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.tslang.cn/docs/home.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  TypeScript
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://docschina.org/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  印记中文
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav> <div style="margin-left:20px;margin-right:20px;">
    音乐
    <div role="switch" class="el-switch"><input type="checkbox" name="" true-value="true" class="el-switch__input"><!----><span class="el-switch__core" style="width:40px;"></span><!----></div> <audio><source src="/vuebloger/mp3/065b_520b_0409_111c898908eab454414c3c326fe77c36.mp3" type="audio/mpeg"></audio></div></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/vuebloger/timeLine/" class="nav-link">首页</a></div><div class="nav-item"><a href="/vuebloger/technology/" class="nav-link router-link-active">技术</a></div><div class="nav-item"><a href="/vuebloger/life/" class="nav-link">生活</a></div><div class="nav-item"><a href="/vuebloger/workplace/" class="nav-link">职场</a></div><div class="nav-item"><a href="/vuebloger/bake/" class="nav-link">备忘</a></div><div class="nav-item"><a href="/vuebloger/tags/" class="nav-link">标签库</a></div><div class="nav-item"><a href="/vuebloger/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/vuebloger/massage/" class="nav-link">留言板</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">链接</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://gitee.com/xccjh/projects" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://nextjs.frontendx.cn/docs/#%E5%AE%89%E8%A3%85" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Nextjs
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://zh.nuxtjs.org/guide/installation" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Nuxtjs
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://angularjs.org/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  AngularJS
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://reactnative.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ReactNative
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://element-cn.eleme.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ElementUI
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://youzan.github.io/vant/#/zh-CN/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Vant
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://developer.mozilla.org/zh-CN/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  MDN
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://www.fontawesome.com.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Fontawesome
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://developers.weixin.qq.com/miniprogram/dev/index.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  MiniProgram
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://reacttraining.com/react-router/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  react-router-dom
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://webpack.js.org/concepts/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  webpack
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.babeljs.cn/docs/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  babel
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://eslint.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  eslint
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.swiper.com.cn/api/index.html/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  swiper
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://momentjs.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  momentjs
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.runoob.com/linux/linux-shell.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  shell
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://lodash.com/docs/4.17.15#template" target="_blank" rel="noopener noreferrer" class="nav-link external">
  lodash
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://koa.bootcss.com/#links" target="_blank" rel="noopener noreferrer" class="nav-link external">
  koa
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://jestjs.io/docs/en/getting-started" target="_blank" rel="noopener noreferrer" class="nav-link external">
  jest
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://aui.github.io/art-template/zh-cn/docs/index.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  art-template
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://ejs.bootcss.com/#docs" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ejs
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.layui.com/doc/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  layui
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://antv-g2.gitee.io/zh/examples/gallery" target="_blank" rel="noopener noreferrer" class="nav-link external">
  G2
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.echartsjs.com/zh/option.html#title" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ECharts
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.vagrantup.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  vagrant
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://docs.docker.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  docker
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="/vuebloger/technology/ https:/www.runoob.com/redis/redis-tutorial.html" class="nav-link">redis</a></li><li class="dropdown-item"><!----> <a href="https://www.runoob.com/mysql/mysql-tutorial.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  mysql
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://leafletjs.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  leaflet
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.tslang.cn/docs/home.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  TypeScript
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://docschina.org/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  印记中文
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>rxjs心得总结</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/vuebloger/technology/rxjs%E5%BF%83%E5%BE%97%E6%80%BB%E7%BB%93.html#前言" class="sidebar-link">前言</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vuebloger/technology/rxjs%E5%BF%83%E5%BE%97%E6%80%BB%E7%BB%93.html#基本概念" class="sidebar-link">基本概念</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vuebloger/technology/rxjs%E5%BF%83%E5%BE%97%E6%80%BB%E7%BB%93.html#rxjs操作符" class="sidebar-link">rxjs操作符</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vuebloger/technology/rxjs%E5%BF%83%E5%BE%97%E6%80%BB%E7%BB%93.html#创建" class="sidebar-link">创建</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vuebloger/technology/rxjs%E5%BF%83%E5%BE%97%E6%80%BB%E7%BB%93.html#转换" class="sidebar-link">转换</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vuebloger/technology/rxjs%E5%BF%83%E5%BE%97%E6%80%BB%E7%BB%93.html#过滤" class="sidebar-link">过滤</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vuebloger/technology/rxjs%E5%BF%83%E5%BE%97%E6%80%BB%E7%BB%93.html#组合" class="sidebar-link">组合</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vuebloger/technology/rxjs%E5%BF%83%E5%BE%97%E6%80%BB%E7%BB%93.html#广播" class="sidebar-link">广播</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vuebloger/technology/rxjs%E5%BF%83%E5%BE%97%E6%80%BB%E7%BB%93.html#错误处理" class="sidebar-link">错误处理</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vuebloger/technology/rxjs%E5%BF%83%E5%BE%97%E6%80%BB%E7%BB%93.html#实用工具" class="sidebar-link">实用工具</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vuebloger/technology/rxjs%E5%BF%83%E5%BE%97%E6%80%BB%E7%BB%93.html#条件-布尔" class="sidebar-link">条件/布尔</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vuebloger/technology/rxjs%E5%BF%83%E5%BE%97%E6%80%BB%E7%BB%93.html#数学" class="sidebar-link">数学</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vuebloger/technology/rxjs%E5%BF%83%E5%BE%97%E6%80%BB%E7%BB%93.html#映射-拍平-截断" class="sidebar-link">映射/拍平/截断</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuebloger/technology/rxjs%E5%BF%83%E5%BE%97%E6%80%BB%E7%BB%93.html#map" class="sidebar-link">map</a></li><li class="sidebar-sub-header"><a href="/vuebloger/technology/rxjs%E5%BF%83%E5%BE%97%E6%80%BB%E7%BB%93.html#concatall" class="sidebar-link">concatAll</a></li><li class="sidebar-sub-header"><a href="/vuebloger/technology/rxjs%E5%BF%83%E5%BE%97%E6%80%BB%E7%BB%93.html#concatmap" class="sidebar-link">concatMap</a></li><li class="sidebar-sub-header"><a href="/vuebloger/technology/rxjs%E5%BF%83%E5%BE%97%E6%80%BB%E7%BB%93.html#mergeall" class="sidebar-link">mergeAll</a></li><li class="sidebar-sub-header"><a href="/vuebloger/technology/rxjs%E5%BF%83%E5%BE%97%E6%80%BB%E7%BB%93.html#mergemap-flatmap" class="sidebar-link">mergeMap(flatMap)</a></li><li class="sidebar-sub-header"><a href="/vuebloger/technology/rxjs%E5%BF%83%E5%BE%97%E6%80%BB%E7%BB%93.html#flatmaplatest-switchmap" class="sidebar-link">flatMapLatest(switchMap)</a></li><li class="sidebar-sub-header"><a href="/vuebloger/technology/rxjs%E5%BF%83%E5%BE%97%E6%80%BB%E7%BB%93.html#exhaustmap" class="sidebar-link">exhaustMap</a></li></ul></li><li><a href="/vuebloger/technology/rxjs%E5%BF%83%E5%BE%97%E6%80%BB%E7%BB%93.html#map在时间维度上叠加" class="sidebar-link">map在时间维度上叠加</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuebloger/technology/rxjs%E5%BF%83%E5%BE%97%E6%80%BB%E7%BB%93.html#mergemap" class="sidebar-link">mergeMap</a></li><li class="sidebar-sub-header"><a href="/vuebloger/technology/rxjs%E5%BF%83%E5%BE%97%E6%80%BB%E7%BB%93.html#switchmap" class="sidebar-link">switchMap</a></li><li class="sidebar-sub-header"><a href="/vuebloger/technology/rxjs%E5%BF%83%E5%BE%97%E6%80%BB%E7%BB%93.html#concatmap-3" class="sidebar-link">concatMap</a></li><li class="sidebar-sub-header"><a href="/vuebloger/technology/rxjs%E5%BF%83%E5%BE%97%E6%80%BB%E7%BB%93.html#exhaustmap-3" class="sidebar-link">exhaustMap</a></li></ul></li><li><a href="/vuebloger/technology/rxjs%E5%BF%83%E5%BE%97%E6%80%BB%E7%BB%93.html#内存泄露" class="sidebar-link">内存泄露</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuebloger/technology/rxjs%E5%BF%83%E5%BE%97%E6%80%BB%E7%BB%93.html#需要unsubscribe的常见情况" class="sidebar-link">需要unsubscribe的常见情况</a></li><li class="sidebar-sub-header"><a href="/vuebloger/technology/rxjs%E5%BF%83%E5%BE%97%E6%80%BB%E7%BB%93.html#forms-formcontrol" class="sidebar-link">Forms/formControl</a></li><li class="sidebar-sub-header"><a href="/vuebloger/technology/rxjs%E5%BF%83%E5%BE%97%E6%80%BB%E7%BB%93.html#router" class="sidebar-link">Router</a></li><li class="sidebar-sub-header"><a href="/vuebloger/technology/rxjs%E5%BF%83%E5%BE%97%E6%80%BB%E7%BB%93.html#rendererservice" class="sidebar-link">RendererService</a></li><li class="sidebar-sub-header"><a href="/vuebloger/technology/rxjs%E5%BF%83%E5%BE%97%E6%80%BB%E7%BB%93.html#infinite-observables" class="sidebar-link">Infinite Observables</a></li><li class="sidebar-sub-header"><a href="/vuebloger/technology/rxjs%E5%BF%83%E5%BE%97%E6%80%BB%E7%BB%93.html#redux-store" class="sidebar-link">Redux Store</a></li><li class="sidebar-sub-header"><a href="/vuebloger/technology/rxjs%E5%BF%83%E5%BE%97%E6%80%BB%E7%BB%93.html#不需要-unsubscribe-的情况" class="sidebar-link">不需要 Unsubscribe 的情况</a></li><li class="sidebar-sub-header"><a href="/vuebloger/technology/rxjs%E5%BF%83%E5%BE%97%E6%80%BB%E7%BB%93.html#async-pipe" class="sidebar-link">Async pipe</a></li><li class="sidebar-sub-header"><a href="/vuebloger/technology/rxjs%E5%BF%83%E5%BE%97%E6%80%BB%E7%BB%93.html#hostlistener" class="sidebar-link">@HostListener</a></li><li class="sidebar-sub-header"><a href="/vuebloger/technology/rxjs%E5%BF%83%E5%BE%97%E6%80%BB%E7%BB%93.html#finite-observable" class="sidebar-link">Finite Observable</a></li><li class="sidebar-sub-header"><a href="/vuebloger/technology/rxjs%E5%BF%83%E5%BE%97%E6%80%BB%E7%BB%93.html#关于takeuntil" class="sidebar-link">关于takeUntil</a></li><li class="sidebar-sub-header"><a href="/vuebloger/technology/rxjs%E5%BF%83%E5%BE%97%E6%80%BB%E7%BB%93.html#优雅使用takeuntil" class="sidebar-link">优雅使用takeUntil</a></li><li class="sidebar-sub-header"><a href="/vuebloger/technology/rxjs%E5%BF%83%E5%BE%97%E6%80%BB%E7%BB%93.html#避免takeuntil泄露" class="sidebar-link">避免takeUntil泄露</a></li></ul></li><li><a href="/vuebloger/technology/rxjs%E5%BF%83%E5%BE%97%E6%80%BB%E7%BB%93.html#takeuntil-while-skipuntil-while" class="sidebar-link">takeUntil/While skipUntil/While</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vuebloger/technology/rxjs%E5%BF%83%E5%BE%97%E6%80%BB%E7%BB%93.html#关于subject" class="sidebar-link">关于Subject</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuebloger/technology/rxjs%E5%BF%83%E5%BE%97%E6%80%BB%E7%BB%93.html#subject-observable区别" class="sidebar-link">Subject/Observable区别</a></li><li class="sidebar-sub-header"><a href="/vuebloger/technology/rxjs%E5%BF%83%E5%BE%97%E6%80%BB%E7%BB%93.html#subject-eventemitter的区别" class="sidebar-link">Subject/EventEmitter的区别</a></li><li class="sidebar-sub-header"><a href="/vuebloger/technology/rxjs%E5%BF%83%E5%BE%97%E6%80%BB%E7%BB%93.html#使用observable代替subject" class="sidebar-link">使用Observable代替Subject</a></li><li class="sidebar-sub-header"><a href="/vuebloger/technology/rxjs%E5%BF%83%E5%BE%97%E6%80%BB%E7%BB%93.html#behaviorsubject" class="sidebar-link">BehaviorSubject</a></li><li class="sidebar-sub-header"><a href="/vuebloger/technology/rxjs%E5%BF%83%E5%BE%97%E6%80%BB%E7%BB%93.html#replaysubject" class="sidebar-link">ReplaySubject</a></li><li class="sidebar-sub-header"><a href="/vuebloger/technology/rxjs%E5%BF%83%E5%BE%97%E6%80%BB%E7%BB%93.html#asyncsubject" class="sidebar-link">AsyncSubject</a></li><li class="sidebar-sub-header"><a href="/vuebloger/technology/rxjs%E5%BF%83%E5%BE%97%E6%80%BB%E7%BB%93.html#subjects不可重用" class="sidebar-link">Subjects不可重用</a></li><li class="sidebar-sub-header"><a href="/vuebloger/technology/rxjs%E5%BF%83%E5%BE%97%E6%80%BB%E7%BB%93.html#错误处理中的observable" class="sidebar-link">错误处理中的Observable</a></li></ul></li><li><a href="/vuebloger/technology/rxjs%E5%BF%83%E5%BE%97%E6%80%BB%E7%BB%93.html#publish-share" class="sidebar-link">publish/share</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuebloger/technology/rxjs%E5%BF%83%E5%BE%97%E6%80%BB%E7%BB%93.html#多播的心智模型" class="sidebar-link">多播的心智模型</a></li><li class="sidebar-sub-header"><a href="/vuebloger/technology/rxjs%E5%BF%83%E5%BE%97%E6%80%BB%E7%BB%93.html#multicast-connectableobservable" class="sidebar-link">multicast/ConnectableObservable</a></li><li class="sidebar-sub-header"><a href="/vuebloger/technology/rxjs%E5%BF%83%E5%BE%97%E6%80%BB%E7%BB%93.html#refcount" class="sidebar-link">refCount</a></li><li class="sidebar-sub-header"><a href="/vuebloger/technology/rxjs%E5%BF%83%E5%BE%97%E6%80%BB%E7%BB%93.html#publish" class="sidebar-link">publish</a></li><li class="sidebar-sub-header"><a href="/vuebloger/technology/rxjs%E5%BF%83%E5%BE%97%E6%80%BB%E7%BB%93.html#特殊subjects" class="sidebar-link">特殊subjects</a></li><li class="sidebar-sub-header"><a href="/vuebloger/technology/rxjs%E5%BF%83%E5%BE%97%E6%80%BB%E7%BB%93.html#publishbehavior" class="sidebar-link">publishBehavior</a></li><li class="sidebar-sub-header"><a href="/vuebloger/technology/rxjs%E5%BF%83%E5%BE%97%E6%80%BB%E7%BB%93.html#publishreplay" class="sidebar-link">publishReplay</a></li><li class="sidebar-sub-header"><a href="/vuebloger/technology/rxjs%E5%BF%83%E5%BE%97%E6%80%BB%E7%BB%93.html#publishlast" class="sidebar-link">publishLast</a></li><li class="sidebar-sub-header"><a href="/vuebloger/technology/rxjs%E5%BF%83%E5%BE%97%E6%80%BB%E7%BB%93.html#share" class="sidebar-link">share</a></li></ul></li><li><a href="/vuebloger/technology/rxjs%E5%BF%83%E5%BE%97%E6%80%BB%E7%BB%93.html#refcount使用姿势" class="sidebar-link">refCount使用姿势</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuebloger/technology/rxjs%E5%BF%83%E5%BE%97%E6%80%BB%E7%BB%93.html#两种作用" class="sidebar-link">两种作用</a></li><li class="sidebar-sub-header"><a href="/vuebloger/technology/rxjs%E5%BF%83%E5%BE%97%E6%80%BB%E7%BB%93.html#refcount自动取消订阅" class="sidebar-link">refCount自动取消订阅</a></li><li class="sidebar-sub-header"><a href="/vuebloger/technology/rxjs%E5%BF%83%E5%BE%97%E6%80%BB%E7%BB%93.html#重新订阅已完成observables" class="sidebar-link">重新订阅已完成observables</a></li><li class="sidebar-sub-header"><a href="/vuebloger/technology/rxjs%E5%BF%83%E5%BE%97%E6%80%BB%E7%BB%93.html#重新订阅未完成observables" class="sidebar-link">重新订阅未完成observables</a></li><li class="sidebar-sub-header"><a href="/vuebloger/technology/rxjs%E5%BF%83%E5%BE%97%E6%80%BB%E7%BB%93.html#sharereplay" class="sidebar-link">shareReplay</a></li><li class="sidebar-sub-header"><a href="/vuebloger/technology/rxjs%E5%BF%83%E5%BE%97%E6%80%BB%E7%BB%93.html#refcount不完全使用准则" class="sidebar-link">refCount不完全使用准则</a></li></ul></li><li><a href="/vuebloger/technology/rxjs%E5%BF%83%E5%BE%97%E6%80%BB%E7%BB%93.html#rxjs的错误处理机制" class="sidebar-link">rxjs的错误处理机制</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuebloger/technology/rxjs%E5%BF%83%E5%BE%97%E6%80%BB%E7%BB%93.html#retry指定重试次数" class="sidebar-link">retry指定重试次数</a></li><li class="sidebar-sub-header"><a href="/vuebloger/technology/rxjs%E5%BF%83%E5%BE%97%E6%80%BB%E7%BB%93.html#retrywhen指定重试逻辑" class="sidebar-link">retryWhen指定重试逻辑</a></li><li class="sidebar-sub-header"><a href="/vuebloger/technology/rxjs%E5%BF%83%E5%BE%97%E6%80%BB%E7%BB%93.html#在指定的时间间隔后触发重试" class="sidebar-link">在指定的时间间隔后触发重试</a></li><li class="sidebar-sub-header"><a href="/vuebloger/technology/rxjs%E5%BF%83%E5%BE%97%E6%80%BB%E7%BB%93.html#时间间隔增加的自定义重试" class="sidebar-link">时间间隔增加的自定义重试</a></li><li class="sidebar-sub-header"><a href="/vuebloger/technology/rxjs%E5%BF%83%E5%BE%97%E6%80%BB%E7%BB%93.html#retrywhen-scan" class="sidebar-link">retryWhen+scan</a></li><li class="sidebar-sub-header"><a href="/vuebloger/technology/rxjs%E5%BF%83%E5%BE%97%E6%80%BB%E7%BB%93.html#defer-操作符" class="sidebar-link">defer 操作符</a></li></ul></li><li><a href="/vuebloger/technology/rxjs%E5%BF%83%E5%BE%97%E6%80%BB%E7%BB%93.html#rxjs使用注意点" class="sidebar-link">RxJS使用注意点</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vuebloger/technology/rxjs%E5%BF%83%E5%BE%97%E6%80%BB%E7%BB%93.html#推荐链接" class="sidebar-link">推荐链接</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vuebloger/technology/rxjs%E5%BF%83%E5%BE%97%E6%80%BB%E7%BB%93.html#文末" class="sidebar-link">文末</a><ul class="sidebar-sub-headers"></ul></li></ul></div></li></ul> </div> <div class="page"> <div class="content__default" data-v-47862caa data-v-47862caa><h2 id="前言" data-v-47862caa><a href="#前言" class="header-anchor" data-v-47862caa>#</a> 前言</h2> <p data-v-47862caa>说到rxjs,很多刚接触的朋友第一感觉就是很多操作符，发布订阅模式，需要装箱拆箱，目前好像很火？而且大多数人都会觉得,看别人写的代码,理解起来并不难,但是,当自己尝试响应式编程,往往不知道如何下手，总觉得自己写代码,是不是内存泄露了？一堆操作符怎么样才能够在各种场景下使用哪种操作符呢？首先,要理解rxjs我们需要了解一些本质。比如rxjs编程真正解决的是什么问题呢？</p> <p data-v-47862caa>RxJS是ReactiveX编程理念的JavaScript版本。ReactiveX来自微软，它是一种针对异步数据流的编程。简单来说，它将一切数据，包括HTTP请求，DOM事件或者普通数据等包装成流的形式，然后用强大丰富的操作符对流进行处理，使你能以同步编程的方式处理异步数据，并组合不同的操作符来轻松优雅的实现你所需要的功能。遵循函数响应式（FRP）编程范式，实际上Observable可以认为是加强版的Promise，它们之间是可以通过RxJS的API互相转换的：</p> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>const</span> ob <span class="token operator" data-v-47862caa>=</span> Observable<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>fromPromise</span><span class="token punctuation" data-v-47862caa>(</span>somePromise<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span> <span class="token comment" data-v-47862caa>// Promise转为Observable</span>
<span class="token keyword" data-v-47862caa>const</span> promise <span class="token operator" data-v-47862caa>=</span> someObservable<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>toPromise</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span> <span class="token comment" data-v-47862caa>// Observable转为Promise</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa></div></div><p data-v-47862caa>记住一句话响应式编程,本质是在原有的编程思维上,加入了时间的维度。这句话听起来通俗易懂，就像Linux中的一切皆文件一样。这也许就是响应式编程的核心,它解决的问题,就是把复杂的问题简单化：把一条时间线上的各种行为的并发操作,分散成一种行为在一条时间线上的各种操作的叠加，去使用各种操作符进行转化从而产生了一个流和另外一个流的叠加操作符。</p> <p data-v-47862caa>举个例子，一个变量如果没有时间维度他永远是我们设定的初始值，加上时间维度后,他初始化后，我们不用人为干预他会随着时间维度而不停的变化,这就是一个流，一个时间维度的流和另外一个时间维度的流的叠加产生了新的流,这个叠加操作就是rxjs里面的各种操作符。</p> <p data-v-47862caa>其实我们在用rxjs时候经常在思考的问题往往会是,比如，一个发了请求的流,对于下一流内流外的操作他到底是异步还是同步,在流内流外的操作中下一个操作符在什么情况下可以拿到上一个流的结果，不同操作符在流和流之间的转化关系在物理空间和时间维度上面的作用结果是什么，内存泄漏的根本原因是什么，对于有限流和无线流什么时候需要取消消费者的订阅，冷流和热流的本质区别是什么，冷流和热流的经典转换这类包装多层Observable的结构什么情况会产生内存泄漏，Subject的本质是什么，Observable如何手动代替Subject,如何查看宝珠图等等</p> <p data-v-47862caa>想要摸索清楚这些，我们要先学会如何去调式各种rxjs操作符它们的效果。在网上大部分说法是在一些在线的网站里面通过运行代码去观察一些宝珠图的运行情况,事实上,我们常常打不开这些网站，一个最简单的方法就是在node环境安装rxjs包然后,写好相应的代码之后直接运行即可看效果,如果你网络不错，也可以在线地址<a href="https://stackblitz.com/edit/js-rbhpt7?file=index.js" target="_blank" rel="noopener noreferrer" data-v-47862caa>stackblitz<span data-v-47862caa><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>测试</p> <h2 id="基本概念" data-v-47862caa><a href="#基本概念" class="header-anchor" data-v-47862caa>#</a> 基本概念</h2> <p data-v-47862caa>我们先把rxjs中的observable/observer/subscription/Subject/operators的概念过一遍。</p> <ol data-v-47862caa><li data-v-47862caa>公式：Subscription = Observable.subscribe(observer)</li></ol> <ul data-v-47862caa><li data-v-47862caa>observable: 随着时间产生的数据集合，可以理解为流，其subscribe方法可以启动该流</li> <li data-v-47862caa>observer: 决定如何处理数据</li> <li data-v-47862caa>subscription: 存储已经启动过的流，其unsubscribe方法可以停止该流</li> <li data-v-47862caa>Subject: 既是observer,又是observable</li> <li data-v-47862caa>operators: 操作符</li></ul> <ol start="2" data-v-47862caa><li data-v-47862caa>我们可以把一切输入都当做数据流来处理，比如说：</li></ol> <ul data-v-47862caa><li data-v-47862caa>用户操作</li> <li data-v-47862caa>网络响应</li> <li data-v-47862caa>定时器</li> <li data-v-47862caa>Worker</li></ul> <p data-v-47862caa>RxJS提供了各种API来创建数据流：</p> <ul data-v-47862caa><li data-v-47862caa>单值：of, empty, never</li> <li data-v-47862caa>多值：from</li> <li data-v-47862caa>定时：interval, timer</li> <li data-v-47862caa>从事件创建：fromEvent</li> <li data-v-47862caa>从Promise创建：fromPromise</li> <li data-v-47862caa>自定义创建：create</li></ul> <p data-v-47862caa>创建出来的数据流是一种可观察的序列，可以被订阅，也可以被用来做一些转换操作，比如：</p> <ul data-v-47862caa><li data-v-47862caa>改变数据形态：map, mapTo, pluck</li> <li data-v-47862caa>过滤一些值：filter, skip, first, last, take</li> <li data-v-47862caa>时间轴上的操作：delay, timeout, throttle, debounce, audit, bufferTime</li> <li data-v-47862caa>累加：reduce, scan</li> <li data-v-47862caa>异常处理：throw, catch, retry, finally</li> <li data-v-47862caa>条件执行：takeUntil, delayWhen, retryWhen, subscribeOn, ObserveOn</li> <li data-v-47862caa>转接：switch</li></ul> <p data-v-47862caa>也可以对若干个数据流进行组合：</p> <ul data-v-47862caa><li data-v-47862caa>concat，保持原来的序列顺序连接两个数据流</li> <li data-v-47862caa>merge，合并序列</li> <li data-v-47862caa>race，预设条件为其中一个数据流完成</li> <li data-v-47862caa>forkJoin，预设条件为所有数据流都完成</li> <li data-v-47862caa>zip，取各来源数据流最后一个值合并为对象</li> <li data-v-47862caa>combineLatest，取各来源数据流最后一个值合并为数组</li></ul> <p data-v-47862caa>流经过订阅后可以获取流发射的数据：</p> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa>ob<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>{</span>
    <span class="token function-variable function" data-v-47862caa>next</span><span class="token operator" data-v-47862caa>:</span> d <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span>d<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
    <span class="token function-variable function" data-v-47862caa>error</span><span class="token operator" data-v-47862caa>:</span> err <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>error</span><span class="token punctuation" data-v-47862caa>(</span>err<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
    <span class="token function-variable function" data-v-47862caa>complete</span><span class="token operator" data-v-47862caa>:</span> <span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'end of the stream'</span><span class="token punctuation" data-v-47862caa>)</span>
<span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>)</span>
<span class="token comment" data-v-47862caa>//或</span>
ob<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span>log<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa></div></div><h2 id="rxjs操作符" data-v-47862caa><a href="#rxjs操作符" class="header-anchor" data-v-47862caa>#</a> rxjs操作符</h2> <p data-v-47862caa>operators是rxjs的重头戏，操作符大致可以分为:创建，转换，过滤，组合，广播，错误处理，工具，条件布尔，数学聚合9类。也分为类/实例操作符。</p> <ul data-v-47862caa><li data-v-47862caa>类/静态操作符（通常为合并序列或从已有数据创建序列）</li></ul> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token comment" data-v-47862caa>// 组合： forkJoin, combineLatest，zip,withLatestFrom，merge, concat，race</span>
<span class="token comment" data-v-47862caa>// 创建： of, from,create， fromPromise, fromEvent, ajax, bindCallback，bindNodeCallback，throw，empty，never，throwError</span>
<span class="token comment" data-v-47862caa>// timer，interval，defer,range，identity，pairs</span>
<span class="token comment" data-v-47862caa>// 条件布尔： iif generate（仔细看有点像 for循环），isObservable</span>
<span class="token comment" data-v-47862caa>// 错误处理： onErrorResumeNext</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa></div></div><ul data-v-47862caa><li data-v-47862caa>实例操作符（对流中的数据进行处理或者控制流程）</li></ul> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa>转换：map<span class="token punctuation" data-v-47862caa>,</span> switchMap<span class="token punctuation" data-v-47862caa>,</span> toPromise<span class="token punctuation" data-v-47862caa>,</span> timeout<span class="token punctuation" data-v-47862caa>,</span> pluck
过滤：filter<span class="token punctuation" data-v-47862caa>,</span> take<span class="token punctuation" data-v-47862caa>,</span> takeUntil<span class="token punctuation" data-v-47862caa>,</span>debounceTime<span class="token punctuation" data-v-47862caa>,</span> distinctUntilChanged
错误处理：catch
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa></div></div><p data-v-47862caa><img src="/vuebloger/img/post/rxjs.png" alt="rxjs" data-v-47862caa></p> <h2 id="创建" data-v-47862caa><a href="#创建" class="header-anchor" data-v-47862caa>#</a> 创建</h2> <ul data-v-47862caa><li data-v-47862caa>create</li></ul> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>const</span> <span class="token punctuation" data-v-47862caa>{</span> Observable <span class="token punctuation" data-v-47862caa>}</span> <span class="token operator" data-v-47862caa>=</span> <span class="token keyword" data-v-47862caa>require</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'rxjs'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>// 创建 Observables 也可以new Observable</span>
<span class="token keyword" data-v-47862caa>var</span> observable <span class="token operator" data-v-47862caa>=</span> Observable<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>create</span><span class="token punctuation" data-v-47862caa>(</span>observer <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token punctuation" data-v-47862caa>{</span>
    <span class="token keyword" data-v-47862caa>var</span> id <span class="token operator" data-v-47862caa>=</span> <span class="token function" data-v-47862caa>setInterval</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token punctuation" data-v-47862caa>{</span>
        subscriber<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>next</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>123</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
        subscriber<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>error</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'err: ...'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
        subscriber<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>complete</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'done.'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
    <span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>1000</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>

    <span class="token comment" data-v-47862caa>// 提供取消和清理 interval 资源的方法</span>
    <span class="token keyword" data-v-47862caa>return</span> <span class="token keyword" data-v-47862caa>function</span> <span class="token function" data-v-47862caa>unsubscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token punctuation" data-v-47862caa>{</span>
        <span class="token function" data-v-47862caa>clearInterval</span><span class="token punctuation" data-v-47862caa>(</span>id<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
    <span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>

<span class="token comment" data-v-47862caa>// 订阅 Observables</span>
<span class="token keyword" data-v-47862caa>var</span> subscription <span class="token operator" data-v-47862caa>=</span> observable<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>
  v <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span>v<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
  e <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span>e<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
  done <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span>done<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>

<span class="token comment" data-v-47862caa>// .add() 合并多个订阅，以便同时取消订阅</span>
<span class="token comment" data-v-47862caa>// subscription.add(childSubscription);</span>

<span class="token comment" data-v-47862caa>// 撤销 add的合并</span>
<span class="token comment" data-v-47862caa>// subscription.remove(childSubscription);</span>

<span class="token comment" data-v-47862caa>// 3s后取消订阅</span>
<span class="token function" data-v-47862caa>setTimeout</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token punctuation" data-v-47862caa>{</span>
    subscription<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>unsubscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>3000</span><span class="token punctuation" data-v-47862caa>)</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa><span class="line-number" data-v-47862caa>10</span><br data-v-47862caa><span class="line-number" data-v-47862caa>11</span><br data-v-47862caa><span class="line-number" data-v-47862caa>12</span><br data-v-47862caa><span class="line-number" data-v-47862caa>13</span><br data-v-47862caa><span class="line-number" data-v-47862caa>14</span><br data-v-47862caa><span class="line-number" data-v-47862caa>15</span><br data-v-47862caa><span class="line-number" data-v-47862caa>16</span><br data-v-47862caa><span class="line-number" data-v-47862caa>17</span><br data-v-47862caa><span class="line-number" data-v-47862caa>18</span><br data-v-47862caa><span class="line-number" data-v-47862caa>19</span><br data-v-47862caa><span class="line-number" data-v-47862caa>20</span><br data-v-47862caa><span class="line-number" data-v-47862caa>21</span><br data-v-47862caa><span class="line-number" data-v-47862caa>22</span><br data-v-47862caa><span class="line-number" data-v-47862caa>23</span><br data-v-47862caa><span class="line-number" data-v-47862caa>24</span><br data-v-47862caa><span class="line-number" data-v-47862caa>25</span><br data-v-47862caa><span class="line-number" data-v-47862caa>26</span><br data-v-47862caa><span class="line-number" data-v-47862caa>27</span><br data-v-47862caa><span class="line-number" data-v-47862caa>28</span><br data-v-47862caa><span class="line-number" data-v-47862caa>29</span><br data-v-47862caa><span class="line-number" data-v-47862caa>30</span><br data-v-47862caa><span class="line-number" data-v-47862caa>31</span><br data-v-47862caa><span class="line-number" data-v-47862caa>32</span><br data-v-47862caa></div></div><ul data-v-47862caa><li data-v-47862caa>bindCallback 把普通的回调函数转化为 Observable</li></ul> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>let</span> <span class="token punctuation" data-v-47862caa>{</span> bindCallback <span class="token punctuation" data-v-47862caa>}</span> <span class="token operator" data-v-47862caa>=</span> <span class="token keyword" data-v-47862caa>require</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>&quot;rxjs&quot;</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>function</span> <span class="token function" data-v-47862caa>test</span><span class="token punctuation" data-v-47862caa>(</span>cb<span class="token punctuation" data-v-47862caa>)</span> <span class="token punctuation" data-v-47862caa>{</span> <span class="token function" data-v-47862caa>cb</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span> <span class="token punctuation" data-v-47862caa>}</span>

<span class="token keyword" data-v-47862caa>let</span> o$ <span class="token operator" data-v-47862caa>=</span> <span class="token function" data-v-47862caa>bindCallback</span><span class="token punctuation" data-v-47862caa>(</span>test<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
o$<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>v <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token function" data-v-47862caa>l</span><span class="token punctuation" data-v-47862caa>(</span>v<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span> <span class="token comment" data-v-47862caa>// 1</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa></div></div><ul data-v-47862caa><li data-v-47862caa>bindNodeCallback 把标准的node回调函数转化为 Observable</li></ul> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>let</span> <span class="token punctuation" data-v-47862caa>{</span> bindNodeCallback <span class="token punctuation" data-v-47862caa>}</span> <span class="token operator" data-v-47862caa>=</span> <span class="token keyword" data-v-47862caa>require</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>&quot;rxjs&quot;</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>let</span> fs <span class="token operator" data-v-47862caa>=</span> <span class="token keyword" data-v-47862caa>require</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>&quot;fs&quot;</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>// fs.readFile(&quot;./test.jss&quot;, &quot;utf8&quot;, (e, d) =&gt; (!!e ? l(e) : l(d)));</span>

<span class="token keyword" data-v-47862caa>let</span> o$ <span class="token operator" data-v-47862caa>=</span> <span class="token function" data-v-47862caa>bindNodeCallback</span><span class="token punctuation" data-v-47862caa>(</span>fs<span class="token punctuation" data-v-47862caa>.</span>readFile<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>&quot;./test.jss&quot;</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token string" data-v-47862caa>&quot;utf8&quot;</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
o$<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>v <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token function" data-v-47862caa>l</span><span class="token punctuation" data-v-47862caa>(</span>v<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span> e <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token function" data-v-47862caa>l</span><span class="token punctuation" data-v-47862caa>(</span>e<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa></div></div><ul data-v-47862caa><li data-v-47862caa>pairs  将对象转换为Observable</li></ul> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>let</span> <span class="token punctuation" data-v-47862caa>{</span> pairs<span class="token punctuation" data-v-47862caa>,</span> <span class="token keyword" data-v-47862caa>of</span> <span class="token punctuation" data-v-47862caa>}</span> <span class="token operator" data-v-47862caa>=</span> <span class="token keyword" data-v-47862caa>require</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>&quot;rxjs&quot;</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token function" data-v-47862caa>pairs</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>{</span>
  name<span class="token operator" data-v-47862caa>:</span> <span class="token string" data-v-47862caa>&quot;ajanuw&quot;</span><span class="token punctuation" data-v-47862caa>,</span>
  age<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>14</span><span class="token punctuation" data-v-47862caa>,</span>
<span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>l<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span> <span class="token comment" data-v-47862caa>// [ 'name', 'ajanuw' ] [ 'age', 14 ]</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa></div></div><ul data-v-47862caa><li data-v-47862caa>of 单一输出</li></ul> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> <span class="token keyword" data-v-47862caa>of</span> <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>of</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>[</span><span class="token number" data-v-47862caa>1</span><span class="token punctuation" data-v-47862caa>,</span><span class="token number" data-v-47862caa>2</span><span class="token punctuation" data-v-47862caa>,</span><span class="token number" data-v-47862caa>3</span><span class="token punctuation" data-v-47862caa>]</span><span class="token punctuation" data-v-47862caa>)</span>
<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>
  next <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'next:'</span><span class="token punctuation" data-v-47862caa>,</span> next<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
  err <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'error:'</span><span class="token punctuation" data-v-47862caa>,</span> err<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
  <span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'the end'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>// result:</span>
<span class="token comment" data-v-47862caa>// 'next: [1,2,3]'</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa></div></div><ul data-v-47862caa><li data-v-47862caa>from - 拆分输出</li></ul> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> from<span class="token punctuation" data-v-47862caa>,</span> asyncScheduler <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'start'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> array <span class="token operator" data-v-47862caa>=</span> <span class="token punctuation" data-v-47862caa>[</span><span class="token number" data-v-47862caa>10</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>20</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>30</span><span class="token punctuation" data-v-47862caa>]</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> result <span class="token operator" data-v-47862caa>=</span> <span class="token function" data-v-47862caa>from</span><span class="token punctuation" data-v-47862caa>(</span>array<span class="token punctuation" data-v-47862caa>,</span> asyncScheduler<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
result<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>x <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span>x<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'end'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>// Logs:</span>
<span class="token comment" data-v-47862caa>// start</span>
<span class="token comment" data-v-47862caa>// end</span>
<span class="token comment" data-v-47862caa>// 10</span>
<span class="token comment" data-v-47862caa>// 20</span>
<span class="token comment" data-v-47862caa>// 30</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa><span class="line-number" data-v-47862caa>10</span><br data-v-47862caa><span class="line-number" data-v-47862caa>11</span><br data-v-47862caa><span class="line-number" data-v-47862caa>12</span><br data-v-47862caa></div></div><ul data-v-47862caa><li data-v-47862caa>ajax 异步产生数据</li></ul> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> ajax <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs/ajax'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> map<span class="token punctuation" data-v-47862caa>,</span> catchError <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs/operators'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> <span class="token keyword" data-v-47862caa>of</span> <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs'</span><span class="token punctuation" data-v-47862caa>;</span>                          
<span class="token comment" data-v-47862caa>// ajax()</span>
<span class="token keyword" data-v-47862caa>const</span> obs$ <span class="token operator" data-v-47862caa>=</span> <span class="token function" data-v-47862caa>ajax</span><span class="token punctuation" data-v-47862caa>(</span><span class="token template-string" data-v-47862caa><span class="token template-punctuation string" data-v-47862caa>`</span><span class="token string" data-v-47862caa>https://api.github.com/users?per_page=5</span><span class="token template-punctuation string" data-v-47862caa>`</span></span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span>
  <span class="token function" data-v-47862caa>map</span><span class="token punctuation" data-v-47862caa>(</span>userResponse <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'users: '</span><span class="token punctuation" data-v-47862caa>,</span> userResponse<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
  <span class="token function" data-v-47862caa>catchError</span><span class="token punctuation" data-v-47862caa>(</span>error <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token punctuation" data-v-47862caa>{</span>
    <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'error: '</span><span class="token punctuation" data-v-47862caa>,</span> error<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
    <span class="token keyword" data-v-47862caa>return</span> <span class="token keyword" data-v-47862caa>of</span><span class="token punctuation" data-v-47862caa>(</span>error<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
  <span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>)</span>
<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>// ajax.getJson</span>
 <span class="token keyword" data-v-47862caa>const</span> obs$ <span class="token operator" data-v-47862caa>=</span> ajax<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>getJSON</span><span class="token punctuation" data-v-47862caa>(</span><span class="token template-string" data-v-47862caa><span class="token template-punctuation string" data-v-47862caa>`</span><span class="token string" data-v-47862caa>https://api.github.com/users?per_page=5</span><span class="token template-punctuation string" data-v-47862caa>`</span></span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span>
   <span class="token function" data-v-47862caa>map</span><span class="token punctuation" data-v-47862caa>(</span>userResponse <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'users: '</span><span class="token punctuation" data-v-47862caa>,</span> userResponse<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
   <span class="token function" data-v-47862caa>catchError</span><span class="token punctuation" data-v-47862caa>(</span>error <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token punctuation" data-v-47862caa>{</span>
     <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'error: '</span><span class="token punctuation" data-v-47862caa>,</span> error<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
     <span class="token keyword" data-v-47862caa>return</span> <span class="token keyword" data-v-47862caa>of</span><span class="token punctuation" data-v-47862caa>(</span>error<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
   <span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>)</span>
 <span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>// 类jquery</span>
 <span class="token keyword" data-v-47862caa>const</span> users <span class="token operator" data-v-47862caa>=</span> <span class="token function" data-v-47862caa>ajax</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>{</span>
   url<span class="token operator" data-v-47862caa>:</span> <span class="token string" data-v-47862caa>'https://httpbin.org/delay/2'</span><span class="token punctuation" data-v-47862caa>,</span>
   method<span class="token operator" data-v-47862caa>:</span> <span class="token string" data-v-47862caa>'POST'</span><span class="token punctuation" data-v-47862caa>,</span>
   headers<span class="token operator" data-v-47862caa>:</span> <span class="token punctuation" data-v-47862caa>{</span>
     <span class="token string" data-v-47862caa>'Content-Type'</span><span class="token operator" data-v-47862caa>:</span> <span class="token string" data-v-47862caa>'application/json'</span><span class="token punctuation" data-v-47862caa>,</span>
     <span class="token string" data-v-47862caa>'rxjs-custom-header'</span><span class="token operator" data-v-47862caa>:</span> <span class="token string" data-v-47862caa>'Rxjs'</span>
   <span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>,</span>
   body<span class="token operator" data-v-47862caa>:</span> <span class="token punctuation" data-v-47862caa>{</span>
     rxjs<span class="token operator" data-v-47862caa>:</span> <span class="token string" data-v-47862caa>'Hello World!'</span>
   <span class="token punctuation" data-v-47862caa>}</span>
 <span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span>
   <span class="token function" data-v-47862caa>map</span><span class="token punctuation" data-v-47862caa>(</span>response <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'response: '</span><span class="token punctuation" data-v-47862caa>,</span> response<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
   <span class="token function" data-v-47862caa>catchError</span><span class="token punctuation" data-v-47862caa>(</span>error <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token punctuation" data-v-47862caa>{</span>
     <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'error: '</span><span class="token punctuation" data-v-47862caa>,</span> error<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
     <span class="token keyword" data-v-47862caa>return</span> <span class="token keyword" data-v-47862caa>of</span><span class="token punctuation" data-v-47862caa>(</span>error<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
   <span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>)</span>
 <span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa><span class="line-number" data-v-47862caa>10</span><br data-v-47862caa><span class="line-number" data-v-47862caa>11</span><br data-v-47862caa><span class="line-number" data-v-47862caa>12</span><br data-v-47862caa><span class="line-number" data-v-47862caa>13</span><br data-v-47862caa><span class="line-number" data-v-47862caa>14</span><br data-v-47862caa><span class="line-number" data-v-47862caa>15</span><br data-v-47862caa><span class="line-number" data-v-47862caa>16</span><br data-v-47862caa><span class="line-number" data-v-47862caa>17</span><br data-v-47862caa><span class="line-number" data-v-47862caa>18</span><br data-v-47862caa><span class="line-number" data-v-47862caa>19</span><br data-v-47862caa><span class="line-number" data-v-47862caa>20</span><br data-v-47862caa><span class="line-number" data-v-47862caa>21</span><br data-v-47862caa><span class="line-number" data-v-47862caa>22</span><br data-v-47862caa><span class="line-number" data-v-47862caa>23</span><br data-v-47862caa><span class="line-number" data-v-47862caa>24</span><br data-v-47862caa><span class="line-number" data-v-47862caa>25</span><br data-v-47862caa><span class="line-number" data-v-47862caa>26</span><br data-v-47862caa><span class="line-number" data-v-47862caa>27</span><br data-v-47862caa><span class="line-number" data-v-47862caa>28</span><br data-v-47862caa><span class="line-number" data-v-47862caa>29</span><br data-v-47862caa><span class="line-number" data-v-47862caa>30</span><br data-v-47862caa><span class="line-number" data-v-47862caa>31</span><br data-v-47862caa><span class="line-number" data-v-47862caa>32</span><br data-v-47862caa><span class="line-number" data-v-47862caa>33</span><br data-v-47862caa><span class="line-number" data-v-47862caa>34</span><br data-v-47862caa><span class="line-number" data-v-47862caa>35</span><br data-v-47862caa><span class="line-number" data-v-47862caa>36</span><br data-v-47862caa><span class="line-number" data-v-47862caa>37</span><br data-v-47862caa></div></div><ul data-v-47862caa><li data-v-47862caa>generate 仔细看有点像 for循环</li></ul> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>let</span> <span class="token punctuation" data-v-47862caa>{</span> generate <span class="token punctuation" data-v-47862caa>}</span> <span class="token operator" data-v-47862caa>=</span> <span class="token keyword" data-v-47862caa>require</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>&quot;rxjs&quot;</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token function" data-v-47862caa>generate</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>0</span><span class="token punctuation" data-v-47862caa>,</span> x <span class="token operator" data-v-47862caa>=&gt;</span> x <span class="token operator" data-v-47862caa>&lt;</span> <span class="token number" data-v-47862caa>3</span><span class="token punctuation" data-v-47862caa>,</span> x <span class="token operator" data-v-47862caa>=&gt;</span> x <span class="token operator" data-v-47862caa>+</span> <span class="token number" data-v-47862caa>1</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>
  v <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token function" data-v-47862caa>l</span><span class="token punctuation" data-v-47862caa>(</span>v<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
  err <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token punctuation" data-v-47862caa>{</span><span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>,</span>
  <span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token function" data-v-47862caa>l</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>&quot;done&quot;</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>// 0, 1, 2, done</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa></div></div><ul data-v-47862caa><li data-v-47862caa>identity 没有做处理，返回值本身</li></ul> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>let</span> <span class="token punctuation" data-v-47862caa>{</span> identity <span class="token punctuation" data-v-47862caa>}</span> <span class="token operator" data-v-47862caa>=</span> <span class="token keyword" data-v-47862caa>require</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>&quot;rxjs&quot;</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>let</span> x <span class="token operator" data-v-47862caa>=</span> <span class="token function" data-v-47862caa>identity</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>233</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token function" data-v-47862caa>l</span><span class="token punctuation" data-v-47862caa>(</span>x<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span> <span class="token comment" data-v-47862caa>// 233</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa></div></div><ul data-v-47862caa><li data-v-47862caa>range(start: number, count: number, scheduler: Scheduler): Observable  依次发出给定区间内的数字</li></ul> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token comment" data-v-47862caa>// 发出1-10的区间值</span>
<span class="token comment" data-v-47862caa>// RxJS v6+</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> range <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>// 依次发出1-10</span>
<span class="token keyword" data-v-47862caa>const</span> source <span class="token operator" data-v-47862caa>=</span> <span class="token function" data-v-47862caa>range</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>10</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>// 输出: 1,2,3,4,5,6,7,8,9,10</span>
<span class="token keyword" data-v-47862caa>const</span> example <span class="token operator" data-v-47862caa>=</span> source<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>val <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span>val<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa></div></div><ul data-v-47862caa><li data-v-47862caa>fromPromise</li></ul> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token comment" data-v-47862caa>// 将 promise 转换成 observable 并捕获错误</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> <span class="token keyword" data-v-47862caa>of</span> <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs/observable/of'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> fromPromise <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs/observable/fromPromise'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> mergeMap<span class="token punctuation" data-v-47862caa>,</span> catchError <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs/operators'</span><span class="token punctuation" data-v-47862caa>;</span>

<span class="token comment" data-v-47862caa>// 基于输入来决定是 resolve 还是 reject 的示例 promise</span>
<span class="token keyword" data-v-47862caa>const</span> <span class="token function-variable function" data-v-47862caa>myPromise</span> <span class="token operator" data-v-47862caa>=</span> willReject <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token punctuation" data-v-47862caa>{</span>
  <span class="token keyword" data-v-47862caa>return</span> <span class="token keyword" data-v-47862caa>new</span> <span class="token class-name" data-v-47862caa><span class="token builtin" data-v-47862caa>Promise</span></span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>(</span>resolve<span class="token punctuation" data-v-47862caa>,</span> reject<span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token punctuation" data-v-47862caa>{</span>
    <span class="token keyword" data-v-47862caa>if</span> <span class="token punctuation" data-v-47862caa>(</span>willReject<span class="token punctuation" data-v-47862caa>)</span> <span class="token punctuation" data-v-47862caa>{</span>
      <span class="token function" data-v-47862caa>reject</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'Rejected!'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
    <span class="token punctuation" data-v-47862caa>}</span>
    <span class="token function" data-v-47862caa>resolve</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'Resolved!'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
  <span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>// 先发出 true，然后是 false</span>
<span class="token keyword" data-v-47862caa>const</span> source <span class="token operator" data-v-47862caa>=</span> <span class="token keyword" data-v-47862caa>of</span><span class="token punctuation" data-v-47862caa>(</span><span class="token boolean" data-v-47862caa>true</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token boolean" data-v-47862caa>false</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> example <span class="token operator" data-v-47862caa>=</span> source<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span>
  <span class="token function" data-v-47862caa>mergeMap</span><span class="token punctuation" data-v-47862caa>(</span>val <span class="token operator" data-v-47862caa>=&gt;</span>
    <span class="token function" data-v-47862caa>fromPromise</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>myPromise</span><span class="token punctuation" data-v-47862caa>(</span>val<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span>
      <span class="token comment" data-v-47862caa>// 捕获并优雅地处理 reject 的结果</span>
      <span class="token function" data-v-47862caa>catchError</span><span class="token punctuation" data-v-47862caa>(</span>error <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token keyword" data-v-47862caa>of</span><span class="token punctuation" data-v-47862caa>(</span><span class="token template-string" data-v-47862caa><span class="token template-punctuation string" data-v-47862caa>`</span><span class="token string" data-v-47862caa>Error: </span><span class="token interpolation" data-v-47862caa><span class="token interpolation-punctuation punctuation" data-v-47862caa>${</span>error<span class="token interpolation-punctuation punctuation" data-v-47862caa>}</span></span><span class="token template-punctuation string" data-v-47862caa>`</span></span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span>
    <span class="token punctuation" data-v-47862caa>)</span>
  <span class="token punctuation" data-v-47862caa>)</span>
<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>// 输出: 'Error: Rejected!', 'Resolved!'</span>
<span class="token keyword" data-v-47862caa>const</span> subscribe <span class="token operator" data-v-47862caa>=</span> example<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>val <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span>val<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa><span class="line-number" data-v-47862caa>10</span><br data-v-47862caa><span class="line-number" data-v-47862caa>11</span><br data-v-47862caa><span class="line-number" data-v-47862caa>12</span><br data-v-47862caa><span class="line-number" data-v-47862caa>13</span><br data-v-47862caa><span class="line-number" data-v-47862caa>14</span><br data-v-47862caa><span class="line-number" data-v-47862caa>15</span><br data-v-47862caa><span class="line-number" data-v-47862caa>16</span><br data-v-47862caa><span class="line-number" data-v-47862caa>17</span><br data-v-47862caa><span class="line-number" data-v-47862caa>18</span><br data-v-47862caa><span class="line-number" data-v-47862caa>19</span><br data-v-47862caa><span class="line-number" data-v-47862caa>20</span><br data-v-47862caa><span class="line-number" data-v-47862caa>21</span><br data-v-47862caa><span class="line-number" data-v-47862caa>22</span><br data-v-47862caa><span class="line-number" data-v-47862caa>23</span><br data-v-47862caa><span class="line-number" data-v-47862caa>24</span><br data-v-47862caa><span class="line-number" data-v-47862caa>25</span><br data-v-47862caa><span class="line-number" data-v-47862caa>26</span><br data-v-47862caa></div></div><h2 id="转换" data-v-47862caa><a href="#转换" class="header-anchor" data-v-47862caa>#</a> 转换</h2> <ul data-v-47862caa><li data-v-47862caa>buffer（closingNotifier） 以数组形式缓存 Observable 发出的值</li></ul> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token comment" data-v-47862caa>// RxJS v6+</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> interval<span class="token punctuation" data-v-47862caa>,</span> fromEvent <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>&quot;rxjs&quot;</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> buffer <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>&quot;rxjs/operators&quot;</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>// 创建每1秒发出值的 observable</span>
<span class="token keyword" data-v-47862caa>const</span> myInterval <span class="token operator" data-v-47862caa>=</span> <span class="token function" data-v-47862caa>interval</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1000</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>// 创建页面点击事件的 observable</span>
<span class="token keyword" data-v-47862caa>const</span> bufferBy <span class="token operator" data-v-47862caa>=</span> <span class="token function" data-v-47862caa>fromEvent</span><span class="token punctuation" data-v-47862caa>(</span>document<span class="token punctuation" data-v-47862caa>,</span> <span class="token string" data-v-47862caa>&quot;click&quot;</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>/*
  收集由 myInterval 发出的所有值，直到我们点击页面。此时 bufferBy 会发出值以完成缓存。
  将自上次缓冲以来收集的所有值传递给数组。
*/</span>
<span class="token keyword" data-v-47862caa>const</span> myBufferedInterval <span class="token operator" data-v-47862caa>=</span> myInterval<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>buffer</span><span class="token punctuation" data-v-47862caa>(</span>bufferBy<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>// 打印值到控制台</span>
<span class="token comment" data-v-47862caa>// 例如 输出: [1,2,3] ... [4,5,6,7,8]</span>
<span class="token keyword" data-v-47862caa>const</span> subscribe <span class="token operator" data-v-47862caa>=</span> myBufferedInterval<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>val <span class="token operator" data-v-47862caa>=&gt;</span>
  <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>&quot; Buffered Values:&quot;</span><span class="token punctuation" data-v-47862caa>,</span> val<span class="token punctuation" data-v-47862caa>)</span>
<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>

<span class="token comment" data-v-47862caa>// 示例二：</span>
<span class="token keyword" data-v-47862caa>var</span> foo <span class="token operator" data-v-47862caa>=</span> Rx<span class="token punctuation" data-v-47862caa>.</span>Observable<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>of</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'h'</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token string" data-v-47862caa>'e'</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token string" data-v-47862caa>'l'</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token string" data-v-47862caa>'l'</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token string" data-v-47862caa>'o'</span><span class="token punctuation" data-v-47862caa>)</span>
  <span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>zip</span><span class="token punctuation" data-v-47862caa>(</span>Rx<span class="token punctuation" data-v-47862caa>.</span>Observable<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>interval</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>600</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>take</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>5</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token punctuation" data-v-47862caa>(</span>x<span class="token punctuation" data-v-47862caa>,</span>y<span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> x<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>var</span> bar <span class="token operator" data-v-47862caa>=</span> Rx<span class="token punctuation" data-v-47862caa>.</span>Observable<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>interval</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>900</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>take</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>3</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>/*
-----h-----e-----l-----l-----o|       (foo)
--------0--------1--------2|          (bar)
        buffer(bar)
--------h--------e--------ll|
*/</span>

<span class="token keyword" data-v-47862caa>var</span> result <span class="token operator" data-v-47862caa>=</span> foo<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>buffer</span><span class="token punctuation" data-v-47862caa>(</span>bar<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
result<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>
  <span class="token keyword" data-v-47862caa>function</span> <span class="token punctuation" data-v-47862caa>(</span>x<span class="token punctuation" data-v-47862caa>)</span> <span class="token punctuation" data-v-47862caa>{</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'next '</span> <span class="token operator" data-v-47862caa>+</span> x<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span> <span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>,</span>
  <span class="token keyword" data-v-47862caa>function</span> <span class="token punctuation" data-v-47862caa>(</span>err<span class="token punctuation" data-v-47862caa>)</span> <span class="token punctuation" data-v-47862caa>{</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'error '</span> <span class="token operator" data-v-47862caa>+</span> err<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span> <span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>,</span>
  <span class="token keyword" data-v-47862caa>function</span> <span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token punctuation" data-v-47862caa>{</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'done'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span> <span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>,</span>
<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
  <span class="token comment" data-v-47862caa>/*
&quot;next h&quot;
&quot;next e&quot;
&quot;next l,l&quot;
&quot;done&quot;
  */</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa><span class="line-number" data-v-47862caa>10</span><br data-v-47862caa><span class="line-number" data-v-47862caa>11</span><br data-v-47862caa><span class="line-number" data-v-47862caa>12</span><br data-v-47862caa><span class="line-number" data-v-47862caa>13</span><br data-v-47862caa><span class="line-number" data-v-47862caa>14</span><br data-v-47862caa><span class="line-number" data-v-47862caa>15</span><br data-v-47862caa><span class="line-number" data-v-47862caa>16</span><br data-v-47862caa><span class="line-number" data-v-47862caa>17</span><br data-v-47862caa><span class="line-number" data-v-47862caa>18</span><br data-v-47862caa><span class="line-number" data-v-47862caa>19</span><br data-v-47862caa><span class="line-number" data-v-47862caa>20</span><br data-v-47862caa><span class="line-number" data-v-47862caa>21</span><br data-v-47862caa><span class="line-number" data-v-47862caa>22</span><br data-v-47862caa><span class="line-number" data-v-47862caa>23</span><br data-v-47862caa><span class="line-number" data-v-47862caa>24</span><br data-v-47862caa><span class="line-number" data-v-47862caa>25</span><br data-v-47862caa><span class="line-number" data-v-47862caa>26</span><br data-v-47862caa><span class="line-number" data-v-47862caa>27</span><br data-v-47862caa><span class="line-number" data-v-47862caa>28</span><br data-v-47862caa><span class="line-number" data-v-47862caa>29</span><br data-v-47862caa><span class="line-number" data-v-47862caa>30</span><br data-v-47862caa><span class="line-number" data-v-47862caa>31</span><br data-v-47862caa><span class="line-number" data-v-47862caa>32</span><br data-v-47862caa><span class="line-number" data-v-47862caa>33</span><br data-v-47862caa><span class="line-number" data-v-47862caa>34</span><br data-v-47862caa><span class="line-number" data-v-47862caa>35</span><br data-v-47862caa><span class="line-number" data-v-47862caa>36</span><br data-v-47862caa><span class="line-number" data-v-47862caa>37</span><br data-v-47862caa><span class="line-number" data-v-47862caa>38</span><br data-v-47862caa><span class="line-number" data-v-47862caa>39</span><br data-v-47862caa><span class="line-number" data-v-47862caa>40</span><br data-v-47862caa><span class="line-number" data-v-47862caa>41</span><br data-v-47862caa></div></div><ul data-v-47862caa><li data-v-47862caa>bufferCount（bufferSize，startBufferEvery） 将数据缓存至数组，当数组length = bufferSize 时返回</li></ul> <p data-v-47862caa>--bufferSize（number）：缓存区的最大长度</p> <p data-v-47862caa>--startBufferEvery（number）：可选，相隔 startBufferEvery 开启新缓存区</p> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token comment" data-v-47862caa>// 示例一</span>
<span class="token function" data-v-47862caa>fromEvent</span><span class="token punctuation" data-v-47862caa>(</span>document<span class="token punctuation" data-v-47862caa>,</span> <span class="token string" data-v-47862caa>'click'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>bufferCount</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>2</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>e <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span>e<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span>
<span class="token comment" data-v-47862caa>// 示例二</span>
<span class="token keyword" data-v-47862caa>var</span> foo <span class="token operator" data-v-47862caa>=</span> Rx<span class="token punctuation" data-v-47862caa>.</span>Observable<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>of</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'h'</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token string" data-v-47862caa>'e'</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token string" data-v-47862caa>'l'</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token string" data-v-47862caa>'l'</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token string" data-v-47862caa>'o'</span><span class="token punctuation" data-v-47862caa>)</span>
  <span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>zip</span><span class="token punctuation" data-v-47862caa>(</span>Rx<span class="token punctuation" data-v-47862caa>.</span>Observable<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>interval</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>600</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>take</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>5</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token punctuation" data-v-47862caa>(</span>x<span class="token punctuation" data-v-47862caa>,</span>y<span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> x<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>

<span class="token comment" data-v-47862caa>/*
-----h-----e-----l-----l-----o|       (foo)
        bufferCount(2)
----------([h,e])------([l,l])([o|])l
*/</span>
<span class="token keyword" data-v-47862caa>var</span> result <span class="token operator" data-v-47862caa>=</span> foo<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>bufferCount</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>2</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
result<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>
  <span class="token keyword" data-v-47862caa>function</span> <span class="token punctuation" data-v-47862caa>(</span>x<span class="token punctuation" data-v-47862caa>)</span> <span class="token punctuation" data-v-47862caa>{</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'next '</span> <span class="token operator" data-v-47862caa>+</span> x<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span> <span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>,</span>
  <span class="token keyword" data-v-47862caa>function</span> <span class="token punctuation" data-v-47862caa>(</span>err<span class="token punctuation" data-v-47862caa>)</span> <span class="token punctuation" data-v-47862caa>{</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'error '</span> <span class="token operator" data-v-47862caa>+</span> err<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span> <span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>,</span>
  <span class="token keyword" data-v-47862caa>function</span> <span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token punctuation" data-v-47862caa>{</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'done'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span> <span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>,</span>
<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
  <span class="token comment" data-v-47862caa>/*
&quot;next h,e&quot;
&quot;next l,l&quot;
&quot;next o&quot;
&quot;done&quot;
  */</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa><span class="line-number" data-v-47862caa>10</span><br data-v-47862caa><span class="line-number" data-v-47862caa>11</span><br data-v-47862caa><span class="line-number" data-v-47862caa>12</span><br data-v-47862caa><span class="line-number" data-v-47862caa>13</span><br data-v-47862caa><span class="line-number" data-v-47862caa>14</span><br data-v-47862caa><span class="line-number" data-v-47862caa>15</span><br data-v-47862caa><span class="line-number" data-v-47862caa>16</span><br data-v-47862caa><span class="line-number" data-v-47862caa>17</span><br data-v-47862caa><span class="line-number" data-v-47862caa>18</span><br data-v-47862caa><span class="line-number" data-v-47862caa>19</span><br data-v-47862caa><span class="line-number" data-v-47862caa>20</span><br data-v-47862caa><span class="line-number" data-v-47862caa>21</span><br data-v-47862caa><span class="line-number" data-v-47862caa>22</span><br data-v-47862caa><span class="line-number" data-v-47862caa>23</span><br data-v-47862caa></div></div><ul data-v-47862caa><li data-v-47862caa>bufferTime（bufferTimeSpan，bufferCreationInterval，maxBufferSize，scheduler） 将数据缓存至数组，并周期性返回</li></ul> <p data-v-47862caa>--bufferTimeSpan（number）：每隔 bufferTimeSpan 秒返回新缓存buffer区</p> <p data-v-47862caa>--bufferCreationInterval（number）：开启新缓存区的间隔，捕获最后 TimeSpan 时间段的数据</p> <p data-v-47862caa>--maxBufferSize：缓存区length</p> <p data-v-47862caa>--scheduler：（默认值: async）可选，调度器，调度缓冲区</p> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token comment" data-v-47862caa>// 示例一</span>
<span class="token function" data-v-47862caa>fromEvent</span><span class="token punctuation" data-v-47862caa>(</span>document<span class="token punctuation" data-v-47862caa>,</span> <span class="token string" data-v-47862caa>'click'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>bufferTime</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>2000</span><span class="token punctuation" data-v-47862caa>,</span><span class="token keyword" data-v-47862caa>null</span><span class="token punctuation" data-v-47862caa>,</span><span class="token number" data-v-47862caa>3</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>e <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span>e<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span>

<span class="token comment" data-v-47862caa>// 示例二</span>
<span class="token keyword" data-v-47862caa>var</span> foo <span class="token operator" data-v-47862caa>=</span> Rx<span class="token punctuation" data-v-47862caa>.</span>Observable<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>of</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'h'</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token string" data-v-47862caa>'e'</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token string" data-v-47862caa>'l'</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token string" data-v-47862caa>'l'</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token string" data-v-47862caa>'o'</span><span class="token punctuation" data-v-47862caa>)</span>
  <span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>zip</span><span class="token punctuation" data-v-47862caa>(</span>Rx<span class="token punctuation" data-v-47862caa>.</span>Observable<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>interval</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>600</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>take</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>5</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token punctuation" data-v-47862caa>(</span>x<span class="token punctuation" data-v-47862caa>,</span>y<span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> x<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>/*
-----h-----e-----l-----l-----o|       (foo)
--------x--------x--------x|          (900ms)
        bufferTime(900)
--------h--------e--------ll|
*/</span>
<span class="token keyword" data-v-47862caa>var</span> result <span class="token operator" data-v-47862caa>=</span> foo<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>bufferTime</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>900</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
result<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>
  <span class="token keyword" data-v-47862caa>function</span> <span class="token punctuation" data-v-47862caa>(</span>x<span class="token punctuation" data-v-47862caa>)</span> <span class="token punctuation" data-v-47862caa>{</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'next '</span> <span class="token operator" data-v-47862caa>+</span> x<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span> <span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>,</span>
  <span class="token keyword" data-v-47862caa>function</span> <span class="token punctuation" data-v-47862caa>(</span>err<span class="token punctuation" data-v-47862caa>)</span> <span class="token punctuation" data-v-47862caa>{</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'error '</span> <span class="token operator" data-v-47862caa>+</span> err<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span> <span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>,</span>
  <span class="token keyword" data-v-47862caa>function</span> <span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token punctuation" data-v-47862caa>{</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'done'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span> <span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>,</span>
<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
  <span class="token comment" data-v-47862caa>/*

&quot;next h&quot;
&quot;next e&quot;
&quot;next l,l&quot;
&quot;done&quot;
  */</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa><span class="line-number" data-v-47862caa>10</span><br data-v-47862caa><span class="line-number" data-v-47862caa>11</span><br data-v-47862caa><span class="line-number" data-v-47862caa>12</span><br data-v-47862caa><span class="line-number" data-v-47862caa>13</span><br data-v-47862caa><span class="line-number" data-v-47862caa>14</span><br data-v-47862caa><span class="line-number" data-v-47862caa>15</span><br data-v-47862caa><span class="line-number" data-v-47862caa>16</span><br data-v-47862caa><span class="line-number" data-v-47862caa>17</span><br data-v-47862caa><span class="line-number" data-v-47862caa>18</span><br data-v-47862caa><span class="line-number" data-v-47862caa>19</span><br data-v-47862caa><span class="line-number" data-v-47862caa>20</span><br data-v-47862caa><span class="line-number" data-v-47862caa>21</span><br data-v-47862caa><span class="line-number" data-v-47862caa>22</span><br data-v-47862caa><span class="line-number" data-v-47862caa>23</span><br data-v-47862caa><span class="line-number" data-v-47862caa>24</span><br data-v-47862caa><span class="line-number" data-v-47862caa>25</span><br data-v-47862caa></div></div><ul data-v-47862caa><li data-v-47862caa>bufferToggle(open: Observable, () =&gt; close: Observalbe : Observalbe&lt;T[]&gt;)
bufferToggle有两个参数，第一个是open observate，第二个是返回一个observate以关闭的函数。</li></ul> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>const</span> source$ <span class="token operator" data-v-47862caa>=</span> Rx<span class="token punctuation" data-v-47862caa>.</span>Observable<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>interval</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>500</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> open$ <span class="token operator" data-v-47862caa>=</span> Rx<span class="token punctuation" data-v-47862caa>.</span>Observable<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>interval</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1500</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> close$ <span class="token operator" data-v-47862caa>=</span> Rx<span class="token punctuation" data-v-47862caa>.</span>Observable<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>interval</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1000</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>/**
---0---1---2---3---4---5---6---7---8---9----....    (source)
-----------1-----------2-----------3--------...      (open)
           --- ----x   --- ----x   ---- ---x...      (close)
        bufferToggle(open$, () =&gt; close$)
------------------([2,3])-----([5.6])-----([8,9])--...
*/</span>
<span class="token keyword" data-v-47862caa>const</span> foo$ <span class="token operator" data-v-47862caa>=</span> source$<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>bufferToggle</span><span class="token punctuation" data-v-47862caa>(</span>open$<span class="token punctuation" data-v-47862caa>,</span> <span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token punctuation" data-v-47862caa>{</span>
  <span class="token keyword" data-v-47862caa>return</span> close$<span class="token punctuation" data-v-47862caa>;</span>
<span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
foo$<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>
  <span class="token punctuation" data-v-47862caa>(</span>x<span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>debug</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>&quot;Next: &quot;</span> <span class="token operator" data-v-47862caa>+</span> x<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
  <span class="token punctuation" data-v-47862caa>(</span>err<span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>error</span><span class="token punctuation" data-v-47862caa>(</span>err<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
  <span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>info</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>&quot;DONE&quot;</span><span class="token punctuation" data-v-47862caa>)</span>
<span class="token punctuation" data-v-47862caa>)</span>
<span class="token comment" data-v-47862caa>/*
&quot;Next: 2,3&quot;
&quot;Next: 5,6&quot;
&quot;Next: 8,9&quot;
&quot;Next: 11,12&quot;
...
*/</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa><span class="line-number" data-v-47862caa>10</span><br data-v-47862caa><span class="line-number" data-v-47862caa>11</span><br data-v-47862caa><span class="line-number" data-v-47862caa>12</span><br data-v-47862caa><span class="line-number" data-v-47862caa>13</span><br data-v-47862caa><span class="line-number" data-v-47862caa>14</span><br data-v-47862caa><span class="line-number" data-v-47862caa>15</span><br data-v-47862caa><span class="line-number" data-v-47862caa>16</span><br data-v-47862caa><span class="line-number" data-v-47862caa>17</span><br data-v-47862caa><span class="line-number" data-v-47862caa>18</span><br data-v-47862caa><span class="line-number" data-v-47862caa>19</span><br data-v-47862caa><span class="line-number" data-v-47862caa>20</span><br data-v-47862caa><span class="line-number" data-v-47862caa>21</span><br data-v-47862caa><span class="line-number" data-v-47862caa>22</span><br data-v-47862caa><span class="line-number" data-v-47862caa>23</span><br data-v-47862caa><span class="line-number" data-v-47862caa>24</span><br data-v-47862caa><span class="line-number" data-v-47862caa>25</span><br data-v-47862caa></div></div><ul data-v-47862caa><li data-v-47862caa>bufferWhen（closingSelector） 将数据缓存至数组，关闭 Observable 重新开启新缓存区
--closingSelector（function）：该函数不接受参数，返回缓冲区数据，关闭 Observable</li></ul> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token comment" data-v-47862caa>//示例一：</span>
<span class="token function" data-v-47862caa>fromEvent</span><span class="token punctuation" data-v-47862caa>(</span>document<span class="token punctuation" data-v-47862caa>,</span> <span class="token string" data-v-47862caa>'click'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>bufferWhen</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token function" data-v-47862caa>interval</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1000</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>e <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span>e<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span>
<span class="token comment" data-v-47862caa>//示例二：</span>
<span class="token keyword" data-v-47862caa>const</span> source$ <span class="token operator" data-v-47862caa>=</span> Rx<span class="token punctuation" data-v-47862caa>.</span>Observable<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>interval</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>500</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> close$ <span class="token operator" data-v-47862caa>=</span> Rx<span class="token punctuation" data-v-47862caa>.</span>Observable<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>interval</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1000</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>/**
---0---1---2---3---4---5---6---7---8---9----....    (source)
-------0-------1-------2-------3-------4---....     (close)
        bufferWhen(()=&gt;close$)
-------(0)-----([1,2])-([3,4])-([5,6])--......  
*/</span>
<span class="token keyword" data-v-47862caa>const</span> foo$ <span class="token operator" data-v-47862caa>=</span> source$<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>bufferWhen</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> close$<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
foo$<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>
  <span class="token punctuation" data-v-47862caa>(</span>x<span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>debug</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>&quot;Next: &quot;</span> <span class="token operator" data-v-47862caa>+</span> x<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
  <span class="token punctuation" data-v-47862caa>(</span>err<span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>error</span><span class="token punctuation" data-v-47862caa>(</span>err<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
  <span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>info</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>&quot;DONE&quot;</span><span class="token punctuation" data-v-47862caa>)</span>
<span class="token punctuation" data-v-47862caa>)</span>
<span class="token comment" data-v-47862caa>/*
&quot;Next: 0&quot;
&quot;Next: 1,2&quot;
&quot;Next: 3,4&quot;
&quot;Next: 5,6&quot;
&quot;Next: 7,8&quot;
...
*/</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa><span class="line-number" data-v-47862caa>10</span><br data-v-47862caa><span class="line-number" data-v-47862caa>11</span><br data-v-47862caa><span class="line-number" data-v-47862caa>12</span><br data-v-47862caa><span class="line-number" data-v-47862caa>13</span><br data-v-47862caa><span class="line-number" data-v-47862caa>14</span><br data-v-47862caa><span class="line-number" data-v-47862caa>15</span><br data-v-47862caa><span class="line-number" data-v-47862caa>16</span><br data-v-47862caa><span class="line-number" data-v-47862caa>17</span><br data-v-47862caa><span class="line-number" data-v-47862caa>18</span><br data-v-47862caa><span class="line-number" data-v-47862caa>19</span><br data-v-47862caa><span class="line-number" data-v-47862caa>20</span><br data-v-47862caa><span class="line-number" data-v-47862caa>21</span><br data-v-47862caa><span class="line-number" data-v-47862caa>22</span><br data-v-47862caa><span class="line-number" data-v-47862caa>23</span><br data-v-47862caa><span class="line-number" data-v-47862caa>24</span><br data-v-47862caa><span class="line-number" data-v-47862caa>25</span><br data-v-47862caa></div></div><ul data-v-47862caa><li data-v-47862caa>pluck   迭代 observable 的每一个嵌套属性</li></ul> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>of</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>{</span>name<span class="token operator" data-v-47862caa>:</span><span class="token number" data-v-47862caa>1</span><span class="token punctuation" data-v-47862caa>,</span>age<span class="token operator" data-v-47862caa>:</span><span class="token number" data-v-47862caa>11</span><span class="token punctuation" data-v-47862caa>,</span>arr<span class="token operator" data-v-47862caa>:</span><span class="token punctuation" data-v-47862caa>[</span><span class="token number" data-v-47862caa>111</span><span class="token punctuation" data-v-47862caa>,</span><span class="token number" data-v-47862caa>222</span><span class="token punctuation" data-v-47862caa>,</span><span class="token number" data-v-47862caa>333</span><span class="token punctuation" data-v-47862caa>]</span><span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>,</span><span class="token punctuation" data-v-47862caa>{</span>name<span class="token operator" data-v-47862caa>:</span><span class="token number" data-v-47862caa>2</span><span class="token punctuation" data-v-47862caa>,</span>age<span class="token operator" data-v-47862caa>:</span><span class="token number" data-v-47862caa>22</span><span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>,</span><span class="token punctuation" data-v-47862caa>{</span>name<span class="token operator" data-v-47862caa>:</span><span class="token number" data-v-47862caa>3</span><span class="token punctuation" data-v-47862caa>,</span>age<span class="token operator" data-v-47862caa>:</span><span class="token number" data-v-47862caa>33</span><span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>)</span>
<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span>
<span class="token function" data-v-47862caa>pluck</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'arr'</span><span class="token punctuation" data-v-47862caa>,</span><span class="token number" data-v-47862caa>0</span><span class="token punctuation" data-v-47862caa>)</span>
<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>x <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span>x<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span>
<span class="token comment" data-v-47862caa>// 输出</span>
<span class="token number" data-v-47862caa>111</span> ，<span class="token keyword" data-v-47862caa>undefined</span> ，<span class="token keyword" data-v-47862caa>undefined</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa></div></div><ul data-v-47862caa><li data-v-47862caa>pairwise 将当前值和前一个值作为数组放在一起后将其发出（没有前一个值不返回）</li></ul> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>of</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1</span><span class="token punctuation" data-v-47862caa>,</span><span class="token number" data-v-47862caa>2</span><span class="token punctuation" data-v-47862caa>,</span><span class="token number" data-v-47862caa>3</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>pairwise</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>x <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span>x<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span>
<span class="token comment" data-v-47862caa>// 输出</span>
<span class="token punctuation" data-v-47862caa>[</span><span class="token number" data-v-47862caa>1</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>2</span><span class="token punctuation" data-v-47862caa>]</span>，<span class="token punctuation" data-v-47862caa>[</span><span class="token number" data-v-47862caa>2</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>3</span><span class="token punctuation" data-v-47862caa>]</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa></div></div><ul data-v-47862caa><li data-v-47862caa>expand(project: function, concurrent: number, scheduler: Scheduler): Observable 递归调用提供的函数</li></ul> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token comment" data-v-47862caa>// RxJS v6+</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> interval<span class="token punctuation" data-v-47862caa>,</span> <span class="token keyword" data-v-47862caa>of</span> <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> expand<span class="token punctuation" data-v-47862caa>,</span> take <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs/operators'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>// 发出 2</span>
<span class="token keyword" data-v-47862caa>const</span> source <span class="token operator" data-v-47862caa>=</span> <span class="token keyword" data-v-47862caa>of</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>2</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> example <span class="token operator" data-v-47862caa>=</span> source<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span>
  <span class="token comment" data-v-47862caa>// 递归调用提供的函数</span>
  <span class="token function" data-v-47862caa>expand</span><span class="token punctuation" data-v-47862caa>(</span>val <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token punctuation" data-v-47862caa>{</span>
    <span class="token comment" data-v-47862caa>// 2,3,4,5,6</span>
    <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token template-string" data-v-47862caa><span class="token template-punctuation string" data-v-47862caa>`</span><span class="token string" data-v-47862caa>Passed value: </span><span class="token interpolation" data-v-47862caa><span class="token interpolation-punctuation punctuation" data-v-47862caa>${</span>val<span class="token interpolation-punctuation punctuation" data-v-47862caa>}</span></span><span class="token template-punctuation string" data-v-47862caa>`</span></span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
    <span class="token comment" data-v-47862caa>// 3,4,5,6</span>
    <span class="token keyword" data-v-47862caa>return</span> <span class="token keyword" data-v-47862caa>of</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1</span> <span class="token operator" data-v-47862caa>+</span> val<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
  <span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
  <span class="token comment" data-v-47862caa>// 用5次</span>
  <span class="token function" data-v-47862caa>take</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>5</span><span class="token punctuation" data-v-47862caa>)</span>
<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>/*
    &quot;RESULT: 2&quot;
    &quot;Passed value: 2&quot;
    &quot;RESULT: 3&quot;
    &quot;Passed value: 3&quot;
    &quot;RESULT: 4&quot;
    &quot;Passed value: 4&quot;
    &quot;RESULT: 5&quot;
    &quot;Passed value: 5&quot;
    &quot;RESULT: 6&quot;
    &quot;Passed value: 6&quot;
*/</span>
<span class="token comment" data-v-47862caa>// 输出: 2,3,4,5,6</span>
<span class="token keyword" data-v-47862caa>const</span> subscribe <span class="token operator" data-v-47862caa>=</span> example<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>val <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token template-string" data-v-47862caa><span class="token template-punctuation string" data-v-47862caa>`</span><span class="token string" data-v-47862caa>RESULT: </span><span class="token interpolation" data-v-47862caa><span class="token interpolation-punctuation punctuation" data-v-47862caa>${</span>val<span class="token interpolation-punctuation punctuation" data-v-47862caa>}</span></span><span class="token template-punctuation string" data-v-47862caa>`</span></span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa><span class="line-number" data-v-47862caa>10</span><br data-v-47862caa><span class="line-number" data-v-47862caa>11</span><br data-v-47862caa><span class="line-number" data-v-47862caa>12</span><br data-v-47862caa><span class="line-number" data-v-47862caa>13</span><br data-v-47862caa><span class="line-number" data-v-47862caa>14</span><br data-v-47862caa><span class="line-number" data-v-47862caa>15</span><br data-v-47862caa><span class="line-number" data-v-47862caa>16</span><br data-v-47862caa><span class="line-number" data-v-47862caa>17</span><br data-v-47862caa><span class="line-number" data-v-47862caa>18</span><br data-v-47862caa><span class="line-number" data-v-47862caa>19</span><br data-v-47862caa><span class="line-number" data-v-47862caa>20</span><br data-v-47862caa><span class="line-number" data-v-47862caa>21</span><br data-v-47862caa><span class="line-number" data-v-47862caa>22</span><br data-v-47862caa><span class="line-number" data-v-47862caa>23</span><br data-v-47862caa><span class="line-number" data-v-47862caa>24</span><br data-v-47862caa><span class="line-number" data-v-47862caa>25</span><br data-v-47862caa><span class="line-number" data-v-47862caa>26</span><br data-v-47862caa><span class="line-number" data-v-47862caa>27</span><br data-v-47862caa><span class="line-number" data-v-47862caa>28</span><br data-v-47862caa><span class="line-number" data-v-47862caa>29</span><br data-v-47862caa><span class="line-number" data-v-47862caa>30</span><br data-v-47862caa></div></div><ul data-v-47862caa><li data-v-47862caa>map 时间和空间维度映射(如果map一个流，则是组合操作，（即时流或永久流）映射可以忽略时间维度，后面有详细时间维度的案例，这是理解流和流操作的基础)
通常我们不是map一个流的时候就是转换操作</li></ul> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> combineLatest<span class="token punctuation" data-v-47862caa>,</span> <span class="token keyword" data-v-47862caa>of</span> <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> map<span class="token punctuation" data-v-47862caa>,</span> tap <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs/operators'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> weight <span class="token operator" data-v-47862caa>=</span> <span class="token keyword" data-v-47862caa>of</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>70</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>72</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>76</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>79</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>75</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> height <span class="token operator" data-v-47862caa>=</span> <span class="token keyword" data-v-47862caa>of</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1.76</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>1.77</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>1.78</span><span class="token punctuation" data-v-47862caa>,</span><span class="token number" data-v-47862caa>1.8</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> bmi <span class="token operator" data-v-47862caa>=</span> <span class="token function" data-v-47862caa>combineLatest</span><span class="token punctuation" data-v-47862caa>(</span>weight<span class="token punctuation" data-v-47862caa>,</span> height<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span>
  <span class="token function" data-v-47862caa>tap</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>[</span>w<span class="token punctuation" data-v-47862caa>,</span>h<span class="token punctuation" data-v-47862caa>]</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token punctuation" data-v-47862caa>{</span>
      <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token template-string" data-v-47862caa><span class="token template-punctuation string" data-v-47862caa>`</span><span class="token string" data-v-47862caa>w:</span><span class="token interpolation" data-v-47862caa><span class="token interpolation-punctuation punctuation" data-v-47862caa>${</span>w<span class="token interpolation-punctuation punctuation" data-v-47862caa>}</span></span><span class="token string" data-v-47862caa>,h:</span><span class="token interpolation" data-v-47862caa><span class="token interpolation-punctuation punctuation" data-v-47862caa>${</span>h<span class="token interpolation-punctuation punctuation" data-v-47862caa>}</span></span><span class="token template-punctuation string" data-v-47862caa>`</span></span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
  <span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
  <span class="token function" data-v-47862caa>map</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>[</span>w<span class="token punctuation" data-v-47862caa>,</span> h<span class="token punctuation" data-v-47862caa>]</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> w <span class="token operator" data-v-47862caa>/</span> <span class="token punctuation" data-v-47862caa>(</span>h <span class="token operator" data-v-47862caa>*</span> h<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
bmi<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>x <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'BMI is '</span> <span class="token operator" data-v-47862caa>+</span> x<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>// With output to console:</span>
w<span class="token operator" data-v-47862caa>:</span><span class="token number" data-v-47862caa>75</span><span class="token punctuation" data-v-47862caa>,</span>h<span class="token operator" data-v-47862caa>:</span><span class="token number" data-v-47862caa>1.76</span>
<span class="token constant" data-v-47862caa>BMI</span> <span class="token keyword" data-v-47862caa>is</span> <span class="token number" data-v-47862caa>24.212293388429753</span>
w<span class="token operator" data-v-47862caa>:</span><span class="token number" data-v-47862caa>75</span><span class="token punctuation" data-v-47862caa>,</span>h<span class="token operator" data-v-47862caa>:</span><span class="token number" data-v-47862caa>1.77</span>
<span class="token constant" data-v-47862caa>BMI</span> <span class="token keyword" data-v-47862caa>is</span> <span class="token number" data-v-47862caa>23.93948099205209</span>
w<span class="token operator" data-v-47862caa>:</span><span class="token number" data-v-47862caa>75</span><span class="token punctuation" data-v-47862caa>,</span>h<span class="token operator" data-v-47862caa>:</span><span class="token number" data-v-47862caa>1.78</span>
<span class="token constant" data-v-47862caa>BMI</span> <span class="token keyword" data-v-47862caa>is</span> <span class="token number" data-v-47862caa>23.671253629592222</span>
w<span class="token operator" data-v-47862caa>:</span><span class="token number" data-v-47862caa>75</span><span class="token punctuation" data-v-47862caa>,</span>h<span class="token operator" data-v-47862caa>:</span><span class="token number" data-v-47862caa>1.8</span>
<span class="token constant" data-v-47862caa>BMI</span> <span class="token keyword" data-v-47862caa>is</span> <span class="token number" data-v-47862caa>23.148148148148145</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa><span class="line-number" data-v-47862caa>10</span><br data-v-47862caa><span class="line-number" data-v-47862caa>11</span><br data-v-47862caa><span class="line-number" data-v-47862caa>12</span><br data-v-47862caa><span class="line-number" data-v-47862caa>13</span><br data-v-47862caa><span class="line-number" data-v-47862caa>14</span><br data-v-47862caa><span class="line-number" data-v-47862caa>15</span><br data-v-47862caa><span class="line-number" data-v-47862caa>16</span><br data-v-47862caa><span class="line-number" data-v-47862caa>17</span><br data-v-47862caa><span class="line-number" data-v-47862caa>18</span><br data-v-47862caa><span class="line-number" data-v-47862caa>19</span><br data-v-47862caa><span class="line-number" data-v-47862caa>20</span><br data-v-47862caa></div></div><ul data-v-47862caa><li data-v-47862caa>mapTo 修改值</li></ul> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> fromEvent <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> mapTo <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs/operators'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> clicks <span class="token operator" data-v-47862caa>=</span> <span class="token function" data-v-47862caa>fromEvent</span><span class="token punctuation" data-v-47862caa>(</span>document<span class="token punctuation" data-v-47862caa>,</span> <span class="token string" data-v-47862caa>'click'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> greetings <span class="token operator" data-v-47862caa>=</span> clicks<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>mapTo</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'Hi'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
greetings<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>x <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span>x<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa></div></div><h2 id="过滤" data-v-47862caa><a href="#过滤" class="header-anchor" data-v-47862caa>#</a> 过滤</h2> <ul data-v-47862caa><li data-v-47862caa>filter 该操作符就是用来过滤掉某些不符合要求的事件</li></ul> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa>Observable<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>of</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>2</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>30</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>22</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>5</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>60</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>3</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>40</span> <span class="token punctuation" data-v-47862caa>,</span><span class="token number" data-v-47862caa>9</span><span class="token punctuation" data-v-47862caa>)</span>
    <span class="token punctuation" data-v-47862caa>.</span>filter <span class="token punctuation" data-v-47862caa>{</span>
        $<span class="token number" data-v-47862caa>0</span> <span class="token operator" data-v-47862caa>&gt;</span> <span class="token number" data-v-47862caa>10</span>
    <span class="token punctuation" data-v-47862caa>}</span>
    <span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>onNext<span class="token operator" data-v-47862caa>:</span> <span class="token punctuation" data-v-47862caa>{</span> <span class="token function" data-v-47862caa>print</span><span class="token punctuation" data-v-47862caa>(</span>$<span class="token number" data-v-47862caa>0</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>)</span>
    <span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>disposed</span><span class="token punctuation" data-v-47862caa>(</span>by<span class="token operator" data-v-47862caa>:</span> disposeBag<span class="token punctuation" data-v-47862caa>)</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa></div></div><ul data-v-47862caa><li data-v-47862caa>distinctUntilChanged 该操作符用于过滤掉连续重复的事件</li></ul> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa>Observable<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>of</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>2</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>3</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>1</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>1</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>4</span><span class="token punctuation" data-v-47862caa>)</span>
    <span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>distinctUntilChanged</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span>
    <span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>onNext<span class="token operator" data-v-47862caa>:</span> <span class="token punctuation" data-v-47862caa>{</span> <span class="token function" data-v-47862caa>print</span><span class="token punctuation" data-v-47862caa>(</span>$<span class="token number" data-v-47862caa>0</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>)</span>
    <span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>disposed</span><span class="token punctuation" data-v-47862caa>(</span>by<span class="token operator" data-v-47862caa>:</span> disposeBag<span class="token punctuation" data-v-47862caa>)</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa></div></div><ul data-v-47862caa><li data-v-47862caa>single</li></ul> <p data-v-47862caa>限制只发送一次事件，或者满足条件的第一个事件，如果存在有多个事件或者没有事件都会发出一个 error 事件，如果只有一个事件，则不会发出 error 事件，如果没有满足数据则返回undefined。</p> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token comment" data-v-47862caa>// 发出“错误”</span>
 <span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> range <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs'</span><span class="token punctuation" data-v-47862caa>;</span>
 <span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> single <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs/operators'</span><span class="token punctuation" data-v-47862caa>;</span>
 <span class="token keyword" data-v-47862caa>const</span> numbers <span class="token operator" data-v-47862caa>=</span> <span class="token function" data-v-47862caa>range</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1</span><span class="token punctuation" data-v-47862caa>,</span><span class="token number" data-v-47862caa>5</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>single</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
 numbers<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>x <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'never get called'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span> e <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'error'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
 <span class="token comment" data-v-47862caa>// result</span>
 <span class="token comment" data-v-47862caa>// 'error'</span>

<span class="token comment" data-v-47862caa>// 发出'undefined'</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> range <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> single <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs/operators'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> numbers <span class="token operator" data-v-47862caa>=</span> <span class="token function" data-v-47862caa>range</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1</span><span class="token punctuation" data-v-47862caa>,</span><span class="token number" data-v-47862caa>5</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>single</span><span class="token punctuation" data-v-47862caa>(</span>x <span class="token operator" data-v-47862caa>=&gt;</span> x <span class="token operator" data-v-47862caa>===</span> <span class="token number" data-v-47862caa>10</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
numbers<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>x <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span>x<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>// result</span>
<span class="token comment" data-v-47862caa>// 'undefined'</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa><span class="line-number" data-v-47862caa>10</span><br data-v-47862caa><span class="line-number" data-v-47862caa>11</span><br data-v-47862caa><span class="line-number" data-v-47862caa>12</span><br data-v-47862caa><span class="line-number" data-v-47862caa>13</span><br data-v-47862caa><span class="line-number" data-v-47862caa>14</span><br data-v-47862caa><span class="line-number" data-v-47862caa>15</span><br data-v-47862caa></div></div><ul data-v-47862caa><li data-v-47862caa>elementAt 该操作符实现只处理在指定位置的事件</li></ul> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> fromEvent <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> elementAt <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs/operators'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> clicks <span class="token operator" data-v-47862caa>=</span> <span class="token function" data-v-47862caa>fromEvent</span><span class="token punctuation" data-v-47862caa>(</span>document<span class="token punctuation" data-v-47862caa>,</span> <span class="token string" data-v-47862caa>'click'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> result <span class="token operator" data-v-47862caa>=</span> clicks<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>elementAt</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>2</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
result<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>x <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span>x<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>// Results in:</span>
<span class="token comment" data-v-47862caa>// click 1 = nothing</span>
<span class="token comment" data-v-47862caa>// click 2 = nothing</span>
<span class="token comment" data-v-47862caa>// click 3 = MouseEvent object logged to console</span>
Observable<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>of</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>2</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>3</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>4</span><span class="token punctuation" data-v-47862caa>)</span>
    <span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>elementAt</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>2</span><span class="token punctuation" data-v-47862caa>)</span>
    <span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>onNext<span class="token operator" data-v-47862caa>:</span> <span class="token punctuation" data-v-47862caa>{</span> <span class="token function" data-v-47862caa>print</span><span class="token punctuation" data-v-47862caa>(</span>$<span class="token number" data-v-47862caa>0</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>)</span>
    <span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>disposed</span><span class="token punctuation" data-v-47862caa>(</span>by<span class="token operator" data-v-47862caa>:</span> disposeBag<span class="token punctuation" data-v-47862caa>)</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa><span class="line-number" data-v-47862caa>10</span><br data-v-47862caa><span class="line-number" data-v-47862caa>11</span><br data-v-47862caa><span class="line-number" data-v-47862caa>12</span><br data-v-47862caa><span class="line-number" data-v-47862caa>13</span><br data-v-47862caa></div></div><ul data-v-47862caa><li data-v-47862caa>ignoreElements
该操作符可以忽略掉所有的元素，只发出 error 或 completed 事件
如果我们并不关心 Observable 的任何元素，只想知道 Observable 在什么时候终止，那就可以使用 ignoreElements 操作符</li></ul> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa>Observable<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>of</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>2</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>3</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>4</span><span class="token punctuation" data-v-47862caa>)</span>
    <span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>ignoreElements</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span>
    <span class="token punctuation" data-v-47862caa>.</span>subscribe<span class="token punctuation" data-v-47862caa>{</span>
        <span class="token function" data-v-47862caa>print</span><span class="token punctuation" data-v-47862caa>(</span>$<span class="token number" data-v-47862caa>0</span><span class="token punctuation" data-v-47862caa>)</span>
    <span class="token punctuation" data-v-47862caa>}</span>
    <span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>disposed</span><span class="token punctuation" data-v-47862caa>(</span>by<span class="token operator" data-v-47862caa>:</span> disposeBag<span class="token punctuation" data-v-47862caa>)</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa></div></div><ul data-v-47862caa><li data-v-47862caa>take 该方法实现仅发送 Observable 序列中的前 n 个事件，在满足数量之后会自动completed</li></ul> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa>Observable<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>of</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>2</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>3</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>4</span><span class="token punctuation" data-v-47862caa>)</span>
    <span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>take</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>2</span><span class="token punctuation" data-v-47862caa>)</span>
    <span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>onNext<span class="token operator" data-v-47862caa>:</span> <span class="token punctuation" data-v-47862caa>{</span> <span class="token function" data-v-47862caa>print</span><span class="token punctuation" data-v-47862caa>(</span>$<span class="token number" data-v-47862caa>0</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>)</span>
    <span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>disposed</span><span class="token punctuation" data-v-47862caa>(</span>by<span class="token operator" data-v-47862caa>:</span> disposeBag<span class="token punctuation" data-v-47862caa>)</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa></div></div><ul data-v-47862caa><li data-v-47862caa>takeLast 该方法实现仅发送 Observable 序列中的后 n 个事件</li></ul> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa>Observable<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>of</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>2</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>3</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>4</span><span class="token punctuation" data-v-47862caa>)</span>
    <span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>takeLast</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1</span><span class="token punctuation" data-v-47862caa>)</span>
    <span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>onNext<span class="token operator" data-v-47862caa>:</span> <span class="token punctuation" data-v-47862caa>{</span> <span class="token function" data-v-47862caa>print</span><span class="token punctuation" data-v-47862caa>(</span>$<span class="token number" data-v-47862caa>0</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>)</span>
    <span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>disposed</span><span class="token punctuation" data-v-47862caa>(</span>by<span class="token operator" data-v-47862caa>:</span> disposeBag<span class="token punctuation" data-v-47862caa>)</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa></div></div><ul data-v-47862caa><li data-v-47862caa>skip 该方法用于跳过源 Observable 序列发出的前 n 个事件</li></ul> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa>Observable<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>of</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>2</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>3</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>4</span><span class="token punctuation" data-v-47862caa>)</span>
    <span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>skip</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>2</span><span class="token punctuation" data-v-47862caa>)</span>
    <span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>onNext<span class="token operator" data-v-47862caa>:</span> <span class="token punctuation" data-v-47862caa>{</span> <span class="token function" data-v-47862caa>print</span><span class="token punctuation" data-v-47862caa>(</span>$<span class="token number" data-v-47862caa>0</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>)</span>
    <span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>disposed</span><span class="token punctuation" data-v-47862caa>(</span>by<span class="token operator" data-v-47862caa>:</span> disposeBag<span class="token punctuation" data-v-47862caa>)</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa></div></div><ul data-v-47862caa><li data-v-47862caa>sample 采样被采样流最接近主流的数据发射</li></ul> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token comment" data-v-47862caa>// 每次点击时，请采样最近的“秒”计时器</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> fromEvent<span class="token punctuation" data-v-47862caa>,</span> interval <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> sample <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs/operators'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> seconds <span class="token operator" data-v-47862caa>=</span> <span class="token function" data-v-47862caa>interval</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1000</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> clicks <span class="token operator" data-v-47862caa>=</span> <span class="token function" data-v-47862caa>fromEvent</span><span class="token punctuation" data-v-47862caa>(</span>document<span class="token punctuation" data-v-47862caa>,</span> <span class="token string" data-v-47862caa>'click'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> result <span class="token operator" data-v-47862caa>=</span> seconds<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>sample</span><span class="token punctuation" data-v-47862caa>(</span>clicks<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
result<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>x <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span>x<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa></div></div><ul data-v-47862caa><li data-v-47862caa>debounce</li></ul> <p data-v-47862caa>队列中的元素如果和下一个元素的间隔小于了指定的时间间隔，那么这个元素将被过滤掉，但保证取最后一个事件触发</p> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> fromEvent<span class="token punctuation" data-v-47862caa>,</span> interval <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> debounce <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs/operators'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> clicks <span class="token operator" data-v-47862caa>=</span> <span class="token function" data-v-47862caa>fromEvent</span><span class="token punctuation" data-v-47862caa>(</span>document<span class="token punctuation" data-v-47862caa>,</span> <span class="token string" data-v-47862caa>'click'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> result <span class="token operator" data-v-47862caa>=</span> clicks<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>debounce</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token function" data-v-47862caa>interval</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1000</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
result<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>x <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span>x<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>// subscription.dispose();</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa></div></div><ul data-v-47862caa><li data-v-47862caa>debounceTime</li></ul> <p data-v-47862caa>假设a产生出来20ms后没有产生别的数据，订阅者可以得到a。b产生出来20ms内产生了新的数据c，b被忽略。c产生之后20ms内没有产生新数据，订阅者可以得到c</p> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token operator" data-v-47862caa>&lt;</span>script<span class="token operator" data-v-47862caa>&gt;</span>
  <span class="token keyword" data-v-47862caa>const</span> <span class="token punctuation" data-v-47862caa>{</span>fromEvent<span class="token punctuation" data-v-47862caa>}</span> <span class="token operator" data-v-47862caa>=</span> rxjs<span class="token punctuation" data-v-47862caa>;</span>
  <span class="token keyword" data-v-47862caa>const</span> <span class="token punctuation" data-v-47862caa>{</span>debounceTime <span class="token punctuation" data-v-47862caa>}</span> <span class="token operator" data-v-47862caa>=</span> rxjs<span class="token punctuation" data-v-47862caa>.</span>operators<span class="token punctuation" data-v-47862caa>;</span>
  <span class="token keyword" data-v-47862caa>const</span> clicks <span class="token operator" data-v-47862caa>=</span> <span class="token function" data-v-47862caa>fromEvent</span><span class="token punctuation" data-v-47862caa>(</span>document<span class="token punctuation" data-v-47862caa>,</span> <span class="token string" data-v-47862caa>'click'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
  <span class="token keyword" data-v-47862caa>const</span> result <span class="token operator" data-v-47862caa>=</span> clicks<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>debounceTime</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1000</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
  result<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>x <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span>x<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token operator" data-v-47862caa>&lt;</span><span class="token operator" data-v-47862caa>/</span>script<span class="token operator" data-v-47862caa>&gt;</span>
<span class="token comment" data-v-47862caa>// 不断的在页面上点击，如果某个点击之后的1000内没有新的点击，则该点击会被订阅到。</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa></div></div><ul data-v-47862caa><li data-v-47862caa>throttle 第一次会触发</li></ul> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token operator" data-v-47862caa>&lt;</span>div id<span class="token operator" data-v-47862caa>=</span><span class="token string" data-v-47862caa>&quot;aaa&quot;</span><span class="token operator" data-v-47862caa>&gt;</span><span class="token operator" data-v-47862caa>&lt;</span><span class="token operator" data-v-47862caa>/</span>div<span class="token operator" data-v-47862caa>&gt;</span>
<span class="token operator" data-v-47862caa>&lt;</span>div id<span class="token operator" data-v-47862caa>=</span><span class="token string" data-v-47862caa>&quot;bbb&quot;</span><span class="token operator" data-v-47862caa>&gt;</span><span class="token operator" data-v-47862caa>&lt;</span><span class="token operator" data-v-47862caa>/</span>div<span class="token operator" data-v-47862caa>&gt;</span>
<span class="token operator" data-v-47862caa>&lt;</span>script<span class="token operator" data-v-47862caa>&gt;</span>
  <span class="token keyword" data-v-47862caa>const</span> <span class="token punctuation" data-v-47862caa>{</span>fromEvent<span class="token punctuation" data-v-47862caa>}</span> <span class="token operator" data-v-47862caa>=</span> rxjs<span class="token punctuation" data-v-47862caa>;</span>
  <span class="token keyword" data-v-47862caa>const</span> <span class="token punctuation" data-v-47862caa>{</span>throttle<span class="token punctuation" data-v-47862caa>}</span> <span class="token operator" data-v-47862caa>=</span> rxjs<span class="token punctuation" data-v-47862caa>.</span>operators<span class="token punctuation" data-v-47862caa>;</span>
  <span class="token keyword" data-v-47862caa>const</span> clicksaaa <span class="token operator" data-v-47862caa>=</span> <span class="token function" data-v-47862caa>fromEvent</span><span class="token punctuation" data-v-47862caa>(</span>document<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>querySelector</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'#aaa'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token string" data-v-47862caa>'click'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
  <span class="token keyword" data-v-47862caa>const</span> clicksbbb <span class="token operator" data-v-47862caa>=</span> <span class="token function" data-v-47862caa>fromEvent</span><span class="token punctuation" data-v-47862caa>(</span>document<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>querySelector</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'#bbb'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token string" data-v-47862caa>'click'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
  <span class="token keyword" data-v-47862caa>const</span> result <span class="token operator" data-v-47862caa>=</span> clicksaaa<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>throttle</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> clicksbbb<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
  result<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>x <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span>x<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token operator" data-v-47862caa>&lt;</span><span class="token operator" data-v-47862caa>/</span>script<span class="token operator" data-v-47862caa>&gt;</span>
<span class="token comment" data-v-47862caa>/*
1.开始的时候，内部timer是disabled状态,点击红色的div会有打印输出；之后内部timer变成enabled状态，接下来的点击被忽略。
2.但是当点击了蓝色的div之后，throttle里面的那个observable有了产出，内部timer又变成disabled状态。
重复1和2
*/</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa><span class="line-number" data-v-47862caa>10</span><br data-v-47862caa><span class="line-number" data-v-47862caa>11</span><br data-v-47862caa><span class="line-number" data-v-47862caa>12</span><br data-v-47862caa><span class="line-number" data-v-47862caa>13</span><br data-v-47862caa><span class="line-number" data-v-47862caa>14</span><br data-v-47862caa><span class="line-number" data-v-47862caa>15</span><br data-v-47862caa></div></div><center data-v-47862caa><img src="https://img-blog.csdnimg.cn/20190225184738214.gif" data-v-47862caa></center> <ul data-v-47862caa><li data-v-47862caa>throttleTime 发射第一个数据出来之后，之后发射的频率受duration影响，每次发射之后的duration时间之内不会发射出来新的数据</li></ul> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token operator" data-v-47862caa>&lt;</span>script<span class="token operator" data-v-47862caa>&gt;</span>
  <span class="token keyword" data-v-47862caa>const</span> <span class="token punctuation" data-v-47862caa>{</span>fromEvent<span class="token punctuation" data-v-47862caa>}</span> <span class="token operator" data-v-47862caa>=</span> rxjs<span class="token punctuation" data-v-47862caa>;</span>
  <span class="token keyword" data-v-47862caa>const</span> <span class="token punctuation" data-v-47862caa>{</span>throttleTime<span class="token punctuation" data-v-47862caa>}</span> <span class="token operator" data-v-47862caa>=</span> rxjs<span class="token punctuation" data-v-47862caa>.</span>operators<span class="token punctuation" data-v-47862caa>;</span>
  <span class="token keyword" data-v-47862caa>let</span> k <span class="token operator" data-v-47862caa>=</span> <span class="token number" data-v-47862caa>0</span><span class="token punctuation" data-v-47862caa>;</span>
  <span class="token keyword" data-v-47862caa>const</span> clicks <span class="token operator" data-v-47862caa>=</span> <span class="token function" data-v-47862caa>fromEvent</span><span class="token punctuation" data-v-47862caa>(</span>document<span class="token punctuation" data-v-47862caa>,</span> <span class="token string" data-v-47862caa>'click'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
  <span class="token keyword" data-v-47862caa>const</span> result <span class="token operator" data-v-47862caa>=</span> clicks<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>throttleTime</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1000</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
  result<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token punctuation" data-v-47862caa>{</span>
    <span class="token keyword" data-v-47862caa>const</span> i <span class="token operator" data-v-47862caa>=</span> Date<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>now</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
    <span class="token keyword" data-v-47862caa>if</span><span class="token punctuation" data-v-47862caa>(</span>k<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>{</span>
      <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span>i<span class="token operator" data-v-47862caa>-</span>k<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
    <span class="token punctuation" data-v-47862caa>}</span>
    k <span class="token operator" data-v-47862caa>=</span> i<span class="token punctuation" data-v-47862caa>;</span>
  <span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token operator" data-v-47862caa>&lt;</span><span class="token operator" data-v-47862caa>/</span>script<span class="token operator" data-v-47862caa>&gt;</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa><span class="line-number" data-v-47862caa>10</span><br data-v-47862caa><span class="line-number" data-v-47862caa>11</span><br data-v-47862caa><span class="line-number" data-v-47862caa>12</span><br data-v-47862caa><span class="line-number" data-v-47862caa>13</span><br data-v-47862caa><span class="line-number" data-v-47862caa>14</span><br data-v-47862caa></div></div><center data-v-47862caa><img src="https://img-blog.csdnimg.cn/20190225175947803.gif" data-v-47862caa></center> <ul data-v-47862caa><li data-v-47862caa>audit 与相似 throttle 第一次不会触发，只有主流出发后，从流再出发才开始触发</li></ul> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token comment" data-v-47862caa>// 以每秒最多一次点击的速度发出点击</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> fromEvent<span class="token punctuation" data-v-47862caa>,</span> interval <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> audit <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs/operators'</span>
<span class="token keyword" data-v-47862caa>const</span> clicks <span class="token operator" data-v-47862caa>=</span> <span class="token function" data-v-47862caa>fromEvent</span><span class="token punctuation" data-v-47862caa>(</span>document<span class="token punctuation" data-v-47862caa>,</span> <span class="token string" data-v-47862caa>'click'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> result <span class="token operator" data-v-47862caa>=</span> clicks<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>audit</span><span class="token punctuation" data-v-47862caa>(</span>ev <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token function" data-v-47862caa>interval</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1000</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
result<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>x <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span>x<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>

<span class="token comment" data-v-47862caa>// 示例二</span>
<span class="token operator" data-v-47862caa>&lt;</span>div id<span class="token operator" data-v-47862caa>=</span><span class="token string" data-v-47862caa>&quot;aaa&quot;</span><span class="token operator" data-v-47862caa>&gt;</span><span class="token operator" data-v-47862caa>&lt;</span><span class="token operator" data-v-47862caa>/</span>div<span class="token operator" data-v-47862caa>&gt;</span>
<span class="token operator" data-v-47862caa>&lt;</span>div id<span class="token operator" data-v-47862caa>=</span><span class="token string" data-v-47862caa>&quot;bbb&quot;</span><span class="token operator" data-v-47862caa>&gt;</span><span class="token operator" data-v-47862caa>&lt;</span><span class="token operator" data-v-47862caa>/</span>div<span class="token operator" data-v-47862caa>&gt;</span>
<span class="token operator" data-v-47862caa>&lt;</span>script<span class="token operator" data-v-47862caa>&gt;</span>
  <span class="token keyword" data-v-47862caa>const</span> <span class="token punctuation" data-v-47862caa>{</span>fromEvent<span class="token punctuation" data-v-47862caa>}</span> <span class="token operator" data-v-47862caa>=</span> rxjs<span class="token punctuation" data-v-47862caa>;</span>
  <span class="token keyword" data-v-47862caa>const</span> <span class="token punctuation" data-v-47862caa>{</span>audit<span class="token punctuation" data-v-47862caa>}</span> <span class="token operator" data-v-47862caa>=</span> rxjs<span class="token punctuation" data-v-47862caa>.</span>operators<span class="token punctuation" data-v-47862caa>;</span>
  <span class="token keyword" data-v-47862caa>const</span> clicksaaa <span class="token operator" data-v-47862caa>=</span> <span class="token function" data-v-47862caa>fromEvent</span><span class="token punctuation" data-v-47862caa>(</span>document<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>querySelector</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'#aaa'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token string" data-v-47862caa>'click'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
  <span class="token keyword" data-v-47862caa>const</span> clicksbbb <span class="token operator" data-v-47862caa>=</span> <span class="token function" data-v-47862caa>fromEvent</span><span class="token punctuation" data-v-47862caa>(</span>document<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>querySelector</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'#bbb'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token string" data-v-47862caa>'click'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
  <span class="token keyword" data-v-47862caa>const</span> result <span class="token operator" data-v-47862caa>=</span> clicksaaa<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>audit</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> clicksbbb<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
  result<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>x <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span>x<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token operator" data-v-47862caa>&lt;</span><span class="token operator" data-v-47862caa>/</span>script<span class="token operator" data-v-47862caa>&gt;</span>
<span class="token comment" data-v-47862caa>/*
1.开始的时候，内部timer是disabled状态；第一次点击红色的div的时候会激活内部timer到enabled状态；这个时候可以再点击红色div任意次数，可以看到到目前为止控制台还是没有输出。
2.但是当点击了蓝色的div之后，audit里面的内部timer又变成disabled状态，结果是最近的红色div的点击被输出到控制台
重复1和2
*/</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa><span class="line-number" data-v-47862caa>10</span><br data-v-47862caa><span class="line-number" data-v-47862caa>11</span><br data-v-47862caa><span class="line-number" data-v-47862caa>12</span><br data-v-47862caa><span class="line-number" data-v-47862caa>13</span><br data-v-47862caa><span class="line-number" data-v-47862caa>14</span><br data-v-47862caa><span class="line-number" data-v-47862caa>15</span><br data-v-47862caa><span class="line-number" data-v-47862caa>16</span><br data-v-47862caa><span class="line-number" data-v-47862caa>17</span><br data-v-47862caa><span class="line-number" data-v-47862caa>18</span><br data-v-47862caa><span class="line-number" data-v-47862caa>19</span><br data-v-47862caa><span class="line-number" data-v-47862caa>20</span><br data-v-47862caa><span class="line-number" data-v-47862caa>21</span><br data-v-47862caa><span class="line-number" data-v-47862caa>22</span><br data-v-47862caa><span class="line-number" data-v-47862caa>23</span><br data-v-47862caa></div></div><center data-v-47862caa><img src="https://img-blog.csdnimg.cn/20190227111234295.gif" data-v-47862caa></center> <ul data-v-47862caa><li data-v-47862caa>auditTime</li></ul> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token operator" data-v-47862caa>&lt;</span>script src<span class="token operator" data-v-47862caa>=</span><span class="token string" data-v-47862caa>&quot;https://cdn.bootcss.com/rxjs/6.4.0/rxjs.umd.min.js&quot;</span><span class="token operator" data-v-47862caa>&gt;</span><span class="token operator" data-v-47862caa>&lt;</span><span class="token operator" data-v-47862caa>/</span>script<span class="token operator" data-v-47862caa>&gt;</span>
<span class="token operator" data-v-47862caa>&lt;</span>script<span class="token operator" data-v-47862caa>&gt;</span>
  <span class="token keyword" data-v-47862caa>const</span> <span class="token punctuation" data-v-47862caa>{</span>fromEvent<span class="token punctuation" data-v-47862caa>,</span> interval<span class="token punctuation" data-v-47862caa>}</span> <span class="token operator" data-v-47862caa>=</span> rxjs<span class="token punctuation" data-v-47862caa>;</span>
  <span class="token keyword" data-v-47862caa>const</span> <span class="token punctuation" data-v-47862caa>{</span>auditTime<span class="token punctuation" data-v-47862caa>,</span> throttleTime<span class="token punctuation" data-v-47862caa>}</span> <span class="token operator" data-v-47862caa>=</span> rxjs<span class="token punctuation" data-v-47862caa>.</span>operators<span class="token punctuation" data-v-47862caa>;</span>
  <span class="token function" data-v-47862caa>interval</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>500</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>auditTime</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1000</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>x <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'auditTime'</span><span class="token punctuation" data-v-47862caa>,</span> x<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
  <span class="token function" data-v-47862caa>interval</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>500</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>throttleTime</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1000</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>x <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'throttleTime'</span><span class="token punctuation" data-v-47862caa>,</span> x<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token operator" data-v-47862caa>&lt;</span><span class="token operator" data-v-47862caa>/</span>script<span class="token operator" data-v-47862caa>&gt;</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa></div></div><center data-v-47862caa><img src="https://img-blog.csdnimg.cn/20190227105733660.gif" data-v-47862caa></center> <div class="custom-block tip" data-v-47862caa><p class="custom-block-title" data-v-47862caa>关于防抖和节流</p> <p data-v-47862caa>throttle函数用于限制函数触发的频率，每个delay时间间隔，最多只能执行函数一次。一个最常见的例子是在监听resize/scroll事件时，为了性能考虑，需要限制回调执行的频率，此时便会使用throttle函数进行限制。由throttle函数的定义可知，每个delay时间间隔，最多只能执行函数一次，所以需要有一个变量来记录上一个执行函数的时刻，再结合延迟时间和当前触发函数的时刻来判断当前是否可以执行函数。函数节流的实现有不同的思路，可以通过时间戳实现，也可以通过定时器实现。在设定的时间间隔内，函数最多只能被执行一次。同时，第一次触发时立即执行函数。最后一次触发也会执行。</p> <p data-v-47862caa>debounce函数同样可以减少函数触发的频率，但限制的方式有点不同。当函数触发时，使用一个定时器延迟执行操作。当函数被再次触发时，清除已设置的定时器，重新设置定时器。如果上一次的延迟操作还未执行，则会被清除。一个最常见的业务场景是监听onchange事件，根据用户输入进行搜索，获取远程数据。为避免多次ajax请求，使用debounce函数作为onchange的回调。</p> <p data-v-47862caa>函数防抖的情况下，函数将一直推迟执行，造成不会被执行的效果，但保证最后一次会执行。</p> <p data-v-47862caa>函数节流的情况下，函数将每个 n 秒执行一次，同时意味着触发点最开始和最后都会执行。</p> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>function</span> <span class="token function" data-v-47862caa>debounce</span><span class="token punctuation" data-v-47862caa>(</span>fn<span class="token punctuation" data-v-47862caa>,</span>delay<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>{</span>
    <span class="token keyword" data-v-47862caa>let</span> timer <span class="token operator" data-v-47862caa>=</span> <span class="token keyword" data-v-47862caa>null</span> <span class="token comment" data-v-47862caa>//借助闭包</span>
    <span class="token keyword" data-v-47862caa>return</span> <span class="token keyword" data-v-47862caa>function</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token punctuation" data-v-47862caa>{</span>
        <span class="token keyword" data-v-47862caa>if</span><span class="token punctuation" data-v-47862caa>(</span>timer<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>{</span>
            <span class="token function" data-v-47862caa>clearTimeout</span><span class="token punctuation" data-v-47862caa>(</span>timer<span class="token punctuation" data-v-47862caa>)</span> <span class="token comment" data-v-47862caa>//进入该分支语句，说明当前正在一个计时过程中，并且又触发了相同事件。所以要取消当前的计时，重新开始计时</span>
        <span class="token punctuation" data-v-47862caa>}</span>
       timer <span class="token operator" data-v-47862caa>=</span> <span class="token function" data-v-47862caa>setTimeout</span><span class="token punctuation" data-v-47862caa>(</span>fn<span class="token punctuation" data-v-47862caa>,</span>delay<span class="token punctuation" data-v-47862caa>)</span> <span class="token comment" data-v-47862caa>// 进入该分支说明当前并没有在计时，那么就开始一个计时</span>
    <span class="token punctuation" data-v-47862caa>}</span>
<span class="token punctuation" data-v-47862caa>}</span>
 <span class="token comment" data-v-47862caa>// 定时器实现</span>
<span class="token keyword" data-v-47862caa>function</span> <span class="token function" data-v-47862caa>throttle</span><span class="token punctuation" data-v-47862caa>(</span>func<span class="token punctuation" data-v-47862caa>,</span>delay<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>{</span>
      <span class="token keyword" data-v-47862caa>var</span> timer <span class="token operator" data-v-47862caa>=</span> <span class="token keyword" data-v-47862caa>null</span><span class="token punctuation" data-v-47862caa>;</span>
      <span class="token keyword" data-v-47862caa>return</span> <span class="token function" data-v-47862caa>funtion</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>{</span>
            <span class="token keyword" data-v-47862caa>var</span> context <span class="token operator" data-v-47862caa>=</span> <span class="token keyword" data-v-47862caa>this</span><span class="token punctuation" data-v-47862caa>;</span>
            <span class="token keyword" data-v-47862caa>var</span> args <span class="token operator" data-v-47862caa>=</span> arguments<span class="token punctuation" data-v-47862caa>;</span>
 <span class="token keyword" data-v-47862caa>if</span><span class="token punctuation" data-v-47862caa>(</span><span class="token operator" data-v-47862caa>!</span>timer<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>{</span>
           timer <span class="token operator" data-v-47862caa>=</span> <span class="token function" data-v-47862caa>setTimeout</span><span class="token punctuation" data-v-47862caa>(</span><span class="token keyword" data-v-47862caa>function</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>{</span>
                <span class="token function" data-v-47862caa>func</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>apply</span><span class="token punctuation" data-v-47862caa>(</span>context<span class="token punctuation" data-v-47862caa>,</span>args<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
                <span class="token function" data-v-47862caa>clearTimeout</span><span class="token punctuation" data-v-47862caa>(</span>timer<span class="token punctuation" data-v-47862caa>)</span>
                timer <span class="token operator" data-v-47862caa>=</span> <span class="token keyword" data-v-47862caa>null</span><span class="token punctuation" data-v-47862caa>;</span>
             <span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>,</span>delay<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
               <span class="token punctuation" data-v-47862caa>}</span>
        <span class="token punctuation" data-v-47862caa>}</span>
<span class="token punctuation" data-v-47862caa>}</span>
<span class="token comment" data-v-47862caa>// 时间戳实现</span>
<span class="token keyword" data-v-47862caa>function</span> <span class="token function" data-v-47862caa>throttle</span><span class="token punctuation" data-v-47862caa>(</span>func<span class="token punctuation" data-v-47862caa>,</span> delay<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>{</span>
    <span class="token keyword" data-v-47862caa>let</span> prev <span class="token operator" data-v-47862caa>=</span> <span class="token keyword" data-v-47862caa>new</span> <span class="token class-name" data-v-47862caa>Date</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
    <span class="token keyword" data-v-47862caa>return</span> <span class="token function" data-v-47862caa>funtion</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>{</span>
       <span class="token keyword" data-v-47862caa>let</span> contxt <span class="token operator" data-v-47862caa>=</span> <span class="token keyword" data-v-47862caa>this</span><span class="token punctuation" data-v-47862caa>;</span>
       <span class="token keyword" data-v-47862caa>let</span> args <span class="token operator" data-v-47862caa>=</span> arguments<span class="token punctuation" data-v-47862caa>;</span>
       <span class="token keyword" data-v-47862caa>let</span> now <span class="token operator" data-v-47862caa>=</span> <span class="token keyword" data-v-47862caa>new</span> <span class="token class-name" data-v-47862caa>Date</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
       <span class="token keyword" data-v-47862caa>if</span><span class="token punctuation" data-v-47862caa>(</span><span class="token keyword" data-v-47862caa>new</span><span class="token operator" data-v-47862caa>-</span>prev <span class="token operator" data-v-47862caa>&gt;=</span> delay<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>{</span>  <span class="token comment" data-v-47862caa>// 时间间隔大于delay就会触发</span>
           <span class="token function" data-v-47862caa>func</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>apply</span><span class="token punctuation" data-v-47862caa>(</span>contxt<span class="token punctuation" data-v-47862caa>,</span> args<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
           prev <span class="token operator" data-v-47862caa>=</span> <span class="token keyword" data-v-47862caa>new</span> <span class="token class-name" data-v-47862caa>Date</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
       <span class="token punctuation" data-v-47862caa>}</span>
   <span class="token punctuation" data-v-47862caa>}</span>
<span class="token punctuation" data-v-47862caa>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa><span class="line-number" data-v-47862caa>10</span><br data-v-47862caa><span class="line-number" data-v-47862caa>11</span><br data-v-47862caa><span class="line-number" data-v-47862caa>12</span><br data-v-47862caa><span class="line-number" data-v-47862caa>13</span><br data-v-47862caa><span class="line-number" data-v-47862caa>14</span><br data-v-47862caa><span class="line-number" data-v-47862caa>15</span><br data-v-47862caa><span class="line-number" data-v-47862caa>16</span><br data-v-47862caa><span class="line-number" data-v-47862caa>17</span><br data-v-47862caa><span class="line-number" data-v-47862caa>18</span><br data-v-47862caa><span class="line-number" data-v-47862caa>19</span><br data-v-47862caa><span class="line-number" data-v-47862caa>20</span><br data-v-47862caa><span class="line-number" data-v-47862caa>21</span><br data-v-47862caa><span class="line-number" data-v-47862caa>22</span><br data-v-47862caa><span class="line-number" data-v-47862caa>23</span><br data-v-47862caa><span class="line-number" data-v-47862caa>24</span><br data-v-47862caa><span class="line-number" data-v-47862caa>25</span><br data-v-47862caa><span class="line-number" data-v-47862caa>26</span><br data-v-47862caa><span class="line-number" data-v-47862caa>27</span><br data-v-47862caa><span class="line-number" data-v-47862caa>28</span><br data-v-47862caa><span class="line-number" data-v-47862caa>29</span><br data-v-47862caa><span class="line-number" data-v-47862caa>30</span><br data-v-47862caa><span class="line-number" data-v-47862caa>31</span><br data-v-47862caa><span class="line-number" data-v-47862caa>32</span><br data-v-47862caa><span class="line-number" data-v-47862caa>33</span><br data-v-47862caa><span class="line-number" data-v-47862caa>34</span><br data-v-47862caa><span class="line-number" data-v-47862caa>35</span><br data-v-47862caa><span class="line-number" data-v-47862caa>36</span><br data-v-47862caa><span class="line-number" data-v-47862caa>37</span><br data-v-47862caa></div></div></div> <h2 id="组合" data-v-47862caa><a href="#组合" class="header-anchor" data-v-47862caa>#</a> 组合</h2> <ul data-v-47862caa><li data-v-47862caa>race 返回，第一个Observable的反映的输出，然后结束</li></ul> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token comment" data-v-47862caa>//示例 1: 使用 4个 observables 进行 race</span>
<span class="token comment" data-v-47862caa>// RxJS v6+</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> mapTo <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs/operators'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> interval <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs/observable/interval'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> race <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs/observable/race'</span><span class="token punctuation" data-v-47862caa>;</span>

<span class="token comment" data-v-47862caa>// 接收第一个发出值的 observable</span>
<span class="token keyword" data-v-47862caa>const</span> example <span class="token operator" data-v-47862caa>=</span> <span class="token function" data-v-47862caa>race</span><span class="token punctuation" data-v-47862caa>(</span>
  <span class="token comment" data-v-47862caa>// 每1.5秒发出值</span>
  <span class="token function" data-v-47862caa>interval</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1500</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
  <span class="token comment" data-v-47862caa>// 每1秒发出值</span>
  <span class="token function" data-v-47862caa>interval</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1000</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>mapTo</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'1s won!'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
  <span class="token comment" data-v-47862caa>// 每2秒发出值</span>
  <span class="token function" data-v-47862caa>interval</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>2000</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
  <span class="token comment" data-v-47862caa>// 每2.5秒发出值</span>
  <span class="token function" data-v-47862caa>interval</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>2500</span><span class="token punctuation" data-v-47862caa>)</span>
<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>// 输出: &quot;1s won!&quot;...&quot;1s won!&quot;...etc</span>
<span class="token keyword" data-v-47862caa>const</span> subscribe <span class="token operator" data-v-47862caa>=</span> example<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>val <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span>val<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>

<span class="token comment" data-v-47862caa>// 示例 2: 使用 error 进行 race</span>
<span class="token comment" data-v-47862caa>// RxJS v6+</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> delay<span class="token punctuation" data-v-47862caa>,</span> map <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs/operators'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> <span class="token keyword" data-v-47862caa>of</span><span class="token punctuation" data-v-47862caa>,</span> race <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs'</span><span class="token punctuation" data-v-47862caa>;</span>

<span class="token comment" data-v-47862caa>// 抛出错误并忽略其他的 observables 。</span>
<span class="token keyword" data-v-47862caa>const</span> first <span class="token operator" data-v-47862caa>=</span> <span class="token keyword" data-v-47862caa>of</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'first'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span>
  <span class="token function" data-v-47862caa>delay</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>100</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
  <span class="token function" data-v-47862caa>map</span><span class="token punctuation" data-v-47862caa>(</span>_ <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token punctuation" data-v-47862caa>{</span>
    <span class="token keyword" data-v-47862caa>throw</span> <span class="token string" data-v-47862caa>'error'</span><span class="token punctuation" data-v-47862caa>;</span>
  <span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>)</span>
<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> second <span class="token operator" data-v-47862caa>=</span> <span class="token keyword" data-v-47862caa>of</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'second'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>delay</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>200</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> third <span class="token operator" data-v-47862caa>=</span> <span class="token keyword" data-v-47862caa>of</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'third'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>delay</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>300</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>// nothing logged</span>
<span class="token function" data-v-47862caa>race</span><span class="token punctuation" data-v-47862caa>(</span>first<span class="token punctuation" data-v-47862caa>,</span> second<span class="token punctuation" data-v-47862caa>,</span> third<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>val <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span>val<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa><span class="line-number" data-v-47862caa>10</span><br data-v-47862caa><span class="line-number" data-v-47862caa>11</span><br data-v-47862caa><span class="line-number" data-v-47862caa>12</span><br data-v-47862caa><span class="line-number" data-v-47862caa>13</span><br data-v-47862caa><span class="line-number" data-v-47862caa>14</span><br data-v-47862caa><span class="line-number" data-v-47862caa>15</span><br data-v-47862caa><span class="line-number" data-v-47862caa>16</span><br data-v-47862caa><span class="line-number" data-v-47862caa>17</span><br data-v-47862caa><span class="line-number" data-v-47862caa>18</span><br data-v-47862caa><span class="line-number" data-v-47862caa>19</span><br data-v-47862caa><span class="line-number" data-v-47862caa>20</span><br data-v-47862caa><span class="line-number" data-v-47862caa>21</span><br data-v-47862caa><span class="line-number" data-v-47862caa>22</span><br data-v-47862caa><span class="line-number" data-v-47862caa>23</span><br data-v-47862caa><span class="line-number" data-v-47862caa>24</span><br data-v-47862caa><span class="line-number" data-v-47862caa>25</span><br data-v-47862caa><span class="line-number" data-v-47862caa>26</span><br data-v-47862caa><span class="line-number" data-v-47862caa>27</span><br data-v-47862caa><span class="line-number" data-v-47862caa>28</span><br data-v-47862caa><span class="line-number" data-v-47862caa>29</span><br data-v-47862caa><span class="line-number" data-v-47862caa>30</span><br data-v-47862caa><span class="line-number" data-v-47862caa>31</span><br data-v-47862caa><span class="line-number" data-v-47862caa>32</span><br data-v-47862caa><span class="line-number" data-v-47862caa>33</span><br data-v-47862caa><span class="line-number" data-v-47862caa>34</span><br data-v-47862caa><span class="line-number" data-v-47862caa>35</span><br data-v-47862caa><span class="line-number" data-v-47862caa>36</span><br data-v-47862caa></div></div><ul data-v-47862caa><li data-v-47862caa>combineLatest
可以接收多个Observable，但最后一个参数一定是callback function，这个回调函数接收的参数个数和前边传入Observable一一对应，最后需要注意：一定至少有2个Observable送出新值的时候才会执行回调函数。</li></ul> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token comment" data-v-47862caa>/**
 * 取得各个observable 最后送出的值，再输出成一个值
 * combineLatest可以接收多个observable，最后一个参数是callback function，这个callback function接收的参数数量跟合并的observable数量相同
 * callback 都会依照合并的observable 数量来传入参数，如果我们合并了三个observable，callback 就会有三个参数，而不管合并几个observable 都会只会回传一个值。
 * source:      ----0----1----2|
 * newest:      --0--1--2--3--4--5|
 *          combineLatest(newest, (x, y) =&gt; x + y);
 * example:     ----01--23-4--(56)--7|
 */</span>
<span class="token keyword" data-v-47862caa>const</span> source <span class="token operator" data-v-47862caa>=</span> <span class="token function" data-v-47862caa>interval</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>500</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>take</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>3</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> newest <span class="token operator" data-v-47862caa>=</span> <span class="token function" data-v-47862caa>interval</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>300</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>take</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>6</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> combineLatestObservable <span class="token operator" data-v-47862caa>=</span> source<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>combineLatest</span><span class="token punctuation" data-v-47862caa>(</span>newest<span class="token punctuation" data-v-47862caa>,</span> <span class="token punctuation" data-v-47862caa>(</span>x<span class="token punctuation" data-v-47862caa>,</span> y<span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> x <span class="token operator" data-v-47862caa>+</span> y<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>this</span><span class="token punctuation" data-v-47862caa>.</span>combineLatestSubscription <span class="token operator" data-v-47862caa>=</span> combineLatestObservable<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>{</span>
    <span class="token function-variable function" data-v-47862caa>next</span><span class="token operator" data-v-47862caa>:</span> <span class="token punctuation" data-v-47862caa>(</span>value<span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token punctuation" data-v-47862caa>{</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'=====combineLatest操作符: '</span><span class="token punctuation" data-v-47862caa>,</span> value<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span> <span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>,</span>
    <span class="token function-variable function" data-v-47862caa>error</span><span class="token operator" data-v-47862caa>:</span> <span class="token punctuation" data-v-47862caa>(</span>err<span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token punctuation" data-v-47862caa>{</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'=====combineLatest操作符: Error: '</span><span class="token punctuation" data-v-47862caa>,</span> err<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span> <span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>,</span>
    <span class="token function-variable function" data-v-47862caa>complete</span><span class="token operator" data-v-47862caa>:</span> <span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token punctuation" data-v-47862caa>{</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'=====combineLatest操作符: complete!'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span> <span class="token punctuation" data-v-47862caa>}</span>
<span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa><span class="line-number" data-v-47862caa>10</span><br data-v-47862caa><span class="line-number" data-v-47862caa>11</span><br data-v-47862caa><span class="line-number" data-v-47862caa>12</span><br data-v-47862caa><span class="line-number" data-v-47862caa>13</span><br data-v-47862caa><span class="line-number" data-v-47862caa>14</span><br data-v-47862caa><span class="line-number" data-v-47862caa>15</span><br data-v-47862caa><span class="line-number" data-v-47862caa>16</span><br data-v-47862caa><span class="line-number" data-v-47862caa>17</span><br data-v-47862caa></div></div><p data-v-47862caa>从上边的例子，我们可以看到，newest送出0时，source此时没有送出值，因此不执行回调函数，当source送出0时，此时newest送出的最新值是之前的0，执行回调0+0=0，以此类推...</p> <ul data-v-47862caa><li data-v-47862caa>withLatestFrom</li></ul> <p data-v-47862caa>和combineLatest很像，唯一不同的是他多了一个主从关系，即只有主Observable送出新值的时候，才会执行callback function，其他情况下不会触发回调。</p> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token comment" data-v-47862caa>/**
 * 和combineLatest类似，但是withLatestFrom只有在主要的observable 送出新的值时，才会执行callback，附随的observable 只是在背景下运作
 * withLatestFrom 会在main 送出值的时候执行callback，但请注意如果main 送出值时some 之前没有送出过任何值callback 仍然不会执行！
 * callback 都会依照合并的observable 数量来传入参数，如果我们合并了三个observable，callback 就会有三个参数，而不管合并几个observable 都会只会回传一个值。
 * main:       ----h----e----l----l----o|
 * some:       --0--1--0--0--0--1|
 *         withLatestFrom(some, (x, y) =&gt; y === 1 ? x.toUpperCase() : x);
 * example:    ----h----e----l----L----O|
 */</span>
<span class="token keyword" data-v-47862caa>const</span> main <span class="token operator" data-v-47862caa>=</span> <span class="token function" data-v-47862caa>from</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'hello'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>zip</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>interval</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>500</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token punctuation" data-v-47862caa>(</span>x<span class="token punctuation" data-v-47862caa>,</span> y<span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> x<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> some <span class="token operator" data-v-47862caa>=</span> <span class="token function" data-v-47862caa>from</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>[</span><span class="token number" data-v-47862caa>0</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>1</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>0</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>0</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>0</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>1</span><span class="token punctuation" data-v-47862caa>]</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>zip</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>interval</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>300</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token punctuation" data-v-47862caa>(</span>x<span class="token punctuation" data-v-47862caa>,</span> y<span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> x<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> withLatestFromObservable <span class="token operator" data-v-47862caa>=</span> main<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>withLatestFrom</span><span class="token punctuation" data-v-47862caa>(</span>some<span class="token punctuation" data-v-47862caa>,</span> <span class="token punctuation" data-v-47862caa>(</span>x<span class="token punctuation" data-v-47862caa>,</span> y<span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> y <span class="token operator" data-v-47862caa>===</span> <span class="token number" data-v-47862caa>1</span> <span class="token operator" data-v-47862caa>?</span> x<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>toUpperCase</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>:</span> x<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>this</span><span class="token punctuation" data-v-47862caa>.</span>withLatestFromSubscription <span class="token operator" data-v-47862caa>=</span> withLatestFromObservable<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>{</span>
    <span class="token function-variable function" data-v-47862caa>next</span><span class="token operator" data-v-47862caa>:</span> <span class="token punctuation" data-v-47862caa>(</span>value<span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token punctuation" data-v-47862caa>{</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'=====withLatestFrom操作符: '</span><span class="token punctuation" data-v-47862caa>,</span> value<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span> <span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>,</span>
    <span class="token function-variable function" data-v-47862caa>error</span><span class="token operator" data-v-47862caa>:</span> <span class="token punctuation" data-v-47862caa>(</span>err<span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token punctuation" data-v-47862caa>{</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'=====withLatestFrom操作符: Error: '</span><span class="token punctuation" data-v-47862caa>,</span> err<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span> <span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>,</span>
    <span class="token function-variable function" data-v-47862caa>complete</span><span class="token operator" data-v-47862caa>:</span> <span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token punctuation" data-v-47862caa>{</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'=====withLatestFrom操作符: complete!'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span> <span class="token punctuation" data-v-47862caa>}</span>
<span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa><span class="line-number" data-v-47862caa>10</span><br data-v-47862caa><span class="line-number" data-v-47862caa>11</span><br data-v-47862caa><span class="line-number" data-v-47862caa>12</span><br data-v-47862caa><span class="line-number" data-v-47862caa>13</span><br data-v-47862caa><span class="line-number" data-v-47862caa>14</span><br data-v-47862caa><span class="line-number" data-v-47862caa>15</span><br data-v-47862caa><span class="line-number" data-v-47862caa>16</span><br data-v-47862caa><span class="line-number" data-v-47862caa>17</span><br data-v-47862caa></div></div><p data-v-47862caa>从上边的例子，我们可以观察到：main送出h时，some的最新值是上一次的0，0不等于1，所以原样输出main，即h。当main送出e时，some送出的新值是上一次0，0不等于1，所以原样输出main，即e。以此类推...</p> <ul data-v-47862caa><li data-v-47862caa>zip 会取每个Observable且按顺序传入callback function回调函数的参数中，简单的理解就是一一对应，成双成对。</li></ul> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token comment" data-v-47862caa>/**
 * 取每个observable 相同顺位的元素并传入callback，也就是说每个observable 的第n 个元素会一起被传入callback
 * zip 会把各个observable 相同顺位送出的值传入callback
 * zip 必须cache 住还没处理的元素，当我们两个observable 一个很快一个很慢时，就会cache 非常多的元素，等待比较慢的那个observable。这很有可能造成记忆体相关的问题！
 * callback 都会依照合并的observable 数量来传入参数，如果我们合并了三个observable，callback 就会有三个参数，而不管合并几个observable 都会只会回传一个值。
 * source:      ----0----1----2|
 * newest:      --0--1--2--3--4--5|
 *            zip(newest, (x, y) =&gt; x + y)
 * exaple:      ----0----2----4|
 */</span>
<span class="token keyword" data-v-47862caa>const</span> source <span class="token operator" data-v-47862caa>=</span> <span class="token function" data-v-47862caa>interval</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>500</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>take</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>3</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> newest <span class="token operator" data-v-47862caa>=</span> <span class="token function" data-v-47862caa>interval</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>300</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>take</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>6</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> zipObservable <span class="token operator" data-v-47862caa>=</span> source<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>zip</span><span class="token punctuation" data-v-47862caa>(</span>newest<span class="token punctuation" data-v-47862caa>,</span> <span class="token punctuation" data-v-47862caa>(</span>x<span class="token punctuation" data-v-47862caa>,</span> y<span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> x <span class="token operator" data-v-47862caa>+</span> y<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>this</span><span class="token punctuation" data-v-47862caa>.</span>zipSubscription <span class="token operator" data-v-47862caa>=</span> zipObservable<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>{</span>
    <span class="token function-variable function" data-v-47862caa>next</span><span class="token operator" data-v-47862caa>:</span> <span class="token punctuation" data-v-47862caa>(</span>value<span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token punctuation" data-v-47862caa>{</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'=====zip操作符: '</span><span class="token punctuation" data-v-47862caa>,</span> value<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span> <span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>,</span>
    <span class="token function-variable function" data-v-47862caa>error</span><span class="token operator" data-v-47862caa>:</span> <span class="token punctuation" data-v-47862caa>(</span>err<span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token punctuation" data-v-47862caa>{</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'=====zip操作符: Error: '</span><span class="token punctuation" data-v-47862caa>,</span> err<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span> <span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>,</span>
    <span class="token function-variable function" data-v-47862caa>complete</span><span class="token operator" data-v-47862caa>:</span> <span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token punctuation" data-v-47862caa>{</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'=====zip操作符: complete!'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span> <span class="token punctuation" data-v-47862caa>}</span>
<span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa><span class="line-number" data-v-47862caa>10</span><br data-v-47862caa><span class="line-number" data-v-47862caa>11</span><br data-v-47862caa><span class="line-number" data-v-47862caa>12</span><br data-v-47862caa><span class="line-number" data-v-47862caa>13</span><br data-v-47862caa><span class="line-number" data-v-47862caa>14</span><br data-v-47862caa><span class="line-number" data-v-47862caa>15</span><br data-v-47862caa><span class="line-number" data-v-47862caa>16</span><br data-v-47862caa><span class="line-number" data-v-47862caa>17</span><br data-v-47862caa><span class="line-number" data-v-47862caa>18</span><br data-v-47862caa></div></div><ul data-v-47862caa><li data-v-47862caa>forkJoin - 入参observabel数组,只取最终值，只发射一次,返回数组</li></ul> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>const</span> ob1 <span class="token operator" data-v-47862caa>=</span> Rx<span class="token punctuation" data-v-47862caa>.</span>Observable<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>interval</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1000</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>map</span><span class="token punctuation" data-v-47862caa>(</span>d <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token template-string" data-v-47862caa><span class="token template-punctuation string" data-v-47862caa>`</span><span class="token string" data-v-47862caa>ob1:</span><span class="token interpolation" data-v-47862caa><span class="token interpolation-punctuation punctuation" data-v-47862caa>${</span>d<span class="token interpolation-punctuation punctuation" data-v-47862caa>}</span></span><span class="token template-punctuation string" data-v-47862caa>`</span></span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>take</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>3</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> ob2 <span class="token operator" data-v-47862caa>=</span> Rx<span class="token punctuation" data-v-47862caa>.</span>Observable<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>interval</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>2000</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>map</span><span class="token punctuation" data-v-47862caa>(</span>d <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token template-string" data-v-47862caa><span class="token template-punctuation string" data-v-47862caa>`</span><span class="token string" data-v-47862caa>ob2:</span><span class="token interpolation" data-v-47862caa><span class="token interpolation-punctuation punctuation" data-v-47862caa>${</span>d<span class="token interpolation-punctuation punctuation" data-v-47862caa>}</span></span><span class="token template-punctuation string" data-v-47862caa>`</span></span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>take</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>2</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
Rx<span class="token punctuation" data-v-47862caa>.</span>Observable<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>forkJoin</span><span class="token punctuation" data-v-47862caa>(</span>ob1<span class="token punctuation" data-v-47862caa>,</span> ob2<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>(</span>data<span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span>data<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>// [&quot;ob1:2&quot;, &quot;ob2:1&quot;]</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa></div></div><ul data-v-47862caa><li data-v-47862caa>switch 切换流的操作，切换的时候，前一个流会被丢掉。</li></ul> <p data-v-47862caa>但是，单纯从一个流切换到另外一个流是没有意义的，需要将前一个流中的数据在切换时，要将它的数据传给下一个流中去使用。rxjs中的switchMap就是要做这样一件事，它接收一个函数，这个函数的参数是上一个流遗留下来的数据，而它需要返回一个新的流，这个流中你可以使用上一个流遗留下来的数据。</p> <ul data-v-47862caa><li data-v-47862caa>switchAll - 截断拍平 如果前一个流还没发射完，主流又开始发射，将忽略前一个流的发射，如果主流只发射一次，功能是切换流</li></ul> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> fromEvent<span class="token punctuation" data-v-47862caa>,</span> interval <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> switchAll<span class="token punctuation" data-v-47862caa>,</span> map<span class="token punctuation" data-v-47862caa>,</span> tap <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs/operators'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> clicks <span class="token operator" data-v-47862caa>=</span> <span class="token function" data-v-47862caa>fromEvent</span><span class="token punctuation" data-v-47862caa>(</span>document<span class="token punctuation" data-v-47862caa>,</span> <span class="token string" data-v-47862caa>'click'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>tap</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'click'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> source <span class="token operator" data-v-47862caa>=</span> clicks<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>map</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>(</span>ev<span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token function" data-v-47862caa>interval</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1000</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
source<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span>
  <span class="token function" data-v-47862caa>switchAll</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span>
<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>x <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span>x<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa></div></div><ul data-v-47862caa><li data-v-47862caa>concat - 串行队列形式发射</li></ul> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>const</span> <span class="token punctuation" data-v-47862caa>{</span> concat <span class="token punctuation" data-v-47862caa>}</span> <span class="token operator" data-v-47862caa>=</span> rxjs<span class="token punctuation" data-v-47862caa>.</span>operators<span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> <span class="token punctuation" data-v-47862caa>{</span> <span class="token keyword" data-v-47862caa>of</span> <span class="token punctuation" data-v-47862caa>}</span> <span class="token operator" data-v-47862caa>=</span> rxjs<span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> sourceOne <span class="token operator" data-v-47862caa>=</span> <span class="token keyword" data-v-47862caa>of</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>2</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>3</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> sourceTwo <span class="token operator" data-v-47862caa>=</span> <span class="token keyword" data-v-47862caa>of</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>4</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>5</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>6</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> sourceThree <span class="token operator" data-v-47862caa>=</span> <span class="token keyword" data-v-47862caa>of</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>7</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>8</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>// 先发出 sourceOne 的值，当完成时订阅 sourceTwo</span>
<span class="token comment" data-v-47862caa>// 输出: 1,2,3,4,5,6,7,8</span>
<span class="token comment" data-v-47862caa>// 特点： 必须先等前一个 observable 完成(complete)，才会继续下一个</span>
sourceOne
  <span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span>
    <span class="token function" data-v-47862caa>concat</span><span class="token punctuation" data-v-47862caa>(</span>sourceTwo<span class="token punctuation" data-v-47862caa>,</span> sourceThree<span class="token punctuation" data-v-47862caa>)</span>
  <span class="token punctuation" data-v-47862caa>)</span>
  <span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>val <span class="token operator" data-v-47862caa>=&gt;</span>
    <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'Example: Basic concat:'</span><span class="token punctuation" data-v-47862caa>,</span> val<span class="token punctuation" data-v-47862caa>)</span>
  <span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>//  等价写法， 把 concat 作为静态方法使用，这样更直观</span>
rxjs
  <span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>concat</span><span class="token punctuation" data-v-47862caa>(</span>sourceOne<span class="token punctuation" data-v-47862caa>,</span> sourceTwo<span class="token punctuation" data-v-47862caa>)</span>
  <span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>val <span class="token operator" data-v-47862caa>=&gt;</span>
    <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span>val<span class="token punctuation" data-v-47862caa>)</span>
  <span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa><span class="line-number" data-v-47862caa>10</span><br data-v-47862caa><span class="line-number" data-v-47862caa>11</span><br data-v-47862caa><span class="line-number" data-v-47862caa>12</span><br data-v-47862caa><span class="line-number" data-v-47862caa>13</span><br data-v-47862caa><span class="line-number" data-v-47862caa>14</span><br data-v-47862caa><span class="line-number" data-v-47862caa>15</span><br data-v-47862caa><span class="line-number" data-v-47862caa>16</span><br data-v-47862caa><span class="line-number" data-v-47862caa>17</span><br data-v-47862caa><span class="line-number" data-v-47862caa>18</span><br data-v-47862caa><span class="line-number" data-v-47862caa>19</span><br data-v-47862caa><span class="line-number" data-v-47862caa>20</span><br data-v-47862caa><span class="line-number" data-v-47862caa>21</span><br data-v-47862caa></div></div><ul data-v-47862caa><li data-v-47862caa>concatAll - 串行拍平发射</li></ul> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token comment" data-v-47862caa>// 我们每点击一次 body 就会立刻送出 1,2,3</span>
<span class="token function" data-v-47862caa>fromEvent</span><span class="token punctuation" data-v-47862caa>(</span>document<span class="token punctuation" data-v-47862caa>.</span>body<span class="token punctuation" data-v-47862caa>,</span> <span class="token string" data-v-47862caa>'click'</span><span class="token punctuation" data-v-47862caa>)</span>
  <span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span>
    <span class="token comment" data-v-47862caa>// 内部发出值是 observable 类型</span>
    <span class="token function" data-v-47862caa>map</span><span class="token punctuation" data-v-47862caa>(</span>e <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token keyword" data-v-47862caa>of</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1</span><span class="token punctuation" data-v-47862caa>,</span><span class="token number" data-v-47862caa>2</span><span class="token punctuation" data-v-47862caa>,</span><span class="token number" data-v-47862caa>3</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
    <span class="token comment" data-v-47862caa>// 取 observable 的值</span>
    <span class="token function" data-v-47862caa>concatAll</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
  <span class="token punctuation" data-v-47862caa>)</span>
  <span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>val <span class="token operator" data-v-47862caa>=&gt;</span>
    <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span>val<span class="token punctuation" data-v-47862caa>)</span>
  <span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa><span class="line-number" data-v-47862caa>10</span><br data-v-47862caa><span class="line-number" data-v-47862caa>11</span><br data-v-47862caa></div></div><ul data-v-47862caa><li data-v-47862caa>merge - 并行，先到先输出发射</li></ul> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token comment" data-v-47862caa>// 1.使用静态方法合并多个 observables</span>
<span class="token comment" data-v-47862caa>// RxJS v6+</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> mapTo <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs/operators'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> interval<span class="token punctuation" data-v-47862caa>,</span> merge <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>// 每2.5秒发出值</span>
<span class="token keyword" data-v-47862caa>const</span> first <span class="token operator" data-v-47862caa>=</span> <span class="token function" data-v-47862caa>interval</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>2500</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>// 每2秒发出值</span>
<span class="token keyword" data-v-47862caa>const</span> second <span class="token operator" data-v-47862caa>=</span> <span class="token function" data-v-47862caa>interval</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>2000</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>// 每1.5秒发出值</span>
<span class="token keyword" data-v-47862caa>const</span> third <span class="token operator" data-v-47862caa>=</span> <span class="token function" data-v-47862caa>interval</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1500</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>// 每1秒发出值</span>
<span class="token keyword" data-v-47862caa>const</span> fourth <span class="token operator" data-v-47862caa>=</span> <span class="token function" data-v-47862caa>interval</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1000</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>// 从一个 observable 中发出输出值</span>
<span class="token keyword" data-v-47862caa>const</span> example <span class="token operator" data-v-47862caa>=</span> <span class="token function" data-v-47862caa>merge</span><span class="token punctuation" data-v-47862caa>(</span>
  first<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>mapTo</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'FIRST!'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
  second<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>mapTo</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'SECOND!'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
  third<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>mapTo</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'THIRD'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
  fourth<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>mapTo</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'FOURTH'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span>
<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>// 输出: &quot;FOURTH&quot;, &quot;THIRD&quot;, &quot;SECOND!&quot;, &quot;FOURTH&quot;, &quot;FIRST!&quot;, &quot;THIRD&quot;, &quot;FOURTH&quot;</span>
<span class="token keyword" data-v-47862caa>const</span> subscribe <span class="token operator" data-v-47862caa>=</span> example<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>val <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span>val<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>// 2. 使用实例方法合并2个 observables</span>
<span class="token comment" data-v-47862caa>// RxJS v6+</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> merge <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs/operators'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> interval <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>// 每2.5秒发出值</span>
<span class="token keyword" data-v-47862caa>const</span> first <span class="token operator" data-v-47862caa>=</span> <span class="token function" data-v-47862caa>interval</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>2500</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>// 每1秒发出值</span>
<span class="token keyword" data-v-47862caa>const</span> second <span class="token operator" data-v-47862caa>=</span> <span class="token function" data-v-47862caa>interval</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1000</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>// 作为实例方法使用</span>
<span class="token keyword" data-v-47862caa>const</span> example <span class="token operator" data-v-47862caa>=</span> first<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>merge</span><span class="token punctuation" data-v-47862caa>(</span>second<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>// 输出: 0,1,0,2....</span>
<span class="token keyword" data-v-47862caa>const</span> subscribe <span class="token operator" data-v-47862caa>=</span> example<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>val <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span>val<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa><span class="line-number" data-v-47862caa>10</span><br data-v-47862caa><span class="line-number" data-v-47862caa>11</span><br data-v-47862caa><span class="line-number" data-v-47862caa>12</span><br data-v-47862caa><span class="line-number" data-v-47862caa>13</span><br data-v-47862caa><span class="line-number" data-v-47862caa>14</span><br data-v-47862caa><span class="line-number" data-v-47862caa>15</span><br data-v-47862caa><span class="line-number" data-v-47862caa>16</span><br data-v-47862caa><span class="line-number" data-v-47862caa>17</span><br data-v-47862caa><span class="line-number" data-v-47862caa>18</span><br data-v-47862caa><span class="line-number" data-v-47862caa>19</span><br data-v-47862caa><span class="line-number" data-v-47862caa>20</span><br data-v-47862caa><span class="line-number" data-v-47862caa>21</span><br data-v-47862caa><span class="line-number" data-v-47862caa>22</span><br data-v-47862caa><span class="line-number" data-v-47862caa>23</span><br data-v-47862caa><span class="line-number" data-v-47862caa>24</span><br data-v-47862caa><span class="line-number" data-v-47862caa>25</span><br data-v-47862caa><span class="line-number" data-v-47862caa>26</span><br data-v-47862caa><span class="line-number" data-v-47862caa>27</span><br data-v-47862caa><span class="line-number" data-v-47862caa>28</span><br data-v-47862caa><span class="line-number" data-v-47862caa>29</span><br data-v-47862caa><span class="line-number" data-v-47862caa>30</span><br data-v-47862caa><span class="line-number" data-v-47862caa>31</span><br data-v-47862caa><span class="line-number" data-v-47862caa>32</span><br data-v-47862caa><span class="line-number" data-v-47862caa>33</span><br data-v-47862caa></div></div><ul data-v-47862caa><li data-v-47862caa>mergeAll - 并行拍平发射</li></ul> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token comment" data-v-47862caa>// 1. 使用 promise 来进行 concatAll</span>
<span class="token comment" data-v-47862caa>// RxJS v6+</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> map<span class="token punctuation" data-v-47862caa>,</span> mergeAll <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs/operators'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> <span class="token keyword" data-v-47862caa>of</span> <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> <span class="token function-variable function" data-v-47862caa>myPromise</span> <span class="token operator" data-v-47862caa>=</span> val <span class="token operator" data-v-47862caa>=&gt;</span>
  <span class="token keyword" data-v-47862caa>new</span> <span class="token class-name" data-v-47862caa><span class="token builtin" data-v-47862caa>Promise</span></span><span class="token punctuation" data-v-47862caa>(</span>resolve <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token function" data-v-47862caa>setTimeout</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token function" data-v-47862caa>resolve</span><span class="token punctuation" data-v-47862caa>(</span><span class="token template-string" data-v-47862caa><span class="token template-punctuation string" data-v-47862caa>`</span><span class="token string" data-v-47862caa>Result: </span><span class="token interpolation" data-v-47862caa><span class="token interpolation-punctuation punctuation" data-v-47862caa>${</span>val<span class="token interpolation-punctuation punctuation" data-v-47862caa>}</span></span><span class="token template-punctuation string" data-v-47862caa>`</span></span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>2000</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>// 发出 1,2,3</span>
<span class="token keyword" data-v-47862caa>const</span> source <span class="token operator" data-v-47862caa>=</span> <span class="token keyword" data-v-47862caa>of</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>2</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>3</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> example <span class="token operator" data-v-47862caa>=</span> source<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span>
  <span class="token comment" data-v-47862caa>// 将每个值映射成 promise</span>
  <span class="token function" data-v-47862caa>map</span><span class="token punctuation" data-v-47862caa>(</span>val <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token function" data-v-47862caa>myPromise</span><span class="token punctuation" data-v-47862caa>(</span>val<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
  <span class="token comment" data-v-47862caa>// 发出 source 的结果</span>
  <span class="token function" data-v-47862caa>mergeAll</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span>
<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>/*
  输出:
  &quot;Result: 1&quot;
  &quot;Result: 2&quot;
  &quot;Result: 3&quot;
*/</span>
<span class="token keyword" data-v-47862caa>const</span> subscribe <span class="token operator" data-v-47862caa>=</span> example<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>val <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span>val<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>// 2. 使用并发的参数来进行 mergeAll</span>
<span class="token comment" data-v-47862caa>// RxJS v6+</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> take<span class="token punctuation" data-v-47862caa>,</span> map<span class="token punctuation" data-v-47862caa>,</span> delay<span class="token punctuation" data-v-47862caa>,</span> mergeAll <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs/operators'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> interval <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> source <span class="token operator" data-v-47862caa>=</span> <span class="token function" data-v-47862caa>interval</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>500</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>take</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>5</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>/*
  interval 每0.5秒发出一个值。这个值会被映射成延迟1秒的 interval 。mergeAll 操作符接收一个可选参数
  以决定在同一时间有多少个内部 observables 可以被订阅。其余的 observables 会先暂存以等待订阅。
*/</span>
<span class="token keyword" data-v-47862caa>const</span> example <span class="token operator" data-v-47862caa>=</span> source
  <span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span>
    <span class="token function" data-v-47862caa>map</span><span class="token punctuation" data-v-47862caa>(</span>val <span class="token operator" data-v-47862caa>=&gt;</span>
      source<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span>
        <span class="token function" data-v-47862caa>delay</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1000</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
        <span class="token function" data-v-47862caa>take</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>3</span><span class="token punctuation" data-v-47862caa>)</span>
      <span class="token punctuation" data-v-47862caa>)</span>
    <span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
    <span class="token function" data-v-47862caa>mergeAll</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>2</span><span class="token punctuation" data-v-47862caa>)</span>
  <span class="token punctuation" data-v-47862caa>)</span>
  <span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>val <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span>val<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>/*
  一旦操作符发出了所有值，则 subscription 完成。
*/</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa><span class="line-number" data-v-47862caa>10</span><br data-v-47862caa><span class="line-number" data-v-47862caa>11</span><br data-v-47862caa><span class="line-number" data-v-47862caa>12</span><br data-v-47862caa><span class="line-number" data-v-47862caa>13</span><br data-v-47862caa><span class="line-number" data-v-47862caa>14</span><br data-v-47862caa><span class="line-number" data-v-47862caa>15</span><br data-v-47862caa><span class="line-number" data-v-47862caa>16</span><br data-v-47862caa><span class="line-number" data-v-47862caa>17</span><br data-v-47862caa><span class="line-number" data-v-47862caa>18</span><br data-v-47862caa><span class="line-number" data-v-47862caa>19</span><br data-v-47862caa><span class="line-number" data-v-47862caa>20</span><br data-v-47862caa><span class="line-number" data-v-47862caa>21</span><br data-v-47862caa><span class="line-number" data-v-47862caa>22</span><br data-v-47862caa><span class="line-number" data-v-47862caa>23</span><br data-v-47862caa><span class="line-number" data-v-47862caa>24</span><br data-v-47862caa><span class="line-number" data-v-47862caa>25</span><br data-v-47862caa><span class="line-number" data-v-47862caa>26</span><br data-v-47862caa><span class="line-number" data-v-47862caa>27</span><br data-v-47862caa><span class="line-number" data-v-47862caa>28</span><br data-v-47862caa><span class="line-number" data-v-47862caa>29</span><br data-v-47862caa><span class="line-number" data-v-47862caa>30</span><br data-v-47862caa><span class="line-number" data-v-47862caa>31</span><br data-v-47862caa><span class="line-number" data-v-47862caa>32</span><br data-v-47862caa><span class="line-number" data-v-47862caa>33</span><br data-v-47862caa><span class="line-number" data-v-47862caa>34</span><br data-v-47862caa><span class="line-number" data-v-47862caa>35</span><br data-v-47862caa><span class="line-number" data-v-47862caa>36</span><br data-v-47862caa><span class="line-number" data-v-47862caa>37</span><br data-v-47862caa><span class="line-number" data-v-47862caa>38</span><br data-v-47862caa><span class="line-number" data-v-47862caa>39</span><br data-v-47862caa><span class="line-number" data-v-47862caa>40</span><br data-v-47862caa><span class="line-number" data-v-47862caa>41</span><br data-v-47862caa><span class="line-number" data-v-47862caa>42</span><br data-v-47862caa><span class="line-number" data-v-47862caa>43</span><br data-v-47862caa><span class="line-number" data-v-47862caa>44</span><br data-v-47862caa></div></div><ul data-v-47862caa><li data-v-47862caa>mergeScan 在源 Observable 上应用 accumulator 函数，其中 accumulator 函数本身返回 Observable ，然后每个返回的中间 Observable 会被合并到输出 Observable 中。</li></ul> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>const</span> button <span class="token operator" data-v-47862caa>=</span> document<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>querySelector</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'button'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
    <span class="token keyword" data-v-47862caa>const</span> click$ <span class="token operator" data-v-47862caa>=</span> <span class="token function" data-v-47862caa>fromEvent</span><span class="token punctuation" data-v-47862caa>(</span>button<span class="token punctuation" data-v-47862caa>,</span> <span class="token string" data-v-47862caa>'click'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
    <span class="token keyword" data-v-47862caa>const</span> seed <span class="token operator" data-v-47862caa>=</span> <span class="token number" data-v-47862caa>1</span><span class="token punctuation" data-v-47862caa>;</span> <span class="token comment" data-v-47862caa>// 初始的累加值。</span>
    <span class="token keyword" data-v-47862caa>const</span> <span class="token function-variable function" data-v-47862caa>fn</span> <span class="token operator" data-v-47862caa>=</span> <span class="token punctuation" data-v-47862caa>(</span>acc<span class="token punctuation" data-v-47862caa>,</span> one<span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token keyword" data-v-47862caa>of</span><span class="token punctuation" data-v-47862caa>(</span>acc <span class="token operator" data-v-47862caa>*</span> one<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span> <span class="token comment" data-v-47862caa>// 在每个源值上调用的累加器函数。</span>
    click$
    <span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span>
      <span class="token function" data-v-47862caa>mapTo</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>2</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
      <span class="token function" data-v-47862caa>mergeScan</span><span class="token punctuation" data-v-47862caa>(</span>fn<span class="token punctuation" data-v-47862caa>,</span> seed<span class="token punctuation" data-v-47862caa>)</span>
    <span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>x <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span>x<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>//点击button</span>
<span class="token number" data-v-47862caa>2</span>
<span class="token comment" data-v-47862caa>//点击button</span>
<span class="token number" data-v-47862caa>4</span>
<span class="token comment" data-v-47862caa>//点击button</span>
<span class="token number" data-v-47862caa>8</span>
<span class="token comment" data-v-47862caa>//点击button</span>
<span class="token number" data-v-47862caa>16</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa><span class="line-number" data-v-47862caa>10</span><br data-v-47862caa><span class="line-number" data-v-47862caa>11</span><br data-v-47862caa><span class="line-number" data-v-47862caa>12</span><br data-v-47862caa><span class="line-number" data-v-47862caa>13</span><br data-v-47862caa><span class="line-number" data-v-47862caa>14</span><br data-v-47862caa><span class="line-number" data-v-47862caa>15</span><br data-v-47862caa><span class="line-number" data-v-47862caa>16</span><br data-v-47862caa><span class="line-number" data-v-47862caa>17</span><br data-v-47862caa></div></div><ul data-v-47862caa><li data-v-47862caa>exhaust 订阅发出 Observable 的 Observable，也称为高阶 Observable , 实现拍平 如果前一个流还没发射完，主流又开始发射，将忽略主流的这次发射</li></ul> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token comment" data-v-47862caa>// 仅当当前没有活动的计时器时，才为每次点击进行输出。即从流如果还在发射，将忽略主流的发射。</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> fromEvent<span class="token punctuation" data-v-47862caa>,</span> interval <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> exhaust<span class="token punctuation" data-v-47862caa>,</span> map<span class="token punctuation" data-v-47862caa>,</span> take <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs/operators'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> clicks <span class="token operator" data-v-47862caa>=</span> <span class="token function" data-v-47862caa>fromEvent</span><span class="token punctuation" data-v-47862caa>(</span>document<span class="token punctuation" data-v-47862caa>,</span> <span class="token string" data-v-47862caa>'click'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> higherOrder <span class="token operator" data-v-47862caa>=</span> clicks<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span>
  <span class="token function" data-v-47862caa>map</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>(</span>ev<span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token function" data-v-47862caa>interval</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1000</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>take</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>5</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> result <span class="token operator" data-v-47862caa>=</span> higherOrder<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>exhaust</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
result<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>x <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span>x<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa></div></div><ul data-v-47862caa><li data-v-47862caa>mergeMap = map + mergeAll</li></ul> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> <span class="token keyword" data-v-47862caa>of</span><span class="token punctuation" data-v-47862caa>,</span> interval <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> mergeMap<span class="token punctuation" data-v-47862caa>,</span> map <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs/operators'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> letters <span class="token operator" data-v-47862caa>=</span> <span class="token keyword" data-v-47862caa>of</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'a'</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token string" data-v-47862caa>'b'</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token string" data-v-47862caa>'c'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> result <span class="token operator" data-v-47862caa>=</span> letters<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span>
  <span class="token function" data-v-47862caa>mergeMap</span><span class="token punctuation" data-v-47862caa>(</span>x <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token function" data-v-47862caa>interval</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1000</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>map</span><span class="token punctuation" data-v-47862caa>(</span>i <span class="token operator" data-v-47862caa>=&gt;</span> x<span class="token operator" data-v-47862caa>+</span>i<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
result<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>x <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span>x<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>//output</span>
a0
b0
c0
a1
b1
c1
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa><span class="line-number" data-v-47862caa>10</span><br data-v-47862caa><span class="line-number" data-v-47862caa>11</span><br data-v-47862caa><span class="line-number" data-v-47862caa>12</span><br data-v-47862caa><span class="line-number" data-v-47862caa>13</span><br data-v-47862caa><span class="line-number" data-v-47862caa>14</span><br data-v-47862caa></div></div><ul data-v-47862caa><li data-v-47862caa>concatMap = map + concatAll</li></ul> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> <span class="token keyword" data-v-47862caa>of</span> <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> concatMap<span class="token punctuation" data-v-47862caa>,</span> delay<span class="token punctuation" data-v-47862caa>,</span> mergeMap <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs/operators'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> source <span class="token operator" data-v-47862caa>=</span> <span class="token keyword" data-v-47862caa>of</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>2000</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>1000</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> example <span class="token operator" data-v-47862caa>=</span> source<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span>
  <span class="token function" data-v-47862caa>concatMap</span><span class="token punctuation" data-v-47862caa>(</span>val <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token keyword" data-v-47862caa>of</span><span class="token punctuation" data-v-47862caa>(</span><span class="token template-string" data-v-47862caa><span class="token template-punctuation string" data-v-47862caa>`</span><span class="token string" data-v-47862caa>Delayed by: </span><span class="token interpolation" data-v-47862caa><span class="token interpolation-punctuation punctuation" data-v-47862caa>${</span>val<span class="token interpolation-punctuation punctuation" data-v-47862caa>}</span></span><span class="token string" data-v-47862caa>ms</span><span class="token template-punctuation string" data-v-47862caa>`</span></span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>delay</span><span class="token punctuation" data-v-47862caa>(</span>val<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span>
<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> subscribe <span class="token operator" data-v-47862caa>=</span> example<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>val <span class="token operator" data-v-47862caa>=&gt;</span>
  <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token template-string" data-v-47862caa><span class="token template-punctuation string" data-v-47862caa>`</span><span class="token string" data-v-47862caa>With concatMap: </span><span class="token interpolation" data-v-47862caa><span class="token interpolation-punctuation punctuation" data-v-47862caa>${</span>val<span class="token interpolation-punctuation punctuation" data-v-47862caa>}</span></span><span class="token template-punctuation string" data-v-47862caa>`</span></span><span class="token punctuation" data-v-47862caa>)</span>
<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> mergeMapExample <span class="token operator" data-v-47862caa>=</span> source
  <span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span>
    <span class="token function" data-v-47862caa>delay</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>5000</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
    <span class="token function" data-v-47862caa>mergeMap</span><span class="token punctuation" data-v-47862caa>(</span>val <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token keyword" data-v-47862caa>of</span><span class="token punctuation" data-v-47862caa>(</span><span class="token template-string" data-v-47862caa><span class="token template-punctuation string" data-v-47862caa>`</span><span class="token string" data-v-47862caa>Delayed by: </span><span class="token interpolation" data-v-47862caa><span class="token interpolation-punctuation punctuation" data-v-47862caa>${</span>val<span class="token interpolation-punctuation punctuation" data-v-47862caa>}</span></span><span class="token string" data-v-47862caa>ms</span><span class="token template-punctuation string" data-v-47862caa>`</span></span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>delay</span><span class="token punctuation" data-v-47862caa>(</span>val<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span>
  <span class="token punctuation" data-v-47862caa>)</span>
  <span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>val <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token template-string" data-v-47862caa><span class="token template-punctuation string" data-v-47862caa>`</span><span class="token string" data-v-47862caa>With mergeMap: </span><span class="token interpolation" data-v-47862caa><span class="token interpolation-punctuation punctuation" data-v-47862caa>${</span>val<span class="token interpolation-punctuation punctuation" data-v-47862caa>}</span></span><span class="token template-punctuation string" data-v-47862caa>`</span></span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>//output</span>
<span class="token comment" data-v-47862caa>// With concatMap: Delayed by: 2000ms</span>
<span class="token comment" data-v-47862caa>// With concatMap: Delayed by: 1000ms</span>
<span class="token comment" data-v-47862caa>// With mergeMap: Delayed by: 1000ms  1s延迟短，提前输出</span>
<span class="token comment" data-v-47862caa>// With mergeMap: Delayed by: 2000ms</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa><span class="line-number" data-v-47862caa>10</span><br data-v-47862caa><span class="line-number" data-v-47862caa>11</span><br data-v-47862caa><span class="line-number" data-v-47862caa>12</span><br data-v-47862caa><span class="line-number" data-v-47862caa>13</span><br data-v-47862caa><span class="line-number" data-v-47862caa>14</span><br data-v-47862caa><span class="line-number" data-v-47862caa>15</span><br data-v-47862caa><span class="line-number" data-v-47862caa>16</span><br data-v-47862caa><span class="line-number" data-v-47862caa>17</span><br data-v-47862caa><span class="line-number" data-v-47862caa>18</span><br data-v-47862caa><span class="line-number" data-v-47862caa>19</span><br data-v-47862caa><span class="line-number" data-v-47862caa>20</span><br data-v-47862caa></div></div><ul data-v-47862caa><li data-v-47862caa>concatMapTo
接受的第一个参数和concatMap不同， 它直接接受一个数据流，并把这个数据流产生的数据直接抛给下游,它的第二个参数与concatMap相同</li></ul> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token comment" data-v-47862caa>// 直接把map的函数去掉即可</span>
<span class="token keyword" data-v-47862caa>const</span> example <span class="token operator" data-v-47862caa>=</span> source<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span>
  <span class="token function" data-v-47862caa>concatMapTo</span><span class="token punctuation" data-v-47862caa>(</span><span class="token keyword" data-v-47862caa>of</span><span class="token punctuation" data-v-47862caa>(</span><span class="token template-string" data-v-47862caa><span class="token template-punctuation string" data-v-47862caa>`</span><span class="token string" data-v-47862caa>Delayed by: 1000ms</span><span class="token template-punctuation string" data-v-47862caa>`</span></span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>delay</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1000</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span>
<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> subscribe <span class="token operator" data-v-47862caa>=</span> example<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>val <span class="token operator" data-v-47862caa>=&gt;</span>
  <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token template-string" data-v-47862caa><span class="token template-punctuation string" data-v-47862caa>`</span><span class="token string" data-v-47862caa>With concatMap: </span><span class="token interpolation" data-v-47862caa><span class="token interpolation-punctuation punctuation" data-v-47862caa>${</span>val<span class="token interpolation-punctuation punctuation" data-v-47862caa>}</span></span><span class="token template-punctuation string" data-v-47862caa>`</span></span><span class="token punctuation" data-v-47862caa>)</span>
<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa></div></div><ul data-v-47862caa><li data-v-47862caa>switchMap = map + switchAll</li></ul> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> timer<span class="token punctuation" data-v-47862caa>,</span> interval<span class="token punctuation" data-v-47862caa>,</span> <span class="token keyword" data-v-47862caa>of</span> <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> switchMap<span class="token punctuation" data-v-47862caa>,</span> tap <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs/operators'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>&quot;time 0....&quot;</span><span class="token punctuation" data-v-47862caa>,</span><span class="token keyword" data-v-47862caa>new</span> <span class="token class-name" data-v-47862caa>Date</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>toLocaleTimeString</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token function" data-v-47862caa>timer</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1000</span><span class="token punctuation" data-v-47862caa>,</span><span class="token number" data-v-47862caa>4000</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span> <span class="token comment" data-v-47862caa>//延迟一段时间，产生自增的整数</span>
 <span class="token function" data-v-47862caa>tap</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token punctuation" data-v-47862caa>{</span>
     <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>&quot;time 1....&quot;</span><span class="token punctuation" data-v-47862caa>,</span><span class="token keyword" data-v-47862caa>new</span> <span class="token class-name" data-v-47862caa>Date</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>toLocaleTimeString</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
 <span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
 <span class="token function" data-v-47862caa>switchMap</span><span class="token punctuation" data-v-47862caa>(</span>
    _ <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token function" data-v-47862caa>interval</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1000</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>tap</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>(</span>rs<span class="token punctuation" data-v-47862caa>)</span><span class="token operator" data-v-47862caa>=&gt;</span> <span class="token punctuation" data-v-47862caa>{</span><span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'inner value....'</span><span class="token punctuation" data-v-47862caa>,</span>rs<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token comment" data-v-47862caa>//特定间隔，产生递增整数 </span>
    <span class="token punctuation" data-v-47862caa>(</span>outerValue<span class="token punctuation" data-v-47862caa>,</span> innerValue<span class="token punctuation" data-v-47862caa>,</span> outerIndex<span class="token punctuation" data-v-47862caa>,</span> innerIndex<span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>{</span>
      outerValue<span class="token punctuation" data-v-47862caa>,</span>
      innerValue<span class="token punctuation" data-v-47862caa>,</span>
      outerIndex<span class="token punctuation" data-v-47862caa>,</span>
      innerIndex
    <span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>)</span>
  <span class="token punctuation" data-v-47862caa>)</span>
 <span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>(</span>res<span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token punctuation" data-v-47862caa>{</span>
    <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>&quot;final res....&quot;</span><span class="token punctuation" data-v-47862caa>,</span>res<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>//output</span>
time <span class="token number" data-v-47862caa>0.</span><span class="token operator" data-v-47862caa>...</span> <span class="token number" data-v-47862caa>5</span><span class="token operator" data-v-47862caa>:</span><span class="token number" data-v-47862caa>21</span><span class="token operator" data-v-47862caa>:</span><span class="token number" data-v-47862caa>59</span> <span class="token constant" data-v-47862caa>PM</span>
time <span class="token number" data-v-47862caa>1.</span><span class="token operator" data-v-47862caa>...</span> <span class="token number" data-v-47862caa>5</span><span class="token operator" data-v-47862caa>:</span><span class="token number" data-v-47862caa>22</span><span class="token operator" data-v-47862caa>:</span><span class="token number" data-v-47862caa>00</span> <span class="token constant" data-v-47862caa>PM</span>
inner value<span class="token operator" data-v-47862caa>...</span><span class="token punctuation" data-v-47862caa>.</span> <span class="token number" data-v-47862caa>0</span>
final res<span class="token operator" data-v-47862caa>...</span><span class="token punctuation" data-v-47862caa>.</span> <span class="token punctuation" data-v-47862caa>{</span> outerValue<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>0</span><span class="token punctuation" data-v-47862caa>,</span> innerValue<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>0</span><span class="token punctuation" data-v-47862caa>,</span> outerIndex<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>0</span><span class="token punctuation" data-v-47862caa>,</span> innerIndex<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>0</span> <span class="token punctuation" data-v-47862caa>}</span>
inner value<span class="token operator" data-v-47862caa>...</span><span class="token punctuation" data-v-47862caa>.</span> <span class="token number" data-v-47862caa>1</span>
final res<span class="token operator" data-v-47862caa>...</span><span class="token punctuation" data-v-47862caa>.</span> <span class="token punctuation" data-v-47862caa>{</span> outerValue<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>0</span><span class="token punctuation" data-v-47862caa>,</span> innerValue<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>1</span><span class="token punctuation" data-v-47862caa>,</span> outerIndex<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>0</span><span class="token punctuation" data-v-47862caa>,</span> innerIndex<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>1</span> <span class="token punctuation" data-v-47862caa>}</span>
inner value<span class="token operator" data-v-47862caa>...</span><span class="token punctuation" data-v-47862caa>.</span> <span class="token number" data-v-47862caa>2</span>
final res<span class="token operator" data-v-47862caa>...</span><span class="token punctuation" data-v-47862caa>.</span> <span class="token punctuation" data-v-47862caa>{</span> outerValue<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>0</span><span class="token punctuation" data-v-47862caa>,</span> innerValue<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>2</span><span class="token punctuation" data-v-47862caa>,</span> outerIndex<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>0</span><span class="token punctuation" data-v-47862caa>,</span> innerIndex<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>2</span> <span class="token punctuation" data-v-47862caa>}</span>
time <span class="token number" data-v-47862caa>1.</span><span class="token operator" data-v-47862caa>...</span> <span class="token number" data-v-47862caa>5</span><span class="token operator" data-v-47862caa>:</span><span class="token number" data-v-47862caa>22</span><span class="token operator" data-v-47862caa>:</span><span class="token number" data-v-47862caa>04</span> <span class="token constant" data-v-47862caa>PM</span>
inner value<span class="token operator" data-v-47862caa>...</span><span class="token punctuation" data-v-47862caa>.</span> <span class="token number" data-v-47862caa>0</span>
final res<span class="token operator" data-v-47862caa>...</span><span class="token punctuation" data-v-47862caa>.</span> <span class="token punctuation" data-v-47862caa>{</span> outerValue<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>1</span><span class="token punctuation" data-v-47862caa>,</span> innerValue<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>0</span><span class="token punctuation" data-v-47862caa>,</span> outerIndex<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>1</span><span class="token punctuation" data-v-47862caa>,</span> innerIndex<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>0</span> <span class="token punctuation" data-v-47862caa>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa><span class="line-number" data-v-47862caa>10</span><br data-v-47862caa><span class="line-number" data-v-47862caa>11</span><br data-v-47862caa><span class="line-number" data-v-47862caa>12</span><br data-v-47862caa><span class="line-number" data-v-47862caa>13</span><br data-v-47862caa><span class="line-number" data-v-47862caa>14</span><br data-v-47862caa><span class="line-number" data-v-47862caa>15</span><br data-v-47862caa><span class="line-number" data-v-47862caa>16</span><br data-v-47862caa><span class="line-number" data-v-47862caa>17</span><br data-v-47862caa><span class="line-number" data-v-47862caa>18</span><br data-v-47862caa><span class="line-number" data-v-47862caa>19</span><br data-v-47862caa><span class="line-number" data-v-47862caa>20</span><br data-v-47862caa><span class="line-number" data-v-47862caa>21</span><br data-v-47862caa><span class="line-number" data-v-47862caa>22</span><br data-v-47862caa><span class="line-number" data-v-47862caa>23</span><br data-v-47862caa><span class="line-number" data-v-47862caa>24</span><br data-v-47862caa><span class="line-number" data-v-47862caa>25</span><br data-v-47862caa><span class="line-number" data-v-47862caa>26</span><br data-v-47862caa><span class="line-number" data-v-47862caa>27</span><br data-v-47862caa><span class="line-number" data-v-47862caa>28</span><br data-v-47862caa><span class="line-number" data-v-47862caa>29</span><br data-v-47862caa><span class="line-number" data-v-47862caa>30</span><br data-v-47862caa><span class="line-number" data-v-47862caa>31</span><br data-v-47862caa></div></div><ul data-v-47862caa><li data-v-47862caa>exhaustMap = map + exhaust</li></ul> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> interval <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> exhaustMap<span class="token punctuation" data-v-47862caa>,</span> tap<span class="token punctuation" data-v-47862caa>,</span> take <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs/operators'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> firstInterval <span class="token operator" data-v-47862caa>=</span> <span class="token function" data-v-47862caa>interval</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1000</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>take</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>10</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> secondInterval <span class="token operator" data-v-47862caa>=</span> <span class="token function" data-v-47862caa>interval</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1000</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>take</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>2</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> exhaustSub <span class="token operator" data-v-47862caa>=</span> firstInterval
  <span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span>
    <span class="token function" data-v-47862caa>exhaustMap</span><span class="token punctuation" data-v-47862caa>(</span>f <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token punctuation" data-v-47862caa>{</span>
      <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token template-string" data-v-47862caa><span class="token template-punctuation string" data-v-47862caa>`</span><span class="token string" data-v-47862caa>Emission Corrected of first interval: </span><span class="token interpolation" data-v-47862caa><span class="token interpolation-punctuation punctuation" data-v-47862caa>${</span>f<span class="token interpolation-punctuation punctuation" data-v-47862caa>}</span></span><span class="token template-punctuation string" data-v-47862caa>`</span></span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
      <span class="token keyword" data-v-47862caa>return</span> secondInterval<span class="token punctuation" data-v-47862caa>;</span> <span class="token comment" data-v-47862caa>//激活第二个，会忽略第一个</span>
    <span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>)</span>
  <span class="token punctuation" data-v-47862caa>)</span>
  <span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>val <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span>val<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>//output</span>
Emission Corrected <span class="token keyword" data-v-47862caa>of</span> first interval<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>0</span>
<span class="token number" data-v-47862caa>0</span>
<span class="token number" data-v-47862caa>1</span>
Emission Corrected <span class="token keyword" data-v-47862caa>of</span> first interval<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>2</span>
<span class="token number" data-v-47862caa>0</span>
<span class="token number" data-v-47862caa>1</span>
Emission Corrected <span class="token keyword" data-v-47862caa>of</span> first interval<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>4</span>
<span class="token number" data-v-47862caa>0</span>
<span class="token number" data-v-47862caa>1</span>
Emission Corrected <span class="token keyword" data-v-47862caa>of</span> first interval<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>6</span>
<span class="token number" data-v-47862caa>0</span>
<span class="token number" data-v-47862caa>1</span>
Emission Corrected <span class="token keyword" data-v-47862caa>of</span> first interval<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>8</span>
<span class="token number" data-v-47862caa>0</span>
<span class="token number" data-v-47862caa>1</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa><span class="line-number" data-v-47862caa>10</span><br data-v-47862caa><span class="line-number" data-v-47862caa>11</span><br data-v-47862caa><span class="line-number" data-v-47862caa>12</span><br data-v-47862caa><span class="line-number" data-v-47862caa>13</span><br data-v-47862caa><span class="line-number" data-v-47862caa>14</span><br data-v-47862caa><span class="line-number" data-v-47862caa>15</span><br data-v-47862caa><span class="line-number" data-v-47862caa>16</span><br data-v-47862caa><span class="line-number" data-v-47862caa>17</span><br data-v-47862caa><span class="line-number" data-v-47862caa>18</span><br data-v-47862caa><span class="line-number" data-v-47862caa>19</span><br data-v-47862caa><span class="line-number" data-v-47862caa>20</span><br data-v-47862caa><span class="line-number" data-v-47862caa>21</span><br data-v-47862caa><span class="line-number" data-v-47862caa>22</span><br data-v-47862caa><span class="line-number" data-v-47862caa>23</span><br data-v-47862caa><span class="line-number" data-v-47862caa>24</span><br data-v-47862caa><span class="line-number" data-v-47862caa>25</span><br data-v-47862caa><span class="line-number" data-v-47862caa>26</span><br data-v-47862caa><span class="line-number" data-v-47862caa>27</span><br data-v-47862caa><span class="line-number" data-v-47862caa>28</span><br data-v-47862caa></div></div><ul data-v-47862caa><li data-v-47862caa>startWith 添加特定的数据</li></ul> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa>添加单个前置数据 <span class="token operator" data-v-47862caa>-</span> hello world
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> startWith<span class="token punctuation" data-v-47862caa>,</span> scan <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs/operators'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> <span class="token keyword" data-v-47862caa>of</span> <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>//emit ('World!', 'Goodbye', 'World!')</span>
<span class="token keyword" data-v-47862caa>const</span> source <span class="token operator" data-v-47862caa>=</span> <span class="token keyword" data-v-47862caa>of</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'World!'</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token string" data-v-47862caa>'Goodbye'</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token string" data-v-47862caa>'World!'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>//start with 'Hello', concat current string to previous</span>
<span class="token keyword" data-v-47862caa>const</span> example <span class="token operator" data-v-47862caa>=</span> source<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span>
  <span class="token function" data-v-47862caa>startWith</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'Hello'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
  <span class="token function" data-v-47862caa>scan</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>(</span>acc<span class="token punctuation" data-v-47862caa>,</span> curr<span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token template-string" data-v-47862caa><span class="token template-punctuation string" data-v-47862caa>`</span><span class="token interpolation" data-v-47862caa><span class="token interpolation-punctuation punctuation" data-v-47862caa>${</span>acc<span class="token interpolation-punctuation punctuation" data-v-47862caa>}</span></span><span class="token string" data-v-47862caa> </span><span class="token interpolation" data-v-47862caa><span class="token interpolation-punctuation punctuation" data-v-47862caa>${</span>curr<span class="token interpolation-punctuation punctuation" data-v-47862caa>}</span></span><span class="token template-punctuation string" data-v-47862caa>`</span></span><span class="token punctuation" data-v-47862caa>)</span>
<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>/*
  output:
  &quot;Hello&quot;
  &quot;Hello World!&quot;
  &quot;Hello World! Goodbye&quot;
  &quot;Hello World! Goodbye World!&quot;
*/</span>
<span class="token keyword" data-v-47862caa>const</span> subscribe <span class="token operator" data-v-47862caa>=</span> example<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>val <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span>val<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
添加多个前置数据
<span class="token comment" data-v-47862caa>// RxJS v6+</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> startWith <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs/operators'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> interval <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>//emit values in sequence every 1s</span>
<span class="token keyword" data-v-47862caa>const</span> source <span class="token operator" data-v-47862caa>=</span> <span class="token function" data-v-47862caa>interval</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1000</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>//start with -3, -2, -1</span>
<span class="token keyword" data-v-47862caa>const</span> example <span class="token operator" data-v-47862caa>=</span> source<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>startWith</span><span class="token punctuation" data-v-47862caa>(</span><span class="token operator" data-v-47862caa>-</span><span class="token number" data-v-47862caa>3</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token operator" data-v-47862caa>-</span><span class="token number" data-v-47862caa>2</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token operator" data-v-47862caa>-</span><span class="token number" data-v-47862caa>1</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>//output: -3, -2, -1, 0, 1, 2....</span>
<span class="token keyword" data-v-47862caa>const</span> subscribe <span class="token operator" data-v-47862caa>=</span> example<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>val <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span>val<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa><span class="line-number" data-v-47862caa>10</span><br data-v-47862caa><span class="line-number" data-v-47862caa>11</span><br data-v-47862caa><span class="line-number" data-v-47862caa>12</span><br data-v-47862caa><span class="line-number" data-v-47862caa>13</span><br data-v-47862caa><span class="line-number" data-v-47862caa>14</span><br data-v-47862caa><span class="line-number" data-v-47862caa>15</span><br data-v-47862caa><span class="line-number" data-v-47862caa>16</span><br data-v-47862caa><span class="line-number" data-v-47862caa>17</span><br data-v-47862caa><span class="line-number" data-v-47862caa>18</span><br data-v-47862caa><span class="line-number" data-v-47862caa>19</span><br data-v-47862caa><span class="line-number" data-v-47862caa>20</span><br data-v-47862caa><span class="line-number" data-v-47862caa>21</span><br data-v-47862caa><span class="line-number" data-v-47862caa>22</span><br data-v-47862caa><span class="line-number" data-v-47862caa>23</span><br data-v-47862caa><span class="line-number" data-v-47862caa>24</span><br data-v-47862caa><span class="line-number" data-v-47862caa>25</span><br data-v-47862caa><span class="line-number" data-v-47862caa>26</span><br data-v-47862caa><span class="line-number" data-v-47862caa>27</span><br data-v-47862caa><span class="line-number" data-v-47862caa>28</span><br data-v-47862caa></div></div><h2 id="广播" data-v-47862caa><a href="#广播" class="header-anchor" data-v-47862caa>#</a> 广播</h2> <ul data-v-47862caa><li data-v-47862caa>publish() : ConnectableObservable</li></ul> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token comment" data-v-47862caa>// 在订阅之后调用 observable 的 connect 方法</span>
<span class="token comment" data-v-47862caa>// RxJS v6+</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> interval <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> publish<span class="token punctuation" data-v-47862caa>,</span> tap <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs/operators'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>// 每1秒发出值</span>
<span class="token keyword" data-v-47862caa>const</span> source <span class="token operator" data-v-47862caa>=</span> <span class="token function" data-v-47862caa>interval</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1000</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> example <span class="token operator" data-v-47862caa>=</span> source<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span>
  <span class="token comment" data-v-47862caa>// 副作用只会执行1次</span>
  <span class="token function" data-v-47862caa>tap</span><span class="token punctuation" data-v-47862caa>(</span>_ <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'Do Something!'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
  <span class="token comment" data-v-47862caa>// 不会做任何事直到 connect() 被调用</span>
  <span class="token function" data-v-47862caa>publish</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span>
<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>/*
  source 不会发出任何值直到 connect() 被调用
  输出: (5秒后)
  &quot;Do Something!&quot;
  &quot;Subscriber One: 0&quot;
  &quot;Subscriber Two: 0&quot;
  &quot;Do Something!&quot;
  &quot;Subscriber One: 1&quot;
  &quot;Subscriber Two: 1&quot;
*/</span>
<span class="token keyword" data-v-47862caa>const</span> subscribe <span class="token operator" data-v-47862caa>=</span> example<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>val <span class="token operator" data-v-47862caa>=&gt;</span>
  <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token template-string" data-v-47862caa><span class="token template-punctuation string" data-v-47862caa>`</span><span class="token string" data-v-47862caa>Subscriber One: </span><span class="token interpolation" data-v-47862caa><span class="token interpolation-punctuation punctuation" data-v-47862caa>${</span>val<span class="token interpolation-punctuation punctuation" data-v-47862caa>}</span></span><span class="token template-punctuation string" data-v-47862caa>`</span></span><span class="token punctuation" data-v-47862caa>)</span>
<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> subscribeTwo <span class="token operator" data-v-47862caa>=</span> example<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>val <span class="token operator" data-v-47862caa>=&gt;</span>
  <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token template-string" data-v-47862caa><span class="token template-punctuation string" data-v-47862caa>`</span><span class="token string" data-v-47862caa>Subscriber Two: </span><span class="token interpolation" data-v-47862caa><span class="token interpolation-punctuation punctuation" data-v-47862caa>${</span>val<span class="token interpolation-punctuation punctuation" data-v-47862caa>}</span></span><span class="token template-punctuation string" data-v-47862caa>`</span></span><span class="token punctuation" data-v-47862caa>)</span>
<span class="token comment" data-v-47862caa>// 5秒后调用 connect，这会使得 source 开始发出值</span>
<span class="token function" data-v-47862caa>setTimeout</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token punctuation" data-v-47862caa>{</span>
<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
  example<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>connect</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>5000</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa><span class="line-number" data-v-47862caa>10</span><br data-v-47862caa><span class="line-number" data-v-47862caa>11</span><br data-v-47862caa><span class="line-number" data-v-47862caa>12</span><br data-v-47862caa><span class="line-number" data-v-47862caa>13</span><br data-v-47862caa><span class="line-number" data-v-47862caa>14</span><br data-v-47862caa><span class="line-number" data-v-47862caa>15</span><br data-v-47862caa><span class="line-number" data-v-47862caa>16</span><br data-v-47862caa><span class="line-number" data-v-47862caa>17</span><br data-v-47862caa><span class="line-number" data-v-47862caa>18</span><br data-v-47862caa><span class="line-number" data-v-47862caa>19</span><br data-v-47862caa><span class="line-number" data-v-47862caa>20</span><br data-v-47862caa><span class="line-number" data-v-47862caa>21</span><br data-v-47862caa><span class="line-number" data-v-47862caa>22</span><br data-v-47862caa><span class="line-number" data-v-47862caa>23</span><br data-v-47862caa><span class="line-number" data-v-47862caa>24</span><br data-v-47862caa><span class="line-number" data-v-47862caa>25</span><br data-v-47862caa><span class="line-number" data-v-47862caa>26</span><br data-v-47862caa><span class="line-number" data-v-47862caa>27</span><br data-v-47862caa><span class="line-number" data-v-47862caa>28</span><br data-v-47862caa><span class="line-number" data-v-47862caa>29</span><br data-v-47862caa><span class="line-number" data-v-47862caa>30</span><br data-v-47862caa><span class="line-number" data-v-47862caa>31</span><br data-v-47862caa><span class="line-number" data-v-47862caa>32</span><br data-v-47862caa></div></div><ul data-v-47862caa><li data-v-47862caa>multicast(selector: Function): Observable 使用提供 的 Subject 来共享源 observable</li></ul> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token comment" data-v-47862caa>// 使用标准的 Subject 进行 multicast</span>
<span class="token comment" data-v-47862caa>// RxJS v6+</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> Subject<span class="token punctuation" data-v-47862caa>,</span> interval <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> take<span class="token punctuation" data-v-47862caa>,</span> tap<span class="token punctuation" data-v-47862caa>,</span> multicast<span class="token punctuation" data-v-47862caa>,</span> mapTo <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs/operators'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>// 每2秒发出值并只取前5个</span>
<span class="token keyword" data-v-47862caa>const</span> source <span class="token operator" data-v-47862caa>=</span> <span class="token function" data-v-47862caa>interval</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>2000</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>take</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>5</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> example <span class="token operator" data-v-47862caa>=</span> source<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span>
  <span class="token comment" data-v-47862caa>// 因为我们在下面进行了多播，所以副作用只会调用一次</span>
  <span class="token function" data-v-47862caa>tap</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'Side Effect #1'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
  <span class="token function" data-v-47862caa>mapTo</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'Result!'</span><span class="token punctuation" data-v-47862caa>)</span>
<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>// 使用 subject 订阅 source 需要调用 connect() 方法</span>
<span class="token keyword" data-v-47862caa>const</span> multi <span class="token operator" data-v-47862caa>=</span> example<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>multicast</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token keyword" data-v-47862caa>new</span> <span class="token class-name" data-v-47862caa>Subject</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>/*
  多个订阅者会共享 source 
  输出:
  &quot;Side Effect #1&quot;
  &quot;Result!&quot;
  &quot;Result!&quot;
  ...
*/</span>
<span class="token keyword" data-v-47862caa>const</span> subscriberOne <span class="token operator" data-v-47862caa>=</span> multi<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>val <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span>val<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> subscriberTwo <span class="token operator" data-v-47862caa>=</span> multi<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>val <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span>val<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>// 使用 subject 订阅 source</span>
multi<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>connect</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>

<span class="token comment" data-v-47862caa>//  使用 ReplaySubject 进行 multicast</span>
<span class="token comment" data-v-47862caa>// RxJS v6+</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> interval<span class="token punctuation" data-v-47862caa>,</span> ReplaySubject <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> take<span class="token punctuation" data-v-47862caa>,</span> multicast<span class="token punctuation" data-v-47862caa>,</span> tap<span class="token punctuation" data-v-47862caa>,</span> mapTo <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs/operators'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>// 每2秒发出值并只取前5个</span>
<span class="token keyword" data-v-47862caa>const</span> source <span class="token operator" data-v-47862caa>=</span> <span class="token function" data-v-47862caa>interval</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>2000</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>take</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>5</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>// 使用 ReplaySubject 的示例</span>
<span class="token keyword" data-v-47862caa>const</span> example <span class="token operator" data-v-47862caa>=</span> source<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span>
  <span class="token comment" data-v-47862caa>// 因为我们在下面进行了多播，所以副作用只会调用一次</span>
  <span class="token function" data-v-47862caa>tap</span><span class="token punctuation" data-v-47862caa>(</span>_ <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'Side Effect #2'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
  <span class="token function" data-v-47862caa>mapTo</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'Result Two!'</span><span class="token punctuation" data-v-47862caa>)</span>
<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>// 可以使用任何类型的 subject</span>
<span class="token keyword" data-v-47862caa>const</span> multi <span class="token operator" data-v-47862caa>=</span> example<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>multicast</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token keyword" data-v-47862caa>new</span> <span class="token class-name" data-v-47862caa>ReplaySubject</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>5</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>// 使用 subject 订阅 source</span>
multi<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>connect</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token function" data-v-47862caa>setTimeout</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token punctuation" data-v-47862caa>{</span>
  <span class="token comment" data-v-47862caa>/*
   因为使用的是 ReplaySubject，订阅者会接收到 subscription 中的之前所有值。
   */</span>
  <span class="token keyword" data-v-47862caa>const</span> subscriber <span class="token operator" data-v-47862caa>=</span> multi<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>val <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>group</span><span class="token punctuation" data-v-47862caa>(</span>val<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>5000</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa><span class="line-number" data-v-47862caa>10</span><br data-v-47862caa><span class="line-number" data-v-47862caa>11</span><br data-v-47862caa><span class="line-number" data-v-47862caa>12</span><br data-v-47862caa><span class="line-number" data-v-47862caa>13</span><br data-v-47862caa><span class="line-number" data-v-47862caa>14</span><br data-v-47862caa><span class="line-number" data-v-47862caa>15</span><br data-v-47862caa><span class="line-number" data-v-47862caa>16</span><br data-v-47862caa><span class="line-number" data-v-47862caa>17</span><br data-v-47862caa><span class="line-number" data-v-47862caa>18</span><br data-v-47862caa><span class="line-number" data-v-47862caa>19</span><br data-v-47862caa><span class="line-number" data-v-47862caa>20</span><br data-v-47862caa><span class="line-number" data-v-47862caa>21</span><br data-v-47862caa><span class="line-number" data-v-47862caa>22</span><br data-v-47862caa><span class="line-number" data-v-47862caa>23</span><br data-v-47862caa><span class="line-number" data-v-47862caa>24</span><br data-v-47862caa><span class="line-number" data-v-47862caa>25</span><br data-v-47862caa><span class="line-number" data-v-47862caa>26</span><br data-v-47862caa><span class="line-number" data-v-47862caa>27</span><br data-v-47862caa><span class="line-number" data-v-47862caa>28</span><br data-v-47862caa><span class="line-number" data-v-47862caa>29</span><br data-v-47862caa><span class="line-number" data-v-47862caa>30</span><br data-v-47862caa><span class="line-number" data-v-47862caa>31</span><br data-v-47862caa><span class="line-number" data-v-47862caa>32</span><br data-v-47862caa><span class="line-number" data-v-47862caa>33</span><br data-v-47862caa><span class="line-number" data-v-47862caa>34</span><br data-v-47862caa><span class="line-number" data-v-47862caa>35</span><br data-v-47862caa><span class="line-number" data-v-47862caa>36</span><br data-v-47862caa><span class="line-number" data-v-47862caa>37</span><br data-v-47862caa><span class="line-number" data-v-47862caa>38</span><br data-v-47862caa><span class="line-number" data-v-47862caa>39</span><br data-v-47862caa><span class="line-number" data-v-47862caa>40</span><br data-v-47862caa><span class="line-number" data-v-47862caa>41</span><br data-v-47862caa><span class="line-number" data-v-47862caa>42</span><br data-v-47862caa><span class="line-number" data-v-47862caa>43</span><br data-v-47862caa><span class="line-number" data-v-47862caa>44</span><br data-v-47862caa><span class="line-number" data-v-47862caa>45</span><br data-v-47862caa><span class="line-number" data-v-47862caa>46</span><br data-v-47862caa><span class="line-number" data-v-47862caa>47</span><br data-v-47862caa><span class="line-number" data-v-47862caa>48</span><br data-v-47862caa></div></div><ul data-v-47862caa><li data-v-47862caa>share 在多个订阅者间共享源 observable 。
publish  就像是使用了 Subject 的 multicast
share 就像是使用了 Subject 和 refCount 的 multicast</li></ul> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token comment" data-v-47862caa>//多个订阅者共享源 observable</span>
<span class="token comment" data-v-47862caa>// RxJS v6+</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> timer <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> tap<span class="token punctuation" data-v-47862caa>,</span> mapTo<span class="token punctuation" data-v-47862caa>,</span> share <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs/operators'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>// 1秒后发出值</span>
<span class="token keyword" data-v-47862caa>const</span> source <span class="token operator" data-v-47862caa>=</span> <span class="token function" data-v-47862caa>timer</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1000</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>// 输出副作用，然后发出结果</span>
<span class="token keyword" data-v-47862caa>const</span> example <span class="token operator" data-v-47862caa>=</span> source<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span>
  <span class="token function" data-v-47862caa>tap</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'***SIDE EFFECT***'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
  <span class="token function" data-v-47862caa>mapTo</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'***RESULT***'</span><span class="token punctuation" data-v-47862caa>)</span>
<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>/*
  ***不共享的话，副作用会执行两次***
  输出: 
  &quot;***SIDE EFFECT***&quot;
  &quot;***RESULT***&quot;
  &quot;***SIDE EFFECT***&quot;
  &quot;***RESULT***&quot;
*/</span>
<span class="token keyword" data-v-47862caa>const</span> subscribe <span class="token operator" data-v-47862caa>=</span> example<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>val <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span>val<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> subscribeTwo <span class="token operator" data-v-47862caa>=</span> example<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>val <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span>val<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>// 在多个订阅者间共享 observable</span>
<span class="token keyword" data-v-47862caa>const</span> sharedExample <span class="token operator" data-v-47862caa>=</span> example<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>share</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>/*
   ***共享的话，副作用只执行一次***
  输出:
  &quot;***SIDE EFFECT***&quot;
  &quot;***RESULT***&quot;
  &quot;***RESULT***&quot;
*/</span>
<span class="token keyword" data-v-47862caa>const</span> subscribeThree <span class="token operator" data-v-47862caa>=</span> sharedExample<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>val <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span>val<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> subscribeFour <span class="token operator" data-v-47862caa>=</span> sharedExample<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>val <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span>val<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa><span class="line-number" data-v-47862caa>10</span><br data-v-47862caa><span class="line-number" data-v-47862caa>11</span><br data-v-47862caa><span class="line-number" data-v-47862caa>12</span><br data-v-47862caa><span class="line-number" data-v-47862caa>13</span><br data-v-47862caa><span class="line-number" data-v-47862caa>14</span><br data-v-47862caa><span class="line-number" data-v-47862caa>15</span><br data-v-47862caa><span class="line-number" data-v-47862caa>16</span><br data-v-47862caa><span class="line-number" data-v-47862caa>17</span><br data-v-47862caa><span class="line-number" data-v-47862caa>18</span><br data-v-47862caa><span class="line-number" data-v-47862caa>19</span><br data-v-47862caa><span class="line-number" data-v-47862caa>20</span><br data-v-47862caa><span class="line-number" data-v-47862caa>21</span><br data-v-47862caa><span class="line-number" data-v-47862caa>22</span><br data-v-47862caa><span class="line-number" data-v-47862caa>23</span><br data-v-47862caa><span class="line-number" data-v-47862caa>24</span><br data-v-47862caa><span class="line-number" data-v-47862caa>25</span><br data-v-47862caa><span class="line-number" data-v-47862caa>26</span><br data-v-47862caa><span class="line-number" data-v-47862caa>27</span><br data-v-47862caa><span class="line-number" data-v-47862caa>28</span><br data-v-47862caa><span class="line-number" data-v-47862caa>29</span><br data-v-47862caa><span class="line-number" data-v-47862caa>30</span><br data-v-47862caa><span class="line-number" data-v-47862caa>31</span><br data-v-47862caa><span class="line-number" data-v-47862caa>32</span><br data-v-47862caa></div></div><ul data-v-47862caa><li data-v-47862caa>shareReplay(bufferSize?: number, windowTime?: number, scheduler?I IScheduler): Observable</li></ul> <p data-v-47862caa>共享源 observable 并重放指定次数的发出。当有副作用或繁重的计算时，你不希望在多个订阅者之间重复执行时，会使用 share/shareReplay，在订阅过程中重放值的能力是区分 share 和 shareReplay 的关键</p> <p data-v-47862caa>例如，加入你有一个发出最后访问 url 的 observable 。 在第一个示例中，我们使用 share将获取不到之前的值:</p> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token comment" data-v-47862caa>// 使用 subject 模拟 url 的变化</span>
<span class="token keyword" data-v-47862caa>const</span> routeEnd <span class="token operator" data-v-47862caa>=</span> <span class="token keyword" data-v-47862caa>new</span> <span class="token class-name" data-v-47862caa>Subject<span class="token operator" data-v-47862caa>&lt;</span><span class="token punctuation" data-v-47862caa>{</span>data<span class="token operator" data-v-47862caa>:</span> <span class="token builtin" data-v-47862caa>any</span><span class="token punctuation" data-v-47862caa>,</span> url<span class="token operator" data-v-47862caa>:</span> <span class="token builtin" data-v-47862caa>string</span><span class="token punctuation" data-v-47862caa>}</span><span class="token operator" data-v-47862caa>&gt;</span></span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>// 提取 url 并与后来订阅者共享</span>
<span class="token keyword" data-v-47862caa>const</span> lastUrl <span class="token operator" data-v-47862caa>=</span> routeEnd<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span>
  <span class="token function" data-v-47862caa>pluck</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'url'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
  <span class="token function" data-v-47862caa>share</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span>
<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>// 起始订阅者是必须的</span>
<span class="token keyword" data-v-47862caa>const</span> initialSubscriber <span class="token operator" data-v-47862caa>=</span> lastUrl<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span>log<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>// 模拟路由变化</span>
routeEnd<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>next</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>{</span>data<span class="token operator" data-v-47862caa>:</span> <span class="token punctuation" data-v-47862caa>{</span><span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>,</span> url<span class="token operator" data-v-47862caa>:</span> <span class="token string" data-v-47862caa>'my-path'</span><span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>// 没有任何输出</span>
<span class="token keyword" data-v-47862caa>const</span> lateSubscriber <span class="token operator" data-v-47862caa>=</span> lastUrl<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span>log<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa><span class="line-number" data-v-47862caa>10</span><br data-v-47862caa><span class="line-number" data-v-47862caa>11</span><br data-v-47862caa><span class="line-number" data-v-47862caa>12</span><br data-v-47862caa><span class="line-number" data-v-47862caa>13</span><br data-v-47862caa></div></div><p data-v-47862caa>现在我们想要访问订阅中的最新发出值，可以通过 shareReplay 来完成:</p> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> Subject <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs/Subject'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> ReplaySubject <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs/ReplaySubject'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> pluck<span class="token punctuation" data-v-47862caa>,</span> share<span class="token punctuation" data-v-47862caa>,</span> shareReplay<span class="token punctuation" data-v-47862caa>,</span> tap <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs/operators'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>// 使用 subject 模拟 url 的变化</span>
<span class="token keyword" data-v-47862caa>const</span> routeEnd <span class="token operator" data-v-47862caa>=</span> <span class="token keyword" data-v-47862caa>new</span> <span class="token class-name" data-v-47862caa>Subject<span class="token operator" data-v-47862caa>&lt;</span><span class="token punctuation" data-v-47862caa>{</span>data<span class="token operator" data-v-47862caa>:</span> <span class="token builtin" data-v-47862caa>any</span><span class="token punctuation" data-v-47862caa>,</span> url<span class="token operator" data-v-47862caa>:</span> <span class="token builtin" data-v-47862caa>string</span><span class="token punctuation" data-v-47862caa>}</span><span class="token operator" data-v-47862caa>&gt;</span></span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>// 提取 url 并与后来订阅者共享</span>
<span class="token keyword" data-v-47862caa>const</span> lastUrl <span class="token operator" data-v-47862caa>=</span> routeEnd<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span>
  <span class="token function" data-v-47862caa>tap</span><span class="token punctuation" data-v-47862caa>(</span>_ <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'executed'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
  <span class="token function" data-v-47862caa>pluck</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'url'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
  <span class="token comment" data-v-47862caa>// 默认为所有值，因此我们将其设置为仅保留并重放最后一个值</span>
  <span class="token function" data-v-47862caa>shareReplay</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1</span><span class="token punctuation" data-v-47862caa>)</span>
<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>// 起始订阅者是必须的</span>
<span class="token keyword" data-v-47862caa>const</span> initialSubscriber <span class="token operator" data-v-47862caa>=</span> lastUrl<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span>log<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>// 模拟路由变化</span>
<span class="token comment" data-v-47862caa>// 输出: 'executed', 'my-path'</span>
routeEnd<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>next</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>{</span>data<span class="token operator" data-v-47862caa>:</span> <span class="token punctuation" data-v-47862caa>{</span><span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>,</span> url<span class="token operator" data-v-47862caa>:</span> <span class="token string" data-v-47862caa>'my-path'</span><span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>// 输出: 'my-path'</span>
<span class="token keyword" data-v-47862caa>const</span> lateSubscriber <span class="token operator" data-v-47862caa>=</span> lastUrl<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span>log<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa><span class="line-number" data-v-47862caa>10</span><br data-v-47862caa><span class="line-number" data-v-47862caa>11</span><br data-v-47862caa><span class="line-number" data-v-47862caa>12</span><br data-v-47862caa><span class="line-number" data-v-47862caa>13</span><br data-v-47862caa><span class="line-number" data-v-47862caa>14</span><br data-v-47862caa><span class="line-number" data-v-47862caa>15</span><br data-v-47862caa><span class="line-number" data-v-47862caa>16</span><br data-v-47862caa><span class="line-number" data-v-47862caa>17</span><br data-v-47862caa><span class="line-number" data-v-47862caa>18</span><br data-v-47862caa><span class="line-number" data-v-47862caa>19</span><br data-v-47862caa></div></div><p data-v-47862caa>如果使用 ReplaySubject 订阅 lastUrl 流，然后再订阅 ReplaySubject， 这种行为与使用 shareReplay 类似:</p> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token comment" data-v-47862caa>// 使用 subject 模拟 url 的变化</span>
<span class="token keyword" data-v-47862caa>const</span> routeEnd <span class="token operator" data-v-47862caa>=</span> <span class="token keyword" data-v-47862caa>new</span> <span class="token class-name" data-v-47862caa>Subject<span class="token operator" data-v-47862caa>&lt;</span><span class="token punctuation" data-v-47862caa>{</span>data<span class="token operator" data-v-47862caa>:</span> <span class="token builtin" data-v-47862caa>any</span><span class="token punctuation" data-v-47862caa>,</span> url<span class="token operator" data-v-47862caa>:</span> <span class="token builtin" data-v-47862caa>string</span><span class="token punctuation" data-v-47862caa>}</span><span class="token operator" data-v-47862caa>&gt;</span></span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>// 使用 ReplaySubject 来替代 shareReplay</span>
<span class="token keyword" data-v-47862caa>const</span> shareWithReplay <span class="token operator" data-v-47862caa>=</span> <span class="token keyword" data-v-47862caa>new</span> <span class="token class-name" data-v-47862caa>ReplaySubject</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>// 取 url 并与后来订阅者共享</span>
<span class="token keyword" data-v-47862caa>const</span> lastUrl <span class="token operator" data-v-47862caa>=</span> routeEnd<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span>
  <span class="token function" data-v-47862caa>pluck</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'url'</span><span class="token punctuation" data-v-47862caa>)</span>
<span class="token punctuation" data-v-47862caa>)</span>
<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>val <span class="token operator" data-v-47862caa>=&gt;</span> shareWithReplay<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>next</span><span class="token punctuation" data-v-47862caa>(</span>val<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>// 模拟路由变化</span>
routeEnd<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>next</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>{</span>data<span class="token operator" data-v-47862caa>:</span> <span class="token punctuation" data-v-47862caa>{</span><span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>,</span> url<span class="token operator" data-v-47862caa>:</span> <span class="token string" data-v-47862caa>'my-path'</span><span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>// 订阅 ReplaySubject </span>
<span class="token comment" data-v-47862caa>// 输出: 'my path'</span>
shareWithReplay<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span>log<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa><span class="line-number" data-v-47862caa>10</span><br data-v-47862caa><span class="line-number" data-v-47862caa>11</span><br data-v-47862caa><span class="line-number" data-v-47862caa>12</span><br data-v-47862caa><span class="line-number" data-v-47862caa>13</span><br data-v-47862caa><span class="line-number" data-v-47862caa>14</span><br data-v-47862caa></div></div><ul data-v-47862caa><li data-v-47862caa>publishLast 相当于使用AsyncSubject的publish,记得connect(),只在异步complete时候发射同一份缓存的数据，注意与<code data-v-47862caa>publishBehavior,publishReplay,publish</code>区别</li></ul> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token comment" data-v-47862caa>/**
我们创建了一个Observable，这个Observable在被订阅后会发出ajax请求，然后等待返回，当请求响应后，会发出事件。
在管道经过publishLast后，数据被缓存了起来。如果在请求过程中调用了多次的getConfig函数，也不会发出多次ajax请求，publish以及share系列操作符是会共享同一个Observable。
publishLast会缓存最后一个事件，后续订阅者订阅了该事件流就会立即得到缓存的事件数据。
*/</span>
<span class="token keyword" data-v-47862caa>var</span> requestOB <span class="token operator" data-v-47862caa>=</span> rxjs<span class="token punctuation" data-v-47862caa>.</span>Observable<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>create</span><span class="token punctuation" data-v-47862caa>(</span><span class="token keyword" data-v-47862caa>function</span><span class="token punctuation" data-v-47862caa>(</span>observer<span class="token punctuation" data-v-47862caa>)</span> <span class="token punctuation" data-v-47862caa>{</span>
        $<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>ajax</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>{</span>
            <span class="token operator" data-v-47862caa>...</span>
            <span class="token function" data-v-47862caa>success</span><span class="token punctuation" data-v-47862caa>(</span>res<span class="token punctuation" data-v-47862caa>)</span> <span class="token punctuation" data-v-47862caa>{</span>
                observer<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>next</span><span class="token punctuation" data-v-47862caa>(</span>res<span class="token punctuation" data-v-47862caa>)</span>
                observer<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>complete</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span>
            <span class="token punctuation" data-v-47862caa>}</span>
        <span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>)</span>
    <span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span>rxjs<span class="token punctuation" data-v-47862caa>.</span>operators<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>publishLast</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
requestOB<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>connect</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span>
<span class="token keyword" data-v-47862caa>function</span> <span class="token function" data-v-47862caa>getConfig</span><span class="token punctuation" data-v-47862caa>(</span>cb<span class="token punctuation" data-v-47862caa>)</span> <span class="token punctuation" data-v-47862caa>{</span>
    requestConfigOB<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>cb<span class="token punctuation" data-v-47862caa>)</span>
<span class="token punctuation" data-v-47862caa>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa><span class="line-number" data-v-47862caa>10</span><br data-v-47862caa><span class="line-number" data-v-47862caa>11</span><br data-v-47862caa><span class="line-number" data-v-47862caa>12</span><br data-v-47862caa><span class="line-number" data-v-47862caa>13</span><br data-v-47862caa><span class="line-number" data-v-47862caa>14</span><br data-v-47862caa><span class="line-number" data-v-47862caa>15</span><br data-v-47862caa><span class="line-number" data-v-47862caa>16</span><br data-v-47862caa><span class="line-number" data-v-47862caa>17</span><br data-v-47862caa><span class="line-number" data-v-47862caa>18</span><br data-v-47862caa></div></div><h2 id="错误处理" data-v-47862caa><a href="#错误处理" class="header-anchor" data-v-47862caa>#</a> 错误处理</h2> <ul data-v-47862caa><li data-v-47862caa>catchError</li></ul> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token comment" data-v-47862caa>// 单一处理</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> throwError<span class="token punctuation" data-v-47862caa>,</span> <span class="token keyword" data-v-47862caa>of</span> <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> catchError <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs/operators'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>//emit error</span>
<span class="token keyword" data-v-47862caa>const</span> source <span class="token operator" data-v-47862caa>=</span> <span class="token function" data-v-47862caa>throwError</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'This is an error!'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>//gracefully handle error, returning observable with error message</span>
<span class="token keyword" data-v-47862caa>const</span> example <span class="token operator" data-v-47862caa>=</span> source<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>catchError</span><span class="token punctuation" data-v-47862caa>(</span>val <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token keyword" data-v-47862caa>of</span><span class="token punctuation" data-v-47862caa>(</span><span class="token template-string" data-v-47862caa><span class="token template-punctuation string" data-v-47862caa>`</span><span class="token string" data-v-47862caa>I caught: </span><span class="token interpolation" data-v-47862caa><span class="token interpolation-punctuation punctuation" data-v-47862caa>${</span>val<span class="token interpolation-punctuation punctuation" data-v-47862caa>}</span></span><span class="token template-punctuation string" data-v-47862caa>`</span></span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>//output: 'I caught: This is an error'</span>
<span class="token keyword" data-v-47862caa>const</span> subscribe <span class="token operator" data-v-47862caa>=</span> example<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>val <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span>val<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>// 整合其他operator</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> throwError<span class="token punctuation" data-v-47862caa>,</span> fromEvent<span class="token punctuation" data-v-47862caa>,</span> <span class="token keyword" data-v-47862caa>of</span> <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span>
 catchError<span class="token punctuation" data-v-47862caa>,</span>
 tap<span class="token punctuation" data-v-47862caa>,</span>
 switchMap<span class="token punctuation" data-v-47862caa>,</span>
 mergeMap<span class="token punctuation" data-v-47862caa>,</span>
 concatMap<span class="token punctuation" data-v-47862caa>,</span>
 exhaustMap
<span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs/operators'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> fakeRequest$ <span class="token operator" data-v-47862caa>=</span> <span class="token keyword" data-v-47862caa>of</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span>
 <span class="token function" data-v-47862caa>tap</span><span class="token punctuation" data-v-47862caa>(</span>_ <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'fakeRequest'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
 throwError
<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> iWillContinueListening$ <span class="token operator" data-v-47862caa>=</span> <span class="token function" data-v-47862caa>fromEvent</span><span class="token punctuation" data-v-47862caa>(</span>
 document<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>getElementById</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'continued'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
 <span class="token string" data-v-47862caa>'click'</span>
<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span>
 <span class="token function" data-v-47862caa>switchMap</span><span class="token punctuation" data-v-47862caa>(</span>_ <span class="token operator" data-v-47862caa>=&gt;</span> fakeRequest$<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>catchError</span><span class="token punctuation" data-v-47862caa>(</span>_ <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token keyword" data-v-47862caa>of</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'keep on clicking!!!'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span>
<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> iWillStopListening$ <span class="token operator" data-v-47862caa>=</span> <span class="token function" data-v-47862caa>fromEvent</span><span class="token punctuation" data-v-47862caa>(</span>
 document<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>getElementById</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'stopped'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
 <span class="token string" data-v-47862caa>'click'</span>
<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span>
 <span class="token function" data-v-47862caa>switchMap</span><span class="token punctuation" data-v-47862caa>(</span>_ <span class="token operator" data-v-47862caa>=&gt;</span> fakeRequest$<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
 <span class="token function" data-v-47862caa>catchError</span><span class="token punctuation" data-v-47862caa>(</span>_ <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token keyword" data-v-47862caa>of</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'no more requests!!!'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span>
<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
iWillContinueListening$<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span>log<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
iWillStopListening$<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span>log<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa><span class="line-number" data-v-47862caa>10</span><br data-v-47862caa><span class="line-number" data-v-47862caa>11</span><br data-v-47862caa><span class="line-number" data-v-47862caa>12</span><br data-v-47862caa><span class="line-number" data-v-47862caa>13</span><br data-v-47862caa><span class="line-number" data-v-47862caa>14</span><br data-v-47862caa><span class="line-number" data-v-47862caa>15</span><br data-v-47862caa><span class="line-number" data-v-47862caa>16</span><br data-v-47862caa><span class="line-number" data-v-47862caa>17</span><br data-v-47862caa><span class="line-number" data-v-47862caa>18</span><br data-v-47862caa><span class="line-number" data-v-47862caa>19</span><br data-v-47862caa><span class="line-number" data-v-47862caa>20</span><br data-v-47862caa><span class="line-number" data-v-47862caa>21</span><br data-v-47862caa><span class="line-number" data-v-47862caa>22</span><br data-v-47862caa><span class="line-number" data-v-47862caa>23</span><br data-v-47862caa><span class="line-number" data-v-47862caa>24</span><br data-v-47862caa><span class="line-number" data-v-47862caa>25</span><br data-v-47862caa><span class="line-number" data-v-47862caa>26</span><br data-v-47862caa><span class="line-number" data-v-47862caa>27</span><br data-v-47862caa><span class="line-number" data-v-47862caa>28</span><br data-v-47862caa><span class="line-number" data-v-47862caa>29</span><br data-v-47862caa><span class="line-number" data-v-47862caa>30</span><br data-v-47862caa><span class="line-number" data-v-47862caa>31</span><br data-v-47862caa><span class="line-number" data-v-47862caa>32</span><br data-v-47862caa><span class="line-number" data-v-47862caa>33</span><br data-v-47862caa><span class="line-number" data-v-47862caa>34</span><br data-v-47862caa><span class="line-number" data-v-47862caa>35</span><br data-v-47862caa><span class="line-number" data-v-47862caa>36</span><br data-v-47862caa><span class="line-number" data-v-47862caa>37</span><br data-v-47862caa><span class="line-number" data-v-47862caa>38</span><br data-v-47862caa></div></div><ul data-v-47862caa><li data-v-47862caa>retry 设置重试次数</li></ul> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token comment" data-v-47862caa>// RxJS v6+</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> interval<span class="token punctuation" data-v-47862caa>,</span> <span class="token keyword" data-v-47862caa>of</span><span class="token punctuation" data-v-47862caa>,</span> throwError <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> mergeMap<span class="token punctuation" data-v-47862caa>,</span> retry <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs/operators'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>//emit value every 1s</span>
<span class="token keyword" data-v-47862caa>const</span> source <span class="token operator" data-v-47862caa>=</span> <span class="token function" data-v-47862caa>interval</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1000</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> example <span class="token operator" data-v-47862caa>=</span> source<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span>
 <span class="token function" data-v-47862caa>mergeMap</span><span class="token punctuation" data-v-47862caa>(</span>val <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token punctuation" data-v-47862caa>{</span>
   <span class="token comment" data-v-47862caa>//throw error for demonstration</span>
   <span class="token keyword" data-v-47862caa>if</span> <span class="token punctuation" data-v-47862caa>(</span>val <span class="token operator" data-v-47862caa>&gt;</span> <span class="token number" data-v-47862caa>5</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token punctuation" data-v-47862caa>{</span>
     <span class="token keyword" data-v-47862caa>return</span> <span class="token function" data-v-47862caa>throwError</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'Error!'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
   <span class="token punctuation" data-v-47862caa>}</span>
   <span class="token keyword" data-v-47862caa>return</span> <span class="token keyword" data-v-47862caa>of</span><span class="token punctuation" data-v-47862caa>(</span>val<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
 <span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
 <span class="token comment" data-v-47862caa>//retry 2 times on error</span>
 <span class="token function" data-v-47862caa>retry</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>2</span><span class="token punctuation" data-v-47862caa>)</span>
<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>/*
 output:
 0..1..2..3..4..5..
 0..1..2..3..4..5..
 0..1..2..3..4..5..
 &quot;Error!: Retried 2 times then quit!&quot;
*/</span>
<span class="token keyword" data-v-47862caa>const</span> subscribe <span class="token operator" data-v-47862caa>=</span> example<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>{</span>
 <span class="token function-variable function" data-v-47862caa>next</span><span class="token operator" data-v-47862caa>:</span> val <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span>val<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
 <span class="token function-variable function" data-v-47862caa>error</span><span class="token operator" data-v-47862caa>:</span> val <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token template-string" data-v-47862caa><span class="token template-punctuation string" data-v-47862caa>`</span><span class="token interpolation" data-v-47862caa><span class="token interpolation-punctuation punctuation" data-v-47862caa>${</span>val<span class="token interpolation-punctuation punctuation" data-v-47862caa>}</span></span><span class="token string" data-v-47862caa>: Retried 2 times then quit!</span><span class="token template-punctuation string" data-v-47862caa>`</span></span><span class="token punctuation" data-v-47862caa>)</span>
<span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa><span class="line-number" data-v-47862caa>10</span><br data-v-47862caa><span class="line-number" data-v-47862caa>11</span><br data-v-47862caa><span class="line-number" data-v-47862caa>12</span><br data-v-47862caa><span class="line-number" data-v-47862caa>13</span><br data-v-47862caa><span class="line-number" data-v-47862caa>14</span><br data-v-47862caa><span class="line-number" data-v-47862caa>15</span><br data-v-47862caa><span class="line-number" data-v-47862caa>16</span><br data-v-47862caa><span class="line-number" data-v-47862caa>17</span><br data-v-47862caa><span class="line-number" data-v-47862caa>18</span><br data-v-47862caa><span class="line-number" data-v-47862caa>19</span><br data-v-47862caa><span class="line-number" data-v-47862caa>20</span><br data-v-47862caa><span class="line-number" data-v-47862caa>21</span><br data-v-47862caa><span class="line-number" data-v-47862caa>22</span><br data-v-47862caa><span class="line-number" data-v-47862caa>23</span><br data-v-47862caa><span class="line-number" data-v-47862caa>24</span><br data-v-47862caa><span class="line-number" data-v-47862caa>25</span><br data-v-47862caa><span class="line-number" data-v-47862caa>26</span><br data-v-47862caa><span class="line-number" data-v-47862caa>27</span><br data-v-47862caa></div></div><ul data-v-47862caa><li data-v-47862caa>retryWhen/delayWhen自定义设置重重试逻辑</li></ul> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token comment" data-v-47862caa>// RxJS v6+</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> timer<span class="token punctuation" data-v-47862caa>,</span> interval <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> map<span class="token punctuation" data-v-47862caa>,</span> tap<span class="token punctuation" data-v-47862caa>,</span> retryWhen<span class="token punctuation" data-v-47862caa>,</span> delayWhen <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs/operators'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>//emit value every 1s</span>
<span class="token keyword" data-v-47862caa>const</span> source <span class="token operator" data-v-47862caa>=</span> <span class="token function" data-v-47862caa>interval</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1000</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> example <span class="token operator" data-v-47862caa>=</span> source<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span>
 <span class="token function" data-v-47862caa>map</span><span class="token punctuation" data-v-47862caa>(</span>val <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token punctuation" data-v-47862caa>{</span>
   <span class="token keyword" data-v-47862caa>if</span> <span class="token punctuation" data-v-47862caa>(</span>val <span class="token operator" data-v-47862caa>&gt;</span> <span class="token number" data-v-47862caa>5</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token punctuation" data-v-47862caa>{</span>
     <span class="token comment" data-v-47862caa>//error will be picked up by retryWhen</span>
     <span class="token keyword" data-v-47862caa>throw</span> val<span class="token punctuation" data-v-47862caa>;</span>
   <span class="token punctuation" data-v-47862caa>}</span>
   <span class="token keyword" data-v-47862caa>return</span> val<span class="token punctuation" data-v-47862caa>;</span>
 <span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
 <span class="token function" data-v-47862caa>retryWhen</span><span class="token punctuation" data-v-47862caa>(</span>errors <span class="token operator" data-v-47862caa>=&gt;</span>
   errors<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span>
     <span class="token comment" data-v-47862caa>//log error message</span>
     <span class="token function" data-v-47862caa>tap</span><span class="token punctuation" data-v-47862caa>(</span>val <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token template-string" data-v-47862caa><span class="token template-punctuation string" data-v-47862caa>`</span><span class="token string" data-v-47862caa>Value </span><span class="token interpolation" data-v-47862caa><span class="token interpolation-punctuation punctuation" data-v-47862caa>${</span>val<span class="token interpolation-punctuation punctuation" data-v-47862caa>}</span></span><span class="token string" data-v-47862caa> was too high!</span><span class="token template-punctuation string" data-v-47862caa>`</span></span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
     <span class="token comment" data-v-47862caa>//restart in 6 seconds</span>
     <span class="token function" data-v-47862caa>delayWhen</span><span class="token punctuation" data-v-47862caa>(</span>val <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token function" data-v-47862caa>timer</span><span class="token punctuation" data-v-47862caa>(</span>val <span class="token operator" data-v-47862caa>*</span> <span class="token number" data-v-47862caa>1000</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span>
   <span class="token punctuation" data-v-47862caa>)</span>
 <span class="token punctuation" data-v-47862caa>)</span>
<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>/*
 output:
 0
 1
 2
 3
 4
 5
 &quot;Value 6 was too high!&quot;
 --Wait 6 seconds then repeat
*/</span>
<span class="token keyword" data-v-47862caa>const</span> subscribe <span class="token operator" data-v-47862caa>=</span> example<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>val <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span>val<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa><span class="line-number" data-v-47862caa>10</span><br data-v-47862caa><span class="line-number" data-v-47862caa>11</span><br data-v-47862caa><span class="line-number" data-v-47862caa>12</span><br data-v-47862caa><span class="line-number" data-v-47862caa>13</span><br data-v-47862caa><span class="line-number" data-v-47862caa>14</span><br data-v-47862caa><span class="line-number" data-v-47862caa>15</span><br data-v-47862caa><span class="line-number" data-v-47862caa>16</span><br data-v-47862caa><span class="line-number" data-v-47862caa>17</span><br data-v-47862caa><span class="line-number" data-v-47862caa>18</span><br data-v-47862caa><span class="line-number" data-v-47862caa>19</span><br data-v-47862caa><span class="line-number" data-v-47862caa>20</span><br data-v-47862caa><span class="line-number" data-v-47862caa>21</span><br data-v-47862caa><span class="line-number" data-v-47862caa>22</span><br data-v-47862caa><span class="line-number" data-v-47862caa>23</span><br data-v-47862caa><span class="line-number" data-v-47862caa>24</span><br data-v-47862caa><span class="line-number" data-v-47862caa>25</span><br data-v-47862caa><span class="line-number" data-v-47862caa>26</span><br data-v-47862caa><span class="line-number" data-v-47862caa>27</span><br data-v-47862caa><span class="line-number" data-v-47862caa>28</span><br data-v-47862caa><span class="line-number" data-v-47862caa>29</span><br data-v-47862caa><span class="line-number" data-v-47862caa>30</span><br data-v-47862caa><span class="line-number" data-v-47862caa>31</span><br data-v-47862caa><span class="line-number" data-v-47862caa>32</span><br data-v-47862caa><span class="line-number" data-v-47862caa>33</span><br data-v-47862caa><span class="line-number" data-v-47862caa>34</span><br data-v-47862caa></div></div><h2 id="实用工具" data-v-47862caa><a href="#实用工具" class="header-anchor" data-v-47862caa>#</a> 实用工具</h2> <ul data-v-47862caa><li data-v-47862caa>tap/do 流内操作</li></ul> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> <span class="token keyword" data-v-47862caa>of</span><span class="token punctuation" data-v-47862caa>,</span>merge <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> max<span class="token punctuation" data-v-47862caa>,</span>min<span class="token punctuation" data-v-47862caa>,</span>tap <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs/operators'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> obs$ <span class="token operator" data-v-47862caa>=</span> <span class="token keyword" data-v-47862caa>of</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>5</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>4</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>7</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>2</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>8</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
obs$<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>tap</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>{</span>
    <span class="token function-variable function" data-v-47862caa>next</span><span class="token operator" data-v-47862caa>:</span><span class="token punctuation" data-v-47862caa>(</span>val<span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token punctuation" data-v-47862caa>{</span>
        <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>&quot;val&quot;</span><span class="token punctuation" data-v-47862caa>,</span>val<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
    <span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>,</span>
    <span class="token function-variable function" data-v-47862caa>error</span><span class="token operator" data-v-47862caa>:</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token punctuation" data-v-47862caa>{</span>

    <span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>,</span>
    <span class="token function-variable function" data-v-47862caa>complete</span><span class="token operator" data-v-47862caa>:</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token punctuation" data-v-47862caa>{</span>

    <span class="token punctuation" data-v-47862caa>}</span>
<span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span>log<span class="token punctuation" data-v-47862caa>)</span>
<span class="token comment" data-v-47862caa>//output</span>
val <span class="token number" data-v-47862caa>5</span>
<span class="token number" data-v-47862caa>5</span>
val <span class="token number" data-v-47862caa>4</span>
<span class="token number" data-v-47862caa>4</span>
val <span class="token number" data-v-47862caa>7</span>
<span class="token number" data-v-47862caa>7</span>
val <span class="token number" data-v-47862caa>2</span>
<span class="token number" data-v-47862caa>2</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa><span class="line-number" data-v-47862caa>10</span><br data-v-47862caa><span class="line-number" data-v-47862caa>11</span><br data-v-47862caa><span class="line-number" data-v-47862caa>12</span><br data-v-47862caa><span class="line-number" data-v-47862caa>13</span><br data-v-47862caa><span class="line-number" data-v-47862caa>14</span><br data-v-47862caa><span class="line-number" data-v-47862caa>15</span><br data-v-47862caa><span class="line-number" data-v-47862caa>16</span><br data-v-47862caa><span class="line-number" data-v-47862caa>17</span><br data-v-47862caa><span class="line-number" data-v-47862caa>18</span><br data-v-47862caa><span class="line-number" data-v-47862caa>19</span><br data-v-47862caa><span class="line-number" data-v-47862caa>20</span><br data-v-47862caa><span class="line-number" data-v-47862caa>21</span><br data-v-47862caa><span class="line-number" data-v-47862caa>22</span><br data-v-47862caa><span class="line-number" data-v-47862caa>23</span><br data-v-47862caa></div></div><ul data-v-47862caa><li data-v-47862caa>repeat 重复，即多次订阅</li></ul> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> tap <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs/operators'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> repeat<span class="token punctuation" data-v-47862caa>,</span> delay <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs/operators'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> <span class="token keyword" data-v-47862caa>of</span> <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> delayedThing <span class="token operator" data-v-47862caa>=</span> <span class="token keyword" data-v-47862caa>of</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'delayed value'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span>
        <span class="token function" data-v-47862caa>tap</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token punctuation" data-v-47862caa>{</span>
            <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>&quot;time..1.&quot;</span><span class="token punctuation" data-v-47862caa>,</span><span class="token keyword" data-v-47862caa>new</span> <span class="token class-name" data-v-47862caa>Date</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>toLocaleTimeString</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
        <span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
        <span class="token function" data-v-47862caa>delay</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>2000</span><span class="token punctuation" data-v-47862caa>)</span>
        <span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>

delayedThing
  <span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span>
    <span class="token function" data-v-47862caa>tap</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token punctuation" data-v-47862caa>{</span>
        <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>&quot;time...2&quot;</span><span class="token punctuation" data-v-47862caa>,</span><span class="token keyword" data-v-47862caa>new</span> <span class="token class-name" data-v-47862caa>Date</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>toLocaleTimeString</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
    <span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
      <span class="token function" data-v-47862caa>repeat</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>3</span><span class="token punctuation" data-v-47862caa>)</span>
    <span class="token punctuation" data-v-47862caa>)</span>
  <span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span>log<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>

<span class="token comment" data-v-47862caa>//output </span>
time<span class="token punctuation" data-v-47862caa>.</span><span class="token number" data-v-47862caa>.1</span><span class="token punctuation" data-v-47862caa>.</span> <span class="token number" data-v-47862caa>4</span><span class="token operator" data-v-47862caa>:</span><span class="token number" data-v-47862caa>42</span><span class="token operator" data-v-47862caa>:</span><span class="token number" data-v-47862caa>45</span> <span class="token constant" data-v-47862caa>PM</span>
time<span class="token punctuation" data-v-47862caa>.</span><span class="token punctuation" data-v-47862caa>.</span><span class="token number" data-v-47862caa>.2</span> <span class="token number" data-v-47862caa>4</span><span class="token operator" data-v-47862caa>:</span><span class="token number" data-v-47862caa>42</span><span class="token operator" data-v-47862caa>:</span><span class="token number" data-v-47862caa>47</span> <span class="token constant" data-v-47862caa>PM</span>
delayed value
time<span class="token punctuation" data-v-47862caa>.</span><span class="token number" data-v-47862caa>.1</span><span class="token punctuation" data-v-47862caa>.</span> <span class="token number" data-v-47862caa>4</span><span class="token operator" data-v-47862caa>:</span><span class="token number" data-v-47862caa>42</span><span class="token operator" data-v-47862caa>:</span><span class="token number" data-v-47862caa>47</span> <span class="token constant" data-v-47862caa>PM</span>
time<span class="token punctuation" data-v-47862caa>.</span><span class="token punctuation" data-v-47862caa>.</span><span class="token number" data-v-47862caa>.2</span> <span class="token number" data-v-47862caa>4</span><span class="token operator" data-v-47862caa>:</span><span class="token number" data-v-47862caa>42</span><span class="token operator" data-v-47862caa>:</span><span class="token number" data-v-47862caa>49</span> <span class="token constant" data-v-47862caa>PM</span>
delayed value
time<span class="token punctuation" data-v-47862caa>.</span><span class="token number" data-v-47862caa>.1</span><span class="token punctuation" data-v-47862caa>.</span> <span class="token number" data-v-47862caa>4</span><span class="token operator" data-v-47862caa>:</span><span class="token number" data-v-47862caa>42</span><span class="token operator" data-v-47862caa>:</span><span class="token number" data-v-47862caa>49</span> <span class="token constant" data-v-47862caa>PM</span>
time<span class="token punctuation" data-v-47862caa>.</span><span class="token punctuation" data-v-47862caa>.</span><span class="token number" data-v-47862caa>.2</span> <span class="token number" data-v-47862caa>4</span><span class="token operator" data-v-47862caa>:</span><span class="token number" data-v-47862caa>42</span><span class="token operator" data-v-47862caa>:</span><span class="token number" data-v-47862caa>51</span> <span class="token constant" data-v-47862caa>PM</span>
delayed value
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa><span class="line-number" data-v-47862caa>10</span><br data-v-47862caa><span class="line-number" data-v-47862caa>11</span><br data-v-47862caa><span class="line-number" data-v-47862caa>12</span><br data-v-47862caa><span class="line-number" data-v-47862caa>13</span><br data-v-47862caa><span class="line-number" data-v-47862caa>14</span><br data-v-47862caa><span class="line-number" data-v-47862caa>15</span><br data-v-47862caa><span class="line-number" data-v-47862caa>16</span><br data-v-47862caa><span class="line-number" data-v-47862caa>17</span><br data-v-47862caa><span class="line-number" data-v-47862caa>18</span><br data-v-47862caa><span class="line-number" data-v-47862caa>19</span><br data-v-47862caa><span class="line-number" data-v-47862caa>20</span><br data-v-47862caa><span class="line-number" data-v-47862caa>21</span><br data-v-47862caa><span class="line-number" data-v-47862caa>22</span><br data-v-47862caa><span class="line-number" data-v-47862caa>23</span><br data-v-47862caa><span class="line-number" data-v-47862caa>24</span><br data-v-47862caa><span class="line-number" data-v-47862caa>25</span><br data-v-47862caa><span class="line-number" data-v-47862caa>26</span><br data-v-47862caa><span class="line-number" data-v-47862caa>27</span><br data-v-47862caa><span class="line-number" data-v-47862caa>28</span><br data-v-47862caa><span class="line-number" data-v-47862caa>29</span><br data-v-47862caa></div></div><ul data-v-47862caa><li data-v-47862caa>subscribeOn/observeOn 调整执行时机</li></ul> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> <span class="token keyword" data-v-47862caa>of</span><span class="token punctuation" data-v-47862caa>,</span> merge <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> a <span class="token operator" data-v-47862caa>=</span> <span class="token keyword" data-v-47862caa>of</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>2</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>3</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>4</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> b <span class="token operator" data-v-47862caa>=</span> <span class="token keyword" data-v-47862caa>of</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>5</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>6</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>7</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>8</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>9</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token function" data-v-47862caa>merge</span><span class="token punctuation" data-v-47862caa>(</span>a<span class="token punctuation" data-v-47862caa>,</span> b<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span>log<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>// 1 2 3 4 5 6 7 8 9</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> <span class="token keyword" data-v-47862caa>of</span><span class="token punctuation" data-v-47862caa>,</span> merge<span class="token punctuation" data-v-47862caa>,</span> asyncScheduler <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> subscribeOn <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs/operators'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> a <span class="token operator" data-v-47862caa>=</span> <span class="token keyword" data-v-47862caa>of</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>2</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>3</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>4</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>subscribeOn</span><span class="token punctuation" data-v-47862caa>(</span>asyncScheduler<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> b <span class="token operator" data-v-47862caa>=</span> <span class="token keyword" data-v-47862caa>of</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>5</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>6</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>7</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>8</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>9</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token function" data-v-47862caa>merge</span><span class="token punctuation" data-v-47862caa>(</span>a<span class="token punctuation" data-v-47862caa>,</span> b<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span>log<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>//5 6 7 8 9 1 2 3 4</span>
<span class="token comment" data-v-47862caa>// 确保在重新绘制浏览器之前调用 subscribe 中的值。</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> interval <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> observeOn <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs/operators'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> intervals <span class="token operator" data-v-47862caa>=</span> <span class="token function" data-v-47862caa>interval</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>10</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>                <span class="token comment" data-v-47862caa>// Intervals are scheduled</span>
intervals<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span>
  <span class="token function" data-v-47862caa>observeOn</span><span class="token punctuation" data-v-47862caa>(</span>animationFrameScheduler<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>          <span class="token comment" data-v-47862caa>// ...but we will observe on animationFrame</span>
<span class="token punctuation" data-v-47862caa>)</span>                                              <span class="token comment" data-v-47862caa>// scheduler to ensure smooth animation.</span>
<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>val <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token punctuation" data-v-47862caa>{</span>
  someDiv<span class="token punctuation" data-v-47862caa>.</span>style<span class="token punctuation" data-v-47862caa>.</span>height <span class="token operator" data-v-47862caa>=</span> val <span class="token operator" data-v-47862caa>+</span> <span class="token string" data-v-47862caa>'px'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa><span class="line-number" data-v-47862caa>10</span><br data-v-47862caa><span class="line-number" data-v-47862caa>11</span><br data-v-47862caa><span class="line-number" data-v-47862caa>12</span><br data-v-47862caa><span class="line-number" data-v-47862caa>13</span><br data-v-47862caa><span class="line-number" data-v-47862caa>14</span><br data-v-47862caa><span class="line-number" data-v-47862caa>15</span><br data-v-47862caa><span class="line-number" data-v-47862caa>16</span><br data-v-47862caa><span class="line-number" data-v-47862caa>17</span><br data-v-47862caa><span class="line-number" data-v-47862caa>18</span><br data-v-47862caa><span class="line-number" data-v-47862caa>19</span><br data-v-47862caa><span class="line-number" data-v-47862caa>20</span><br data-v-47862caa><span class="line-number" data-v-47862caa>21</span><br data-v-47862caa></div></div><ul data-v-47862caa><li data-v-47862caa>materialize 用默认对象包箱, dematerialize 开箱</li></ul> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> <span class="token keyword" data-v-47862caa>of</span> <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> materialize<span class="token punctuation" data-v-47862caa>,</span> map <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs/operators'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> letters <span class="token operator" data-v-47862caa>=</span> <span class="token keyword" data-v-47862caa>of</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'a'</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token string" data-v-47862caa>'b'</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token string" data-v-47862caa>'13'</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token string" data-v-47862caa>'d'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> upperCase <span class="token operator" data-v-47862caa>=</span> letters<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>map</span><span class="token punctuation" data-v-47862caa>(</span>x <span class="token operator" data-v-47862caa>=&gt;</span> x<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>toUpperCase</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> materialized <span class="token operator" data-v-47862caa>=</span> upperCase<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>materialize</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
materialized<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>x <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span>x<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
Notification <span class="token punctuation" data-v-47862caa>{</span> kind<span class="token operator" data-v-47862caa>:</span> <span class="token string" data-v-47862caa>'N'</span><span class="token punctuation" data-v-47862caa>,</span> value<span class="token operator" data-v-47862caa>:</span> <span class="token string" data-v-47862caa>'A'</span><span class="token punctuation" data-v-47862caa>,</span> error<span class="token operator" data-v-47862caa>:</span> <span class="token keyword" data-v-47862caa>undefined</span><span class="token punctuation" data-v-47862caa>,</span> hasValue<span class="token operator" data-v-47862caa>:</span> <span class="token boolean" data-v-47862caa>true</span> <span class="token punctuation" data-v-47862caa>}</span>
Notification <span class="token punctuation" data-v-47862caa>{</span> kind<span class="token operator" data-v-47862caa>:</span> <span class="token string" data-v-47862caa>'N'</span><span class="token punctuation" data-v-47862caa>,</span> value<span class="token operator" data-v-47862caa>:</span> <span class="token string" data-v-47862caa>'B'</span><span class="token punctuation" data-v-47862caa>,</span> error<span class="token operator" data-v-47862caa>:</span> <span class="token keyword" data-v-47862caa>undefined</span><span class="token punctuation" data-v-47862caa>,</span> hasValue<span class="token operator" data-v-47862caa>:</span> <span class="token boolean" data-v-47862caa>true</span> <span class="token punctuation" data-v-47862caa>}</span>
Notification <span class="token punctuation" data-v-47862caa>{</span> kind<span class="token operator" data-v-47862caa>:</span> <span class="token string" data-v-47862caa>'N'</span><span class="token punctuation" data-v-47862caa>,</span> value<span class="token operator" data-v-47862caa>:</span> <span class="token string" data-v-47862caa>'13'</span><span class="token punctuation" data-v-47862caa>,</span> error<span class="token operator" data-v-47862caa>:</span> <span class="token keyword" data-v-47862caa>undefined</span><span class="token punctuation" data-v-47862caa>,</span> hasValue<span class="token operator" data-v-47862caa>:</span> <span class="token boolean" data-v-47862caa>true</span> <span class="token punctuation" data-v-47862caa>}</span>
Notification <span class="token punctuation" data-v-47862caa>{</span> kind<span class="token operator" data-v-47862caa>:</span> <span class="token string" data-v-47862caa>'N'</span><span class="token punctuation" data-v-47862caa>,</span> value<span class="token operator" data-v-47862caa>:</span> <span class="token string" data-v-47862caa>'D'</span><span class="token punctuation" data-v-47862caa>,</span> error<span class="token operator" data-v-47862caa>:</span> <span class="token keyword" data-v-47862caa>undefined</span><span class="token punctuation" data-v-47862caa>,</span> hasValue<span class="token operator" data-v-47862caa>:</span> <span class="token boolean" data-v-47862caa>true</span> <span class="token punctuation" data-v-47862caa>}</span>
Notification <span class="token punctuation" data-v-47862caa>{</span> kind<span class="token operator" data-v-47862caa>:</span> <span class="token string" data-v-47862caa>'C'</span><span class="token punctuation" data-v-47862caa>,</span> value<span class="token operator" data-v-47862caa>:</span> <span class="token keyword" data-v-47862caa>undefined</span><span class="token punctuation" data-v-47862caa>,</span> error<span class="token operator" data-v-47862caa>:</span> <span class="token keyword" data-v-47862caa>undefined</span><span class="token punctuation" data-v-47862caa>,</span> hasValue<span class="token operator" data-v-47862caa>:</span> <span class="token boolean" data-v-47862caa>false</span> <span class="token punctuation" data-v-47862caa>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa><span class="line-number" data-v-47862caa>10</span><br data-v-47862caa><span class="line-number" data-v-47862caa>11</span><br data-v-47862caa></div></div><ul data-v-47862caa><li data-v-47862caa>timestamp 添加时间戳</li></ul> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> <span class="token keyword" data-v-47862caa>of</span> <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs'</span><span class="token punctuation" data-v-47862caa>;</span>
 <span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> materialize<span class="token punctuation" data-v-47862caa>,</span> map<span class="token punctuation" data-v-47862caa>,</span> timestamp<span class="token punctuation" data-v-47862caa>,</span> tap <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs/operators'</span><span class="token punctuation" data-v-47862caa>;</span>
 <span class="token keyword" data-v-47862caa>const</span> letters <span class="token operator" data-v-47862caa>=</span> <span class="token keyword" data-v-47862caa>of</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'a'</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token string" data-v-47862caa>'b'</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token string" data-v-47862caa>'13'</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token string" data-v-47862caa>'d'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
 <span class="token keyword" data-v-47862caa>const</span> times <span class="token operator" data-v-47862caa>=</span> letters<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>timestamp</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
 times<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>res <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token punctuation" data-v-47862caa>{</span>
     <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>&quot;res...&quot;</span><span class="token punctuation" data-v-47862caa>,</span>res<span class="token punctuation" data-v-47862caa>)</span>
 <span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>//output </span>
 res<span class="token operator" data-v-47862caa>...</span> Timestamp <span class="token punctuation" data-v-47862caa>{</span> value<span class="token operator" data-v-47862caa>:</span> <span class="token string" data-v-47862caa>'a'</span><span class="token punctuation" data-v-47862caa>,</span> timestamp<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>1594074567694</span> <span class="token punctuation" data-v-47862caa>}</span>
 res<span class="token operator" data-v-47862caa>...</span> Timestamp <span class="token punctuation" data-v-47862caa>{</span> value<span class="token operator" data-v-47862caa>:</span> <span class="token string" data-v-47862caa>'b'</span><span class="token punctuation" data-v-47862caa>,</span> timestamp<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>1594074567700</span> <span class="token punctuation" data-v-47862caa>}</span>
 res<span class="token operator" data-v-47862caa>...</span> Timestamp <span class="token punctuation" data-v-47862caa>{</span> value<span class="token operator" data-v-47862caa>:</span> <span class="token string" data-v-47862caa>'13'</span><span class="token punctuation" data-v-47862caa>,</span> timestamp<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>1594074567700</span> <span class="token punctuation" data-v-47862caa>}</span>
 res<span class="token operator" data-v-47862caa>...</span> Timestamp <span class="token punctuation" data-v-47862caa>{</span> value<span class="token operator" data-v-47862caa>:</span> <span class="token string" data-v-47862caa>'d'</span><span class="token punctuation" data-v-47862caa>,</span> timestamp<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>1594074567700</span> <span class="token punctuation" data-v-47862caa>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa><span class="line-number" data-v-47862caa>10</span><br data-v-47862caa><span class="line-number" data-v-47862caa>11</span><br data-v-47862caa><span class="line-number" data-v-47862caa>12</span><br data-v-47862caa></div></div><ul data-v-47862caa><li data-v-47862caa>toArray 最终结果toArray，取决于source是一个个产生的，map,filter,interval</li></ul> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> interval <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> toArray<span class="token punctuation" data-v-47862caa>,</span> take <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs/operators'</span><span class="token punctuation" data-v-47862caa>;</span>
 <span class="token keyword" data-v-47862caa>const</span> source <span class="token operator" data-v-47862caa>=</span> <span class="token function" data-v-47862caa>interval</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1000</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
 <span class="token keyword" data-v-47862caa>const</span> example <span class="token operator" data-v-47862caa>=</span> source<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span>
   <span class="token function" data-v-47862caa>take</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>10</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
   <span class="token function" data-v-47862caa>toArray</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span>
 <span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
 <span class="token keyword" data-v-47862caa>const</span> subscribe <span class="token operator" data-v-47862caa>=</span> example<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>val <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span>val<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
 <span class="token comment" data-v-47862caa>// output: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]</span>
 <span class="token comment" data-v-47862caa>// 结合 filter、map</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> from <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs'</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> filter <span class="token punctuation" data-v-47862caa>,</span> tap<span class="token punctuation" data-v-47862caa>,</span> toArray<span class="token punctuation" data-v-47862caa>,</span> map <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs/operators'</span>
<span class="token keyword" data-v-47862caa>const</span> arr <span class="token operator" data-v-47862caa>=</span> <span class="token punctuation" data-v-47862caa>[</span><span class="token punctuation" data-v-47862caa>{</span>
    a<span class="token operator" data-v-47862caa>:</span><span class="token number" data-v-47862caa>1</span><span class="token punctuation" data-v-47862caa>,</span>
    b<span class="token operator" data-v-47862caa>:</span><span class="token number" data-v-47862caa>2</span><span class="token punctuation" data-v-47862caa>,</span>
    c<span class="token operator" data-v-47862caa>:</span><span class="token number" data-v-47862caa>3</span>
<span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>,</span><span class="token punctuation" data-v-47862caa>{</span>
    a<span class="token operator" data-v-47862caa>:</span><span class="token number" data-v-47862caa>2</span><span class="token punctuation" data-v-47862caa>,</span>
    b<span class="token operator" data-v-47862caa>:</span><span class="token number" data-v-47862caa>4</span><span class="token punctuation" data-v-47862caa>,</span>
    c<span class="token operator" data-v-47862caa>:</span><span class="token number" data-v-47862caa>5</span><span class="token punctuation" data-v-47862caa>,</span>
<span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>,</span><span class="token punctuation" data-v-47862caa>{</span>
    a<span class="token operator" data-v-47862caa>:</span><span class="token number" data-v-47862caa>7</span><span class="token punctuation" data-v-47862caa>,</span>
    b<span class="token operator" data-v-47862caa>:</span><span class="token number" data-v-47862caa>10</span><span class="token punctuation" data-v-47862caa>,</span>
    c<span class="token operator" data-v-47862caa>:</span><span class="token number" data-v-47862caa>10</span>
<span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>]</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token function" data-v-47862caa>from</span><span class="token punctuation" data-v-47862caa>(</span>arr<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span>
    <span class="token function" data-v-47862caa>map</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>(</span>item<span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token punctuation" data-v-47862caa>{</span>
        <span class="token keyword" data-v-47862caa>return</span> <span class="token punctuation" data-v-47862caa>{</span>
            a<span class="token operator" data-v-47862caa>:</span>item<span class="token punctuation" data-v-47862caa>.</span>a<span class="token punctuation" data-v-47862caa>,</span>
            b<span class="token operator" data-v-47862caa>:</span>item<span class="token punctuation" data-v-47862caa>.</span>b <span class="token operator" data-v-47862caa>*</span> <span class="token number" data-v-47862caa>2</span><span class="token punctuation" data-v-47862caa>,</span>
            c<span class="token operator" data-v-47862caa>:</span> item<span class="token punctuation" data-v-47862caa>.</span>c
        <span class="token punctuation" data-v-47862caa>}</span>
    <span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
    <span class="token function" data-v-47862caa>tap</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>(</span>val<span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token punctuation" data-v-47862caa>{</span>
        <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>&quot;map result ....&quot;</span><span class="token punctuation" data-v-47862caa>,</span>val<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
    <span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
    <span class="token function" data-v-47862caa>toArray</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span>
<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span>log<span class="token punctuation" data-v-47862caa>)</span>

<span class="token function" data-v-47862caa>from</span><span class="token punctuation" data-v-47862caa>(</span>arr<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span>
    <span class="token function" data-v-47862caa>filter</span><span class="token punctuation" data-v-47862caa>(</span> <span class="token punctuation" data-v-47862caa>(</span>item<span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token punctuation" data-v-47862caa>{</span>
        <span class="token keyword" data-v-47862caa>return</span> item<span class="token punctuation" data-v-47862caa>.</span>a <span class="token operator" data-v-47862caa>&gt;</span> <span class="token number" data-v-47862caa>1</span><span class="token punctuation" data-v-47862caa>;</span>
    <span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
    <span class="token function" data-v-47862caa>tap</span><span class="token punctuation" data-v-47862caa>(</span> <span class="token punctuation" data-v-47862caa>(</span>val<span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token punctuation" data-v-47862caa>{</span>
        <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>&quot;the result is &quot;</span><span class="token punctuation" data-v-47862caa>,</span>val<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
    <span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
    <span class="token function" data-v-47862caa>toArray</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span>log<span class="token punctuation" data-v-47862caa>)</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa><span class="line-number" data-v-47862caa>10</span><br data-v-47862caa><span class="line-number" data-v-47862caa>11</span><br data-v-47862caa><span class="line-number" data-v-47862caa>12</span><br data-v-47862caa><span class="line-number" data-v-47862caa>13</span><br data-v-47862caa><span class="line-number" data-v-47862caa>14</span><br data-v-47862caa><span class="line-number" data-v-47862caa>15</span><br data-v-47862caa><span class="line-number" data-v-47862caa>16</span><br data-v-47862caa><span class="line-number" data-v-47862caa>17</span><br data-v-47862caa><span class="line-number" data-v-47862caa>18</span><br data-v-47862caa><span class="line-number" data-v-47862caa>19</span><br data-v-47862caa><span class="line-number" data-v-47862caa>20</span><br data-v-47862caa><span class="line-number" data-v-47862caa>21</span><br data-v-47862caa><span class="line-number" data-v-47862caa>22</span><br data-v-47862caa><span class="line-number" data-v-47862caa>23</span><br data-v-47862caa><span class="line-number" data-v-47862caa>24</span><br data-v-47862caa><span class="line-number" data-v-47862caa>25</span><br data-v-47862caa><span class="line-number" data-v-47862caa>26</span><br data-v-47862caa><span class="line-number" data-v-47862caa>27</span><br data-v-47862caa><span class="line-number" data-v-47862caa>28</span><br data-v-47862caa><span class="line-number" data-v-47862caa>29</span><br data-v-47862caa><span class="line-number" data-v-47862caa>30</span><br data-v-47862caa><span class="line-number" data-v-47862caa>31</span><br data-v-47862caa><span class="line-number" data-v-47862caa>32</span><br data-v-47862caa><span class="line-number" data-v-47862caa>33</span><br data-v-47862caa><span class="line-number" data-v-47862caa>34</span><br data-v-47862caa><span class="line-number" data-v-47862caa>35</span><br data-v-47862caa><span class="line-number" data-v-47862caa>36</span><br data-v-47862caa><span class="line-number" data-v-47862caa>37</span><br data-v-47862caa><span class="line-number" data-v-47862caa>38</span><br data-v-47862caa><span class="line-number" data-v-47862caa>39</span><br data-v-47862caa><span class="line-number" data-v-47862caa>40</span><br data-v-47862caa><span class="line-number" data-v-47862caa>41</span><br data-v-47862caa><span class="line-number" data-v-47862caa>42</span><br data-v-47862caa><span class="line-number" data-v-47862caa>43</span><br data-v-47862caa><span class="line-number" data-v-47862caa>44</span><br data-v-47862caa><span class="line-number" data-v-47862caa>45</span><br data-v-47862caa><span class="line-number" data-v-47862caa>46</span><br data-v-47862caa><span class="line-number" data-v-47862caa>47</span><br data-v-47862caa><span class="line-number" data-v-47862caa>48</span><br data-v-47862caa></div></div><ul data-v-47862caa><li data-v-47862caa>delay 延迟类 延迟执行，但是忽略error</li></ul> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa>  <span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> <span class="token keyword" data-v-47862caa>of</span> <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs'</span><span class="token punctuation" data-v-47862caa>;</span>
  <span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> tap<span class="token punctuation" data-v-47862caa>,</span> delay <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs/operators'</span><span class="token punctuation" data-v-47862caa>;</span>

  <span class="token keyword" data-v-47862caa>const</span> obs$ <span class="token operator" data-v-47862caa>=</span> <span class="token keyword" data-v-47862caa>of</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>[</span><span class="token number" data-v-47862caa>1</span><span class="token punctuation" data-v-47862caa>,</span><span class="token number" data-v-47862caa>2</span><span class="token punctuation" data-v-47862caa>]</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
  obs$<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>tap</span><span class="token punctuation" data-v-47862caa>(</span>res <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token punctuation" data-v-47862caa>{</span>
      <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>&quot;get value from of....&quot;</span><span class="token punctuation" data-v-47862caa>,</span><span class="token keyword" data-v-47862caa>new</span> <span class="token class-name" data-v-47862caa>Date</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>toLocaleTimeString</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
  <span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span><span class="token function" data-v-47862caa>delay</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>2000</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span><span class="token function" data-v-47862caa>tap</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token punctuation" data-v-47862caa>{</span>
     <span class="token comment" data-v-47862caa>// 延迟执行，也可以变成随机延迟。 delayWhen(event =&gt; interval(Math.random() * 5000))</span>
      <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>&quot;get value from of....&quot;</span><span class="token punctuation" data-v-47862caa>,</span><span class="token keyword" data-v-47862caa>new</span> <span class="token class-name" data-v-47862caa>Date</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>toLocaleTimeString</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
  <span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>res <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token punctuation" data-v-47862caa>{</span>
      <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>&quot;of res...;.&quot;</span><span class="token punctuation" data-v-47862caa>,</span>res<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
  <span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>

  <span class="token comment" data-v-47862caa>//output</span>
  <span class="token keyword" data-v-47862caa>get</span> value from <span class="token keyword" data-v-47862caa>of</span><span class="token operator" data-v-47862caa>...</span><span class="token punctuation" data-v-47862caa>.</span> <span class="token number" data-v-47862caa>7</span><span class="token operator" data-v-47862caa>:</span><span class="token number" data-v-47862caa>52</span><span class="token operator" data-v-47862caa>:</span><span class="token number" data-v-47862caa>27</span> <span class="token constant" data-v-47862caa>AM</span>
  <span class="token keyword" data-v-47862caa>get</span> value from <span class="token keyword" data-v-47862caa>of</span><span class="token operator" data-v-47862caa>...</span><span class="token punctuation" data-v-47862caa>.</span> <span class="token number" data-v-47862caa>7</span><span class="token operator" data-v-47862caa>:</span><span class="token number" data-v-47862caa>52</span><span class="token operator" data-v-47862caa>:</span><span class="token number" data-v-47862caa>29</span> <span class="token constant" data-v-47862caa>AM</span>
  <span class="token keyword" data-v-47862caa>of</span> res<span class="token operator" data-v-47862caa>...</span><span class="token punctuation" data-v-47862caa>;</span><span class="token punctuation" data-v-47862caa>.</span> <span class="token punctuation" data-v-47862caa>[</span> <span class="token number" data-v-47862caa>1</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>2</span> <span class="token punctuation" data-v-47862caa>]</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa><span class="line-number" data-v-47862caa>10</span><br data-v-47862caa><span class="line-number" data-v-47862caa>11</span><br data-v-47862caa><span class="line-number" data-v-47862caa>12</span><br data-v-47862caa><span class="line-number" data-v-47862caa>13</span><br data-v-47862caa><span class="line-number" data-v-47862caa>14</span><br data-v-47862caa><span class="line-number" data-v-47862caa>15</span><br data-v-47862caa><span class="line-number" data-v-47862caa>16</span><br data-v-47862caa><span class="line-number" data-v-47862caa>17</span><br data-v-47862caa></div></div><ul data-v-47862caa><li data-v-47862caa>delayWhen</li></ul> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> interval<span class="token punctuation" data-v-47862caa>,</span> timer <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> delayWhen <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs/operators'</span><span class="token punctuation" data-v-47862caa>;</span>

<span class="token keyword" data-v-47862caa>const</span> message <span class="token operator" data-v-47862caa>=</span> <span class="token function" data-v-47862caa>interval</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1000</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> <span class="token function-variable function" data-v-47862caa>delayForFiveSeconds</span> <span class="token operator" data-v-47862caa>=</span> <span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token function" data-v-47862caa>timer</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>5000</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> delayWhenExample <span class="token operator" data-v-47862caa>=</span> message<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>delayWhen</span><span class="token punctuation" data-v-47862caa>(</span>delayForFiveSeconds<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> subscribe <span class="token operator" data-v-47862caa>=</span> delayWhenExample<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>val <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span>val<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>//output</span>
<span class="token number" data-v-47862caa>5</span>s延迟<span class="token operator" data-v-47862caa>...</span><span class="token punctuation" data-v-47862caa>.</span>

<span class="token number" data-v-47862caa>0</span>
<span class="token number" data-v-47862caa>1</span>
<span class="token number" data-v-47862caa>2</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa><span class="line-number" data-v-47862caa>10</span><br data-v-47862caa><span class="line-number" data-v-47862caa>11</span><br data-v-47862caa><span class="line-number" data-v-47862caa>12</span><br data-v-47862caa><span class="line-number" data-v-47862caa>13</span><br data-v-47862caa></div></div><ul data-v-47862caa><li data-v-47862caa>timeout/timeInterval 总的来说timeInterval 输出对象，timeout输出值</li></ul> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> timeInterval<span class="token punctuation" data-v-47862caa>,</span> timeout <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>&quot;rxjs/operators&quot;</span><span class="token punctuation" data-v-47862caa>;</span>
 <span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> interval <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>&quot;rxjs&quot;</span><span class="token punctuation" data-v-47862caa>;</span>
 <span class="token keyword" data-v-47862caa>const</span> seconds <span class="token operator" data-v-47862caa>=</span> <span class="token function" data-v-47862caa>interval</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1000</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
 seconds<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>timeInterval</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span>
 <span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>
     value <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token punctuation" data-v-47862caa>{</span>
         <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>&quot;time.....&quot;</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
         <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span>value<span class="token punctuation" data-v-47862caa>)</span>
     <span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>,</span>
     err <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span>err<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
 <span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
 seconds<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>timeout</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1100</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span> # <span class="token number" data-v-47862caa>900</span>小于间隔<span class="token number" data-v-47862caa>1000</span>，会忽略，不输出值
 <span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>
     value <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token punctuation" data-v-47862caa>{</span>
         <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>&quot;out.....&quot;</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
         <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span>value<span class="token punctuation" data-v-47862caa>)</span>
     <span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>,</span>
     err <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span>err<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
 <span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>//output</span>
 time<span class="token operator" data-v-47862caa>...</span><span class="token punctuation" data-v-47862caa>.</span><span class="token punctuation" data-v-47862caa>.</span>
 TimeInterval <span class="token punctuation" data-v-47862caa>{</span> value<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>0</span><span class="token punctuation" data-v-47862caa>,</span> interval<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>1007</span> <span class="token punctuation" data-v-47862caa>}</span>
 out<span class="token operator" data-v-47862caa>...</span><span class="token punctuation" data-v-47862caa>.</span><span class="token punctuation" data-v-47862caa>.</span>
 <span class="token number" data-v-47862caa>0</span>
 time<span class="token operator" data-v-47862caa>...</span><span class="token punctuation" data-v-47862caa>.</span><span class="token punctuation" data-v-47862caa>.</span>
 TimeInterval <span class="token punctuation" data-v-47862caa>{</span> value<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>1</span><span class="token punctuation" data-v-47862caa>,</span> interval<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>1005</span> <span class="token punctuation" data-v-47862caa>}</span>
 out<span class="token operator" data-v-47862caa>...</span><span class="token punctuation" data-v-47862caa>.</span><span class="token punctuation" data-v-47862caa>.</span>
 <span class="token number" data-v-47862caa>1</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa><span class="line-number" data-v-47862caa>10</span><br data-v-47862caa><span class="line-number" data-v-47862caa>11</span><br data-v-47862caa><span class="line-number" data-v-47862caa>12</span><br data-v-47862caa><span class="line-number" data-v-47862caa>13</span><br data-v-47862caa><span class="line-number" data-v-47862caa>14</span><br data-v-47862caa><span class="line-number" data-v-47862caa>15</span><br data-v-47862caa><span class="line-number" data-v-47862caa>16</span><br data-v-47862caa><span class="line-number" data-v-47862caa>17</span><br data-v-47862caa><span class="line-number" data-v-47862caa>18</span><br data-v-47862caa><span class="line-number" data-v-47862caa>19</span><br data-v-47862caa><span class="line-number" data-v-47862caa>20</span><br data-v-47862caa><span class="line-number" data-v-47862caa>21</span><br data-v-47862caa><span class="line-number" data-v-47862caa>22</span><br data-v-47862caa><span class="line-number" data-v-47862caa>23</span><br data-v-47862caa><span class="line-number" data-v-47862caa>24</span><br data-v-47862caa><span class="line-number" data-v-47862caa>25</span><br data-v-47862caa><span class="line-number" data-v-47862caa>26</span><br data-v-47862caa><span class="line-number" data-v-47862caa>27</span><br data-v-47862caa><span class="line-number" data-v-47862caa>28</span><br data-v-47862caa></div></div><ul data-v-47862caa><li data-v-47862caa>timeoutWith</li></ul> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> interval <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> timeoutWith <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs/operators'</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> <span class="token keyword" data-v-47862caa>of</span> <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> first$ <span class="token operator" data-v-47862caa>=</span> <span class="token function" data-v-47862caa>interval</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>3000</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> second$ <span class="token operator" data-v-47862caa>=</span> <span class="token keyword" data-v-47862caa>of</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'go to the default'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
first$<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>timeoutWith</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>2000</span><span class="token punctuation" data-v-47862caa>,</span>second$<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span>log<span class="token punctuation" data-v-47862caa>)</span> # <span class="token number" data-v-47862caa>2</span>s内必须获取到数据，否则走默认值
<span class="token comment" data-v-47862caa>//output</span>
go to the <span class="token keyword" data-v-47862caa>default</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa></div></div><ul data-v-47862caa><li data-v-47862caa>interval 异步产生数据</li></ul> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> interval <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> take <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs/operators'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> numbers <span class="token operator" data-v-47862caa>=</span> <span class="token function" data-v-47862caa>interval</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1000</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> takeFourNumbers <span class="token operator" data-v-47862caa>=</span> numbers<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>take</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>4</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
takeFourNumbers<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>x <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'Next: '</span><span class="token punctuation" data-v-47862caa>,</span> x<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>// Logs:</span>
<span class="token comment" data-v-47862caa>// Next: 0</span>
<span class="token comment" data-v-47862caa>// Next: 1</span>
<span class="token comment" data-v-47862caa>// Next: 2</span>
<span class="token comment" data-v-47862caa>// Next: 3</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa><span class="line-number" data-v-47862caa>10</span><br data-v-47862caa></div></div><ul data-v-47862caa><li data-v-47862caa>timer</li></ul> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> timer <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> numbers <span class="token operator" data-v-47862caa>=</span> <span class="token function" data-v-47862caa>timer</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>3000</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>1000</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
numbers<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>x <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span>x<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa></div></div><h2 id="条件-布尔" data-v-47862caa><a href="#条件-布尔" class="header-anchor" data-v-47862caa>#</a> 条件/布尔</h2> <ul data-v-47862caa><li data-v-47862caa>every</li></ul> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token comment" data-v-47862caa>// 每一个都需要满足条件才true</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> <span class="token keyword" data-v-47862caa>of</span> <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> every <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs/operators'</span><span class="token punctuation" data-v-47862caa>;</span>

<span class="token keyword" data-v-47862caa>of</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>2</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>3</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>4</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>5</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>6</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span>
    <span class="token function" data-v-47862caa>every</span><span class="token punctuation" data-v-47862caa>(</span>x <span class="token operator" data-v-47862caa>=&gt;</span> x <span class="token operator" data-v-47862caa>&lt;</span> <span class="token number" data-v-47862caa>5</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
<span class="token punctuation" data-v-47862caa>)</span>
<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>x <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span>x<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span> <span class="token comment" data-v-47862caa>// -&gt; false</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa></div></div><ul data-v-47862caa><li data-v-47862caa>find、findIndex 找到第一个满足条件的就行</li></ul> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> fromEvent <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> find <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs/operators'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> clicks <span class="token operator" data-v-47862caa>=</span> <span class="token function" data-v-47862caa>fromEvent</span><span class="token punctuation" data-v-47862caa>(</span>document<span class="token punctuation" data-v-47862caa>,</span> <span class="token string" data-v-47862caa>'click'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> result <span class="token operator" data-v-47862caa>=</span> clicks<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>find</span><span class="token punctuation" data-v-47862caa>(</span>ev <span class="token operator" data-v-47862caa>=&gt;</span> ev<span class="token punctuation" data-v-47862caa>.</span>target<span class="token punctuation" data-v-47862caa>.</span>tagName <span class="token operator" data-v-47862caa>===</span> <span class="token string" data-v-47862caa>'DIV'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
result<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>x <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span>x<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa></div></div><ul data-v-47862caa><li data-v-47862caa>isEmpty 判断Observable是否为空</li></ul> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> Subject <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> isEmpty <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs/operators'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> source <span class="token operator" data-v-47862caa>=</span> <span class="token keyword" data-v-47862caa>new</span> <span class="token class-name" data-v-47862caa>Subject<span class="token operator" data-v-47862caa>&lt;</span><span class="token builtin" data-v-47862caa>string</span><span class="token operator" data-v-47862caa>&gt;</span></span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> result <span class="token operator" data-v-47862caa>=</span> source<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>isEmpty</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
source<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>x <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span>x<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
result<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>x <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span>x<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
source<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>next</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'a'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
source<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>next</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'b'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
source<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>next</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'c'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
source<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>complete</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>// Results in:</span>
<span class="token comment" data-v-47862caa>// a</span>
<span class="token comment" data-v-47862caa>// false</span>
<span class="token comment" data-v-47862caa>// b</span>
<span class="token comment" data-v-47862caa>// c</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa><span class="line-number" data-v-47862caa>10</span><br data-v-47862caa><span class="line-number" data-v-47862caa>11</span><br data-v-47862caa><span class="line-number" data-v-47862caa>12</span><br data-v-47862caa><span class="line-number" data-v-47862caa>13</span><br data-v-47862caa><span class="line-number" data-v-47862caa>14</span><br data-v-47862caa><span class="line-number" data-v-47862caa>15</span><br data-v-47862caa></div></div><ul data-v-47862caa><li data-v-47862caa>iif 条件</li></ul> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> iif<span class="token punctuation" data-v-47862caa>,</span> <span class="token keyword" data-v-47862caa>of</span><span class="token punctuation" data-v-47862caa>,</span> interval <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> mergeMap <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs/operators'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> r$ <span class="token operator" data-v-47862caa>=</span> <span class="token keyword" data-v-47862caa>of</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'R'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> x$ <span class="token operator" data-v-47862caa>=</span> <span class="token keyword" data-v-47862caa>of</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'X'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token function" data-v-47862caa>interval</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1000</span><span class="token punctuation" data-v-47862caa>)</span>
  <span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>mergeMap</span><span class="token punctuation" data-v-47862caa>(</span>v <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token function" data-v-47862caa>iif</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> v <span class="token operator" data-v-47862caa>%</span> <span class="token number" data-v-47862caa>4</span> <span class="token operator" data-v-47862caa>===</span> <span class="token number" data-v-47862caa>0</span><span class="token punctuation" data-v-47862caa>,</span> r$<span class="token punctuation" data-v-47862caa>,</span> x$<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span>
  <span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span>log<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>//output </span>
<span class="token constant" data-v-47862caa>R</span>
<span class="token constant" data-v-47862caa>X</span>
<span class="token constant" data-v-47862caa>R</span>
<span class="token constant" data-v-47862caa>X</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa><span class="line-number" data-v-47862caa>10</span><br data-v-47862caa><span class="line-number" data-v-47862caa>11</span><br data-v-47862caa><span class="line-number" data-v-47862caa>12</span><br data-v-47862caa></div></div><ul data-v-47862caa><li data-v-47862caa>onErrorResumeNext 将无错误地移动到下一个源</li></ul> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>let</span> <span class="token punctuation" data-v-47862caa>{</span> onErrorResumeNext<span class="token punctuation" data-v-47862caa>,</span> <span class="token keyword" data-v-47862caa>of</span> <span class="token punctuation" data-v-47862caa>}</span> <span class="token operator" data-v-47862caa>=</span> <span class="token keyword" data-v-47862caa>require</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>&quot;rxjs&quot;</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>let</span> <span class="token punctuation" data-v-47862caa>{</span> map <span class="token punctuation" data-v-47862caa>}</span> <span class="token operator" data-v-47862caa>=</span> <span class="token keyword" data-v-47862caa>require</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>&quot;rxjs/operators&quot;</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>

<span class="token function" data-v-47862caa>onErrorResumeNext</span><span class="token punctuation" data-v-47862caa>(</span>
  <span class="token keyword" data-v-47862caa>of</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>2</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>0</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>1</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span>
    <span class="token function" data-v-47862caa>map</span><span class="token punctuation" data-v-47862caa>(</span>el <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token punctuation" data-v-47862caa>{</span>
      <span class="token keyword" data-v-47862caa>if</span> <span class="token punctuation" data-v-47862caa>(</span>el <span class="token operator" data-v-47862caa>===</span> <span class="token number" data-v-47862caa>0</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token keyword" data-v-47862caa>throw</span> <span class="token function" data-v-47862caa>Error</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>&quot;000&quot;</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
      <span class="token keyword" data-v-47862caa>return</span> el <span class="token operator" data-v-47862caa>+</span> el<span class="token punctuation" data-v-47862caa>;</span>
    <span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
  <span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
  <span class="token keyword" data-v-47862caa>of</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>&quot;2&quot;</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>l<span class="token punctuation" data-v-47862caa>,</span> err <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>error</span><span class="token punctuation" data-v-47862caa>(</span>err<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token function" data-v-47862caa>l</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>&quot;done&quot;</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span> <span class="token comment" data-v-47862caa>// 2, 4, 2, done</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa><span class="line-number" data-v-47862caa>10</span><br data-v-47862caa><span class="line-number" data-v-47862caa>11</span><br data-v-47862caa><span class="line-number" data-v-47862caa>12</span><br data-v-47862caa></div></div><ul data-v-47862caa><li data-v-47862caa>isObservable</li></ul> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>let</span> <span class="token punctuation" data-v-47862caa>{</span> isObservable <span class="token punctuation" data-v-47862caa>}</span> <span class="token operator" data-v-47862caa>=</span> <span class="token keyword" data-v-47862caa>require</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>&quot;rxjs&quot;</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token function" data-v-47862caa>l</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>isObservable</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>2</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span> <span class="token comment" data-v-47862caa>// false</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa></div></div><ul data-v-47862caa><li data-v-47862caa>partition 将源Observable分为两个，一个具有满足谓词的值，另一个具有不满足谓词的值。用来做流内条件判断</li></ul> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> fromEvent <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> partition <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs/operators'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> clicks <span class="token operator" data-v-47862caa>=</span> <span class="token function" data-v-47862caa>fromEvent</span><span class="token punctuation" data-v-47862caa>(</span>document<span class="token punctuation" data-v-47862caa>,</span> <span class="token string" data-v-47862caa>'click'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> parts <span class="token operator" data-v-47862caa>=</span> clicks<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>partition</span><span class="token punctuation" data-v-47862caa>(</span>ev <span class="token operator" data-v-47862caa>=&gt;</span> ev<span class="token punctuation" data-v-47862caa>.</span>target<span class="token punctuation" data-v-47862caa>.</span>tagName <span class="token operator" data-v-47862caa>===</span> <span class="token string" data-v-47862caa>'DIV'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> clicksOnDivs <span class="token operator" data-v-47862caa>=</span> parts<span class="token punctuation" data-v-47862caa>[</span><span class="token number" data-v-47862caa>0</span><span class="token punctuation" data-v-47862caa>]</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> clicksElsewhere <span class="token operator" data-v-47862caa>=</span> parts<span class="token punctuation" data-v-47862caa>[</span><span class="token number" data-v-47862caa>1</span><span class="token punctuation" data-v-47862caa>]</span><span class="token punctuation" data-v-47862caa>;</span>
clicksOnDivs<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>x <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'DIV clicked: '</span><span class="token punctuation" data-v-47862caa>,</span> x<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
clicksElsewhere<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>x <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'Other clicked: '</span><span class="token punctuation" data-v-47862caa>,</span> x<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa></div></div><ul data-v-47862caa><li data-v-47862caa>defaultIfEmpty 空默认值 如果在完成前没有发出任何通知，那么发出给定的值</li></ul> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> defaultIfEmpty <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs/operators'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> empty<span class="token punctuation" data-v-47862caa>,</span><span class="token keyword" data-v-47862caa>of</span><span class="token punctuation" data-v-47862caa>,</span> merge <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> exampleOne <span class="token operator" data-v-47862caa>=</span> <span class="token keyword" data-v-47862caa>of</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>defaultIfEmpty</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'Observable.of() Empty!'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span> <span class="token comment" data-v-47862caa>//  没有值的 Observable.of 的默认值</span>
<span class="token keyword" data-v-47862caa>const</span> example <span class="token operator" data-v-47862caa>=</span> <span class="token function" data-v-47862caa>empty</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>defaultIfEmpty</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'Observable.empty()!'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span> <span class="token comment" data-v-47862caa>// Observable.empty 的默认值</span>
<span class="token function" data-v-47862caa>merge</span><span class="token punctuation" data-v-47862caa>(</span>
    example<span class="token punctuation" data-v-47862caa>,</span>
    exampleOne
<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span>log<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>//output </span>
Observable<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>empty</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token operator" data-v-47862caa>!</span>
Observable<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>of</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> Empty<span class="token operator" data-v-47862caa>!</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa><span class="line-number" data-v-47862caa>10</span><br data-v-47862caa><span class="line-number" data-v-47862caa>11</span><br data-v-47862caa></div></div><h2 id="数学" data-v-47862caa><a href="#数学" class="header-anchor" data-v-47862caa>#</a> 数学</h2> <ul data-v-47862caa><li data-v-47862caa>count 统计总数</li></ul> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> range <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> count <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs/operators'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> numbers <span class="token operator" data-v-47862caa>=</span> <span class="token function" data-v-47862caa>range</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>7</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> result <span class="token operator" data-v-47862caa>=</span> numbers<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>count</span><span class="token punctuation" data-v-47862caa>(</span>i <span class="token operator" data-v-47862caa>=&gt;</span> i <span class="token operator" data-v-47862caa>%</span> <span class="token number" data-v-47862caa>2</span> <span class="token operator" data-v-47862caa>===</span> <span class="token number" data-v-47862caa>1</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
result<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>x <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span>x<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>// Results in:</span>
<span class="token comment" data-v-47862caa>// 4</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa></div></div><ul data-v-47862caa><li data-v-47862caa>reduce  累计</li></ul> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> fromEvent<span class="token punctuation" data-v-47862caa>,</span> interval <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> reduce<span class="token punctuation" data-v-47862caa>,</span> takeUntil<span class="token punctuation" data-v-47862caa>,</span> mapTo <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs/operators'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> clicksInFiveSeconds <span class="token operator" data-v-47862caa>=</span> <span class="token function" data-v-47862caa>fromEvent</span><span class="token punctuation" data-v-47862caa>(</span>document<span class="token punctuation" data-v-47862caa>,</span> <span class="token string" data-v-47862caa>'click'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span>
  <span class="token function" data-v-47862caa>takeUntil</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>interval</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>5000</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> ones <span class="token operator" data-v-47862caa>=</span> clicksInFiveSeconds<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>mapTo</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> seed <span class="token operator" data-v-47862caa>=</span> <span class="token number" data-v-47862caa>0</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> count <span class="token operator" data-v-47862caa>=</span> ones<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>reduce</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>(</span>acc<span class="token punctuation" data-v-47862caa>,</span> one<span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> acc <span class="token operator" data-v-47862caa>+</span> one<span class="token punctuation" data-v-47862caa>,</span> seed<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
count<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>x <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span>x<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa></div></div><ul data-v-47862caa><li data-v-47862caa>max/min</li></ul> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> <span class="token keyword" data-v-47862caa>of</span><span class="token punctuation" data-v-47862caa>,</span>merge <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> max<span class="token punctuation" data-v-47862caa>,</span>min<span class="token punctuation" data-v-47862caa>,</span>tap <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs/operators'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> obs$ <span class="token operator" data-v-47862caa>=</span> <span class="token keyword" data-v-47862caa>of</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>5</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>4</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>7</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>2</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>8</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token function" data-v-47862caa>merge</span><span class="token punctuation" data-v-47862caa>(</span>
    obs$<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>max</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
    obs$<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>min</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>tap</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>(</span>val<span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token punctuation" data-v-47862caa>{</span>
    <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>&quot;result....&quot;</span><span class="token punctuation" data-v-47862caa>,</span>val<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span>log<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>//output</span>
result<span class="token operator" data-v-47862caa>...</span><span class="token punctuation" data-v-47862caa>.</span> <span class="token number" data-v-47862caa>8</span>
<span class="token number" data-v-47862caa>8</span>
result<span class="token operator" data-v-47862caa>...</span><span class="token punctuation" data-v-47862caa>.</span> <span class="token number" data-v-47862caa>2</span>
<span class="token number" data-v-47862caa>2</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa><span class="line-number" data-v-47862caa>10</span><br data-v-47862caa><span class="line-number" data-v-47862caa>11</span><br data-v-47862caa><span class="line-number" data-v-47862caa>12</span><br data-v-47862caa><span class="line-number" data-v-47862caa>13</span><br data-v-47862caa><span class="line-number" data-v-47862caa>14</span><br data-v-47862caa></div></div><h2 id="映射-拍平-截断" data-v-47862caa><a href="#映射-拍平-截断" class="header-anchor" data-v-47862caa>#</a> 映射/拍平/截断</h2> <p data-v-47862caa>流和流的操作最让人困惑的大概是流和流的映射关系，这点很重要，理解了map，我们后续深入rxjs才有了基本根基。我们先以一个例子过下<code data-v-47862caa>map、concatAll、concatMap、mergeAll、mergeMap、switchAll、switchMap</code>这些操作符。</p> <h3 id="map" data-v-47862caa><a href="#map" class="header-anchor" data-v-47862caa>#</a> map</h3> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa> <span class="token keyword" data-v-47862caa>const</span> <span class="token function-variable function" data-v-47862caa>getData</span> <span class="token operator" data-v-47862caa>=</span> <span class="token punctuation" data-v-47862caa>(</span>param<span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token punctuation" data-v-47862caa>{</span>
    <span class="token keyword" data-v-47862caa>return</span> <span class="token keyword" data-v-47862caa>of</span><span class="token punctuation" data-v-47862caa>(</span><span class="token template-string" data-v-47862caa><span class="token template-punctuation string" data-v-47862caa>`</span><span class="token string" data-v-47862caa>return: </span><span class="token interpolation" data-v-47862caa><span class="token interpolation-punctuation punctuation" data-v-47862caa>${</span>param<span class="token interpolation-punctuation punctuation" data-v-47862caa>}</span></span><span class="token template-punctuation string" data-v-47862caa>`</span></span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span>
      <span class="token function" data-v-47862caa>delay</span><span class="token punctuation" data-v-47862caa>(</span>Math<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>random</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>*</span> <span class="token number" data-v-47862caa>1000</span><span class="token punctuation" data-v-47862caa>)</span>
    <span class="token punctuation" data-v-47862caa>)</span>
  <span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>;</span>
  <span class="token function" data-v-47862caa>from</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>[</span><span class="token number" data-v-47862caa>1</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>2</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>3</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>4</span><span class="token punctuation" data-v-47862caa>,</span><span class="token number" data-v-47862caa>5</span><span class="token punctuation" data-v-47862caa>]</span><span class="token punctuation" data-v-47862caa>)</span>
    <span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span>
      <span class="token function" data-v-47862caa>map</span><span class="token punctuation" data-v-47862caa>(</span>param <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token function" data-v-47862caa>getData</span><span class="token punctuation" data-v-47862caa>(</span>param<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
    <span class="token punctuation" data-v-47862caa>)</span>
    <span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>val <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span>val<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa><span class="line-number" data-v-47862caa>10</span><br data-v-47862caa></div></div><p data-v-47862caa>控制台输出是：
<center data-v-47862caa><img src="https://img-blog.csdnimg.cn/20190309170601358.png" data-v-47862caa></center>
getData返回的是observable, 但是如果我想拿到返回的observable里面的值，怎么办呢？就是下面的方法了：</p> <h3 id="concatall" data-v-47862caa><a href="#concatall" class="header-anchor" data-v-47862caa>#</a> concatAll</h3> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token function" data-v-47862caa>from</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>[</span><span class="token number" data-v-47862caa>1</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>2</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>3</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>4</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>5</span><span class="token punctuation" data-v-47862caa>]</span><span class="token punctuation" data-v-47862caa>)</span>
    <span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span>
      <span class="token function" data-v-47862caa>map</span><span class="token punctuation" data-v-47862caa>(</span>param <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token function" data-v-47862caa>getData</span><span class="token punctuation" data-v-47862caa>(</span>param<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
      <span class="token function" data-v-47862caa>concatAll</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span>  <span class="token comment" data-v-47862caa>// 比上个例子多出的部分</span>
    <span class="token punctuation" data-v-47862caa>)</span>
    <span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>val <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span>val<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa></div></div><p data-v-47862caa>输出结果是：</p> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>return</span><span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>1</span>
<span class="token keyword" data-v-47862caa>return</span><span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>2</span>
<span class="token keyword" data-v-47862caa>return</span><span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>3</span>
<span class="token keyword" data-v-47862caa>return</span><span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>4</span>
<span class="token keyword" data-v-47862caa>return</span><span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>5</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa></div></div><p data-v-47862caa>多跑几次代码，每次都是这个输出顺序。
和上个demo相比，直接拿到了getData返回的observable中的值，因为concatAll有个flatten效果。不过可以把map和concatAll直接结合成一个操作符, 就是下面这个：</p> <h3 id="concatmap" data-v-47862caa><a href="#concatmap" class="header-anchor" data-v-47862caa>#</a> concatMap</h3> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token function" data-v-47862caa>from</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>[</span><span class="token number" data-v-47862caa>1</span><span class="token punctuation" data-v-47862caa>,</span><span class="token number" data-v-47862caa>2</span><span class="token punctuation" data-v-47862caa>,</span><span class="token number" data-v-47862caa>3</span><span class="token punctuation" data-v-47862caa>,</span><span class="token number" data-v-47862caa>4</span><span class="token punctuation" data-v-47862caa>,</span><span class="token number" data-v-47862caa>5</span><span class="token punctuation" data-v-47862caa>]</span><span class="token punctuation" data-v-47862caa>)</span>
   <span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span>
     <span class="token function" data-v-47862caa>concatMap</span><span class="token punctuation" data-v-47862caa>(</span>param <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token function" data-v-47862caa>getData</span><span class="token punctuation" data-v-47862caa>(</span>param<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span>
   <span class="token punctuation" data-v-47862caa>)</span>
   <span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>val <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span>val<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa></div></div><p data-v-47862caa>这个操作符可以传递好几个参数。我们在来看下mergeAll：</p> <h3 id="mergeall" data-v-47862caa><a href="#mergeall" class="header-anchor" data-v-47862caa>#</a> mergeAll</h3> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token function" data-v-47862caa>from</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>[</span><span class="token number" data-v-47862caa>1</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>2</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>3</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>4</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>5</span><span class="token punctuation" data-v-47862caa>]</span><span class="token punctuation" data-v-47862caa>)</span>
    <span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span>
          <span class="token function" data-v-47862caa>map</span><span class="token punctuation" data-v-47862caa>(</span>
             item <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token function" data-v-47862caa>getData</span><span class="token punctuation" data-v-47862caa>(</span>item<span class="token punctuation" data-v-47862caa>)</span>
          <span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
          <span class="token function" data-v-47862caa>mergeAll</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span>
    <span class="token punctuation" data-v-47862caa>)</span>
    <span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>v <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span>v<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa></div></div><p data-v-47862caa>多跑几次，就会发现每次的输出的顺序都是不一致的，并不是按照1 2 3 4 5的顺序输出的,这里mergeAll接受2个observable，每个observable发射出来值之后，mergeAll之后产生的observable就直接emit了（并行）。而concatAll按照顺序emit（串行）。map + mergeAll就是下面的mergeMap</p> <div class="custom-block tip" data-v-47862caa><p class="custom-block-title" data-v-47862caa>温馨提示</p> <p data-v-47862caa>mergeAll(1)也可以实现concatAll的效果</p></div> <h3 id="mergemap-flatmap" data-v-47862caa><a href="#mergemap-flatmap" class="header-anchor" data-v-47862caa>#</a> mergeMap(flatMap)</h3> <p data-v-47862caa>又叫flatMap</p> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa>  <span class="token function" data-v-47862caa>from</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>[</span><span class="token number" data-v-47862caa>1</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>2</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>3</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>4</span><span class="token punctuation" data-v-47862caa>,</span><span class="token number" data-v-47862caa>5</span><span class="token punctuation" data-v-47862caa>]</span><span class="token punctuation" data-v-47862caa>)</span>
    <span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span>
      <span class="token function" data-v-47862caa>mergeMap</span><span class="token punctuation" data-v-47862caa>(</span>param <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token function" data-v-47862caa>getData</span><span class="token punctuation" data-v-47862caa>(</span>param<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span>
    <span class="token punctuation" data-v-47862caa>)</span>
    <span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>val <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span>val<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa></div></div><h3 id="flatmaplatest-switchmap" data-v-47862caa><a href="#flatmaplatest-switchmap" class="header-anchor" data-v-47862caa>#</a> flatMapLatest(switchMap)</h3> <p data-v-47862caa>又叫switchMap。flatMap有一个很适用的场景，就是搜索框。在用户输入一串字符后，将其发送到服务器并获取搜索结果，这里就涉及到两个Observable。</p> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa>Observable
<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>fromEvent</span><span class="token punctuation" data-v-47862caa>(</span>$input<span class="token punctuation" data-v-47862caa>,</span> <span class="token string" data-v-47862caa>'keyup'</span><span class="token punctuation" data-v-47862caa>)</span>
<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>flatMap</span><span class="token punctuation" data-v-47862caa>(</span>text <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token function" data-v-47862caa>getHttpResponse</span><span class="token punctuation" data-v-47862caa>(</span>text<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span>
<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>data <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span>data<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa></div></div><p data-v-47862caa>使用flatMap就可以直接获取到新的Observable返回的数据。但是这里存在一个问题，如果用户有多次输入，由于网络原因可能会发生前一次响应时间比后一次长的情况，这时后一次的结果就被覆盖了。</p> <p data-v-47862caa>flatMapLatest可以解决这个问题。如果之前的Observable还没有未触发，而又收到了新的Observable，flatMapLatest会取消之前的Observable，只处理最新收到的Observable，这样就保证了处理请求的先后顺序，flatMapLatest在RxJS 5.x中已更名为switchMap。</p> <p data-v-47862caa>这里还会有一个问题。switchMap在处理连续多次点击流会只用最后一次点击流，这意味着他会一直响应，有时候我们希望如果已经点击了发请求了，再次点击就不要去请求了，这时候就要用到exhaustMap,它会在从流还没有结束的时候如果主流仍然有数据在发射，它会忽略此时主流发射的数据，而在从流结束以后才会去响应主流中正在发射的数据，遗弃之前发射的响应。</p> <h3 id="exhaustmap" data-v-47862caa><a href="#exhaustmap" class="header-anchor" data-v-47862caa>#</a> exhaustMap</h3> <p data-v-47862caa><code data-v-47862caa>switchMap/concatMap/flatMap/exhaustMap</code>都存在一个主流和一个从流，主流上每发射一次数据都会触发从流开始发射数据，最后数据都被打平到同一个输出流中。在看exhaustMap前，我们进一步来认识这些类似的操作符，以下四个例子，主流是每500毫秒发射一次数据，从流是每200毫秒发射数据，每次主流发射数据都会触发从流。</p> <h4 id="switchmap-flatmaplatest" data-v-47862caa><a href="#switchmap-flatmaplatest" class="header-anchor" data-v-47862caa>#</a> switchMap(flatMapLatest)</h4> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>var</span> mainstream <span class="token operator" data-v-47862caa>=</span> Rx<span class="token punctuation" data-v-47862caa>.</span>Observable<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>interval</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>500</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
mainstream<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>switchMap</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>(</span>x<span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> Rx<span class="token punctuation" data-v-47862caa>.</span>Observable<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>interval</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>200</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>take</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>5</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa></div></div><center data-v-47862caa><img src="/vuebloger/img/post/1611421778-5b1a4b5a139b2_fix732.png" data-v-47862caa></center>
从结果可以看到，用switchMap的时候，从流每次只能发射2个数据0-1，这是因为主流每发射一次触发了从流的发射，但是在从流发射的过程中，如果主流又一次发射了数据，switchMap会截断上一次的从流，响应本次的主流，从而开启新的一段的从流发射。
<h4 id="concatmap-2" data-v-47862caa><a href="#concatmap-2" class="header-anchor" data-v-47862caa>#</a> concatMap</h4> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>var</span> mainstream<span class="token operator" data-v-47862caa>=</span> Rx<span class="token punctuation" data-v-47862caa>.</span>Observable<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>interval</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>500</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
mainstream<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>concatMap</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>(</span>x<span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> Rx<span class="token punctuation" data-v-47862caa>.</span>Observable<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>interval</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>200</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>take</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>5</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa></div></div><center data-v-47862caa><img src="/vuebloger/img/post/1062811339-5b1a4b2237886_fix732.png" data-v-47862caa></center>
从结果可以看到，用concatMap的时候，虽然在从流还没有结束的时候，主流还在发射数据，主流会先把发射的数据缓存起来，等从流结束后立即响应主流的数据从而引发新一轮的从流发射，这有些类似与js的消息队列机制。所以我们看到它的输出流响应是连续的。
<h4 id="flatmap-mergemap" data-v-47862caa><a href="#flatmap-mergemap" class="header-anchor" data-v-47862caa>#</a> flatMap(mergeMap)</h4> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>var</span> mainstream<span class="token operator" data-v-47862caa>=</span> Rx<span class="token punctuation" data-v-47862caa>.</span>Observable<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>interval</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>500</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
mainstream<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>flatMap</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>(</span>x<span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> Rx<span class="token punctuation" data-v-47862caa>.</span>Observable<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>interval</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>200</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>take</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>5</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa></div></div><center data-v-47862caa><img src="/vuebloger/img/post/4237824604-5b1a4b8a396c9_fix732.png" data-v-47862caa></center>
从结果可以看出来，flatMap/mergeMap会即使响应主流中发射的每一个数据，它既不会忽略也不会缓存，这就导致主流中数据对应的从流产生了叠加。
<h4 id="exhaustmap-2" data-v-47862caa><a href="#exhaustmap-2" class="header-anchor" data-v-47862caa>#</a> exhaustMap</h4> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>var</span> mainstream<span class="token operator" data-v-47862caa>=</span> Rx<span class="token punctuation" data-v-47862caa>.</span>Observable<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>interval</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>500</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
mainstream<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>exhaustMap</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>(</span>x<span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> Rx<span class="token punctuation" data-v-47862caa>.</span>Observable<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>interval</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>200</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>take</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>5</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa></div></div><center data-v-47862caa><img src="/vuebloger/img/post/638895358-5b1a4c12a7dcd_fix732.png" data-v-47862caa></center>
从结果可以看出，exhaustMap在从流还没有结束的时候如果主流仍然有数据在发射，它会忽略此时主流发射的数据，而在从流结束以后才会去响应主流中发射的数据。
<h2 id="map在时间维度上叠加" data-v-47862caa><a href="#map在时间维度上叠加" class="header-anchor" data-v-47862caa>#</a> map在时间维度上叠加</h2> <p data-v-47862caa>我们再进一步在时间维度看下流和流的映射效果，下面示例需要你反序去理解消化。首先我们定义一下我们的源。</p> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>const</span> <span class="token punctuation" data-v-47862caa>{</span> interval<span class="token punctuation" data-v-47862caa>}</span> <span class="token operator" data-v-47862caa>=</span> Rx<span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> <span class="token punctuation" data-v-47862caa>{</span> take<span class="token punctuation" data-v-47862caa>,</span> map <span class="token punctuation" data-v-47862caa>}</span> <span class="token operator" data-v-47862caa>=</span> RxOperators<span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> <span class="token function-variable function" data-v-47862caa>sourceA</span> <span class="token operator" data-v-47862caa>=</span> <span class="token punctuation" data-v-47862caa>(</span>time<span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token function" data-v-47862caa>interval</span><span class="token punctuation" data-v-47862caa>(</span>time<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>take</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>3</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> <span class="token function-variable function" data-v-47862caa>sourceB</span> <span class="token operator" data-v-47862caa>=</span> <span class="token punctuation" data-v-47862caa>(</span>time<span class="token punctuation" data-v-47862caa>,</span> value<span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token function" data-v-47862caa>interval</span><span class="token punctuation" data-v-47862caa>(</span>time<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span>
  <span class="token function" data-v-47862caa>take</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>3</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
  <span class="token function" data-v-47862caa>map</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> value <span class="token operator" data-v-47862caa>*</span> <span class="token number" data-v-47862caa>10</span><span class="token punctuation" data-v-47862caa>)</span>
<span class="token punctuation" data-v-47862caa>)</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa></div></div><h3 id="mergemap" data-v-47862caa><a href="#mergemap" class="header-anchor" data-v-47862caa>#</a> mergeMap</h3> <p data-v-47862caa>为了研究 mergeMap 是怎么运作的，我们可以通过以下代码来工作：</p> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token function" data-v-47862caa>sourceA</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1000</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span>
  <span class="token function" data-v-47862caa>mergeMap</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>(</span>value<span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token function" data-v-47862caa>sourceB</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1500</span><span class="token punctuation" data-v-47862caa>,</span> value<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span>
<span class="token punctuation" data-v-47862caa>)</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa></div></div><p data-v-47862caa>输出结果如下：</p> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token number" data-v-47862caa>010020100201020</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa></div></div><p data-v-47862caa>我们可以看到，这样看可能不太直观，但是我们将他们分别打印，你就能看出区别了：</p> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token number" data-v-47862caa>101010</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa></div></div><div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token number" data-v-47862caa>012</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa></div></div><p data-v-47862caa>这段解析很重要，要理解 mergeMap的时序，第一点就是，它会直到两个源都输出数据的时候才会输出。那么，当源A输出后，需要等 1.5s 的时间等待源B的输出。而后，源A每隔1s就会有下一个输出，源B每隔1.5s后就会有下一个输出，所以，我们可以看到，为了保证后面的时序不被打乱，mergeMap 把合成之后的输出分别按照源A和源B的时序输出了。
以源A的角度看，它的每一个输出和源B的三个输出结合的输出的时序是源B的；以源B的角度看，它的每一个输出和源A的三个输出结合的输出的时序是源A的。
所以mergeMap的作用是保证输出后的原有叠加的时序不变。</p> <h3 id="switchmap" data-v-47862caa><a href="#switchmap" class="header-anchor" data-v-47862caa>#</a> switchMap</h3> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token function" data-v-47862caa>sourceA</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1000</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span>
  <span class="token function" data-v-47862caa>switchMap</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>(</span>value<span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token function" data-v-47862caa>sourceB</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1500</span><span class="token punctuation" data-v-47862caa>,</span> value<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span>
<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa></div></div><p data-v-47862caa>然后，看看它的输出是怎么样的。</p> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token number" data-v-47862caa>202020</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa></div></div><p data-v-47862caa>只有这么源A和源B的三个输出结合的输出，改一下时间，我们把源B的时间改成 800ms，再来看看。</p> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token number" data-v-47862caa>010202020</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa></div></div><p data-v-47862caa>好了，看到源A的前两个输出只和源B结合了一次，源A的最后一个输出却都结合了。我们还是看看他们分别的输出。</p> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token number" data-v-47862caa>012</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa></div></div><center data-v-47862caa>源 A 输出</center> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token number" data-v-47862caa>101010</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa></div></div><center data-v-47862caa>源 B 输出</center> <p data-v-47862caa>我们可以对比看出，每当源A发出一个新的输出，之前源A跟源B结合的输出都被截断。那么，可以看出源B的每次输出与源A的输出结合的输出都依赖于源A的时序，当源A发出新输出的时候，之前结合的所有未完成输出都会被截断。</p> <p data-v-47862caa>所以，这也解释了，为什么第一次源A只有最后一次的输出与源B结合。因为，源B每次输出的时序用时为1500ms，这个用时大于源A输出的用时。所以，当源A发出的第一次的输出准备与源B结合时（此时，源A需要等待源B运行完），源A的第二次的输出也发出了，由于switchMap的截断机制，便会跳过源A第一次的结合，以此类推。</p> <h3 id="concatmap-3" data-v-47862caa><a href="#concatmap-3" class="header-anchor" data-v-47862caa>#</a> concatMap</h3> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token function" data-v-47862caa>sourceA</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>500</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span>
  <span class="token function" data-v-47862caa>concatMap</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>(</span>value<span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token function" data-v-47862caa>sourceB</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1000</span><span class="token punctuation" data-v-47862caa>,</span> value<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span>
<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa></div></div><p data-v-47862caa>下面是 concatMap 的输出。</p> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token number" data-v-47862caa>000101010202020</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa></div></div><p data-v-47862caa>我们可以看到，concatMap 并不会截断，它跟mergeMap的输出内容一样，都是会把所有结合都输出。但是有一点，concatMap 输出结合的方式又跟mergeMap不太一样，它会等待上一次结合输出完毕后，才进行下一次的结合输出。也就是当 0，0，0 输出完毕后，才会输出 10，10，10。在这里， 时序会遵循以下规则，如果源B结合完了源A的数据，源A仍未发送下一条数据，源B将会等到源A的下一条数据的到来。如果源A的数据有堆积（或者A的时序比B的时序小），而源B仍未结合完，那么将会以源B的时序进行下一组结合。</p> <h3 id="exhaustmap-3" data-v-47862caa><a href="#exhaustmap-3" class="header-anchor" data-v-47862caa>#</a> exhaustMap</h3> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token function" data-v-47862caa>sourceA</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1000</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span>
  <span class="token function" data-v-47862caa>exhaustMap</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>(</span>value<span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token function" data-v-47862caa>sourceB</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>500</span><span class="token punctuation" data-v-47862caa>,</span> value<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span>
<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa></div></div><p data-v-47862caa>下面是 exhaustMap的输出。</p> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token number" data-v-47862caa>000202020</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa></div></div><p data-v-47862caa>可以看到，10 这个输出被截断了，它跟concatMap的区别就是，源A与源B的结合输出完毕后，并不会等待下一组结合的输出。如果在第一组结合输出完毕前，第二组结合就要开始输出的时候，exhaustMap会阻止第二组结合的输出，直到第一组结合完全输出完毕。</p> <p data-v-47862caa>这样，我们不妨假设在它们开始输出的时候为第0秒，源A与源B的第一组结合完全输出，需要耗费 1.5秒的时间，也就是它会在第1.5秒处完全输出。而源A的第二组结合会在第1秒输出，由于exhaustMap的特性，第二组结合将不会发生，因为，1.5秒大于1秒。而第一组结合完全输出后，第三组结合会在第三秒输出，这样便会输出 20，20，20。</p> <div class="custom-block tip" data-v-47862caa><p class="custom-block-title" data-v-47862caa>温馨提示</p> <p data-v-47862caa>如果不是很明白讲的是什么，注意看我描述的解析，本质是时刻点触发映射。</p></div> <h2 id="内存泄露" data-v-47862caa><a href="#内存泄露" class="header-anchor" data-v-47862caa>#</a> 内存泄露</h2> <p data-v-47862caa>好了，我们已经初步对rxjs的时间维度有了基本概念，现在我们再看下订阅模式常常遇到的取消订阅带来的内存泄露问题。记住一句话，一切潜在的没必要的执行逻辑是内存泄露的根源。</p> <p data-v-47862caa>那么，第一，有限流需要取消订阅吗？一般不需要，因为生产者不会再发送通知带来消费者意外的操作，但是他会生成订阅关系Subscription，这个一般垃圾回收会处理，如果短时间大量产生就需要注意。第二，无线流需要取消订阅吗？不一定，因为只要生产者的通知如果消费者没有操作响应就不需要，大概可以考虑一个场景，计算机一直再运行，代码也是在运行中，一个无线循环的空操作是程序运行的基本状态。</p> <p data-v-47862caa>事实上，我们往往是在条件流中陷入了死循环，在流中触发了另外的相关的流从而引发了新的一轮无休止重复执行，这在使用ngrx等流式编程最为常见，或是用错了组合操作符比如zip导致获取不到流中最新的数据。实际上，在实际项目中运用早期你会发现很多这样的细节而不明原因，然后你在慢慢发现是某个环节出了小问题，这就是这个加深认识的过程。</p> <p data-v-47862caa>这里我分享的是一种编程意识，有了这个意识你才能更好的规避内存泄漏的风险。本文其实更多的是想带来的是rxjs的全面初识和一种编程思维指导，了解了全貌还需要在项目中着实体会下你才会有更深的认识，这些技巧在我想到那会我会慢慢分享给大家。下面我们总结下angular常见的流式订阅哪些需要取消订阅。</p> <h3 id="需要unsubscribe的常见情况" data-v-47862caa><a href="#需要unsubscribe的常见情况" class="header-anchor" data-v-47862caa>#</a> 需要unsubscribe的常见情况</h3> <h3 id="forms-formcontrol" data-v-47862caa><a href="#forms-formcontrol" class="header-anchor" data-v-47862caa>#</a> Forms/formControl</h3> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>export</span> <span class="token keyword" data-v-47862caa>class</span> <span class="token class-name" data-v-47862caa>TestComponent</span> <span class="token punctuation" data-v-47862caa>{</span>
  <span class="token function" data-v-47862caa>ngOnInit</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token punctuation" data-v-47862caa>{</span>
    <span class="token keyword" data-v-47862caa>this</span><span class="token punctuation" data-v-47862caa>.</span>form <span class="token operator" data-v-47862caa>=</span> <span class="token keyword" data-v-47862caa>new</span> <span class="token class-name" data-v-47862caa>FormGroup</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>{</span><span class="token operator" data-v-47862caa>...</span><span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
    <span class="token keyword" data-v-47862caa>this</span><span class="token punctuation" data-v-47862caa>.</span>valueChanges  <span class="token operator" data-v-47862caa>=</span> <span class="token keyword" data-v-47862caa>this</span><span class="token punctuation" data-v-47862caa>.</span>form<span class="token punctuation" data-v-47862caa>.</span>valueChanges<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span>log<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
    <span class="token keyword" data-v-47862caa>this</span><span class="token punctuation" data-v-47862caa>.</span>statusChanges <span class="token operator" data-v-47862caa>=</span> <span class="token keyword" data-v-47862caa>this</span><span class="token punctuation" data-v-47862caa>.</span>form<span class="token punctuation" data-v-47862caa>.</span>statusChanges<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span>log<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
  <span class="token punctuation" data-v-47862caa>}</span>
  <span class="token function" data-v-47862caa>ngOnDestroy</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token punctuation" data-v-47862caa>{</span>
    <span class="token keyword" data-v-47862caa>this</span><span class="token punctuation" data-v-47862caa>.</span>valueChanges<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>unsubscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
    <span class="token keyword" data-v-47862caa>this</span><span class="token punctuation" data-v-47862caa>.</span>statusChanges<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>unsubscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
  <span class="token punctuation" data-v-47862caa>}</span>
<span class="token punctuation" data-v-47862caa>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa><span class="line-number" data-v-47862caa>10</span><br data-v-47862caa><span class="line-number" data-v-47862caa>11</span><br data-v-47862caa></div></div><h3 id="router" data-v-47862caa><a href="#router" class="header-anchor" data-v-47862caa>#</a> Router</h3> <p data-v-47862caa>— 根据官方文档，Angular应该自动unsubscribe,但是异步不能 <a href="https://github.com/angular/angular/issues/16261" data-v-47862caa>bug</a></p> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>export</span> <span class="token keyword" data-v-47862caa>class</span> <span class="token class-name" data-v-47862caa>TestComponent</span> <span class="token punctuation" data-v-47862caa>{</span>
  <span class="token function" data-v-47862caa>constructor</span><span class="token punctuation" data-v-47862caa>(</span><span class="token keyword" data-v-47862caa>private</span> route<span class="token operator" data-v-47862caa>:</span> ActivatedRoute<span class="token punctuation" data-v-47862caa>,</span> <span class="token keyword" data-v-47862caa>private</span> router<span class="token operator" data-v-47862caa>:</span> Router<span class="token punctuation" data-v-47862caa>)</span> <span class="token punctuation" data-v-47862caa>{</span> <span class="token punctuation" data-v-47862caa>}</span>
  <span class="token function" data-v-47862caa>ngOnInit</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token punctuation" data-v-47862caa>{</span>
    <span class="token keyword" data-v-47862caa>this</span><span class="token punctuation" data-v-47862caa>.</span>route<span class="token punctuation" data-v-47862caa>.</span>params<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span>log<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
    <span class="token keyword" data-v-47862caa>this</span><span class="token punctuation" data-v-47862caa>.</span>route<span class="token punctuation" data-v-47862caa>.</span>queryParams<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span>log<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
    <span class="token keyword" data-v-47862caa>this</span><span class="token punctuation" data-v-47862caa>.</span>route<span class="token punctuation" data-v-47862caa>.</span>fragment<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span>log<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
    <span class="token keyword" data-v-47862caa>this</span><span class="token punctuation" data-v-47862caa>.</span>route<span class="token punctuation" data-v-47862caa>.</span>data<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span>log<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
    <span class="token keyword" data-v-47862caa>this</span><span class="token punctuation" data-v-47862caa>.</span>route<span class="token punctuation" data-v-47862caa>.</span>url<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span>log<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
    
    <span class="token keyword" data-v-47862caa>this</span><span class="token punctuation" data-v-47862caa>.</span>router<span class="token punctuation" data-v-47862caa>.</span>events<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span>log<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
  <span class="token punctuation" data-v-47862caa>}</span>
  <span class="token function" data-v-47862caa>ngOnDestroy</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token punctuation" data-v-47862caa>{</span>
    <span class="token comment" data-v-47862caa>// You should unsubscribe from each observable here</span>
  <span class="token punctuation" data-v-47862caa>}</span>
<span class="token punctuation" data-v-47862caa>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa><span class="line-number" data-v-47862caa>10</span><br data-v-47862caa><span class="line-number" data-v-47862caa>11</span><br data-v-47862caa><span class="line-number" data-v-47862caa>12</span><br data-v-47862caa><span class="line-number" data-v-47862caa>13</span><br data-v-47862caa><span class="line-number" data-v-47862caa>14</span><br data-v-47862caa><span class="line-number" data-v-47862caa>15</span><br data-v-47862caa></div></div><h3 id="rendererservice" data-v-47862caa><a href="#rendererservice" class="header-anchor" data-v-47862caa>#</a> RendererService</h3> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>export</span> <span class="token keyword" data-v-47862caa>class</span> <span class="token class-name" data-v-47862caa>TestComponent</span> <span class="token punctuation" data-v-47862caa>{</span>
<span class="token function" data-v-47862caa>constructor</span><span class="token punctuation" data-v-47862caa>(</span><span class="token keyword" data-v-47862caa>private</span> renderer<span class="token operator" data-v-47862caa>:</span> Renderer2<span class="token punctuation" data-v-47862caa>,</span> 
            <span class="token keyword" data-v-47862caa>private</span> element <span class="token operator" data-v-47862caa>:</span> ElementRef<span class="token punctuation" data-v-47862caa>)</span> <span class="token punctuation" data-v-47862caa>{</span> <span class="token punctuation" data-v-47862caa>}</span>
  <span class="token function" data-v-47862caa>ngOnInit</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token punctuation" data-v-47862caa>{</span>
    <span class="token keyword" data-v-47862caa>this</span><span class="token punctuation" data-v-47862caa>.</span>click <span class="token operator" data-v-47862caa>=</span> <span class="token keyword" data-v-47862caa>this</span><span class="token punctuation" data-v-47862caa>.</span>renderer<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>listen</span><span class="token punctuation" data-v-47862caa>(</span><span class="token keyword" data-v-47862caa>this</span><span class="token punctuation" data-v-47862caa>.</span>element<span class="token punctuation" data-v-47862caa>.</span>nativeElement<span class="token punctuation" data-v-47862caa>,</span> <span class="token string" data-v-47862caa>&quot;click&quot;</span><span class="token punctuation" data-v-47862caa>,</span> handler<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
  <span class="token punctuation" data-v-47862caa>}</span>
  <span class="token function" data-v-47862caa>ngOnDestroy</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token punctuation" data-v-47862caa>{</span>
    <span class="token keyword" data-v-47862caa>this</span><span class="token punctuation" data-v-47862caa>.</span>click<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>unsubscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
  <span class="token punctuation" data-v-47862caa>}</span>
<span class="token punctuation" data-v-47862caa>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa><span class="line-number" data-v-47862caa>10</span><br data-v-47862caa></div></div><h3 id="infinite-observables" data-v-47862caa><a href="#infinite-observables" class="header-anchor" data-v-47862caa>#</a> Infinite Observables</h3> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>export</span> <span class="token keyword" data-v-47862caa>class</span> <span class="token class-name" data-v-47862caa>TestComponent</span> <span class="token punctuation" data-v-47862caa>{</span>
  <span class="token function" data-v-47862caa>constructor</span><span class="token punctuation" data-v-47862caa>(</span><span class="token keyword" data-v-47862caa>private</span> element <span class="token operator" data-v-47862caa>:</span> ElementRef<span class="token punctuation" data-v-47862caa>)</span> <span class="token punctuation" data-v-47862caa>{</span> <span class="token punctuation" data-v-47862caa>}</span>
  interval<span class="token operator" data-v-47862caa>:</span> Subscription<span class="token punctuation" data-v-47862caa>;</span>
  click<span class="token operator" data-v-47862caa>:</span> Subscription<span class="token punctuation" data-v-47862caa>;</span>
  <span class="token function" data-v-47862caa>ngOnInit</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token punctuation" data-v-47862caa>{</span>
    <span class="token keyword" data-v-47862caa>this</span><span class="token punctuation" data-v-47862caa>.</span>interval <span class="token operator" data-v-47862caa>=</span> Observable<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>interval</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1000</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span>log<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
    <span class="token keyword" data-v-47862caa>this</span><span class="token punctuation" data-v-47862caa>.</span>click <span class="token operator" data-v-47862caa>=</span> Observable<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>fromEvent</span><span class="token punctuation" data-v-47862caa>(</span><span class="token keyword" data-v-47862caa>this</span><span class="token punctuation" data-v-47862caa>.</span>element<span class="token punctuation" data-v-47862caa>.</span>nativeElement<span class="token punctuation" data-v-47862caa>,</span> <span class="token string" data-v-47862caa>'click'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span>log<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
  <span class="token punctuation" data-v-47862caa>}</span>
  <span class="token function" data-v-47862caa>ngOnDestroy</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token punctuation" data-v-47862caa>{</span>
    <span class="token keyword" data-v-47862caa>this</span><span class="token punctuation" data-v-47862caa>.</span>interval<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>unsubscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
    <span class="token keyword" data-v-47862caa>this</span><span class="token punctuation" data-v-47862caa>.</span>click<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>unsubscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
  <span class="token punctuation" data-v-47862caa>}</span>
<span class="token punctuation" data-v-47862caa>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa><span class="line-number" data-v-47862caa>10</span><br data-v-47862caa><span class="line-number" data-v-47862caa>11</span><br data-v-47862caa><span class="line-number" data-v-47862caa>12</span><br data-v-47862caa><span class="line-number" data-v-47862caa>13</span><br data-v-47862caa></div></div><h3 id="redux-store" data-v-47862caa><a href="#redux-store" class="header-anchor" data-v-47862caa>#</a> Redux Store</h3> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>export</span> <span class="token keyword" data-v-47862caa>class</span> <span class="token class-name" data-v-47862caa>TestComponent</span> <span class="token punctuation" data-v-47862caa>{</span>
  <span class="token function" data-v-47862caa>constructor</span><span class="token punctuation" data-v-47862caa>(</span><span class="token keyword" data-v-47862caa>private</span> store<span class="token operator" data-v-47862caa>:</span> Store<span class="token punctuation" data-v-47862caa>)</span> <span class="token punctuation" data-v-47862caa>{</span> <span class="token punctuation" data-v-47862caa>}</span>
  todos<span class="token operator" data-v-47862caa>:</span> Subscription<span class="token punctuation" data-v-47862caa>;</span>
  <span class="token function" data-v-47862caa>ngOnInit</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token punctuation" data-v-47862caa>{</span>
     <span class="token keyword" data-v-47862caa>this</span><span class="token punctuation" data-v-47862caa>.</span>todos <span class="token operator" data-v-47862caa>=</span> <span class="token keyword" data-v-47862caa>this</span><span class="token punctuation" data-v-47862caa>.</span>store<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>select</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'todos'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span>log<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>  
  <span class="token punctuation" data-v-47862caa>}</span>
  <span class="token function" data-v-47862caa>ngOnDestroy</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token punctuation" data-v-47862caa>{</span>
    <span class="token keyword" data-v-47862caa>this</span><span class="token punctuation" data-v-47862caa>.</span>todos<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>unsubscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
  <span class="token punctuation" data-v-47862caa>}</span>
<span class="token punctuation" data-v-47862caa>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa><span class="line-number" data-v-47862caa>10</span><br data-v-47862caa></div></div><h3 id="不需要-unsubscribe-的情况" data-v-47862caa><a href="#不需要-unsubscribe-的情况" class="header-anchor" data-v-47862caa>#</a> 不需要 Unsubscribe 的情况</h3> <h3 id="async-pipe" data-v-47862caa><a href="#async-pipe" class="header-anchor" data-v-47862caa>#</a> Async pipe</h3> <p data-v-47862caa>当组件被销毁时，async管道自动取消订阅，以避免潜在的内存泄漏。</p> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token decorator" data-v-47862caa><span class="token at operator" data-v-47862caa>@</span><span class="token function" data-v-47862caa>Component</span></span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>{</span>
  selector<span class="token operator" data-v-47862caa>:</span> <span class="token string" data-v-47862caa>'test'</span><span class="token punctuation" data-v-47862caa>,</span>
  template<span class="token operator" data-v-47862caa>:</span> <span class="token template-string" data-v-47862caa><span class="token template-punctuation string" data-v-47862caa>`</span><span class="token string" data-v-47862caa>&lt;todos [todos]=&quot;todos$ | async&quot;&gt;&lt;/todos&gt;</span><span class="token template-punctuation string" data-v-47862caa>`</span></span>
<span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>)</span>
<span class="token keyword" data-v-47862caa>export</span> <span class="token keyword" data-v-47862caa>class</span> <span class="token class-name" data-v-47862caa>TestComponent</span> <span class="token punctuation" data-v-47862caa>{</span>
  <span class="token function" data-v-47862caa>constructor</span><span class="token punctuation" data-v-47862caa>(</span><span class="token keyword" data-v-47862caa>private</span> store<span class="token operator" data-v-47862caa>:</span> Store<span class="token punctuation" data-v-47862caa>)</span> <span class="token punctuation" data-v-47862caa>{</span> <span class="token punctuation" data-v-47862caa>}</span>
  <span class="token function" data-v-47862caa>ngOnInit</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token punctuation" data-v-47862caa>{</span>
     <span class="token keyword" data-v-47862caa>this</span><span class="token punctuation" data-v-47862caa>.</span>todos$ <span class="token operator" data-v-47862caa>=</span> <span class="token keyword" data-v-47862caa>this</span><span class="token punctuation" data-v-47862caa>.</span>store<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>select</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'todos'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
  <span class="token punctuation" data-v-47862caa>}</span>
<span class="token punctuation" data-v-47862caa>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa><span class="line-number" data-v-47862caa>10</span><br data-v-47862caa></div></div><h3 id="hostlistener" data-v-47862caa><a href="#hostlistener" class="header-anchor" data-v-47862caa>#</a> @HostListener</h3> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>export</span> <span class="token keyword" data-v-47862caa>class</span> <span class="token class-name" data-v-47862caa>TestDirective</span> <span class="token punctuation" data-v-47862caa>{</span>
  <span class="token decorator" data-v-47862caa><span class="token at operator" data-v-47862caa>@</span><span class="token function" data-v-47862caa>HostListener</span></span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'click'</span><span class="token punctuation" data-v-47862caa>)</span>
  <span class="token function" data-v-47862caa>onClick</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token punctuation" data-v-47862caa>{</span>
    <span class="token operator" data-v-47862caa>...</span><span class="token punctuation" data-v-47862caa>.</span>
  <span class="token punctuation" data-v-47862caa>}</span>
<span class="token punctuation" data-v-47862caa>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa></div></div><h3 id="finite-observable" data-v-47862caa><a href="#finite-observable" class="header-anchor" data-v-47862caa>#</a> Finite Observable</h3> <p data-v-47862caa>当你有一个有限的序列，通常你不需要unsubscribe，例如当使用HTTPservice或timer observable。</p> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>export</span> <span class="token keyword" data-v-47862caa>class</span> <span class="token class-name" data-v-47862caa>TestComponent</span> <span class="token punctuation" data-v-47862caa>{</span>
  <span class="token function" data-v-47862caa>constructor</span><span class="token punctuation" data-v-47862caa>(</span><span class="token keyword" data-v-47862caa>private</span> http<span class="token operator" data-v-47862caa>:</span> Http<span class="token punctuation" data-v-47862caa>)</span> <span class="token punctuation" data-v-47862caa>{</span> <span class="token punctuation" data-v-47862caa>}</span>
  <span class="token function" data-v-47862caa>ngOnInit</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token punctuation" data-v-47862caa>{</span>
    Observable<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>timer</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1000</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span>log<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
    <span class="token keyword" data-v-47862caa>this</span><span class="token punctuation" data-v-47862caa>.</span>http<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>get</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'http://api.com'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span>log<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
  <span class="token punctuation" data-v-47862caa>}</span>
<span class="token punctuation" data-v-47862caa>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa></div></div><h3 id="关于takeuntil" data-v-47862caa><a href="#关于takeuntil" class="header-anchor" data-v-47862caa>#</a> 关于takeUntil</h3> <p data-v-47862caa>这里有个技巧，建议不要过多的调用unsubscribe方法,使用takeUntil，它发出源 Observable 的值，然后直到第二个 Observable (即 notifier )发出项，它便完成。</p> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span>Component<span class="token punctuation" data-v-47862caa>,</span> OnDestroy<span class="token punctuation" data-v-47862caa>,</span> OnInit<span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'@angular/core'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span>Subject<span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span>takeUntil<span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs/operators'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token decorator" data-v-47862caa><span class="token at operator" data-v-47862caa>@</span><span class="token function" data-v-47862caa>Component</span></span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>{</span>
  selector<span class="token operator" data-v-47862caa>:</span> <span class="token string" data-v-47862caa>'app-root'</span><span class="token punctuation" data-v-47862caa>,</span>
  templateUrl<span class="token operator" data-v-47862caa>:</span> <span class="token string" data-v-47862caa>'./app.component.html'</span><span class="token punctuation" data-v-47862caa>,</span>
  styleUrls<span class="token operator" data-v-47862caa>:</span> <span class="token punctuation" data-v-47862caa>[</span><span class="token string" data-v-47862caa>'./app.component.css'</span><span class="token punctuation" data-v-47862caa>]</span>
<span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>)</span>
<span class="token keyword" data-v-47862caa>export</span> <span class="token keyword" data-v-47862caa>class</span> <span class="token class-name" data-v-47862caa>AppComponent</span> <span class="token keyword" data-v-47862caa>implements</span> <span class="token class-name" data-v-47862caa>OnInit</span><span class="token punctuation" data-v-47862caa>,</span> OnDestroy <span class="token punctuation" data-v-47862caa>{</span>
  <span class="token keyword" data-v-47862caa>private</span> subject <span class="token operator" data-v-47862caa>=</span> <span class="token keyword" data-v-47862caa>new</span> <span class="token class-name" data-v-47862caa>Subject</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
  <span class="token keyword" data-v-47862caa>private</span> $destory <span class="token operator" data-v-47862caa>=</span> <span class="token keyword" data-v-47862caa>new</span> <span class="token class-name" data-v-47862caa>Subject<span class="token operator" data-v-47862caa>&lt;</span><span class="token builtin" data-v-47862caa>boolean</span><span class="token operator" data-v-47862caa>&gt;</span></span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
  <span class="token function" data-v-47862caa>constructor</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token punctuation" data-v-47862caa>{</span>
  <span class="token punctuation" data-v-47862caa>}</span>
  <span class="token comment" data-v-47862caa>/**
   * 组件初始化完毕时调用
   */</span>
  <span class="token function" data-v-47862caa>ngOnInit</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token operator" data-v-47862caa>:</span> <span class="token keyword" data-v-47862caa>void</span> <span class="token punctuation" data-v-47862caa>{</span>
    <span class="token keyword" data-v-47862caa>this</span><span class="token punctuation" data-v-47862caa>.</span>subject
      <span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span>
        <span class="token function" data-v-47862caa>takeUntil</span><span class="token punctuation" data-v-47862caa>(</span><span class="token keyword" data-v-47862caa>this</span><span class="token punctuation" data-v-47862caa>.</span>$destory<span class="token punctuation" data-v-47862caa>)</span><span class="token comment" data-v-47862caa>//需要注意takeUntil要放在最后</span>
      <span class="token punctuation" data-v-47862caa>)</span>
      <span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>data <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token punctuation" data-v-47862caa>{</span>
        <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'data:'</span><span class="token punctuation" data-v-47862caa>,</span> data<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
      <span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
  <span class="token punctuation" data-v-47862caa>}</span>
  <span class="token function" data-v-47862caa>ngOnDestroy</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token operator" data-v-47862caa>:</span> <span class="token keyword" data-v-47862caa>void</span> <span class="token punctuation" data-v-47862caa>{</span>
    <span class="token comment" data-v-47862caa>//this.subject.unsubscribe()</span>
    <span class="token keyword" data-v-47862caa>this</span><span class="token punctuation" data-v-47862caa>.</span>$destory<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>next</span><span class="token punctuation" data-v-47862caa>(</span><span class="token boolean" data-v-47862caa>true</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
    <span class="token keyword" data-v-47862caa>this</span><span class="token punctuation" data-v-47862caa>.</span>$destory<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>unsubscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
  <span class="token punctuation" data-v-47862caa>}</span>
<span class="token punctuation" data-v-47862caa>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa><span class="line-number" data-v-47862caa>10</span><br data-v-47862caa><span class="line-number" data-v-47862caa>11</span><br data-v-47862caa><span class="line-number" data-v-47862caa>12</span><br data-v-47862caa><span class="line-number" data-v-47862caa>13</span><br data-v-47862caa><span class="line-number" data-v-47862caa>14</span><br data-v-47862caa><span class="line-number" data-v-47862caa>15</span><br data-v-47862caa><span class="line-number" data-v-47862caa>16</span><br data-v-47862caa><span class="line-number" data-v-47862caa>17</span><br data-v-47862caa><span class="line-number" data-v-47862caa>18</span><br data-v-47862caa><span class="line-number" data-v-47862caa>19</span><br data-v-47862caa><span class="line-number" data-v-47862caa>20</span><br data-v-47862caa><span class="line-number" data-v-47862caa>21</span><br data-v-47862caa><span class="line-number" data-v-47862caa>22</span><br data-v-47862caa><span class="line-number" data-v-47862caa>23</span><br data-v-47862caa><span class="line-number" data-v-47862caa>24</span><br data-v-47862caa><span class="line-number" data-v-47862caa>25</span><br data-v-47862caa><span class="line-number" data-v-47862caa>26</span><br data-v-47862caa><span class="line-number" data-v-47862caa>27</span><br data-v-47862caa><span class="line-number" data-v-47862caa>28</span><br data-v-47862caa><span class="line-number" data-v-47862caa>29</span><br data-v-47862caa><span class="line-number" data-v-47862caa>30</span><br data-v-47862caa><span class="line-number" data-v-47862caa>31</span><br data-v-47862caa></div></div><h3 id="优雅使用takeuntil" data-v-47862caa><a href="#优雅使用takeuntil" class="header-anchor" data-v-47862caa>#</a> 优雅使用takeUntil</h3> <p data-v-47862caa>我们可以写一个BaseComponent，将一些使用率很高的模板代码放到BaseComponent中，其他组件继承该组件即可。例如：BaseComponent</p> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span>Component<span class="token punctuation" data-v-47862caa>,</span> OnDestroy<span class="token punctuation" data-v-47862caa>,</span> OnInit<span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'@angular/core'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span>Subject<span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token decorator" data-v-47862caa><span class="token at operator" data-v-47862caa>@</span><span class="token function" data-v-47862caa>Component</span></span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>{</span>
  selector<span class="token operator" data-v-47862caa>:</span> <span class="token string" data-v-47862caa>'app-base'</span><span class="token punctuation" data-v-47862caa>,</span>
  templateUrl<span class="token operator" data-v-47862caa>:</span> <span class="token string" data-v-47862caa>'./base.component.html'</span><span class="token punctuation" data-v-47862caa>,</span>
  styleUrls<span class="token operator" data-v-47862caa>:</span> <span class="token punctuation" data-v-47862caa>[</span><span class="token string" data-v-47862caa>'./base.component.css'</span><span class="token punctuation" data-v-47862caa>]</span>
<span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>)</span>
<span class="token keyword" data-v-47862caa>export</span> <span class="token keyword" data-v-47862caa>class</span> <span class="token class-name" data-v-47862caa>BaseComponent</span> <span class="token keyword" data-v-47862caa>implements</span> <span class="token class-name" data-v-47862caa>OnInit</span><span class="token punctuation" data-v-47862caa>,</span> OnDestroy <span class="token punctuation" data-v-47862caa>{</span>
  $destory<span class="token operator" data-v-47862caa>:</span> Subject<span class="token operator" data-v-47862caa>&lt;</span><span class="token builtin" data-v-47862caa>boolean</span><span class="token operator" data-v-47862caa>&gt;</span> <span class="token operator" data-v-47862caa>=</span> <span class="token keyword" data-v-47862caa>new</span> <span class="token class-name" data-v-47862caa>Subject<span class="token operator" data-v-47862caa>&lt;</span><span class="token builtin" data-v-47862caa>boolean</span><span class="token operator" data-v-47862caa>&gt;</span></span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
  <span class="token function" data-v-47862caa>constructor</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token punctuation" data-v-47862caa>{</span>
  <span class="token punctuation" data-v-47862caa>}</span>
  <span class="token function" data-v-47862caa>ngOnInit</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token operator" data-v-47862caa>:</span> <span class="token keyword" data-v-47862caa>void</span> <span class="token punctuation" data-v-47862caa>{</span>
  <span class="token punctuation" data-v-47862caa>}</span>
  <span class="token function" data-v-47862caa>ngOnDestroy</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token operator" data-v-47862caa>:</span> <span class="token keyword" data-v-47862caa>void</span> <span class="token punctuation" data-v-47862caa>{</span>
    <span class="token keyword" data-v-47862caa>this</span><span class="token punctuation" data-v-47862caa>.</span>$destory<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>next</span><span class="token punctuation" data-v-47862caa>(</span><span class="token boolean" data-v-47862caa>true</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
    <span class="token keyword" data-v-47862caa>this</span><span class="token punctuation" data-v-47862caa>.</span>$destory<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>unsubscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
  <span class="token punctuation" data-v-47862caa>}</span>
<span class="token punctuation" data-v-47862caa>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa><span class="line-number" data-v-47862caa>10</span><br data-v-47862caa><span class="line-number" data-v-47862caa>11</span><br data-v-47862caa><span class="line-number" data-v-47862caa>12</span><br data-v-47862caa><span class="line-number" data-v-47862caa>13</span><br data-v-47862caa><span class="line-number" data-v-47862caa>14</span><br data-v-47862caa><span class="line-number" data-v-47862caa>15</span><br data-v-47862caa><span class="line-number" data-v-47862caa>16</span><br data-v-47862caa><span class="line-number" data-v-47862caa>17</span><br data-v-47862caa><span class="line-number" data-v-47862caa>18</span><br data-v-47862caa></div></div><p data-v-47862caa>让我们的组件继承BaseComponent，然后删除无用的模板代码</p> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span>Component<span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'@angular/core'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span>Subject<span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span>takeUntil<span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs/operators'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span>BaseComponent<span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'./base/base.component'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token decorator" data-v-47862caa><span class="token at operator" data-v-47862caa>@</span><span class="token function" data-v-47862caa>Component</span></span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>{</span>
  selector<span class="token operator" data-v-47862caa>:</span> <span class="token string" data-v-47862caa>'app-root'</span><span class="token punctuation" data-v-47862caa>,</span>
  templateUrl<span class="token operator" data-v-47862caa>:</span> <span class="token string" data-v-47862caa>'./app.component.html'</span><span class="token punctuation" data-v-47862caa>,</span>
  styleUrls<span class="token operator" data-v-47862caa>:</span> <span class="token punctuation" data-v-47862caa>[</span><span class="token string" data-v-47862caa>'./app.component.css'</span><span class="token punctuation" data-v-47862caa>]</span>
<span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>)</span>
<span class="token keyword" data-v-47862caa>export</span> <span class="token keyword" data-v-47862caa>class</span> <span class="token class-name" data-v-47862caa>AppComponent</span> <span class="token keyword" data-v-47862caa>extends</span> <span class="token class-name" data-v-47862caa>BaseComponent</span> <span class="token punctuation" data-v-47862caa>{</span>
  <span class="token keyword" data-v-47862caa>private</span> subject <span class="token operator" data-v-47862caa>=</span> <span class="token keyword" data-v-47862caa>new</span> <span class="token class-name" data-v-47862caa>Subject</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
  <span class="token function" data-v-47862caa>constructor</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token punctuation" data-v-47862caa>{</span>
    <span class="token keyword" data-v-47862caa>super</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span><span class="token comment" data-v-47862caa>//继承后要加上super()</span>
  <span class="token punctuation" data-v-47862caa>}</span>
  <span class="token comment" data-v-47862caa>/**
   * 组件初始化完毕时调用
   */</span>
  <span class="token function" data-v-47862caa>ngOnInit</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token operator" data-v-47862caa>:</span> <span class="token keyword" data-v-47862caa>void</span> <span class="token punctuation" data-v-47862caa>{</span>
    <span class="token keyword" data-v-47862caa>this</span><span class="token punctuation" data-v-47862caa>.</span>subject
      <span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span>
        <span class="token function" data-v-47862caa>takeUntil</span><span class="token punctuation" data-v-47862caa>(</span><span class="token keyword" data-v-47862caa>this</span><span class="token punctuation" data-v-47862caa>.</span>$destory<span class="token punctuation" data-v-47862caa>)</span><span class="token comment" data-v-47862caa>//需要注意takeUntil要放在最后</span>
      <span class="token punctuation" data-v-47862caa>)</span>
      <span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>data <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token punctuation" data-v-47862caa>{</span>
        <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'data:'</span><span class="token punctuation" data-v-47862caa>,</span> data<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
      <span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
  <span class="token punctuation" data-v-47862caa>}</span>
<span class="token punctuation" data-v-47862caa>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa><span class="line-number" data-v-47862caa>10</span><br data-v-47862caa><span class="line-number" data-v-47862caa>11</span><br data-v-47862caa><span class="line-number" data-v-47862caa>12</span><br data-v-47862caa><span class="line-number" data-v-47862caa>13</span><br data-v-47862caa><span class="line-number" data-v-47862caa>14</span><br data-v-47862caa><span class="line-number" data-v-47862caa>15</span><br data-v-47862caa><span class="line-number" data-v-47862caa>16</span><br data-v-47862caa><span class="line-number" data-v-47862caa>17</span><br data-v-47862caa><span class="line-number" data-v-47862caa>18</span><br data-v-47862caa><span class="line-number" data-v-47862caa>19</span><br data-v-47862caa><span class="line-number" data-v-47862caa>20</span><br data-v-47862caa><span class="line-number" data-v-47862caa>21</span><br data-v-47862caa><span class="line-number" data-v-47862caa>22</span><br data-v-47862caa><span class="line-number" data-v-47862caa>23</span><br data-v-47862caa><span class="line-number" data-v-47862caa>24</span><br data-v-47862caa><span class="line-number" data-v-47862caa>25</span><br data-v-47862caa><span class="line-number" data-v-47862caa>26</span><br data-v-47862caa><span class="line-number" data-v-47862caa>27</span><br data-v-47862caa></div></div><h3 id="避免takeuntil泄露" data-v-47862caa><a href="#避免takeuntil泄露" class="header-anchor" data-v-47862caa>#</a> 避免takeUntil泄露</h3> <p data-v-47862caa>如果在 takeUntil 后面调用这样一个操作符，该操作符订阅了另一个 observable，那么当 takeUntil 收到通知时，该订阅可能不会被取消。
举个例子，这里的 combineLatest 可能会泄露 b 的订阅。</p> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> Observable <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>&quot;rxjs&quot;</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> combineLatest<span class="token punctuation" data-v-47862caa>,</span> takeUntil <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>&quot;rxjs/operators&quot;</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>declare</span> <span class="token keyword" data-v-47862caa>const</span> a<span class="token operator" data-v-47862caa>:</span> Observable<span class="token operator" data-v-47862caa>&lt;</span><span class="token builtin" data-v-47862caa>number</span><span class="token operator" data-v-47862caa>&gt;</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>declare</span> <span class="token keyword" data-v-47862caa>const</span> b<span class="token operator" data-v-47862caa>:</span> Observable<span class="token operator" data-v-47862caa>&lt;</span><span class="token builtin" data-v-47862caa>number</span><span class="token operator" data-v-47862caa>&gt;</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>declare</span> <span class="token keyword" data-v-47862caa>const</span> notifier<span class="token operator" data-v-47862caa>:</span> Observable<span class="token operator" data-v-47862caa>&lt;</span><span class="token builtin" data-v-47862caa>any</span><span class="token operator" data-v-47862caa>&gt;</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> c <span class="token operator" data-v-47862caa>=</span> a<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span>
  <span class="token function" data-v-47862caa>takeUntil</span><span class="token punctuation" data-v-47862caa>(</span>notifier<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
  <span class="token function" data-v-47862caa>combineLatest</span><span class="token punctuation" data-v-47862caa>(</span>b<span class="token punctuation" data-v-47862caa>)</span>
<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>value <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span>value<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa></div></div><p data-v-47862caa>同样，这里的 switchMap 也可能会泄露 b 的订阅。</p> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> Observable <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>&quot;rxjs&quot;</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> switchMap<span class="token punctuation" data-v-47862caa>,</span> takeUntil <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>&quot;rxjs/operators&quot;</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>declare</span> <span class="token keyword" data-v-47862caa>const</span> a<span class="token operator" data-v-47862caa>:</span> Observable<span class="token operator" data-v-47862caa>&lt;</span><span class="token builtin" data-v-47862caa>number</span><span class="token operator" data-v-47862caa>&gt;</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>declare</span> <span class="token keyword" data-v-47862caa>const</span> b<span class="token operator" data-v-47862caa>:</span> Observable<span class="token operator" data-v-47862caa>&lt;</span><span class="token builtin" data-v-47862caa>number</span><span class="token operator" data-v-47862caa>&gt;</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>declare</span> <span class="token keyword" data-v-47862caa>const</span> notifier<span class="token operator" data-v-47862caa>:</span> Observable<span class="token operator" data-v-47862caa>&lt;</span><span class="token builtin" data-v-47862caa>any</span><span class="token operator" data-v-47862caa>&gt;</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> c <span class="token operator" data-v-47862caa>=</span> a<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span>
  <span class="token function" data-v-47862caa>takeUntil</span><span class="token punctuation" data-v-47862caa>(</span>notifier<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
  <span class="token function" data-v-47862caa>switchMap</span><span class="token punctuation" data-v-47862caa>(</span>_ <span class="token operator" data-v-47862caa>=&gt;</span> b<span class="token punctuation" data-v-47862caa>)</span>
<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>value <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span>value<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa></div></div><p data-v-47862caa>要想避免这个问题，我们就得把 takeUntil 放到最后调用：</p> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>const</span> c <span class="token operator" data-v-47862caa>=</span> a<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span>
  o <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token function" data-v-47862caa>combineLatest</span><span class="token punctuation" data-v-47862caa>(</span>o<span class="token punctuation" data-v-47862caa>,</span> b<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
  <span class="token function" data-v-47862caa>takeUntil</span><span class="token punctuation" data-v-47862caa>(</span>notifier<span class="token punctuation" data-v-47862caa>)</span>
<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>value <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span>value<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa></div></div><p data-v-47862caa>可以通过启用我添加到 rxjs-tslint-rules 包里的 rxjs-no-unsafe-takeuntil 规则来确保 takeUntil 是 pipe 中的最后一个操作符。</p> <p data-v-47862caa>通常的规定是将 takeUntil 放到最后。然而在有些情况下，你可能需要把它放到倒数第二个的位置上。</p> <ol data-v-47862caa><li data-v-47862caa><p data-v-47862caa>在 RxJS 的操作符中，有一些是只在源 observable 完成时才会发出值的。就比如说 count 和 toArray，只有在它们的源 observable 完成时，它们才会发出源 observable 中数据的个数，或是其组成的数组。当一个 observable 因 takeUntil 而完成时，类似 count 和 toArray 的操作符只有放在 takeUntil 后面才会生效。</p></li> <li data-v-47862caa><p data-v-47862caa>另外还有一个操作符是你需要放在 takeUntil 后面的，那就是 shareReplay。目前的 shareReplay 有一个 bug/feature：它永远不会取消其源 observable 的订阅，直到源 observable 完成，或是发生错误。所以将 takeUntil 放在 shareReplay 后面是无效的。</p></li></ol> <p data-v-47862caa>上面提到的 TSLint 规则是知道这些例外的，所以你不用担心会造成一些莫名其妙的问题。</p> <div class="custom-block tip" data-v-47862caa><p class="custom-block-title" data-v-47862caa>温馨提示</p> <p data-v-47862caa>在 6.4.0 版本的 RxJS 中，shareReplay 做了一定修改，现在你可以通过 config 参数来指定其引用计数行为。如果你指定了 shareReplay 的引用计数，就可以把它安全地放到 takeUntil 前面了。`</p></div> <h2 id="takeuntil-while-skipuntil-while" data-v-47862caa><a href="#takeuntil-while-skipuntil-while" class="header-anchor" data-v-47862caa>#</a> takeUntil/While skipUntil/While</h2> <p data-v-47862caa>take 和 skip 互逆,take 取开头的N个值，需要传入数字类型,takeUntil，takeWhile 都是 take的变种,skip 跳过开头的N个值，需要传入数字类型,skipUntil，skipWhile 都是 skip 的变种</p> <ul data-v-47862caa><li data-v-47862caa>takeUntil 接收的是 Observable 类型，当这个Observable发出值才完成</li> <li data-v-47862caa>takeWhile 接收的是 function ，一旦返回值为false 就完成</li> <li data-v-47862caa>skipUntil 接收的是 Observable 类型，当这个Observable发出值才完成</li> <li data-v-47862caa>skipWhile 接收的是 function ，一旦返回值为false 就完成</li></ul> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token operator" data-v-47862caa>&lt;</span>script src<span class="token operator" data-v-47862caa>=</span><span class="token string" data-v-47862caa>'../lib/rxjs6.3.3.umd.js'</span><span class="token operator" data-v-47862caa>&gt;</span><span class="token operator" data-v-47862caa>&lt;</span><span class="token operator" data-v-47862caa>/</span>script<span class="token operator" data-v-47862caa>&gt;</span>
<span class="token operator" data-v-47862caa>&lt;</span>script<span class="token operator" data-v-47862caa>&gt;</span>
    <span class="token comment" data-v-47862caa>// https://rxjs-cn.github.io/learn-rxjs-operators/operators/filtering/filter.html</span>
    <span class="token comment" data-v-47862caa>// filter</span>
    <span class="token comment" data-v-47862caa>// 发出符合给定条件的值</span>
    <span class="token keyword" data-v-47862caa>const</span> <span class="token punctuation" data-v-47862caa>{</span> from<span class="token punctuation" data-v-47862caa>,</span> interval<span class="token punctuation" data-v-47862caa>,</span> timer <span class="token punctuation" data-v-47862caa>}</span> <span class="token operator" data-v-47862caa>=</span> rxjs<span class="token punctuation" data-v-47862caa>;</span>
    <span class="token keyword" data-v-47862caa>const</span> <span class="token punctuation" data-v-47862caa>{</span> filter<span class="token punctuation" data-v-47862caa>,</span> take<span class="token punctuation" data-v-47862caa>,</span> last<span class="token punctuation" data-v-47862caa>,</span> startWith<span class="token punctuation" data-v-47862caa>,</span> skip<span class="token punctuation" data-v-47862caa>,</span> takeUntil<span class="token punctuation" data-v-47862caa>,</span> takeWhile<span class="token punctuation" data-v-47862caa>,</span> skipWhile <span class="token punctuation" data-v-47862caa>}</span> <span class="token operator" data-v-47862caa>=</span> rxjs<span class="token punctuation" data-v-47862caa>.</span>operators<span class="token punctuation" data-v-47862caa>;</span>
    <span class="token function" data-v-47862caa>interval</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1000</span><span class="token punctuation" data-v-47862caa>)</span>
      <span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span>
        <span class="token comment" data-v-47862caa>// timer(5000) 是等待5s发出值</span>
        <span class="token comment" data-v-47862caa>// takeUntil 只取timer(5000)开始发出之前的那些值</span>
        <span class="token function" data-v-47862caa>takeUntil</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>timer</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>5000</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span>
      <span class="token punctuation" data-v-47862caa>)</span>
      <span class="token comment" data-v-47862caa>// 输出 0，1，2，3</span>
      <span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>val <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span>val<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
    <span class="token function" data-v-47862caa>interval</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1000</span><span class="token punctuation" data-v-47862caa>)</span>
      <span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span>
        <span class="token comment" data-v-47862caa>// timer(5000) 是等待5s发出值</span>
        <span class="token comment" data-v-47862caa>// takeWhile 只取timer(5000)开始发出之前的那些值</span>
        <span class="token function" data-v-47862caa>takeWhile</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>(</span>val<span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> val <span class="token operator" data-v-47862caa>&lt;</span> <span class="token number" data-v-47862caa>5</span><span class="token punctuation" data-v-47862caa>)</span>
      <span class="token punctuation" data-v-47862caa>)</span>
      <span class="token comment" data-v-47862caa>// 输出 -0，-1，-2，-3, -4</span>
      <span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>val <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token template-string" data-v-47862caa><span class="token template-punctuation string" data-v-47862caa>`</span><span class="token string" data-v-47862caa>-</span><span class="token interpolation" data-v-47862caa><span class="token interpolation-punctuation punctuation" data-v-47862caa>${</span>val<span class="token interpolation-punctuation punctuation" data-v-47862caa>}</span></span><span class="token template-punctuation string" data-v-47862caa>`</span></span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token operator" data-v-47862caa>&lt;</span><span class="token operator" data-v-47862caa>/</span>script<span class="token operator" data-v-47862caa>&gt;</span>
<span class="token comment" data-v-47862caa>// 来看下skip操作，我们只替换take为skip，显示的内容刚好相反</span>
  <span class="token keyword" data-v-47862caa>const</span> <span class="token punctuation" data-v-47862caa>{</span> from<span class="token punctuation" data-v-47862caa>,</span> interval<span class="token punctuation" data-v-47862caa>,</span> timer <span class="token punctuation" data-v-47862caa>}</span> <span class="token operator" data-v-47862caa>=</span> rxjs<span class="token punctuation" data-v-47862caa>;</span>
    <span class="token keyword" data-v-47862caa>const</span> <span class="token punctuation" data-v-47862caa>{</span> filter<span class="token punctuation" data-v-47862caa>,</span> take<span class="token punctuation" data-v-47862caa>,</span> last<span class="token punctuation" data-v-47862caa>,</span> startWith<span class="token punctuation" data-v-47862caa>,</span> skip<span class="token punctuation" data-v-47862caa>,</span> takeUntil<span class="token punctuation" data-v-47862caa>,</span> takeWhile<span class="token punctuation" data-v-47862caa>,</span> skipWhile<span class="token punctuation" data-v-47862caa>,</span> skipUntil <span class="token punctuation" data-v-47862caa>}</span> <span class="token operator" data-v-47862caa>=</span> rxjs<span class="token punctuation" data-v-47862caa>.</span>operators<span class="token punctuation" data-v-47862caa>;</span>
    <span class="token function" data-v-47862caa>interval</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1000</span><span class="token punctuation" data-v-47862caa>)</span>
      <span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span>
        <span class="token comment" data-v-47862caa>// timer(5000) 是等待5s发出值</span>
        <span class="token comment" data-v-47862caa>// skipUntil 舍弃timer(5000)开始发出之前的那些值</span>
        <span class="token function" data-v-47862caa>skipUntil</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>timer</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>5000</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span>
      <span class="token punctuation" data-v-47862caa>)</span>
      <span class="token comment" data-v-47862caa>// 从 4 开始输出 每秒1发送一次，4, 5, 6, 7...</span>
      <span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>val <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span>val<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
    <span class="token function" data-v-47862caa>interval</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1000</span><span class="token punctuation" data-v-47862caa>)</span>
      <span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span>
        <span class="token comment" data-v-47862caa>// timer(5000) 是等待5s发出值</span>
        <span class="token comment" data-v-47862caa>// skipWhile 舍弃timer(5000)开始发出之前的那些值</span>
        <span class="token comment" data-v-47862caa>// 输出</span>
        <span class="token function" data-v-47862caa>skipWhile</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>(</span>val<span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> val <span class="token operator" data-v-47862caa>&lt;</span> <span class="token number" data-v-47862caa>5</span><span class="token punctuation" data-v-47862caa>)</span>
      <span class="token punctuation" data-v-47862caa>)</span>
      <span class="token comment" data-v-47862caa>// 从 -5 开始输出 每秒1发送一次，如 -5, -6, -7 ...</span>
      <span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>val <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token template-string" data-v-47862caa><span class="token template-punctuation string" data-v-47862caa>`</span><span class="token string" data-v-47862caa>-</span><span class="token interpolation" data-v-47862caa><span class="token interpolation-punctuation punctuation" data-v-47862caa>${</span>val<span class="token interpolation-punctuation punctuation" data-v-47862caa>}</span></span><span class="token template-punctuation string" data-v-47862caa>`</span></span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa><span class="line-number" data-v-47862caa>10</span><br data-v-47862caa><span class="line-number" data-v-47862caa>11</span><br data-v-47862caa><span class="line-number" data-v-47862caa>12</span><br data-v-47862caa><span class="line-number" data-v-47862caa>13</span><br data-v-47862caa><span class="line-number" data-v-47862caa>14</span><br data-v-47862caa><span class="line-number" data-v-47862caa>15</span><br data-v-47862caa><span class="line-number" data-v-47862caa>16</span><br data-v-47862caa><span class="line-number" data-v-47862caa>17</span><br data-v-47862caa><span class="line-number" data-v-47862caa>18</span><br data-v-47862caa><span class="line-number" data-v-47862caa>19</span><br data-v-47862caa><span class="line-number" data-v-47862caa>20</span><br data-v-47862caa><span class="line-number" data-v-47862caa>21</span><br data-v-47862caa><span class="line-number" data-v-47862caa>22</span><br data-v-47862caa><span class="line-number" data-v-47862caa>23</span><br data-v-47862caa><span class="line-number" data-v-47862caa>24</span><br data-v-47862caa><span class="line-number" data-v-47862caa>25</span><br data-v-47862caa><span class="line-number" data-v-47862caa>26</span><br data-v-47862caa><span class="line-number" data-v-47862caa>27</span><br data-v-47862caa><span class="line-number" data-v-47862caa>28</span><br data-v-47862caa><span class="line-number" data-v-47862caa>29</span><br data-v-47862caa><span class="line-number" data-v-47862caa>30</span><br data-v-47862caa><span class="line-number" data-v-47862caa>31</span><br data-v-47862caa><span class="line-number" data-v-47862caa>32</span><br data-v-47862caa><span class="line-number" data-v-47862caa>33</span><br data-v-47862caa><span class="line-number" data-v-47862caa>34</span><br data-v-47862caa><span class="line-number" data-v-47862caa>35</span><br data-v-47862caa><span class="line-number" data-v-47862caa>36</span><br data-v-47862caa><span class="line-number" data-v-47862caa>37</span><br data-v-47862caa><span class="line-number" data-v-47862caa>38</span><br data-v-47862caa><span class="line-number" data-v-47862caa>39</span><br data-v-47862caa><span class="line-number" data-v-47862caa>40</span><br data-v-47862caa><span class="line-number" data-v-47862caa>41</span><br data-v-47862caa><span class="line-number" data-v-47862caa>42</span><br data-v-47862caa><span class="line-number" data-v-47862caa>43</span><br data-v-47862caa><span class="line-number" data-v-47862caa>44</span><br data-v-47862caa></div></div><h2 id="关于subject" data-v-47862caa><a href="#关于subject" class="header-anchor" data-v-47862caa>#</a> 关于Subject</h2> <h3 id="subject-observable区别" data-v-47862caa><a href="#subject-observable区别" class="header-anchor" data-v-47862caa>#</a> Subject/Observable区别</h3> <p data-v-47862caa>Observable有三种状态（即subscribe的三个参数）：next、error、complete</p> <ul data-v-47862caa><li data-v-47862caa>next是正常执行时的内容，subscribe的第一个参数</li> <li data-v-47862caa>error是当执行时出错，或监听了throw类型Observable时的执行内容，subscribe的第二个参数</li> <li data-v-47862caa>complete是Observable执行结束时的内容，subscribe的第三个参数</li></ul> <p data-v-47862caa>特殊的Observable：永不结束、Never、Empty（结束但不发射）、Throw</p> <p data-v-47862caa>Never类型Observable表示不会发生也永远不会结束，也可直接通过Rx.Observable.error('xxx')的方式声明，结果不会执行next、error、complete中任何一个阶段</p> <p data-v-47862caa>Empty类型Observable不会发射元素会直接结束，也可以通过Rx.Observable.empty()的方式声明，结果不会执行next、error，会执行complete阶段</p> <p data-v-47862caa>Throw类型Observable直接进入error状态，会在执行过程中抛出异常导致，也可以直接通过Rx.Observable.throw('xxx')的方式声明，结果只会执行error阶段</p> <p data-v-47862caa>Subject 既是 Observable，又是 Observer 。当对 subject 调用 subscribe 时，只是将 observer 添加到数组中。每当subject或 observable发出值时，它才会调用数组中每个next() 方法。</p> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>var</span> subject <span class="token operator" data-v-47862caa>=</span> <span class="token keyword" data-v-47862caa>new</span> <span class="token class-name" data-v-47862caa>Rx</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>Subject</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
subject<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>{</span>
  <span class="token function-variable function" data-v-47862caa>next</span><span class="token operator" data-v-47862caa>:</span> <span class="token punctuation" data-v-47862caa>(</span>v<span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'observerA: '</span> <span class="token operator" data-v-47862caa>+</span> v<span class="token punctuation" data-v-47862caa>)</span>
<span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
subject<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>{</span>
  <span class="token function-variable function" data-v-47862caa>next</span><span class="token operator" data-v-47862caa>:</span> <span class="token punctuation" data-v-47862caa>(</span>v<span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'observerB: '</span> <span class="token operator" data-v-47862caa>+</span> v<span class="token punctuation" data-v-47862caa>)</span>
<span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
subject<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>next</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
subject<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>next</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>2</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa></div></div><p data-v-47862caa>Subject是一种能够发射数据给多个observer的Observable， Observable只能发射数据给一个observer， 所以说Subject是一种特殊类型的 Observable。</p> <p data-v-47862caa>当使用 Subject 时，无论你何时 subscribe， 你永远都会得到相同的执行，这点不同于典型的 observable，每次 subscribe 都会开启有个新的执行。类似现场直播。</p> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa> <span class="token keyword" data-v-47862caa>const</span> interval$ <span class="token operator" data-v-47862caa>=</span> Rx<span class="token punctuation" data-v-47862caa>.</span>Observable<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>interval</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1000</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>take</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>7</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
  <span class="token keyword" data-v-47862caa>const</span> subject <span class="token operator" data-v-47862caa>=</span> <span class="token keyword" data-v-47862caa>new</span> <span class="token class-name" data-v-47862caa>MySubject</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
  subject<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>map</span><span class="token punctuation" data-v-47862caa>(</span>value <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token template-string" data-v-47862caa><span class="token template-punctuation string" data-v-47862caa>`</span><span class="token string" data-v-47862caa>Observer one </span><span class="token interpolation" data-v-47862caa><span class="token interpolation-punctuation punctuation" data-v-47862caa>${</span>value<span class="token interpolation-punctuation punctuation" data-v-47862caa>}</span></span><span class="token template-punctuation string" data-v-47862caa>`</span></span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>value <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token punctuation" data-v-47862caa>{</span>
    <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span>value<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
  <span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
  interval$<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>subject<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
  <span class="token function" data-v-47862caa>setTimeout</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token punctuation" data-v-47862caa>{</span>
    subject<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>map</span><span class="token punctuation" data-v-47862caa>(</span>value <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token template-string" data-v-47862caa><span class="token template-punctuation string" data-v-47862caa>`</span><span class="token string" data-v-47862caa>Observer two </span><span class="token interpolation" data-v-47862caa><span class="token interpolation-punctuation punctuation" data-v-47862caa>${</span>value<span class="token interpolation-punctuation punctuation" data-v-47862caa>}</span></span><span class="token template-punctuation string" data-v-47862caa>`</span></span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>value <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token punctuation" data-v-47862caa>{</span>
       <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span>value<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
    <span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
  <span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>2000</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa><span class="line-number" data-v-47862caa>10</span><br data-v-47862caa><span class="line-number" data-v-47862caa>11</span><br data-v-47862caa></div></div><h3 id="subject-eventemitter的区别" data-v-47862caa><a href="#subject-eventemitter的区别" class="header-anchor" data-v-47862caa>#</a> Subject/EventEmitter的区别</h3> <p data-v-47862caa>EventEmitter继承Subject，是angular针对ui模板是使用Subject的封装，使用emit传递数据，让我们可以简单通过（属性）=方法的模板形式使用Subject，避开繁琐的中间发布订阅逻辑,并在组件销毁时自动处理订阅销毁问题。我们常常在一些第三方UI组件的类型定义看到很多属性是EventEmitter，本质是该属性内部封装了遵循angualrUI模板方法通讯的基本结构，你可以在对应dom中使用（属性）=方法来使用该属性</p> <h3 id="使用observable代替subject" data-v-47862caa><a href="#使用observable代替subject" class="header-anchor" data-v-47862caa>#</a> 使用Observable代替Subject</h3> <p data-v-47862caa>RxJS 中的 Subjects 经常被误解。因为它们允许你命令式地向 Observable 流中推送值，当人们不太清楚如何将某个东西变成 Observable 时，他们倾向于滥用 Subjects 。此模式看起来有点像这样...</p> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token comment" data-v-47862caa>// 当人们发现不太清楚如何做时，通常会首先使用 Subjects</span>
<span class="token comment" data-v-47862caa>// (不要这样做)</span>
<span class="token keyword" data-v-47862caa>const</span> subject <span class="token operator" data-v-47862caa>=</span> <span class="token keyword" data-v-47862caa>new</span> <span class="token class-name" data-v-47862caa>Subject</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
button<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>addEventListener</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'click'</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> subject<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>next</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'click'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
subject<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>x <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span>x<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa></div></div><p data-v-47862caa>虽然这常常很有帮助，但这不是以 “Rx 的方式”在处理问题。理想的是在 Observable 中包装事件注册，既可以监听事件，又可以取消事件监听。看起来像这样:</p> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token comment" data-v-47862caa>// 这样好些了，但请使用 Observable.fromEvent(button, 'click') 来替代</span>
<span class="token keyword" data-v-47862caa>const</span> clicks <span class="token operator" data-v-47862caa>=</span> <span class="token keyword" data-v-47862caa>new</span> <span class="token class-name" data-v-47862caa>Observable</span><span class="token punctuation" data-v-47862caa>(</span>observer <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token punctuation" data-v-47862caa>{</span>
  <span class="token keyword" data-v-47862caa>const</span> <span class="token function-variable function" data-v-47862caa>handler</span> <span class="token operator" data-v-47862caa>=</span> <span class="token punctuation" data-v-47862caa>(</span>e<span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> observer<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>next</span><span class="token punctuation" data-v-47862caa>(</span>e<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
  button<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>addEventListener</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'click'</span><span class="token punctuation" data-v-47862caa>,</span> handler<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
  <span class="token keyword" data-v-47862caa>return</span> <span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> button<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>removeEventListener</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'click'</span><span class="token punctuation" data-v-47862caa>,</span> handler<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa></div></div><h3 id="behaviorsubject" data-v-47862caa><a href="#behaviorsubject" class="header-anchor" data-v-47862caa>#</a> BehaviorSubject</h3> <p data-v-47862caa>BehaviorSubject它保存了发送给消费者的最新值。并且当有新的观察者订阅时，会立即从 BehaviorSubject 那接收到这个最新值。</p> <h3 id="replaysubject" data-v-47862caa><a href="#replaysubject" class="header-anchor" data-v-47862caa>#</a> ReplaySubject</h3> <p data-v-47862caa>ReplaySubject 类似于BehaviorSubject，它可以发送旧值给新的订阅者，它还可以记录Observable执行的一部分。当创建 ReplaySubject 时，你可以指定回放多少个值。</p> <h3 id="asyncsubject" data-v-47862caa><a href="#asyncsubject" class="header-anchor" data-v-47862caa>#</a> AsyncSubject</h3> <p data-v-47862caa>AsyncSubject只有当 Observable 执行完成时(执行 complete())，它才会将执行的最后一个值发送给观察者。</p> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>var</span> subject <span class="token operator" data-v-47862caa>=</span> <span class="token keyword" data-v-47862caa>new</span> <span class="token class-name" data-v-47862caa>Rx</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>AsyncSubject</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
subject<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>{</span>
  <span class="token function-variable function" data-v-47862caa>next</span><span class="token operator" data-v-47862caa>:</span> <span class="token punctuation" data-v-47862caa>(</span>v<span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'observerA: '</span> <span class="token operator" data-v-47862caa>+</span> v<span class="token punctuation" data-v-47862caa>)</span>
<span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
subject<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>next</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
subject<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>next</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>2</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
subject<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>next</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>3</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
subject<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>next</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>4</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
subject<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>{</span>
  <span class="token function-variable function" data-v-47862caa>next</span><span class="token operator" data-v-47862caa>:</span> <span class="token punctuation" data-v-47862caa>(</span>v<span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'observerB: '</span> <span class="token operator" data-v-47862caa>+</span> v<span class="token punctuation" data-v-47862caa>)</span>
<span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
subject<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>next</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>5</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
subject<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>complete</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa><span class="line-number" data-v-47862caa>10</span><br data-v-47862caa><span class="line-number" data-v-47862caa>11</span><br data-v-47862caa><span class="line-number" data-v-47862caa>12</span><br data-v-47862caa><span class="line-number" data-v-47862caa>13</span><br data-v-47862caa></div></div><h3 id="subjects不可重用" data-v-47862caa><a href="#subjects不可重用" class="header-anchor" data-v-47862caa>#</a> Subjects不可重用</h3> <p data-v-47862caa>在 RxJS 中，Subjects 不能重用。也就是说，当一个 Subject 完成或报错时，便不可再使用了。如果你尝试在已关闭的 Subject (调用过 complete 或 error 方法)上调用 next，它会默认忽略通知。如果想 Subject 在完成后调用 next 时进行显示地报错，你可以在 subject 实例上直接调用 unsubscribe 。</p> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token comment" data-v-47862caa>// Subject 之死</span>
<span class="token keyword" data-v-47862caa>const</span> subject <span class="token operator" data-v-47862caa>=</span> <span class="token keyword" data-v-47862caa>new</span> <span class="token class-name" data-v-47862caa>Subject</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
subject<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>x <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span>x<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
subject<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>next</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>    <span class="token comment" data-v-47862caa>// 1</span>
subject<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>next</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>2</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>    <span class="token comment" data-v-47862caa>// 2</span>
subject<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>complete</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
subject<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>next</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>3</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>    <span class="token comment" data-v-47862caa>// 悄悄地忽略</span>
subject<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>unsubscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
subject<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>next</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>4</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>    <span class="token comment" data-v-47862caa>// Unhandled ObjectUnsubscribedError</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa></div></div><h3 id="错误处理中的observable" data-v-47862caa><a href="#错误处理中的observable" class="header-anchor" data-v-47862caa>#</a> 错误处理中的Observable</h3> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token comment" data-v-47862caa>// 演示缺少错误处理时会进行重新抛出</span>
<span class="token keyword" data-v-47862caa>const</span> badObservable <span class="token operator" data-v-47862caa>=</span> Observable<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>throw</span><span class="token punctuation" data-v-47862caa>(</span><span class="token keyword" data-v-47862caa>new</span> <span class="token class-name" data-v-47862caa>Error</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'haha'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>try</span> <span class="token punctuation" data-v-47862caa>{</span>
  badObservable<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>{</span>
    <span class="token function-variable function" data-v-47862caa>next</span><span class="token operator" data-v-47862caa>:</span> x <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span>x<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
    error<span class="token operator" data-v-47862caa>:</span> <span class="token keyword" data-v-47862caa>null</span><span class="token punctuation" data-v-47862caa>,</span>
    <span class="token function-variable function" data-v-47862caa>complete</span><span class="token operator" data-v-47862caa>:</span> <span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'done'</span><span class="token punctuation" data-v-47862caa>)</span>
  <span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>catch</span> <span class="token punctuation" data-v-47862caa>(</span>err<span class="token punctuation" data-v-47862caa>)</span> <span class="token punctuation" data-v-47862caa>{</span>
  <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>error</span><span class="token punctuation" data-v-47862caa>(</span>err<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span> <span class="token comment" data-v-47862caa>// 输出自定义错误: &quot;haha&quot;</span>
<span class="token punctuation" data-v-47862caa>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa><span class="line-number" data-v-47862caa>10</span><br data-v-47862caa><span class="line-number" data-v-47862caa>11</span><br data-v-47862caa></div></div><p data-v-47862caa>现在我们来想想，当你循环观察者列表并通知它们时会发生什么(正如 subject 所做的)。</p> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>for</span> <span class="token punctuation" data-v-47862caa>(</span><span class="token keyword" data-v-47862caa>let</span> observer <span class="token keyword" data-v-47862caa>of</span> observers<span class="token punctuation" data-v-47862caa>)</span> <span class="token punctuation" data-v-47862caa>{</span>
  observer<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>next</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'notify'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span> <span class="token comment" data-v-47862caa>// 如果在这里调用 throw 会发生什么？</span>
<span class="token punctuation" data-v-47862caa>}</span>
<span class="token comment" data-v-47862caa>// 提示: 会报错会打破循环</span>
<span class="token comment" data-v-47862caa>// 注意: 好吧，这不仅仅是个提示</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa></div></div><p data-v-47862caa>假设一些操作符是同步处理的(map、filter、scan 等等)，如果其中一个或任何其它同步操作符报错了，你会在多播(使用 Subject 来循环观察者列表并通知它们)的下游得到一些诡异的行为:</p> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token comment" data-v-47862caa>// 会发生奇怪的行为</span>
<span class="token keyword" data-v-47862caa>const</span> source$ <span class="token operator" data-v-47862caa>=</span> Observable<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>interval</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1000</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>share</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> mapped$ <span class="token operator" data-v-47862caa>=</span> source$<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>map</span><span class="token punctuation" data-v-47862caa>(</span>x <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token punctuation" data-v-47862caa>{</span>
  <span class="token keyword" data-v-47862caa>if</span> <span class="token punctuation" data-v-47862caa>(</span>x <span class="token operator" data-v-47862caa>===</span> <span class="token number" data-v-47862caa>1</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token punctuation" data-v-47862caa>{</span>
    <span class="token keyword" data-v-47862caa>throw</span> <span class="token keyword" data-v-47862caa>new</span> <span class="token class-name" data-v-47862caa>Error</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'oops'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
  <span class="token punctuation" data-v-47862caa>}</span>
  <span class="token keyword" data-v-47862caa>return</span> x<span class="token punctuation" data-v-47862caa>;</span>
<span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
source$<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>x <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'A'</span><span class="token punctuation" data-v-47862caa>,</span> x<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
mapped$<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>x <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'B'</span><span class="token punctuation" data-v-47862caa>,</span> x<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
source$<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>x <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'C'</span><span class="token punctuation" data-v-47862caa>,</span> x<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>// &quot;A&quot; 0</span>
<span class="token comment" data-v-47862caa>// &quot;B&quot; 0</span>
<span class="token comment" data-v-47862caa>// &quot;C&quot; 0</span>
<span class="token comment" data-v-47862caa>// &quot;A&quot; 1</span>
<span class="token comment" data-v-47862caa>// Uncaught Error: &quot;oops&quot;</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa><span class="line-number" data-v-47862caa>10</span><br data-v-47862caa><span class="line-number" data-v-47862caa>11</span><br data-v-47862caa><span class="line-number" data-v-47862caa>12</span><br data-v-47862caa><span class="line-number" data-v-47862caa>13</span><br data-v-47862caa><span class="line-number" data-v-47862caa>14</span><br data-v-47862caa><span class="line-number" data-v-47862caa>15</span><br data-v-47862caa><span class="line-number" data-v-47862caa>16</span><br data-v-47862caa></div></div><p data-v-47862caa>在上面的示例中，大多数用户会期望 A 和 C 能继续通知。输出 B 的 observable 死了是可以理解的，它报错了，但其他流和源流也死了令人想当困惑。任意的第三方都可以杀掉共享的 observable 流以及未知数量的兄弟流，不应该是这样的。</p> <p data-v-47862caa>临时解决上述场景中的问题是使用调度器( schedulers )。你可以在多播后使用 observeOn，这样就可以解决此问题，因为错误不再是同步抛出的。</p> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>const</span> source$ <span class="token operator" data-v-47862caa>=</span> Observable<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>interval</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1000</span><span class="token punctuation" data-v-47862caa>)</span>
  <span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>share</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span>
  <span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>observeOn</span><span class="token punctuation" data-v-47862caa>(</span>Rx<span class="token punctuation" data-v-47862caa>.</span>Scheduler<span class="token punctuation" data-v-47862caa>.</span>asap<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span> <span class="token comment" data-v-47862caa>// 点睛之笔</span>
<span class="token keyword" data-v-47862caa>const</span> mapped$ <span class="token operator" data-v-47862caa>=</span> source$<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>map</span><span class="token punctuation" data-v-47862caa>(</span>x <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token punctuation" data-v-47862caa>{</span>
  <span class="token keyword" data-v-47862caa>if</span> <span class="token punctuation" data-v-47862caa>(</span>x <span class="token operator" data-v-47862caa>===</span> <span class="token number" data-v-47862caa>1</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token punctuation" data-v-47862caa>{</span>
    <span class="token keyword" data-v-47862caa>throw</span> <span class="token keyword" data-v-47862caa>new</span> <span class="token class-name" data-v-47862caa>Error</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'oops'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
  <span class="token punctuation" data-v-47862caa>}</span>
  <span class="token keyword" data-v-47862caa>return</span> x<span class="token punctuation" data-v-47862caa>;</span>
<span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
source$<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>x <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'A'</span><span class="token punctuation" data-v-47862caa>,</span> x<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
mapped$<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>x <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'B'</span><span class="token punctuation" data-v-47862caa>,</span> x<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
source$<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>x <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'C'</span><span class="token punctuation" data-v-47862caa>,</span> x<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>// &quot;A&quot; 0</span>
<span class="token comment" data-v-47862caa>// &quot;B&quot; 0</span>
<span class="token comment" data-v-47862caa>// &quot;C&quot; 0</span>
<span class="token comment" data-v-47862caa>// &quot;A&quot; 1</span>
<span class="token comment" data-v-47862caa>// Uncaught Error: &quot;oops&quot;</span>
<span class="token comment" data-v-47862caa>// &quot;C&quot; 1</span>
<span class="token comment" data-v-47862caa>// &quot;A&quot; 2</span>
<span class="token comment" data-v-47862caa>// &quot;C&quot; 2 </span>
<span class="token comment" data-v-47862caa>// &quot;A&quot; 3</span>
<span class="token comment" data-v-47862caa>// &quot;C&quot; 3</span>
<span class="token comment" data-v-47862caa>// ... 等等</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa><span class="line-number" data-v-47862caa>10</span><br data-v-47862caa><span class="line-number" data-v-47862caa>11</span><br data-v-47862caa><span class="line-number" data-v-47862caa>12</span><br data-v-47862caa><span class="line-number" data-v-47862caa>13</span><br data-v-47862caa><span class="line-number" data-v-47862caa>14</span><br data-v-47862caa><span class="line-number" data-v-47862caa>15</span><br data-v-47862caa><span class="line-number" data-v-47862caa>16</span><br data-v-47862caa><span class="line-number" data-v-47862caa>17</span><br data-v-47862caa><span class="line-number" data-v-47862caa>18</span><br data-v-47862caa><span class="line-number" data-v-47862caa>19</span><br data-v-47862caa><span class="line-number" data-v-47862caa>20</span><br data-v-47862caa><span class="line-number" data-v-47862caa>21</span><br data-v-47862caa><span class="line-number" data-v-47862caa>22</span><br data-v-47862caa><span class="line-number" data-v-47862caa>23</span><br data-v-47862caa></div></div><p data-v-47862caa>还有另一种临时解决方案，如果你可以管理它的话，它的性能会更好一些，方法是只需为所有的 subscriptions 添加错误处理方法。</p> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>const</span> source$ <span class="token operator" data-v-47862caa>=</span> Observable<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>interval</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1000</span><span class="token punctuation" data-v-47862caa>)</span>
  <span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>share</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span>
  <span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>observeOn</span><span class="token punctuation" data-v-47862caa>(</span>Rx<span class="token punctuation" data-v-47862caa>.</span>Scheduler<span class="token punctuation" data-v-47862caa>.</span>asap<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span> <span class="token comment" data-v-47862caa>// 点睛之笔</span>
<span class="token keyword" data-v-47862caa>const</span> mapped$ <span class="token operator" data-v-47862caa>=</span> source$<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>map</span><span class="token punctuation" data-v-47862caa>(</span>x <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token punctuation" data-v-47862caa>{</span>
  <span class="token keyword" data-v-47862caa>if</span> <span class="token punctuation" data-v-47862caa>(</span>x <span class="token operator" data-v-47862caa>===</span> <span class="token number" data-v-47862caa>1</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token punctuation" data-v-47862caa>{</span>
    <span class="token keyword" data-v-47862caa>throw</span> <span class="token keyword" data-v-47862caa>new</span> <span class="token class-name" data-v-47862caa>Error</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'oops'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
  <span class="token punctuation" data-v-47862caa>}</span>
  <span class="token keyword" data-v-47862caa>return</span> x<span class="token punctuation" data-v-47862caa>;</span>
<span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
source$<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>x <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'A'</span><span class="token punctuation" data-v-47862caa>,</span> x<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
mapped$<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>
  x <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'B'</span><span class="token punctuation" data-v-47862caa>,</span> x<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
  err <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'Error handled: '</span> <span class="token operator" data-v-47862caa>+</span> err<span class="token punctuation" data-v-47862caa>.</span>message<span class="token punctuation" data-v-47862caa>)</span>
<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
source$<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>x <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'C'</span><span class="token punctuation" data-v-47862caa>,</span> x<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>// &quot;A&quot; 0</span>
<span class="token comment" data-v-47862caa>// &quot;B&quot; 0</span>
<span class="token comment" data-v-47862caa>// &quot;C&quot; 0</span>
<span class="token comment" data-v-47862caa>// &quot;A&quot; 1</span>
<span class="token comment" data-v-47862caa>// &quot;Error handled: oops&quot;</span>
<span class="token comment" data-v-47862caa>// &quot;C&quot; 1</span>
<span class="token comment" data-v-47862caa>// &quot;A&quot; 2</span>
<span class="token comment" data-v-47862caa>// &quot;C&quot; 2 </span>
<span class="token comment" data-v-47862caa>// &quot;A&quot; 3</span>
<span class="token comment" data-v-47862caa>// &quot;C&quot; 3</span>
<span class="token comment" data-v-47862caa>// ... 等等</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa><span class="line-number" data-v-47862caa>10</span><br data-v-47862caa><span class="line-number" data-v-47862caa>11</span><br data-v-47862caa><span class="line-number" data-v-47862caa>12</span><br data-v-47862caa><span class="line-number" data-v-47862caa>13</span><br data-v-47862caa><span class="line-number" data-v-47862caa>14</span><br data-v-47862caa><span class="line-number" data-v-47862caa>15</span><br data-v-47862caa><span class="line-number" data-v-47862caa>16</span><br data-v-47862caa><span class="line-number" data-v-47862caa>17</span><br data-v-47862caa><span class="line-number" data-v-47862caa>18</span><br data-v-47862caa><span class="line-number" data-v-47862caa>19</span><br data-v-47862caa><span class="line-number" data-v-47862caa>20</span><br data-v-47862caa><span class="line-number" data-v-47862caa>21</span><br data-v-47862caa><span class="line-number" data-v-47862caa>22</span><br data-v-47862caa><span class="line-number" data-v-47862caa>23</span><br data-v-47862caa><span class="line-number" data-v-47862caa>24</span><br data-v-47862caa><span class="line-number" data-v-47862caa>25</span><br data-v-47862caa><span class="line-number" data-v-47862caa>26</span><br data-v-47862caa></div></div><h2 id="publish-share" data-v-47862caa><a href="#publish-share" class="header-anchor" data-v-47862caa>#</a> publish/share</h2> <p data-v-47862caa>如果你已经掌握了大部分的基础操作符，那么冷/热流的概念你一定要知道。事实上，我们在angular项目中使用的（通过在服务中return出new Observable(Observer=&gt;{})的形式）全局缓存其实是一种冷流机制，每次订阅产生新的Observable,也可以用热流的包装结构BehaviorSubject,过滤掉初始值它可以保留我们第一次next的数据，实现每次订阅获取缓存中的值。</p> <p data-v-47862caa>热流经常出现在我们使用Subject做总线通讯机制，也就是我们常常遇到的已经next一个值了再去subscribe却获取不到值，这常常是刚学不久的朋友在并发请求和处理数据写出的一个bug。以比较感性的说明冷流就是可以获取你之前next的值，像看电视那样的点播，无论你什么时候去看都可以看到完整的节目，热流是只能获取订阅后next的数据，像是在看现场直播，错过了时间点就错过了已经播出的情况。</p> <p data-v-47862caa>如果你有一定基础，你大概见过share/publish操作符，share操符其实是冷热流转化经典结构的封装，往下我们一点一点从基本该概念出发说明清楚。</p> <div class="custom-block tip" data-v-47862caa><p class="custom-block-title" data-v-47862caa>先思考下</p> <p data-v-47862caa>publish 和 share 之间的区别是什么？
如何导入 refCount 操作符？
何时使用 AsyncSubject？</p></div> <h3 id="多播的心智模型" data-v-47862caa><a href="#多播的心智模型" class="header-anchor" data-v-47862caa>#</a> 多播的心智模型</h3> <p data-v-47862caa>多播用来描述由单个 observable 发出的每个通知会被多个观察者所接收的情况。一个 observable 是否具备多播的能力取决于它是热的还是冷的。</p> <p data-v-47862caa>热的和冷的 observable 的特征在于 observable 通知的生产者是在哪创建的。一个新订阅的消费者能否收到生产者历史的通知。</p> <p data-v-47862caa>如果通知的生产者是观察者订阅 observable 时创建的，那么 observable 就是冷的。例如，timer observable 就是冷的，每次订阅时都会创建一个新的定时器。</p> <p data-v-47862caa>如果通知的生产者不是每次观察者订阅 observable 时创建的，那么 observable 就是热的。例如，使用 fromEvent 创建的 observable 就是热的，产生事件的元素存在于 DOM 之中，它不是观察者订阅时所创建的。</p> <p data-v-47862caa>冷的 observables 是单播的，每个观察者所接收到的通知都是来自不同的生产者，生产者是观察者订阅时所创建的。也是点播，可以获取流过去发射的数据。</p> <p data-v-47862caa>热的 observables 是多播的，每个观察者所接收到的通知都是来自同一个生产者。也是直播，不可以获取流过去发射的数据。</p> <p data-v-47862caa>有些时候，需要冷的 observable 具有多播的行为，RxJS 引入了 Subject 类使之成为可能。</p> <p data-v-47862caa>初学者经常会把Subject和Subscription搞混，new Subject被订阅后同样可以像observable那样返回Subscription。Subject 即是 observable，又是 observer。通过使用观察者来订阅 subject，然后 subject 再订阅冷的 observable，可以让冷的 observable 变成热的，同时让一个生产者的通知给多个消费者同一时刻接受。这是 RxJS 引入 subjects 的主要用途。多播是 RxJS 中 Subjects 的主要用法。我们来看下面的示例:</p> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> Observable <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>&quot;rxjs/Observable&quot;</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> Subject <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>&quot;rxjs/Subject&quot;</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token string" data-v-47862caa>&quot;rxjs/add/observable/defer&quot;</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token string" data-v-47862caa>&quot;rxjs/add/observable/of&quot;</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> source <span class="token operator" data-v-47862caa>=</span> Observable<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>defer</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> Observable<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>of</span><span class="token punctuation" data-v-47862caa>(</span>
  Math<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>floor</span><span class="token punctuation" data-v-47862caa>(</span>Math<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>random</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>*</span> <span class="token number" data-v-47862caa>100</span><span class="token punctuation" data-v-47862caa>)</span>
<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>function</span> <span class="token function" data-v-47862caa>observer</span><span class="token punctuation" data-v-47862caa>(</span>name<span class="token operator" data-v-47862caa>:</span> <span class="token builtin" data-v-47862caa>string</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token punctuation" data-v-47862caa>{</span>
  <span class="token keyword" data-v-47862caa>return</span> <span class="token punctuation" data-v-47862caa>{</span>
    <span class="token function-variable function" data-v-47862caa>next</span><span class="token operator" data-v-47862caa>:</span> <span class="token punctuation" data-v-47862caa>(</span>value<span class="token operator" data-v-47862caa>:</span> <span class="token builtin" data-v-47862caa>number</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token template-string" data-v-47862caa><span class="token template-punctuation string" data-v-47862caa>`</span><span class="token string" data-v-47862caa>observer </span><span class="token interpolation" data-v-47862caa><span class="token interpolation-punctuation punctuation" data-v-47862caa>${</span>name<span class="token interpolation-punctuation punctuation" data-v-47862caa>}</span></span><span class="token string" data-v-47862caa>: </span><span class="token interpolation" data-v-47862caa><span class="token interpolation-punctuation punctuation" data-v-47862caa>${</span>value<span class="token interpolation-punctuation punctuation" data-v-47862caa>}</span></span><span class="token template-punctuation string" data-v-47862caa>`</span></span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
    <span class="token function-variable function" data-v-47862caa>complete</span><span class="token operator" data-v-47862caa>:</span> <span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token template-string" data-v-47862caa><span class="token template-punctuation string" data-v-47862caa>`</span><span class="token string" data-v-47862caa>observer </span><span class="token interpolation" data-v-47862caa><span class="token interpolation-punctuation punctuation" data-v-47862caa>${</span>name<span class="token interpolation-punctuation punctuation" data-v-47862caa>}</span></span><span class="token string" data-v-47862caa>: complete</span><span class="token template-punctuation string" data-v-47862caa>`</span></span><span class="token punctuation" data-v-47862caa>)</span>
  <span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token punctuation" data-v-47862caa>}</span>
<span class="token keyword" data-v-47862caa>const</span> subject <span class="token operator" data-v-47862caa>=</span> <span class="token keyword" data-v-47862caa>new</span> <span class="token class-name" data-v-47862caa>Subject<span class="token operator" data-v-47862caa>&lt;</span><span class="token builtin" data-v-47862caa>number</span><span class="token operator" data-v-47862caa>&gt;</span></span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
subject<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>observer</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>&quot;a&quot;</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
subject<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>observer</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>&quot;b&quot;</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
source<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>subject<span class="token punctuation" data-v-47862caa>)</span> 
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa><span class="line-number" data-v-47862caa>10</span><br data-v-47862caa><span class="line-number" data-v-47862caa>11</span><br data-v-47862caa><span class="line-number" data-v-47862caa>12</span><br data-v-47862caa><span class="line-number" data-v-47862caa>13</span><br data-v-47862caa><span class="line-number" data-v-47862caa>14</span><br data-v-47862caa><span class="line-number" data-v-47862caa>15</span><br data-v-47862caa><span class="line-number" data-v-47862caa>16</span><br data-v-47862caa><span class="line-number" data-v-47862caa>17</span><br data-v-47862caa></div></div><p data-v-47862caa>示例中的 source 是冷的。每次观察者订阅 source 时，传给 defer 的工厂函数会创建一个发出随机数后完成的 observable 。</p> <p data-v-47862caa>要让 source 变成多播的，需要观察者订阅 subject，然后 subject 再订阅 source 。source 只会看到一个订阅 ( subscription )，它也只生成一个包含随机数的 next 通知和一个 complete 通知。Subject 会将这些通知发送给它的观察者，输出如下所示:</p> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa>observer a<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>42</span>
observer b<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>42</span>
observer a<span class="token operator" data-v-47862caa>:</span> complete
observer b<span class="token operator" data-v-47862caa>:</span> complete
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa></div></div><p data-v-47862caa>此示例可以作为 RxJS 多播的基本心智模型: 一个源 observable，一个订阅源 observable 的 subject 和多个订阅 subject 的观察者。</p> <h3 id="multicast-connectableobservable" data-v-47862caa><a href="#multicast-connectableobservable" class="header-anchor" data-v-47862caa>#</a> multicast/ConnectableObservable</h3> <p data-v-47862caa>RxJS 引入了 multicast 操作符，它可以应用于 observable ，使其变成热的。此操作符封装了 subject 用于多播 observable 时所涉及的基础结构。</p> <p data-v-47862caa>在看 multicast 操作符之前，我们使用一个简单实现的 multicast 函数来替代上面示例中的 subject :</p> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>function</span> <span class="token generic-function" data-v-47862caa><span class="token function" data-v-47862caa>multicast</span><span class="token generic class-name" data-v-47862caa><span class="token operator" data-v-47862caa>&lt;</span><span class="token constant" data-v-47862caa>T</span><span class="token operator" data-v-47862caa>&gt;</span></span></span><span class="token punctuation" data-v-47862caa>(</span>source<span class="token operator" data-v-47862caa>:</span> Observable<span class="token operator" data-v-47862caa>&lt;</span><span class="token constant" data-v-47862caa>T</span><span class="token operator" data-v-47862caa>&gt;</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token punctuation" data-v-47862caa>{</span>
  <span class="token keyword" data-v-47862caa>const</span> subject <span class="token operator" data-v-47862caa>=</span> <span class="token keyword" data-v-47862caa>new</span> <span class="token class-name" data-v-47862caa>Subject<span class="token operator" data-v-47862caa>&lt;</span><span class="token constant" data-v-47862caa>T</span><span class="token operator" data-v-47862caa>&gt;</span></span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
  source<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>subject<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
  <span class="token keyword" data-v-47862caa>return</span> subject<span class="token punctuation" data-v-47862caa>;</span>
<span class="token punctuation" data-v-47862caa>}</span>
<span class="token keyword" data-v-47862caa>const</span> m <span class="token operator" data-v-47862caa>=</span> <span class="token function" data-v-47862caa>multicast</span><span class="token punctuation" data-v-47862caa>(</span>source<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
m<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>observer</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>&quot;a&quot;</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
m<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>observer</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>&quot;b&quot;</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa></div></div><p data-v-47862caa>代码改变后，示例的输出如下:</p> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa>observer a<span class="token operator" data-v-47862caa>:</span> complete
observer b<span class="token operator" data-v-47862caa>:</span> complete
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa></div></div><p data-v-47862caa>这并不是我们想要的结果。在函数内部订阅 subject 使得 subject 在被观察者订阅之前就已经收到了 next 和 complete 通知，所以观察者只能收到 complete 通知。</p> <p data-v-47862caa>这是可避免的，任何连接多播基础结构的函数的调用者需要能够在 subject 订阅源 observable 时进行控制。RxJS 的 multicast 操作符通过返回一个特殊的 observable 类型 ConnectableObservable 来实现的。</p> <p data-v-47862caa>ConnectableObservable 封装了多播的基础结构，但它不会立即订阅源 observable ，只有当它的 connect 方法调用时，它才会订阅源 observable 。</p> <p data-v-47862caa>我们来使用 multicast 操作符:</p> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> Observable <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>&quot;rxjs/Observable&quot;</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> Subject <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>&quot;rxjs/Subject&quot;</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token string" data-v-47862caa>&quot;rxjs/add/observable/defer&quot;</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token string" data-v-47862caa>&quot;rxjs/add/observable/of&quot;</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token string" data-v-47862caa>&quot;rxjs/add/operator/multicast&quot;</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> source <span class="token operator" data-v-47862caa>=</span> Observable<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>defer</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> Observable<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>of</span><span class="token punctuation" data-v-47862caa>(</span>
  Math<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>floor</span><span class="token punctuation" data-v-47862caa>(</span>Math<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>random</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>*</span> <span class="token number" data-v-47862caa>100</span><span class="token punctuation" data-v-47862caa>)</span>
<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>function</span> <span class="token function" data-v-47862caa>observer</span><span class="token punctuation" data-v-47862caa>(</span>name<span class="token operator" data-v-47862caa>:</span> <span class="token builtin" data-v-47862caa>string</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token punctuation" data-v-47862caa>{</span>
  <span class="token keyword" data-v-47862caa>return</span> <span class="token punctuation" data-v-47862caa>{</span>
    <span class="token function-variable function" data-v-47862caa>next</span><span class="token operator" data-v-47862caa>:</span> <span class="token punctuation" data-v-47862caa>(</span>value<span class="token operator" data-v-47862caa>:</span> <span class="token builtin" data-v-47862caa>number</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token template-string" data-v-47862caa><span class="token template-punctuation string" data-v-47862caa>`</span><span class="token string" data-v-47862caa>observer </span><span class="token interpolation" data-v-47862caa><span class="token interpolation-punctuation punctuation" data-v-47862caa>${</span>name<span class="token interpolation-punctuation punctuation" data-v-47862caa>}</span></span><span class="token string" data-v-47862caa>: </span><span class="token interpolation" data-v-47862caa><span class="token interpolation-punctuation punctuation" data-v-47862caa>${</span>value<span class="token interpolation-punctuation punctuation" data-v-47862caa>}</span></span><span class="token template-punctuation string" data-v-47862caa>`</span></span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
    <span class="token function-variable function" data-v-47862caa>complete</span><span class="token operator" data-v-47862caa>:</span> <span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token template-string" data-v-47862caa><span class="token template-punctuation string" data-v-47862caa>`</span><span class="token string" data-v-47862caa>observer </span><span class="token interpolation" data-v-47862caa><span class="token interpolation-punctuation punctuation" data-v-47862caa>${</span>name<span class="token interpolation-punctuation punctuation" data-v-47862caa>}</span></span><span class="token string" data-v-47862caa>: complete</span><span class="token template-punctuation string" data-v-47862caa>`</span></span><span class="token punctuation" data-v-47862caa>)</span>
  <span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token punctuation" data-v-47862caa>}</span>
<span class="token keyword" data-v-47862caa>const</span> m <span class="token operator" data-v-47862caa>=</span> source<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>multicast</span><span class="token punctuation" data-v-47862caa>(</span><span class="token keyword" data-v-47862caa>new</span> <span class="token class-name" data-v-47862caa>Subject<span class="token operator" data-v-47862caa>&lt;</span><span class="token builtin" data-v-47862caa>number</span><span class="token operator" data-v-47862caa>&gt;</span></span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
m<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>observer</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>&quot;a&quot;</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
m<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>observer</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>&quot;b&quot;</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
m<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>connect</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa><span class="line-number" data-v-47862caa>10</span><br data-v-47862caa><span class="line-number" data-v-47862caa>11</span><br data-v-47862caa><span class="line-number" data-v-47862caa>12</span><br data-v-47862caa><span class="line-number" data-v-47862caa>13</span><br data-v-47862caa><span class="line-number" data-v-47862caa>14</span><br data-v-47862caa><span class="line-number" data-v-47862caa>15</span><br data-v-47862caa><span class="line-number" data-v-47862caa>16</span><br data-v-47862caa><span class="line-number" data-v-47862caa>17</span><br data-v-47862caa><span class="line-number" data-v-47862caa>18</span><br data-v-47862caa></div></div><p data-v-47862caa>代码改变后，现在观察者可以收到 next 通知了:</p> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa>observer a<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>54</span>
observer b<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>54</span>
observer a<span class="token operator" data-v-47862caa>:</span> complete
observer b<span class="token operator" data-v-47862caa>:</span> complete
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa></div></div><p data-v-47862caa>调用 connect 时，传入 multicast 操作符的 subject 会订阅源 observable，而 subject 的观察者会收到多播通知，这正符合 RxJS 多播的基本心智模型。</p> <h3 id="refcount" data-v-47862caa><a href="#refcount" class="header-anchor" data-v-47862caa>#</a> refCount</h3> <p data-v-47862caa>ConnectableObservable 还有另外一个方法 refCount，它可以用来确定源 observable 何时产生了订阅。
refCount 看上去就像是操作符，也就是说，它是在 observable 上调用的方法并且返回另一个 observable，但是它只是 ConnectableObservable 的方法而且不需要导入。顾名思义，refCount 返回 observable， 它负责维护已产生的订阅的引用计数。</p> <p data-v-47862caa>当观察者订阅负责引用计数的 observable 时，引用计数会增加，如果前一个引用计数为0的话，负责多播基础结构的 subject 会订阅源 observable 。当观察者取消订阅时，引用计数会减少，如果引用计数归零的话，subject 会取消对源 observable 的订阅。</p> <p data-v-47862caa>理解了这个，或许你对react的hook编程就更有感觉了，为什么return一个方法用销毁时候执行，因为函数执行是不确定的，预留引用销毁逻辑是实现善后操作的基本方式。而refCount的作用就是回了自动调用这个销毁的逻辑。</p> <p data-v-47862caa>我们来使用 refCount :</p> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>const</span> m <span class="token operator" data-v-47862caa>=</span> source<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>multicast</span><span class="token punctuation" data-v-47862caa>(</span><span class="token keyword" data-v-47862caa>new</span> <span class="token class-name" data-v-47862caa>Subject<span class="token operator" data-v-47862caa>&lt;</span><span class="token builtin" data-v-47862caa>number</span><span class="token operator" data-v-47862caa>&gt;</span></span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>refCount</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
m<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>observer</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>&quot;a&quot;</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
m<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>observer</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>&quot;b&quot;</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa></div></div><p data-v-47862caa>代码改变后，输出如下所示:</p> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa>observer a<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>42</span>
observer a<span class="token operator" data-v-47862caa>:</span> complete
observer b<span class="token operator" data-v-47862caa>:</span> complete
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa></div></div><p data-v-47862caa>只有第一个观察者收到了 next 通知。我们来看看原因。</p> <p data-v-47862caa>示例中的源 observable 会立即发出通知。也就是说，一旦订阅了，源 observable 就会发出 next 和 complete 通知，complete 通知导致在第二个观察者订阅之前第一个就取消了订阅。当第一个取消订阅时，引用计数会归零，所以负责多播基础结构的 subject 也会取消源 observable 的订阅。</p> <p data-v-47862caa>当第二个观察者订阅时，subject 会再次订阅源 observable，但由于 subject 已经收到了 complete 通知，所以它无法被重用。</p> <p data-v-47862caa>向 multicast 传入 subject 的工厂函数可以解决此问题:</p> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>const</span> m <span class="token operator" data-v-47862caa>=</span> source<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>multicast</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token keyword" data-v-47862caa>new</span> <span class="token class-name" data-v-47862caa>Subject<span class="token operator" data-v-47862caa>&lt;</span><span class="token builtin" data-v-47862caa>number</span><span class="token operator" data-v-47862caa>&gt;</span></span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>refCount</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
m<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>observer</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>&quot;a&quot;</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
m<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>observer</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>&quot;b&quot;</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa></div></div><p data-v-47862caa>代码改变后，每次源 observable 被订阅时，都会创建一个新的 subject，输出如下所示:</p> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa>observer a<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>42</span>
observer a<span class="token operator" data-v-47862caa>:</span> complete
observer b<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>54</span>
observer b<span class="token operator" data-v-47862caa>:</span> complete
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa></div></div><p data-v-47862caa>因为源 observable 会立即发出通知，所以观察者收到的通知是分开的。将 source 进行修改，以便延迟通知:</p> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>const</span> source <span class="token operator" data-v-47862caa>=</span> Observable<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>defer</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> Observable<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>of</span><span class="token punctuation" data-v-47862caa>(</span>
  Math<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>floor</span><span class="token punctuation" data-v-47862caa>(</span>Math<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>random</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>*</span> <span class="token number" data-v-47862caa>100</span><span class="token punctuation" data-v-47862caa>)</span>
<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>delay</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>0</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa></div></div><p data-v-47862caa>观察者依然会收到多播通知，输出如下所示:</p> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa>observer a<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>42</span>
observer b<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>42</span>
observer a<span class="token operator" data-v-47862caa>:</span> complete
observer b<span class="token operator" data-v-47862caa>:</span> complete
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa></div></div><p data-v-47862caa>总结一下，上述示例展示了 multicast 操作符的以下特点:</p> <ul data-v-47862caa><li data-v-47862caa>封装了多播的基础结构以符合多播的心智模型；</li> <li data-v-47862caa>提供了 connect 方法以用于确定源 observable 何时产生了订阅；</li> <li data-v-47862caa>提供了 refCount 方法以用于自动管理源 observable 的订阅；</li> <li data-v-47862caa>如果使用 refCount，必须传入 Subject 的工厂函数，而不是 Subject 实例；</li></ul> <p data-v-47862caa>接下来我们来看 publish 和 share 操作符，以及 publish 的变种，看看它们是如何在 multicast 操作符所提供的基础之上建立的。</p> <h3 id="publish" data-v-47862caa><a href="#publish" class="header-anchor" data-v-47862caa>#</a> publish</h3> <p data-v-47862caa>我们通过下面的示例来看看 publish 操作符:</p> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> Observable <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>&quot;rxjs/Observable&quot;</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token string" data-v-47862caa>&quot;rxjs/add/observable/defer&quot;</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token string" data-v-47862caa>&quot;rxjs/add/observable/of&quot;</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token string" data-v-47862caa>&quot;rxjs/add/operator/delay&quot;</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token string" data-v-47862caa>&quot;rxjs/add/operator/publish&quot;</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>function</span> <span class="token function" data-v-47862caa>random</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token punctuation" data-v-47862caa>{</span>
  <span class="token keyword" data-v-47862caa>return</span> Math<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>floor</span><span class="token punctuation" data-v-47862caa>(</span>Math<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>random</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>*</span> <span class="token number" data-v-47862caa>100</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token punctuation" data-v-47862caa>}</span>
<span class="token keyword" data-v-47862caa>const</span> source <span class="token operator" data-v-47862caa>=</span> Observable<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>concat</span><span class="token punctuation" data-v-47862caa>(</span>
  Observable<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>defer</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> Observable<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>of</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>random</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
  Observable<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>defer</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> Observable<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>of</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>random</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>delay</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1</span><span class="token punctuation" data-v-47862caa>)</span>
<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>function</span> <span class="token function" data-v-47862caa>observer</span><span class="token punctuation" data-v-47862caa>(</span>name<span class="token operator" data-v-47862caa>:</span> <span class="token builtin" data-v-47862caa>string</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token punctuation" data-v-47862caa>{</span>
  <span class="token keyword" data-v-47862caa>return</span> <span class="token punctuation" data-v-47862caa>{</span>
    <span class="token function-variable function" data-v-47862caa>next</span><span class="token operator" data-v-47862caa>:</span> <span class="token punctuation" data-v-47862caa>(</span>value<span class="token operator" data-v-47862caa>:</span> <span class="token builtin" data-v-47862caa>number</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token template-string" data-v-47862caa><span class="token template-punctuation string" data-v-47862caa>`</span><span class="token string" data-v-47862caa>observer </span><span class="token interpolation" data-v-47862caa><span class="token interpolation-punctuation punctuation" data-v-47862caa>${</span>name<span class="token interpolation-punctuation punctuation" data-v-47862caa>}</span></span><span class="token string" data-v-47862caa>: </span><span class="token interpolation" data-v-47862caa><span class="token interpolation-punctuation punctuation" data-v-47862caa>${</span>value<span class="token interpolation-punctuation punctuation" data-v-47862caa>}</span></span><span class="token template-punctuation string" data-v-47862caa>`</span></span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
    <span class="token function-variable function" data-v-47862caa>complete</span><span class="token operator" data-v-47862caa>:</span> <span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token template-string" data-v-47862caa><span class="token template-punctuation string" data-v-47862caa>`</span><span class="token string" data-v-47862caa>observer </span><span class="token interpolation" data-v-47862caa><span class="token interpolation-punctuation punctuation" data-v-47862caa>${</span>name<span class="token interpolation-punctuation punctuation" data-v-47862caa>}</span></span><span class="token string" data-v-47862caa>: complete</span><span class="token template-punctuation string" data-v-47862caa>`</span></span><span class="token punctuation" data-v-47862caa>)</span>
  <span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token punctuation" data-v-47862caa>}</span>
<span class="token keyword" data-v-47862caa>const</span> p <span class="token operator" data-v-47862caa>=</span> source<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>publish</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
p<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>observer</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>&quot;a&quot;</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
p<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>connect</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
p<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>observer</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>&quot;b&quot;</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token function" data-v-47862caa>setTimeout</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> p<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>observer</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>&quot;c&quot;</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>10</span><span class="token punctuation" data-v-47862caa>)</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa><span class="line-number" data-v-47862caa>10</span><br data-v-47862caa><span class="line-number" data-v-47862caa>11</span><br data-v-47862caa><span class="line-number" data-v-47862caa>12</span><br data-v-47862caa><span class="line-number" data-v-47862caa>13</span><br data-v-47862caa><span class="line-number" data-v-47862caa>14</span><br data-v-47862caa><span class="line-number" data-v-47862caa>15</span><br data-v-47862caa><span class="line-number" data-v-47862caa>16</span><br data-v-47862caa><span class="line-number" data-v-47862caa>17</span><br data-v-47862caa><span class="line-number" data-v-47862caa>18</span><br data-v-47862caa><span class="line-number" data-v-47862caa>19</span><br data-v-47862caa><span class="line-number" data-v-47862caa>20</span><br data-v-47862caa><span class="line-number" data-v-47862caa>21</span><br data-v-47862caa><span class="line-number" data-v-47862caa>22</span><br data-v-47862caa><span class="line-number" data-v-47862caa>23</span><br data-v-47862caa></div></div><p data-v-47862caa>示例中的源 observable 会立即发出一个随机数，经过短暂的延迟后发出另一个随机数，然后完成。这个示例可以让我们看到订阅者在 connect 调用前、connect 调用后以及调用过 publish 的observable 完成后订阅分别会发生什么。</p> <div class="custom-block tip" data-v-47862caa><p class="custom-block-title" data-v-47862caa>温馨提示</p> <p data-v-47862caa>publish 操作符是对 multicast 操作符进行了一层薄薄的封装。它会调用 multicast 并传入 Subject 。</p></div> <p data-v-47862caa>示例的输出如下所示:</p> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa>observer a<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>42</span>
observer a<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>54</span>
observer b<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>54</span>
observer a<span class="token operator" data-v-47862caa>:</span> complete
observer b<span class="token operator" data-v-47862caa>:</span> complete
observer c<span class="token operator" data-v-47862caa>:</span> complete
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa></div></div><p data-v-47862caa>观察者收到的通知可归纳如下:</p> <ul data-v-47862caa><li data-v-47862caa>a 是在 connect 调用前订阅的，所以它能收到两个 next 通知和 complete 通知。</li> <li data-v-47862caa>b 是在 connect 调用后订阅的，此时第一个立即发送的 next 通知已经发出过了，所以它只能收到第二个 next 通知和 complete 通知。</li> <li data-v-47862caa>c 是在源 observable 完成后订阅的，所以它只能收到 complete 通知。</li></ul> <p data-v-47862caa>使用 refCount 来代替 connect:</p> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>const</span> p <span class="token operator" data-v-47862caa>=</span> source<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>publish</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>refCount</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
p<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>observer</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>&quot;a&quot;</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
p<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>observer</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>&quot;b&quot;</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token function" data-v-47862caa>setTimeout</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> p<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>observer</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>&quot;c&quot;</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>10</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa></div></div><p data-v-47862caa>示例的输出如下所示:</p> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa>observer a<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>42</span>
observer a<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>54</span>
observer b<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>54</span>
observer a<span class="token operator" data-v-47862caa>:</span> complete
observer b<span class="token operator" data-v-47862caa>:</span> complete
observer c<span class="token operator" data-v-47862caa>:</span> complete
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa></div></div><p data-v-47862caa>输出跟使用 connect 时的类似。这是为什么？</p> <ul data-v-47862caa><li data-v-47862caa>b 没有收到第一个 next 通知是因为源 observable 的第一个 next 通知是立即发出的，所以只有 a 能收到。</li> <li data-v-47862caa>c 是在调用过 publish 的 observable 完成后订阅的，所以订阅的引用计数已经是0，此时将会再生成一个订阅。但是，publish 传给 multicast 的是 subject，而不是工厂函数，因为 subjects 无法被复用，所以 c 只能收到 complete 通知。</li></ul> <p data-v-47862caa>publish 和 multicast 操作符都接受一个可选的 selector 函数，如果指定了此函数，操作符的行为将会有很大的不同,感兴趣可以自行百度。</p> <h3 id="特殊subjects" data-v-47862caa><a href="#特殊subjects" class="header-anchor" data-v-47862caa>#</a> 特殊subjects</h3> <p data-v-47862caa>publish 操作符有几个变种，它们都以一种类似的方式对 multicast 进行了包装，传入的是 subjects，而不是工厂函数。但是，它们传入的是不同类型的 subjects 。</p> <p data-v-47862caa>publish 变种使用的特殊类型的 subjects 包括:</p> <ul data-v-47862caa><li data-v-47862caa>BehaviorSubject</li> <li data-v-47862caa>ReplaySubject</li> <li data-v-47862caa>AsyncSubject</li></ul> <p data-v-47862caa>关于如何使用这些特殊类型的 subjects 的答案是: 每个变种都与一个特殊类型的 subject 相关联，当你需要的行为类似于某个 publish 变种时，就使用相对应的 subject 。我们来看看这些变种的行为是怎样的。</p> <h3 id="publishbehavior" data-v-47862caa><a href="#publishbehavior" class="header-anchor" data-v-47862caa>#</a> publishBehavior</h3> <p data-v-47862caa>publishBehavior 传给 multicast 的是 BehaviorSubject，而不是 Subject 。BehaviorSubject 类似于 Subject，但如果 subject 的订阅发生在源 observable 发出 next 通知之前，那么 subject 会发出包含初始值的 next 通知。</p> <p data-v-47862caa>我们更改下示例，给生成随机数的源 observable 加上短暂的延迟，这样它就不会立即发出随机数:</p> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa>
<span class="token keyword" data-v-47862caa>const</span> delayed <span class="token operator" data-v-47862caa>=</span> Observable<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>timer</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>switchMapTo</span><span class="token punctuation" data-v-47862caa>(</span>source<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> p <span class="token operator" data-v-47862caa>=</span> delayed<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>publishBehavior</span><span class="token punctuation" data-v-47862caa>(</span><span class="token operator" data-v-47862caa>-</span><span class="token number" data-v-47862caa>1</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
p<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>observer</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>&quot;a&quot;</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
p<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>connect</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
p<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>observer</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>&quot;b&quot;</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token function" data-v-47862caa>setTimeout</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> p<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>observer</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>&quot;c&quot;</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>10</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa></div></div><p data-v-47862caa>示例的输出如下所示:</p> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa>observer a<span class="token operator" data-v-47862caa>:</span> <span class="token operator" data-v-47862caa>-</span><span class="token number" data-v-47862caa>1</span>
observer b<span class="token operator" data-v-47862caa>:</span> <span class="token operator" data-v-47862caa>-</span><span class="token number" data-v-47862caa>1</span>
observer a<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>42</span>
observer b<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>42</span>
observer a<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>54</span>
observer b<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>54</span>
observer a<span class="token operator" data-v-47862caa>:</span> complete
observer b<span class="token operator" data-v-47862caa>:</span> complete
observer c<span class="token operator" data-v-47862caa>:</span> complete
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa></div></div><p data-v-47862caa>观察者收到的通知可归纳如下:</p> <ul data-v-47862caa><li data-v-47862caa>a 是在 connect 调用前订阅的，所以它能收到带有 subject 的初始值的 next 通知、源 observable 的两个 next 通知和 complete 通知。</li> <li data-v-47862caa>b 是在 connect 调用后但在 subject 收到源 observable 的第一个 next 通知前订阅的，所以它能收到带有 subject 的初始值的 next 通知、源 observable 的两个 next 通知和 complete 通知。</li> <li data-v-47862caa>c 是在源 observable 完成后订阅的，所以它只能收到 complete 通知。</li></ul> <h3 id="publishreplay" data-v-47862caa><a href="#publishreplay" class="header-anchor" data-v-47862caa>#</a> publishReplay</h3> <p data-v-47862caa>publishReplay 传给 multicast 的是 ReplaySubject，而不是 Subject 。顾名思义，每当观察者订阅时，ReplaySubject 会重放指定数量的 next 通知。</p> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>const</span> p <span class="token operator" data-v-47862caa>=</span> source<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>publishReplay</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
p<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>observer</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>&quot;a&quot;</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
p<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>connect</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
p<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>observer</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>&quot;b&quot;</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token function" data-v-47862caa>setTimeout</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> p<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>observer</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>&quot;c&quot;</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>10</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>

</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa></div></div><p data-v-47862caa>使用了 publishReplay，示例的输出如下所示:</p> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa>
observer a<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>42</span>
observer b<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>42</span>
observer a<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>54</span>
observer b<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>54</span>
observer a<span class="token operator" data-v-47862caa>:</span> complete
observer b<span class="token operator" data-v-47862caa>:</span> complete
observer c<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>54</span>
observer c<span class="token operator" data-v-47862caa>:</span> complete
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa></div></div><p data-v-47862caa>观察者收到的通知可归纳如下:</p> <ul data-v-47862caa><li data-v-47862caa>a 是在 connect 调用前订阅的，此时 subject 还没有收到 next 通知，所以 a 能收到源 observable 的两个 next 通知和 complete 通知。</li> <li data-v-47862caa>b 是在 connect 调用后订阅的，此时 subject 已经收到了源 observable 的第一个 next 通知，所以 b 能收到重放的 next 通知、源 observable 的第二个 next 通知和 complete 通知。</li> <li data-v-47862caa>c 是在源 observable 完成后订阅的，所以它能收到重放的 next 通知和 complete 通知。</li></ul> <p data-v-47862caa>来看看 c 的行为，很明显，不同于 publish 操作符，publishReplay 操作符适合使用 refCount 方法，因为观察者在源 observable 完成后订阅依然能收到任意数量的重放的 next 通知。</p> <h3 id="publishlast" data-v-47862caa><a href="#publishlast" class="header-anchor" data-v-47862caa>#</a> publishLast</h3> <p data-v-47862caa>publishLast 传给 multicast 的是 AsyncSubject，而不是 Subject 。AsyncSubject 是最特别的特殊类型 subjects 。只有当它完成时，才会发出 next 通知 (如果有 next 通知的话) 和 complete 通知，这个 next 通知是源 observable 中的最后一个 next 通知。</p> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa>
<span class="token keyword" data-v-47862caa>const</span> p <span class="token operator" data-v-47862caa>=</span> source<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>publishLast</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
p<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>observer</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>&quot;a&quot;</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
p<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>connect</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
p<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>observer</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>&quot;b&quot;</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token function" data-v-47862caa>setTimeout</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> p<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>observer</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>&quot;c&quot;</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>10</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa></div></div><p data-v-47862caa>使用了 publishLast，示例的输出如下所示:</p> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa>
observer a<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>54</span>
observer b<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>54</span>
observer a<span class="token operator" data-v-47862caa>:</span> complete
observer b<span class="token operator" data-v-47862caa>:</span> complete
observer c<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>54</span>
observer c<span class="token operator" data-v-47862caa>:</span> complete
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa></div></div><p data-v-47862caa>观察者收到的通知可归纳如下:</p> <ul data-v-47862caa><li data-v-47862caa>a 和 b 都是在源 observable 完成前订阅的，但直到源 observable 完成它们才能收到通知，它们能收到带有第二个随机数的 next 通知和 complete 通知。</li> <li data-v-47862caa>c 是在源 observable 完成后订阅的，它能收到带有第二个随机数的 next 通知和 complete 通知。
与 publishReplay 类似，publishLast 操作符适合使用 refCount 方法，因为观察者在源 observable 完成后订阅依然能收到任意数量的重放的 next 通知。</li></ul> <h3 id="share" data-v-47862caa><a href="#share" class="header-anchor" data-v-47862caa>#</a> share</h3> <p data-v-47862caa>share 操作符类似于使用 publish().refCount() 。但是，share 传给 multicast 的是工厂函数，这意味着在引用计数为0之后发生订阅的话，会创建一个新的 Subject 来订阅源 observable 。</p> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>const</span> s <span class="token operator" data-v-47862caa>=</span> source<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>share</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
s<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>observer</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>&quot;a&quot;</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
s<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>observer</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>&quot;b&quot;</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token function" data-v-47862caa>setTimeout</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> s<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>observer</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>&quot;c&quot;</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>10</span><span class="token punctuation" data-v-47862caa>)</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa></div></div><p data-v-47862caa>使用了 share，示例的输出如下所示:</p> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa>observer a<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>42</span>
observer a<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>54</span>
observer b<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>54</span>
observer a<span class="token operator" data-v-47862caa>:</span> complete
observer b<span class="token operator" data-v-47862caa>:</span> complete
observer c<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>6</span>
observer c<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>9</span>
observer c<span class="token operator" data-v-47862caa>:</span> complete
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa></div></div><p data-v-47862caa>观察者收到的通知可归纳如下:</p> <ul data-v-47862caa><li data-v-47862caa>a 订阅后立即收到第一个 next 通知，随后是第二个 next 通知和 complete 通知。</li> <li data-v-47862caa>b 只能收到第二个 next 通知和 complete 通知。</li> <li data-v-47862caa>c 是在源 observable 完成后订阅的，会创建一个新的 subject 来订阅源 observable，它会立即收到第一个 next 通知，随后是第二个 next 通知和 complete 通知。</li></ul> <p data-v-47862caa>在上面这些示例中，我们介绍了 publish 和 share 操作符，当源 observable 完成时，a 和 b 会自动取消订阅。如果源 observable 报错，它们也同样会自动取消订阅。publish 和 share 操作符还有另外一个不同点:</p> <ul data-v-47862caa><li data-v-47862caa>如果源 observable 报错，由 publish 返回的 observable 的任何将来的订阅者都将收到 error 通知。</li> <li data-v-47862caa>但是，由 share 返回的 observable 的任何将来的订阅者会生成源 observable 的一个新订阅，因为错误会自动取消任何订阅者的订阅，将其引用计数归零。</li></ul> <h2 id="refcount使用姿势" data-v-47862caa><a href="#refcount使用姿势" class="header-anchor" data-v-47862caa>#</a> refCount使用姿势</h2> <h3 id="两种作用" data-v-47862caa><a href="#两种作用" class="header-anchor" data-v-47862caa>#</a> 两种作用</h3> <p data-v-47862caa>RxJS 多播的基本心智模型包括: 一个源 observable，一个订阅源 observable 的 subject 和多个订阅 subject 的观察者。multicast 操作符封装了基于 subject的基础结构并返回拥有 connect 和 refCount 方法的 ConnectableObservable。</p> <p data-v-47862caa>顾名思义，refCount 返回的 observable 维护订阅者的引用计数。</p> <p data-v-47862caa>当观察者订阅有引用计数的 observable 时，引用计数会增加，如果上一个引用计数为零的话，负责多播基础结构的 subject 会订阅源 observable 。而当观察者取消订阅时，引用计数则会减少，如果引用计数归零的话，subject 会取消源 observable 的订阅。</p> <p data-v-47862caa>这种引用计数的行为有两种用途:</p> <ul data-v-47862caa><li data-v-47862caa>当所有观察者都取消订阅后，自动取消 subject 对源 observable 的订阅</li> <li data-v-47862caa>当所有观察者都取消订阅后，自动取消 subject 对源 observable 的订阅，然后当再有观察者订阅该引用计数的 observable 时，subject 重新订阅源 observable</li></ul> <p data-v-47862caa>我们来详细介绍每一种情况，然后建立一些使用 refCount 的通用指南。</p> <h3 id="refcount自动取消订阅" data-v-47862caa><a href="#refcount自动取消订阅" class="header-anchor" data-v-47862caa>#</a> refCount自动取消订阅</h3> <p data-v-47862caa>publish 操作符返回 ConnectableObservable 。调用 ConnectableObservable 的 connect 方法时，负责多播基础结构的 subject 会订阅源 observable 并返回 subscription (订阅)。subject 会保持对源 observable 的订阅直到调用 subscription 的 unsubscribe 方法。
我们来看下面的示例，观察者会接收一个值，然后(隐式地)取消对调用过 publish 的 observable 的订阅:</p> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>const</span> source <span class="token operator" data-v-47862caa>=</span> <span class="token function" data-v-47862caa>instrument</span><span class="token punctuation" data-v-47862caa>(</span>Observable<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>interval</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>100</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> published <span class="token operator" data-v-47862caa>=</span> source<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>publish</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> a <span class="token operator" data-v-47862caa>=</span> published<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>take</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>observer</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>&quot;a&quot;</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> b <span class="token operator" data-v-47862caa>=</span> published<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>take</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>observer</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>&quot;b&quot;</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> subscription <span class="token operator" data-v-47862caa>=</span> published<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>connect</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa></div></div><p data-v-47862caa>本文中的示例都将使用下面的工具函数来让源 observable 具备日志功能，以及创建有名称的观察者:</p> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>function</span> <span class="token generic-function" data-v-47862caa><span class="token function" data-v-47862caa>instrument</span><span class="token generic class-name" data-v-47862caa><span class="token operator" data-v-47862caa>&lt;</span><span class="token constant" data-v-47862caa>T</span><span class="token operator" data-v-47862caa>&gt;</span></span></span><span class="token punctuation" data-v-47862caa>(</span>source<span class="token operator" data-v-47862caa>:</span> Observable<span class="token operator" data-v-47862caa>&lt;</span><span class="token constant" data-v-47862caa>T</span><span class="token operator" data-v-47862caa>&gt;</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token punctuation" data-v-47862caa>{</span>
  <span class="token keyword" data-v-47862caa>return</span> Observable<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>create</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>(</span>observer<span class="token operator" data-v-47862caa>:</span> Observer<span class="token operator" data-v-47862caa>&lt;</span><span class="token constant" data-v-47862caa>T</span><span class="token operator" data-v-47862caa>&gt;</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token punctuation" data-v-47862caa>{</span>
    <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>&quot;source: subscribing&quot;</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
    <span class="token keyword" data-v-47862caa>const</span> subscription <span class="token operator" data-v-47862caa>=</span> source
      <span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>do</span><span class="token punctuation" data-v-47862caa>(</span>value <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token template-string" data-v-47862caa><span class="token template-punctuation string" data-v-47862caa>`</span><span class="token string" data-v-47862caa>source: </span><span class="token interpolation" data-v-47862caa><span class="token interpolation-punctuation punctuation" data-v-47862caa>${</span>value<span class="token interpolation-punctuation punctuation" data-v-47862caa>}</span></span><span class="token template-punctuation string" data-v-47862caa>`</span></span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span>
      <span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>observer<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
    <span class="token keyword" data-v-47862caa>return</span> <span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token punctuation" data-v-47862caa>{</span>
      subscription<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>unsubscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
      <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>&quot;source: unsubscribed&quot;</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
    <span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>;</span>
  <span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token keyword" data-v-47862caa>as</span> Observable<span class="token operator" data-v-47862caa>&lt;</span><span class="token constant" data-v-47862caa>T</span><span class="token operator" data-v-47862caa>&gt;</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token punctuation" data-v-47862caa>}</span>

<span class="token keyword" data-v-47862caa>function</span> <span class="token generic-function" data-v-47862caa><span class="token function" data-v-47862caa>observer</span><span class="token generic class-name" data-v-47862caa><span class="token operator" data-v-47862caa>&lt;</span><span class="token constant" data-v-47862caa>T</span><span class="token operator" data-v-47862caa>&gt;</span></span></span><span class="token punctuation" data-v-47862caa>(</span>name<span class="token operator" data-v-47862caa>:</span> <span class="token builtin" data-v-47862caa>string</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token punctuation" data-v-47862caa>{</span>
  <span class="token keyword" data-v-47862caa>return</span> <span class="token punctuation" data-v-47862caa>{</span>
    <span class="token function-variable function" data-v-47862caa>next</span><span class="token operator" data-v-47862caa>:</span> <span class="token punctuation" data-v-47862caa>(</span>value<span class="token operator" data-v-47862caa>:</span> <span class="token constant" data-v-47862caa>T</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token template-string" data-v-47862caa><span class="token template-punctuation string" data-v-47862caa>`</span><span class="token string" data-v-47862caa>observer </span><span class="token interpolation" data-v-47862caa><span class="token interpolation-punctuation punctuation" data-v-47862caa>${</span>name<span class="token interpolation-punctuation punctuation" data-v-47862caa>}</span></span><span class="token string" data-v-47862caa>: </span><span class="token interpolation" data-v-47862caa><span class="token interpolation-punctuation punctuation" data-v-47862caa>${</span>value<span class="token interpolation-punctuation punctuation" data-v-47862caa>}</span></span><span class="token template-punctuation string" data-v-47862caa>`</span></span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
    <span class="token function-variable function" data-v-47862caa>complete</span><span class="token operator" data-v-47862caa>:</span> <span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token template-string" data-v-47862caa><span class="token template-punctuation string" data-v-47862caa>`</span><span class="token string" data-v-47862caa>observer </span><span class="token interpolation" data-v-47862caa><span class="token interpolation-punctuation punctuation" data-v-47862caa>${</span>name<span class="token interpolation-punctuation punctuation" data-v-47862caa>}</span></span><span class="token string" data-v-47862caa>: complete</span><span class="token template-punctuation string" data-v-47862caa>`</span></span><span class="token punctuation" data-v-47862caa>)</span>
  <span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token punctuation" data-v-47862caa>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa><span class="line-number" data-v-47862caa>10</span><br data-v-47862caa><span class="line-number" data-v-47862caa>11</span><br data-v-47862caa><span class="line-number" data-v-47862caa>12</span><br data-v-47862caa><span class="line-number" data-v-47862caa>13</span><br data-v-47862caa><span class="line-number" data-v-47862caa>14</span><br data-v-47862caa><span class="line-number" data-v-47862caa>15</span><br data-v-47862caa><span class="line-number" data-v-47862caa>16</span><br data-v-47862caa><span class="line-number" data-v-47862caa>17</span><br data-v-47862caa><span class="line-number" data-v-47862caa>18</span><br data-v-47862caa><span class="line-number" data-v-47862caa>19</span><br data-v-47862caa></div></div><p data-v-47862caa>示例的输出如下所示:</p> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa>source<span class="token operator" data-v-47862caa>:</span> subscribing
source<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>0</span>
observer a<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>0</span>
observer a<span class="token operator" data-v-47862caa>:</span> complete
observer b<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>0</span>
observer b<span class="token operator" data-v-47862caa>:</span> complete
source<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>1</span>
source<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>2</span>
source<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>3</span>
<span class="token operator" data-v-47862caa>...</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa><span class="line-number" data-v-47862caa>10</span><br data-v-47862caa></div></div><p data-v-47862caa>两个观察者都只接收一个值然后完成，完成的同时取消对调用过 publish 的 observable 的订阅。但是，多播基础结构仍然保持着对源 observable 的订阅。
如果不想显示地执行取消订阅操作的话，可以使用 refCount:</p> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>const</span> source <span class="token operator" data-v-47862caa>=</span> <span class="token function" data-v-47862caa>instrument</span><span class="token punctuation" data-v-47862caa>(</span>Observable<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>interval</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>100</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> counted <span class="token operator" data-v-47862caa>=</span> source<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>publish</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>refCount</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> a <span class="token operator" data-v-47862caa>=</span> counted<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>take</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>observer</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>&quot;a&quot;</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> b <span class="token operator" data-v-47862caa>=</span> counted<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>take</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>observer</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>&quot;b&quot;</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa></div></div><p data-v-47862caa>观察者订阅使用引用计数的 observable 的话，当引用计数归零时，负责多播的基础结构的 subject 会取消源 observable 的订阅，示例的输出如下所示:</p> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa>source<span class="token operator" data-v-47862caa>:</span> subscribing
source<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>0</span>
observer a<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>0</span>
observer a<span class="token operator" data-v-47862caa>:</span> complete
observer b<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>0</span>
observer b<span class="token operator" data-v-47862caa>:</span> complete
source<span class="token operator" data-v-47862caa>:</span> unsubscribed
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa></div></div><h3 id="重新订阅已完成observables" data-v-47862caa><a href="#重新订阅已完成observables" class="header-anchor" data-v-47862caa>#</a> 重新订阅已完成observables</h3> <p data-v-47862caa>当引用计数归零后，多播的基础结构除了取消源 observable 的订阅，当负责引用计数的 observable 再次发生订阅时，它还会重新订阅源 observable 。
我们使用下面的示例来看看当使用已完成的源 observable 时会发生什么:</p> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>const</span> source <span class="token operator" data-v-47862caa>=</span> <span class="token function" data-v-47862caa>instrument</span><span class="token punctuation" data-v-47862caa>(</span>Observable<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>timer</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>100</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> counted <span class="token operator" data-v-47862caa>=</span> source<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>publish</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>refCount</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> a <span class="token operator" data-v-47862caa>=</span> counted<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>observer</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>&quot;a&quot;</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token function" data-v-47862caa>setTimeout</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> a<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>unsubscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>110</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token function" data-v-47862caa>setTimeout</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> counted<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>observer</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>&quot;b&quot;</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>120</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa></div></div><p data-v-47862caa>示例中使用 timer observable 作为源。它会等待指定的毫秒数后发出 next 和 complete 通知。还有两个观察者: a 在源 observable 完成后订阅，在源 observable 完成后取消订阅；b 在 a 取消订阅后订阅。
示例的输出如下:</p> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa>source<span class="token operator" data-v-47862caa>:</span> subscribing
source<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>0</span>
observer a<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>0</span>
source<span class="token operator" data-v-47862caa>:</span> unsubscribed
observer a<span class="token operator" data-v-47862caa>:</span> complete
observer b<span class="token operator" data-v-47862caa>:</span> complete
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa></div></div><p data-v-47862caa>当 b 订阅时，引用计数为零，所以多播的基础结构会期望 subject 重新订阅源 observable 。但是，由于 subject 已经收到了源 observable 的 complete 通知，并且 subject 是无法复用的，所以实际上并没有进行重新订阅，b 只能收到 complete 通知。</p> <p data-v-47862caa>如果使用 publishBehavior(-1) 来代替 publish() 的话，输出类似，但会包含  BehaviorSubject 的初始值:</p> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa>observer a<span class="token operator" data-v-47862caa>:</span> <span class="token operator" data-v-47862caa>-</span><span class="token number" data-v-47862caa>1</span>
source<span class="token operator" data-v-47862caa>:</span> subscribing
source<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>0</span>
observer a<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>0</span>
source<span class="token operator" data-v-47862caa>:</span> unsubscribed
observer a<span class="token operator" data-v-47862caa>:</span> complete
observer b<span class="token operator" data-v-47862caa>:</span> complete
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa></div></div><p data-v-47862caa>同样的，b 还是只能收到 complete 通知。
如果使用 publishReplay(1) 来代替 publish() 的话，情况会有些变化，输出如下:</p> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa>source<span class="token operator" data-v-47862caa>:</span> subscribing
source<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>0</span>
observer a<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>0</span>
source<span class="token operator" data-v-47862caa>:</span> unsubscribed
observer a<span class="token operator" data-v-47862caa>:</span> complete
observer b<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>0</span>
observer b<span class="token operator" data-v-47862caa>:</span> complete
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa></div></div><p data-v-47862caa>同样的，这次也没有重新订阅源 observable，因为 subject 已经完成了。但是，已完成的 ReplaySubject 将通知重放给后来的订阅者，所以 b 能收到重放的 next 通知和 complete 通知。</p> <p data-v-47862caa>如果使用 publishLast() 来代替 publish() 的话，情况又会有些不同，输出如下:</p> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa>source<span class="token operator" data-v-47862caa>:</span> subscribing
source<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>0</span>
source<span class="token operator" data-v-47862caa>:</span> unsubscribed
observer a<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>0</span>
observer a<span class="token operator" data-v-47862caa>:</span> complete
observer b<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>0</span>
observer b<span class="token operator" data-v-47862caa>:</span> complete
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa></div></div><p data-v-47862caa>同样的，依然没有重新订阅源 observable，因为 subject 已经完成了。但是，AsyncSubject 会将最后收到的 next 通知发给它的订阅者，所以 a 和 b 都收到的是 next 和 complete 通知。
综上所述，根据示例我们可以发现 publish 以及它的变种:</p> <ul data-v-47862caa><li data-v-47862caa>当源 observable 完成时，负责多播基础结构的 subject 也会完成，而且这会阻止对源 observable 的重新订阅。</li> <li data-v-47862caa>当 publish 和 publishBehavior 与 refCount 一起使用时，后来的订阅者只会收到 complete 通知，这似乎并不是我们想要的效果。</li> <li data-v-47862caa>当 publishReplay 和 publishLast 与 refCount 一起使用时，后来的订阅者会收到预期的通知。</li></ul> <h3 id="重新订阅未完成observables" data-v-47862caa><a href="#重新订阅未完成observables" class="header-anchor" data-v-47862caa>#</a> 重新订阅未完成observables</h3> <p data-v-47862caa>我们已经看过了重新订阅已完成的源 observable 时会发生什么，现在我们再来看看重新订阅未完成的源 observable 是怎样一个情况。
这个示例中将使用 interval observable 来替代 timer observable，它会根据指定的时间间隔重复地发出包含自增数字的 next 通知:</p> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>const</span> source <span class="token operator" data-v-47862caa>=</span> <span class="token function" data-v-47862caa>instrument</span><span class="token punctuation" data-v-47862caa>(</span>Observable<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>interval</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>100</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> counted <span class="token operator" data-v-47862caa>=</span> source<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>publish</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>refCount</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> a <span class="token operator" data-v-47862caa>=</span> counted<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>observer</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>&quot;a&quot;</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token function" data-v-47862caa>setTimeout</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> a<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>unsubscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>110</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token function" data-v-47862caa>setTimeout</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> counted<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>observer</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>&quot;b&quot;</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>120</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa></div></div><p data-v-47862caa>示例的输出如下所示:</p> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa>source<span class="token operator" data-v-47862caa>:</span> subscribing
source<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>0</span>
observer a<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>0</span>
source<span class="token operator" data-v-47862caa>:</span> unsubscribed
source<span class="token operator" data-v-47862caa>:</span> subscribing
source<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>0</span>
observer b<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>0</span>
source<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>1</span>
observer b<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>1</span>
<span class="token operator" data-v-47862caa>...</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa><span class="line-number" data-v-47862caa>10</span><br data-v-47862caa></div></div><p data-v-47862caa>与使用已完成的源 observable 的示例不同的是，负责多播基础结构的 subject 能够被重新订阅，所以源 observable 可以产生新的订阅。b 所收到的 next 通知便是重新订阅的证据: 该通知包含数值0，因为重新订阅已经开启了全新的 interval 序列。</p> <p data-v-47862caa>如果使用 publishBehavior(-1) 来代替 publish() 的话，情况会有所不同，输出如下所示:</p> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa>observer a<span class="token operator" data-v-47862caa>:</span> <span class="token operator" data-v-47862caa>-</span><span class="token number" data-v-47862caa>1</span>
source<span class="token operator" data-v-47862caa>:</span> subscribing
source<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>0</span>
observer a<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>0</span>
source<span class="token operator" data-v-47862caa>:</span> unsubscribed
observer b<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>0</span>
source<span class="token operator" data-v-47862caa>:</span> subscribing
source<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>0</span>
observer b<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>0</span>
source<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>1</span>
observer b<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>1</span>
<span class="token operator" data-v-47862caa>...</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa><span class="line-number" data-v-47862caa>10</span><br data-v-47862caa><span class="line-number" data-v-47862caa>11</span><br data-v-47862caa><span class="line-number" data-v-47862caa>12</span><br data-v-47862caa></div></div><p data-v-47862caa>输出是类似的，可以清楚地看到重新订阅开启了全新的 interval 序列。但是，在收到 interval 的 next 通知前，a 还收到了包含 BehaviorSubject 初始值-1的 next 通知，b 会收到包含 BehaviorSubject 当前值0的 next 通知。</p> <p data-v-47862caa>如果使用 publishReplay(1) 来代替 publish() 的话，情况又会有所不同，输出如下所示:</p> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa>source<span class="token operator" data-v-47862caa>:</span> subscribing
source<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>0</span>
observer a<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>0</span>
source<span class="token operator" data-v-47862caa>:</span> unsubscribed
observer b<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>0</span>
source<span class="token operator" data-v-47862caa>:</span> subscribing
source<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>0</span>
observer b<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>0</span>
source<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>1</span>
observer b<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>1</span>
<span class="token operator" data-v-47862caa>...</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa><span class="line-number" data-v-47862caa>10</span><br data-v-47862caa><span class="line-number" data-v-47862caa>11</span><br data-v-47862caa></div></div><p data-v-47862caa>输出也是类似的，可以清楚地看到重新订阅开启了全新的 interval 序列。但是，b 在收到源 observable 的第一个 next 通知之前会收到重放的 next 通知。</p> <p data-v-47862caa>综上所述，根据示例我们可以发现，当对未完成的源 observable 使用 refCount 时，publish、publishBehavior 和 publishReplay 的行为都如预期一般，没有让人出乎意料之处。</p> <h3 id="sharereplay" data-v-47862caa><a href="#sharereplay" class="header-anchor" data-v-47862caa>#</a> shareReplay</h3> <p data-v-47862caa>在 RxJS 5.4.0 版本中引入了 shareReplay 操作符。它与 publishReplay().refCount() 十分相似，只是有一个细微的差别。</p> <p data-v-47862caa>与 share 类似， shareReplay 传给 multicast 操作符的也是 subject 的工厂函数。这意味着当重新订阅源 observable 时，会使用工厂函数来创建出一个新的 subject 。但是，只有当前一个被订阅 subject 未完成的情况下，工厂函数才会返回新的 subject 。</p> <p data-v-47862caa>publishReplay 传给 multicast 操作符的是 ReplaySubject 实例，而不是工厂函数，这是影响行为不同的原因。</p> <p data-v-47862caa>对调用了 publishReplay().refCount() 的 observable 进行重新订阅，subject 会一直重放它的可重放通知。但是，对调用了 shareReplay() 的 observable 进行重新订阅，行为未必如前者一样，如果 subject 还未完成，会创建一个新的 subject 。所以区别在于，使用调用了 shareReplay() 的 observable 的话，当引用计数归零时，如果 subject 还未完成的话，可重放的通知会被冲洗掉。</p> <h3 id="refcount不完全使用准则" data-v-47862caa><a href="#refcount不完全使用准则" class="header-anchor" data-v-47862caa>#</a> refCount不完全使用准则</h3> <p data-v-47862caa>根据我们看过的这些示例，可以归纳出如下使用准则:</p> <p data-v-47862caa>_ refCount 可以与 publish 及其变种一起使用，从而自动地取消源 observable 的订阅。</p> <ul data-v-47862caa><li data-v-47862caa>当使用 refCount 来自动取消已完成的源 observable 的订阅时，publishReplay 和 publishLast 的行为会如预期一样，但是，对于后来的订阅，publish 和 publishBehavior 的行为并没太大帮助，所以你应该只使用 publish 和 publishBehavior 来自动取消订阅。</li> <li data-v-47862caa>当使用 refCount 来自动取消未完成的源 observable 的订阅时，publish、publishBehavior 和 publishRelay 的行为都会如预期一样。
shareReplay() 的行为类似于 publishReplay().refCount()，在对两者进行选择时，应该根据在对源 observable 进行重新订阅时，你是否想要冲洗掉可重放的通知。</li></ul> <p data-v-47862caa>上面所描述的 shareReplay 的行为只适用于 RxJS 5.5 之前的版本。在 5.5.0 beta 中，shareReplay 做出了变更: 当引用计数归零时，操作符不再取消源 observable 的订阅。
这项变化立即使得引用计数变得多余，因为只有当源 observable 完成或报错时，源 observable 的订阅才会取消订阅。这项变化也意味着只有在处理错误时，shareReplay 和 publishReplay().refCount() 才有所不同:</p> <ul data-v-47862caa><li data-v-47862caa>如果源 observable 报错，publishReplay().refCount() 返回的 observable 的任何后来订阅者都将收到错误。</li> <li data-v-47862caa>但是，shareReplay 返回的 observable 的任何后来订阅者都将产生一个源 observable 的新订阅。</li></ul> <h2 id="rxjs的错误处理机制" data-v-47862caa><a href="#rxjs的错误处理机制" class="header-anchor" data-v-47862caa>#</a> rxjs的错误处理机制</h2> <p data-v-47862caa>我们一起来看看<code data-v-47862caa>retry、retryWhen、catchError、repeat、repeatWhen</code>这些操作符在错误处理的用途。</p> <h3 id="retry指定重试次数" data-v-47862caa><a href="#retry指定重试次数" class="header-anchor" data-v-47862caa>#</a> retry指定重试次数</h3> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token comment" data-v-47862caa>// RxJS v6+</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> interval<span class="token punctuation" data-v-47862caa>,</span> <span class="token keyword" data-v-47862caa>of</span><span class="token punctuation" data-v-47862caa>,</span> throwError <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> mergeMap<span class="token punctuation" data-v-47862caa>,</span> retry <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs/operators'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>// 每1秒发出值</span>
<span class="token keyword" data-v-47862caa>const</span> source <span class="token operator" data-v-47862caa>=</span> <span class="token function" data-v-47862caa>interval</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1000</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> example <span class="token operator" data-v-47862caa>=</span> source<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span>
  <span class="token function" data-v-47862caa>mergeMap</span><span class="token punctuation" data-v-47862caa>(</span>val <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token punctuation" data-v-47862caa>{</span>
    <span class="token comment" data-v-47862caa>// 抛出错误以进行演示</span>
    <span class="token keyword" data-v-47862caa>if</span> <span class="token punctuation" data-v-47862caa>(</span>val <span class="token operator" data-v-47862caa>&gt;</span> <span class="token number" data-v-47862caa>5</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token punctuation" data-v-47862caa>{</span>
      <span class="token keyword" data-v-47862caa>return</span> <span class="token function" data-v-47862caa>throwError</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'Error!'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
    <span class="token punctuation" data-v-47862caa>}</span>
    <span class="token keyword" data-v-47862caa>return</span> <span class="token keyword" data-v-47862caa>of</span><span class="token punctuation" data-v-47862caa>(</span>val<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
  <span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
  <span class="token comment" data-v-47862caa>// 出错的话可以重试2次</span>
  <span class="token function" data-v-47862caa>retry</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>2</span><span class="token punctuation" data-v-47862caa>)</span>
<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>/*
  输出:
  0..1..2..3..4..5..
  0..1..2..3..4..5..
  0..1..2..3..4..5..
  &quot;Error!: Retried 2 times then quit!&quot;
*/</span>
<span class="token keyword" data-v-47862caa>const</span> subscribe <span class="token operator" data-v-47862caa>=</span> example<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>{</span>
  <span class="token function-variable function" data-v-47862caa>next</span><span class="token operator" data-v-47862caa>:</span> val <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span>val<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
  <span class="token function-variable function" data-v-47862caa>error</span><span class="token operator" data-v-47862caa>:</span> val <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token template-string" data-v-47862caa><span class="token template-punctuation string" data-v-47862caa>`</span><span class="token interpolation" data-v-47862caa><span class="token interpolation-punctuation punctuation" data-v-47862caa>${</span>val<span class="token interpolation-punctuation punctuation" data-v-47862caa>}</span></span><span class="token string" data-v-47862caa>: Retried 2 times then quit!</span><span class="token template-punctuation string" data-v-47862caa>`</span></span><span class="token punctuation" data-v-47862caa>)</span>
<span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa><span class="line-number" data-v-47862caa>10</span><br data-v-47862caa><span class="line-number" data-v-47862caa>11</span><br data-v-47862caa><span class="line-number" data-v-47862caa>12</span><br data-v-47862caa><span class="line-number" data-v-47862caa>13</span><br data-v-47862caa><span class="line-number" data-v-47862caa>14</span><br data-v-47862caa><span class="line-number" data-v-47862caa>15</span><br data-v-47862caa><span class="line-number" data-v-47862caa>16</span><br data-v-47862caa><span class="line-number" data-v-47862caa>17</span><br data-v-47862caa><span class="line-number" data-v-47862caa>18</span><br data-v-47862caa><span class="line-number" data-v-47862caa>19</span><br data-v-47862caa><span class="line-number" data-v-47862caa>20</span><br data-v-47862caa><span class="line-number" data-v-47862caa>21</span><br data-v-47862caa><span class="line-number" data-v-47862caa>22</span><br data-v-47862caa><span class="line-number" data-v-47862caa>23</span><br data-v-47862caa><span class="line-number" data-v-47862caa>24</span><br data-v-47862caa><span class="line-number" data-v-47862caa>25</span><br data-v-47862caa><span class="line-number" data-v-47862caa>26</span><br data-v-47862caa><span class="line-number" data-v-47862caa>27</span><br data-v-47862caa></div></div><h3 id="retrywhen指定重试逻辑" data-v-47862caa><a href="#retrywhen指定重试逻辑" class="header-anchor" data-v-47862caa>#</a> retryWhen指定重试逻辑</h3> <p data-v-47862caa>retry只能用来设置重试次数，我们有时想做成：重试时，打印日志，或者其他操作。那么这个时候 retry 就不太适合了。所以我们需要 retryWhen 来操作</p> <h3 id="在指定的时间间隔后触发重试" data-v-47862caa><a href="#在指定的时间间隔后触发重试" class="header-anchor" data-v-47862caa>#</a> 在指定的时间间隔后触发重试</h3> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token comment" data-v-47862caa>// RxJS v6+</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> timer<span class="token punctuation" data-v-47862caa>,</span> interval <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> map<span class="token punctuation" data-v-47862caa>,</span> tap<span class="token punctuation" data-v-47862caa>,</span> retryWhen<span class="token punctuation" data-v-47862caa>,</span> delayWhen <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs/operators'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>// 每1秒发出值</span>
<span class="token keyword" data-v-47862caa>const</span> source <span class="token operator" data-v-47862caa>=</span> <span class="token function" data-v-47862caa>interval</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1000</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>const</span> example <span class="token operator" data-v-47862caa>=</span> source<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span>
  <span class="token function" data-v-47862caa>map</span><span class="token punctuation" data-v-47862caa>(</span>val <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token punctuation" data-v-47862caa>{</span>
    <span class="token keyword" data-v-47862caa>if</span> <span class="token punctuation" data-v-47862caa>(</span>val <span class="token operator" data-v-47862caa>&gt;</span> <span class="token number" data-v-47862caa>5</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token punctuation" data-v-47862caa>{</span>
      <span class="token comment" data-v-47862caa>// 错误将由 retryWhen 接收</span>
      <span class="token keyword" data-v-47862caa>throw</span> val<span class="token punctuation" data-v-47862caa>;</span>
    <span class="token punctuation" data-v-47862caa>}</span>
    <span class="token keyword" data-v-47862caa>return</span> val<span class="token punctuation" data-v-47862caa>;</span>
  <span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
  <span class="token function" data-v-47862caa>retryWhen</span><span class="token punctuation" data-v-47862caa>(</span>errors <span class="token operator" data-v-47862caa>=&gt;</span>
    errors<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span>
      <span class="token comment" data-v-47862caa>// 输出错误信息</span>
      <span class="token function" data-v-47862caa>tap</span><span class="token punctuation" data-v-47862caa>(</span>val <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token template-string" data-v-47862caa><span class="token template-punctuation string" data-v-47862caa>`</span><span class="token string" data-v-47862caa>Value </span><span class="token interpolation" data-v-47862caa><span class="token interpolation-punctuation punctuation" data-v-47862caa>${</span>val<span class="token interpolation-punctuation punctuation" data-v-47862caa>}</span></span><span class="token string" data-v-47862caa> was too high!</span><span class="token template-punctuation string" data-v-47862caa>`</span></span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
      <span class="token comment" data-v-47862caa>// 5秒后重启</span>
      <span class="token function" data-v-47862caa>delayWhen</span><span class="token punctuation" data-v-47862caa>(</span>val <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token function" data-v-47862caa>timer</span><span class="token punctuation" data-v-47862caa>(</span>val <span class="token operator" data-v-47862caa>*</span> <span class="token number" data-v-47862caa>1000</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span>
    <span class="token punctuation" data-v-47862caa>)</span>
  <span class="token punctuation" data-v-47862caa>)</span>
<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>/*
  输出:
  0
  1
  2
  3
  4
  5
  &quot;Value 6 was too high!&quot;
  --等待5秒后然后重复此过程
*/</span>
<span class="token keyword" data-v-47862caa>const</span> subscribe <span class="token operator" data-v-47862caa>=</span> example<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>val <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span>val<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa><span class="line-number" data-v-47862caa>10</span><br data-v-47862caa><span class="line-number" data-v-47862caa>11</span><br data-v-47862caa><span class="line-number" data-v-47862caa>12</span><br data-v-47862caa><span class="line-number" data-v-47862caa>13</span><br data-v-47862caa><span class="line-number" data-v-47862caa>14</span><br data-v-47862caa><span class="line-number" data-v-47862caa>15</span><br data-v-47862caa><span class="line-number" data-v-47862caa>16</span><br data-v-47862caa><span class="line-number" data-v-47862caa>17</span><br data-v-47862caa><span class="line-number" data-v-47862caa>18</span><br data-v-47862caa><span class="line-number" data-v-47862caa>19</span><br data-v-47862caa><span class="line-number" data-v-47862caa>20</span><br data-v-47862caa><span class="line-number" data-v-47862caa>21</span><br data-v-47862caa><span class="line-number" data-v-47862caa>22</span><br data-v-47862caa><span class="line-number" data-v-47862caa>23</span><br data-v-47862caa><span class="line-number" data-v-47862caa>24</span><br data-v-47862caa><span class="line-number" data-v-47862caa>25</span><br data-v-47862caa><span class="line-number" data-v-47862caa>26</span><br data-v-47862caa><span class="line-number" data-v-47862caa>27</span><br data-v-47862caa><span class="line-number" data-v-47862caa>28</span><br data-v-47862caa><span class="line-number" data-v-47862caa>29</span><br data-v-47862caa><span class="line-number" data-v-47862caa>30</span><br data-v-47862caa><span class="line-number" data-v-47862caa>31</span><br data-v-47862caa><span class="line-number" data-v-47862caa>32</span><br data-v-47862caa><span class="line-number" data-v-47862caa>33</span><br data-v-47862caa><span class="line-number" data-v-47862caa>34</span><br data-v-47862caa></div></div><h3 id="时间间隔增加的自定义重试" data-v-47862caa><a href="#时间间隔增加的自定义重试" class="header-anchor" data-v-47862caa>#</a> 时间间隔增加的自定义重试</h3> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token comment" data-v-47862caa>// 封装</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> Observable<span class="token punctuation" data-v-47862caa>,</span> _throw<span class="token punctuation" data-v-47862caa>,</span> timer <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> mergeMap<span class="token punctuation" data-v-47862caa>,</span> finalize <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs/operators'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>export</span> <span class="token keyword" data-v-47862caa>const</span> <span class="token function-variable function" data-v-47862caa>genericRetryStrategy</span> <span class="token operator" data-v-47862caa>=</span> <span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>{</span>
  maxRetryAttempts <span class="token operator" data-v-47862caa>=</span> <span class="token number" data-v-47862caa>3</span><span class="token punctuation" data-v-47862caa>,</span>
  scalingDuration <span class="token operator" data-v-47862caa>=</span> <span class="token number" data-v-47862caa>1000</span><span class="token punctuation" data-v-47862caa>,</span>
  excludedStatusCodes <span class="token operator" data-v-47862caa>=</span> <span class="token punctuation" data-v-47862caa>[</span><span class="token punctuation" data-v-47862caa>]</span>
<span class="token punctuation" data-v-47862caa>}</span><span class="token operator" data-v-47862caa>:</span> <span class="token punctuation" data-v-47862caa>{</span>
  maxRetryAttempts<span class="token operator" data-v-47862caa>?</span><span class="token operator" data-v-47862caa>:</span> <span class="token builtin" data-v-47862caa>number</span><span class="token punctuation" data-v-47862caa>,</span>
  scalingDuration<span class="token operator" data-v-47862caa>?</span><span class="token operator" data-v-47862caa>:</span> <span class="token builtin" data-v-47862caa>number</span><span class="token punctuation" data-v-47862caa>,</span>
  excludedStatusCodes<span class="token operator" data-v-47862caa>?</span><span class="token operator" data-v-47862caa>:</span> <span class="token builtin" data-v-47862caa>number</span><span class="token punctuation" data-v-47862caa>[</span><span class="token punctuation" data-v-47862caa>]</span>
<span class="token punctuation" data-v-47862caa>}</span> <span class="token operator" data-v-47862caa>=</span> <span class="token punctuation" data-v-47862caa>{</span><span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token punctuation" data-v-47862caa>(</span>attempts<span class="token operator" data-v-47862caa>:</span> Observable<span class="token operator" data-v-47862caa>&lt;</span><span class="token builtin" data-v-47862caa>any</span><span class="token operator" data-v-47862caa>&gt;</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token punctuation" data-v-47862caa>{</span>
  <span class="token keyword" data-v-47862caa>return</span> attempts<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span>
    <span class="token function" data-v-47862caa>mergeMap</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>(</span>error<span class="token punctuation" data-v-47862caa>,</span> i<span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token punctuation" data-v-47862caa>{</span>
      <span class="token keyword" data-v-47862caa>const</span> retryAttempt <span class="token operator" data-v-47862caa>=</span> i <span class="token operator" data-v-47862caa>+</span> <span class="token number" data-v-47862caa>1</span><span class="token punctuation" data-v-47862caa>;</span>
      <span class="token comment" data-v-47862caa>// 如果达到最大重试次数或响应的状态码</span>
      <span class="token comment" data-v-47862caa>// 不是我们想重试的，就抛出错误</span>
      <span class="token keyword" data-v-47862caa>if</span> <span class="token punctuation" data-v-47862caa>(</span>
        retryAttempt <span class="token operator" data-v-47862caa>&gt;</span> maxRetryAttempts <span class="token operator" data-v-47862caa>||</span>
        excludedStatusCodes<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>find</span><span class="token punctuation" data-v-47862caa>(</span>e <span class="token operator" data-v-47862caa>=&gt;</span> e <span class="token operator" data-v-47862caa>===</span> error<span class="token punctuation" data-v-47862caa>.</span>status<span class="token punctuation" data-v-47862caa>)</span>
      <span class="token punctuation" data-v-47862caa>)</span> <span class="token punctuation" data-v-47862caa>{</span>
        <span class="token keyword" data-v-47862caa>return</span> <span class="token function" data-v-47862caa>_throw</span><span class="token punctuation" data-v-47862caa>(</span>error<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
      <span class="token punctuation" data-v-47862caa>}</span>
      <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span>
        <span class="token template-string" data-v-47862caa><span class="token template-punctuation string" data-v-47862caa>`</span><span class="token string" data-v-47862caa>Attempt </span><span class="token interpolation" data-v-47862caa><span class="token interpolation-punctuation punctuation" data-v-47862caa>${</span>retryAttempt<span class="token interpolation-punctuation punctuation" data-v-47862caa>}</span></span><span class="token string" data-v-47862caa>: retrying in </span><span class="token interpolation" data-v-47862caa><span class="token interpolation-punctuation punctuation" data-v-47862caa>${</span>retryAttempt <span class="token operator" data-v-47862caa>*</span>
          scalingDuration<span class="token interpolation-punctuation punctuation" data-v-47862caa>}</span></span><span class="token string" data-v-47862caa>ms</span><span class="token template-punctuation string" data-v-47862caa>`</span></span>
      <span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
      <span class="token comment" data-v-47862caa>// 重试的时间间隔不断增长: 1秒、2秒，以此类推</span>
      <span class="token keyword" data-v-47862caa>return</span> <span class="token function" data-v-47862caa>timer</span><span class="token punctuation" data-v-47862caa>(</span>retryAttempt <span class="token operator" data-v-47862caa>*</span> scalingDuration<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
    <span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
    <span class="token function" data-v-47862caa>finalize</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'We are done!'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span>
  <span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token comment" data-v-47862caa>// 使用</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> Component<span class="token punctuation" data-v-47862caa>,</span> OnInit <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'@angular/core'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> catchError<span class="token punctuation" data-v-47862caa>,</span> retryWhen  <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs/operators'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> <span class="token keyword" data-v-47862caa>of</span> <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> genericRetryStrategy <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'./rxjs-utils'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> AppService <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'./app.service'</span><span class="token punctuation" data-v-47862caa>;</span>
<span class="token decorator" data-v-47862caa><span class="token at operator" data-v-47862caa>@</span><span class="token function" data-v-47862caa>Component</span></span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>{</span>
  selector<span class="token operator" data-v-47862caa>:</span> <span class="token string" data-v-47862caa>'my-app'</span><span class="token punctuation" data-v-47862caa>,</span>
  templateUrl<span class="token operator" data-v-47862caa>:</span> <span class="token string" data-v-47862caa>'./app.component.html'</span><span class="token punctuation" data-v-47862caa>,</span>
  styleUrls<span class="token operator" data-v-47862caa>:</span> <span class="token punctuation" data-v-47862caa>[</span> <span class="token string" data-v-47862caa>'./app.component.css'</span> <span class="token punctuation" data-v-47862caa>]</span>
<span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>)</span>
<span class="token keyword" data-v-47862caa>export</span> <span class="token keyword" data-v-47862caa>class</span> <span class="token class-name" data-v-47862caa>AppComponent</span> <span class="token keyword" data-v-47862caa>implements</span> <span class="token class-name" data-v-47862caa>OnInit</span>  <span class="token punctuation" data-v-47862caa>{</span>
  <span class="token function" data-v-47862caa>constructor</span><span class="token punctuation" data-v-47862caa>(</span><span class="token keyword" data-v-47862caa>private</span> _appService<span class="token operator" data-v-47862caa>:</span> AppService<span class="token punctuation" data-v-47862caa>)</span> <span class="token punctuation" data-v-47862caa>{</span><span class="token punctuation" data-v-47862caa>}</span>
  <span class="token function" data-v-47862caa>ngOnInit</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token punctuation" data-v-47862caa>{</span>
    <span class="token keyword" data-v-47862caa>this</span><span class="token punctuation" data-v-47862caa>.</span>_appService
      <span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>getData</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>500</span><span class="token punctuation" data-v-47862caa>)</span>
      <span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span>
        <span class="token function" data-v-47862caa>retryWhen</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>genericRetryStrategy</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
        <span class="token function" data-v-47862caa>catchError</span><span class="token punctuation" data-v-47862caa>(</span>error <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token keyword" data-v-47862caa>of</span><span class="token punctuation" data-v-47862caa>(</span>error<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span>
      <span class="token punctuation" data-v-47862caa>)</span>
      <span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span>log<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>

    <span class="token comment" data-v-47862caa>// 排除状态码，增加延迟以保持日志清晰</span>
    <span class="token function" data-v-47862caa>setTimeout</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token punctuation" data-v-47862caa>{</span>
    <span class="token keyword" data-v-47862caa>this</span><span class="token punctuation" data-v-47862caa>.</span>_appService
      <span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>getData</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>500</span><span class="token punctuation" data-v-47862caa>)</span>
      <span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>pipe</span><span class="token punctuation" data-v-47862caa>(</span>
        <span class="token function" data-v-47862caa>retryWhen</span><span class="token punctuation" data-v-47862caa>(</span><span class="token function" data-v-47862caa>genericRetryStrategy</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>{</span>
          scalingDuration<span class="token operator" data-v-47862caa>:</span> <span class="token number" data-v-47862caa>2000</span><span class="token punctuation" data-v-47862caa>,</span>
          excludedStatusCodes<span class="token operator" data-v-47862caa>:</span> <span class="token punctuation" data-v-47862caa>[</span><span class="token number" data-v-47862caa>500</span><span class="token punctuation" data-v-47862caa>]</span>
        <span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
        <span class="token function" data-v-47862caa>catchError</span><span class="token punctuation" data-v-47862caa>(</span>error <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token keyword" data-v-47862caa>of</span><span class="token punctuation" data-v-47862caa>(</span>error<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span>
      <span class="token punctuation" data-v-47862caa>)</span>
      <span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span>e <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'Exluded code:'</span><span class="token punctuation" data-v-47862caa>,</span> e<span class="token punctuation" data-v-47862caa>.</span>status<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>

    <span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>8000</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
  <span class="token punctuation" data-v-47862caa>}</span>
<span class="token punctuation" data-v-47862caa>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa><span class="line-number" data-v-47862caa>10</span><br data-v-47862caa><span class="line-number" data-v-47862caa>11</span><br data-v-47862caa><span class="line-number" data-v-47862caa>12</span><br data-v-47862caa><span class="line-number" data-v-47862caa>13</span><br data-v-47862caa><span class="line-number" data-v-47862caa>14</span><br data-v-47862caa><span class="line-number" data-v-47862caa>15</span><br data-v-47862caa><span class="line-number" data-v-47862caa>16</span><br data-v-47862caa><span class="line-number" data-v-47862caa>17</span><br data-v-47862caa><span class="line-number" data-v-47862caa>18</span><br data-v-47862caa><span class="line-number" data-v-47862caa>19</span><br data-v-47862caa><span class="line-number" data-v-47862caa>20</span><br data-v-47862caa><span class="line-number" data-v-47862caa>21</span><br data-v-47862caa><span class="line-number" data-v-47862caa>22</span><br data-v-47862caa><span class="line-number" data-v-47862caa>23</span><br data-v-47862caa><span class="line-number" data-v-47862caa>24</span><br data-v-47862caa><span class="line-number" data-v-47862caa>25</span><br data-v-47862caa><span class="line-number" data-v-47862caa>26</span><br data-v-47862caa><span class="line-number" data-v-47862caa>27</span><br data-v-47862caa><span class="line-number" data-v-47862caa>28</span><br data-v-47862caa><span class="line-number" data-v-47862caa>29</span><br data-v-47862caa><span class="line-number" data-v-47862caa>30</span><br data-v-47862caa><span class="line-number" data-v-47862caa>31</span><br data-v-47862caa><span class="line-number" data-v-47862caa>32</span><br data-v-47862caa><span class="line-number" data-v-47862caa>33</span><br data-v-47862caa><span class="line-number" data-v-47862caa>34</span><br data-v-47862caa><span class="line-number" data-v-47862caa>35</span><br data-v-47862caa><span class="line-number" data-v-47862caa>36</span><br data-v-47862caa><span class="line-number" data-v-47862caa>37</span><br data-v-47862caa><span class="line-number" data-v-47862caa>38</span><br data-v-47862caa><span class="line-number" data-v-47862caa>39</span><br data-v-47862caa><span class="line-number" data-v-47862caa>40</span><br data-v-47862caa><span class="line-number" data-v-47862caa>41</span><br data-v-47862caa><span class="line-number" data-v-47862caa>42</span><br data-v-47862caa><span class="line-number" data-v-47862caa>43</span><br data-v-47862caa><span class="line-number" data-v-47862caa>44</span><br data-v-47862caa><span class="line-number" data-v-47862caa>45</span><br data-v-47862caa><span class="line-number" data-v-47862caa>46</span><br data-v-47862caa><span class="line-number" data-v-47862caa>47</span><br data-v-47862caa><span class="line-number" data-v-47862caa>48</span><br data-v-47862caa><span class="line-number" data-v-47862caa>49</span><br data-v-47862caa><span class="line-number" data-v-47862caa>50</span><br data-v-47862caa><span class="line-number" data-v-47862caa>51</span><br data-v-47862caa><span class="line-number" data-v-47862caa>52</span><br data-v-47862caa><span class="line-number" data-v-47862caa>53</span><br data-v-47862caa><span class="line-number" data-v-47862caa>54</span><br data-v-47862caa><span class="line-number" data-v-47862caa>55</span><br data-v-47862caa><span class="line-number" data-v-47862caa>56</span><br data-v-47862caa><span class="line-number" data-v-47862caa>57</span><br data-v-47862caa><span class="line-number" data-v-47862caa>58</span><br data-v-47862caa><span class="line-number" data-v-47862caa>59</span><br data-v-47862caa><span class="line-number" data-v-47862caa>60</span><br data-v-47862caa><span class="line-number" data-v-47862caa>61</span><br data-v-47862caa><span class="line-number" data-v-47862caa>62</span><br data-v-47862caa><span class="line-number" data-v-47862caa>63</span><br data-v-47862caa><span class="line-number" data-v-47862caa>64</span><br data-v-47862caa><span class="line-number" data-v-47862caa>65</span><br data-v-47862caa><span class="line-number" data-v-47862caa>66</span><br data-v-47862caa><span class="line-number" data-v-47862caa>67</span><br data-v-47862caa><span class="line-number" data-v-47862caa>68</span><br data-v-47862caa><span class="line-number" data-v-47862caa>69</span><br data-v-47862caa><span class="line-number" data-v-47862caa>70</span><br data-v-47862caa><span class="line-number" data-v-47862caa>71</span><br data-v-47862caa></div></div><h3 id="retrywhen-scan" data-v-47862caa><a href="#retrywhen-scan" class="header-anchor" data-v-47862caa>#</a> retryWhen+scan</h3> <p data-v-47862caa>设置重试次数+重试逻辑</p> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>const</span> source <span class="token operator" data-v-47862caa>=</span> Rx<span class="token punctuation" data-v-47862caa>.</span>Observable<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>interval</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>1000</span><span class="token punctuation" data-v-47862caa>)</span> 
<span class="token keyword" data-v-47862caa>const</span> example <span class="token operator" data-v-47862caa>=</span> source
<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>map</span><span class="token punctuation" data-v-47862caa>(</span>val <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token punctuation" data-v-47862caa>{</span>
 <span class="token keyword" data-v-47862caa>if</span> <span class="token punctuation" data-v-47862caa>(</span>val <span class="token operator" data-v-47862caa>===</span> <span class="token number" data-v-47862caa>2</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token punctuation" data-v-47862caa>{</span> 
    <span class="token keyword" data-v-47862caa>throw</span> <span class="token function" data-v-47862caa>Error</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'error'</span><span class="token punctuation" data-v-47862caa>)</span> 
    <span class="token punctuation" data-v-47862caa>}</span> 
    <span class="token keyword" data-v-47862caa>return</span> val<span class="token punctuation" data-v-47862caa>;</span> 
<span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>)</span>
<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>retryWhen</span><span class="token punctuation" data-v-47862caa>(</span>err <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token punctuation" data-v-47862caa>{</span> 
    <span class="token keyword" data-v-47862caa>return</span> err<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>scan</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>(</span>acc<span class="token punctuation" data-v-47862caa>,</span> curr<span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token punctuation" data-v-47862caa>{</span>
        <span class="token keyword" data-v-47862caa>if</span> <span class="token punctuation" data-v-47862caa>(</span>acc <span class="token operator" data-v-47862caa>&gt;</span> <span class="token number" data-v-47862caa>2</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token punctuation" data-v-47862caa>{</span> 
             <span class="token keyword" data-v-47862caa>throw</span> curr 
        <span class="token punctuation" data-v-47862caa>}</span> 
        <span class="token keyword" data-v-47862caa>return</span> acc <span class="token operator" data-v-47862caa>+</span> <span class="token number" data-v-47862caa>1</span>
     <span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>1</span><span class="token punctuation" data-v-47862caa>)</span> 
<span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
example<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>{</span>
    <span class="token function-variable function" data-v-47862caa>next</span><span class="token operator" data-v-47862caa>:</span> val <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span>val<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span> 
    <span class="token function-variable function" data-v-47862caa>error</span><span class="token operator" data-v-47862caa>:</span> val <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span>val<span class="token punctuation" data-v-47862caa>.</span>message<span class="token punctuation" data-v-47862caa>)</span>
<span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa><span class="line-number" data-v-47862caa>10</span><br data-v-47862caa><span class="line-number" data-v-47862caa>11</span><br data-v-47862caa><span class="line-number" data-v-47862caa>12</span><br data-v-47862caa><span class="line-number" data-v-47862caa>13</span><br data-v-47862caa><span class="line-number" data-v-47862caa>14</span><br data-v-47862caa><span class="line-number" data-v-47862caa>15</span><br data-v-47862caa><span class="line-number" data-v-47862caa>16</span><br data-v-47862caa><span class="line-number" data-v-47862caa>17</span><br data-v-47862caa><span class="line-number" data-v-47862caa>18</span><br data-v-47862caa><span class="line-number" data-v-47862caa>19</span><br data-v-47862caa><span class="line-number" data-v-47862caa>20</span><br data-v-47862caa></div></div><p data-v-47862caa>retryWhen 操作符。这个操作符如果内部触发了 Error 或者 Completed ，那么就会停止重试，将会把内部触发的 Error 或者 Completed 交给 subscribe 的订阅操作符。</p> <p data-v-47862caa>其实满足重试次数后，把错误再抛出去，是比较正常的操作，让后面的操作符，对错误进行处理。但是可能有些人的业务需求是需要返回 Completed</p> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>const</span> source <span class="token operator" data-v-47862caa>=</span> Rx<span class="token punctuation" data-v-47862caa>.</span>Observable<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>interval</span><span class="token punctuation" data-v-47862caa>(</span><span class="token number" data-v-47862caa>200</span><span class="token punctuation" data-v-47862caa>)</span> 
<span class="token keyword" data-v-47862caa>const</span> example <span class="token operator" data-v-47862caa>=</span> source<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>map</span><span class="token punctuation" data-v-47862caa>(</span>val <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token punctuation" data-v-47862caa>{</span> 
    <span class="token keyword" data-v-47862caa>if</span> <span class="token punctuation" data-v-47862caa>(</span>val <span class="token operator" data-v-47862caa>===</span> <span class="token number" data-v-47862caa>2</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token punctuation" data-v-47862caa>{</span> 
        <span class="token keyword" data-v-47862caa>throw</span> <span class="token function" data-v-47862caa>Error</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'error'</span><span class="token punctuation" data-v-47862caa>)</span>
    <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>return</span> val<span class="token punctuation" data-v-47862caa>;</span> 
<span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>retryWhen</span><span class="token punctuation" data-v-47862caa>(</span>err <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token punctuation" data-v-47862caa>{</span> 
    <span class="token keyword" data-v-47862caa>return</span> err
    <span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>scan</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>(</span>acc<span class="token punctuation" data-v-47862caa>,</span> curr<span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token punctuation" data-v-47862caa>{</span> 
        <span class="token keyword" data-v-47862caa>return</span> acc <span class="token operator" data-v-47862caa>+</span> <span class="token number" data-v-47862caa>1</span> 
    <span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>0</span><span class="token punctuation" data-v-47862caa>)</span>
    <span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>takeWhile</span><span class="token punctuation" data-v-47862caa>(</span>v <span class="token operator" data-v-47862caa>=&gt;</span> v <span class="token operator" data-v-47862caa>&lt;=</span> <span class="token number" data-v-47862caa>2</span><span class="token punctuation" data-v-47862caa>)</span> 
<span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>)</span> 
example<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>{</span> 
    <span class="token function-variable function" data-v-47862caa>complete</span><span class="token operator" data-v-47862caa>:</span> <span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'Completed'</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
    <span class="token function-variable function" data-v-47862caa>next</span><span class="token operator" data-v-47862caa>:</span> val <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span>val<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
    <span class="token function-variable function" data-v-47862caa>error</span><span class="token operator" data-v-47862caa>:</span> val <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span>val<span class="token punctuation" data-v-47862caa>.</span>message<span class="token punctuation" data-v-47862caa>)</span>
 <span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa><span class="line-number" data-v-47862caa>10</span><br data-v-47862caa><span class="line-number" data-v-47862caa>11</span><br data-v-47862caa><span class="line-number" data-v-47862caa>12</span><br data-v-47862caa><span class="line-number" data-v-47862caa>13</span><br data-v-47862caa><span class="line-number" data-v-47862caa>14</span><br data-v-47862caa><span class="line-number" data-v-47862caa>15</span><br data-v-47862caa><span class="line-number" data-v-47862caa>16</span><br data-v-47862caa><span class="line-number" data-v-47862caa>17</span><br data-v-47862caa></div></div><h3 id="defer-操作符" data-v-47862caa><a href="#defer-操作符" class="header-anchor" data-v-47862caa>#</a> defer 操作符</h3> <p data-v-47862caa>重试Promise,Promise没有重试的API,defer 接受一个函数参数，其函数不会运行，只有你使用 subscribe 去订阅的时候，才会去运行函数。并且运行函数，都是在独立的运行空间内，也就说，即使我们使用 Promise ，也不会造成无法重试的情况，因为它不是复用之前的结果，而是重新开启一个新的内存空间，去运行函数，返回函数结果。</p> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>const</span> getInfo<span class="token operator" data-v-47862caa>:</span> AxiosPromise <span class="token operator" data-v-47862caa>=</span> axios<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>get</span><span class="token punctuation" data-v-47862caa>(</span><span class="token string" data-v-47862caa>'http://xxx.com'</span><span class="token punctuation" data-v-47862caa>)</span> 
<span class="token keyword" data-v-47862caa>const</span> exp <span class="token operator" data-v-47862caa>=</span> <span class="token function" data-v-47862caa>defer</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> getInfo<span class="token punctuation" data-v-47862caa>)</span>
<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>retryWhen</span><span class="token punctuation" data-v-47862caa>(</span>err <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token punctuation" data-v-47862caa>{</span> 
    <span class="token keyword" data-v-47862caa>return</span> err<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>scan</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>(</span>acc<span class="token punctuation" data-v-47862caa>,</span> curr<span class="token punctuation" data-v-47862caa>)</span> <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token punctuation" data-v-47862caa>{</span> 
        <span class="token keyword" data-v-47862caa>if</span> <span class="token punctuation" data-v-47862caa>(</span>acc <span class="token operator" data-v-47862caa>&gt;</span> <span class="token number" data-v-47862caa>2</span><span class="token punctuation" data-v-47862caa>)</span> <span class="token punctuation" data-v-47862caa>{</span> 
        <span class="token keyword" data-v-47862caa>throw</span> curr
         <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>return</span> acc <span class="token operator" data-v-47862caa>+</span> <span class="token number" data-v-47862caa>1</span>
         <span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>,</span> <span class="token number" data-v-47862caa>1</span><span class="token punctuation" data-v-47862caa>)</span> 
    <span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
example<span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>subscribe</span><span class="token punctuation" data-v-47862caa>(</span><span class="token punctuation" data-v-47862caa>{</span> 
    <span class="token function-variable function" data-v-47862caa>next</span><span class="token operator" data-v-47862caa>:</span> val <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span>val<span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>,</span>
    <span class="token function-variable function" data-v-47862caa>error</span><span class="token operator" data-v-47862caa>:</span> val <span class="token operator" data-v-47862caa>=&gt;</span> <span class="token builtin" data-v-47862caa>console</span><span class="token punctuation" data-v-47862caa>.</span><span class="token function" data-v-47862caa>log</span><span class="token punctuation" data-v-47862caa>(</span>val<span class="token punctuation" data-v-47862caa>.</span>message<span class="token punctuation" data-v-47862caa>)</span> 
<span class="token punctuation" data-v-47862caa>}</span><span class="token punctuation" data-v-47862caa>)</span><span class="token punctuation" data-v-47862caa>;</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa><span class="line-number" data-v-47862caa>4</span><br data-v-47862caa><span class="line-number" data-v-47862caa>5</span><br data-v-47862caa><span class="line-number" data-v-47862caa>6</span><br data-v-47862caa><span class="line-number" data-v-47862caa>7</span><br data-v-47862caa><span class="line-number" data-v-47862caa>8</span><br data-v-47862caa><span class="line-number" data-v-47862caa>9</span><br data-v-47862caa><span class="line-number" data-v-47862caa>10</span><br data-v-47862caa><span class="line-number" data-v-47862caa>11</span><br data-v-47862caa><span class="line-number" data-v-47862caa>12</span><br data-v-47862caa><span class="line-number" data-v-47862caa>13</span><br data-v-47862caa></div></div><h2 id="rxjs使用注意点" data-v-47862caa><a href="#rxjs使用注意点" class="header-anchor" data-v-47862caa>#</a> RxJS使用注意点</h2> <p data-v-47862caa>RxJS(v5)整个库压缩后约为140KB，由于其模块化可扩展的设计，因此仅需导入所用到的类与操作符即可。导入RxJS常用类与操作符后，打包后的体积约增加30-60KB，具体取决于导入的数量。</p> <p data-v-47862caa>不要用 <code data-v-47862caa>import { Observable } from 'rxjs'</code>这种方式导入，这会导入整个rxjs库，按需导入的方式如下：</p> <div class="language-typescript line-numbers-mode" data-v-47862caa><pre class="language-typescript" data-v-47862caa><code data-v-47862caa><span class="token keyword" data-v-47862caa>import</span> <span class="token punctuation" data-v-47862caa>{</span> Observable <span class="token punctuation" data-v-47862caa>}</span> <span class="token keyword" data-v-47862caa>from</span> <span class="token string" data-v-47862caa>'rxjs/Observable'</span> <span class="token comment" data-v-47862caa>//导入类</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token string" data-v-47862caa>'rxjs/add/operator/map'</span> <span class="token comment" data-v-47862caa>// 导入实例操作符</span>
<span class="token keyword" data-v-47862caa>import</span> <span class="token string" data-v-47862caa>'rxjs/add/observable/forkJoin'</span> <span class="token comment" data-v-47862caa>// 导入类操作符</span>
</code></pre> <div class="line-numbers-wrapper" data-v-47862caa><span class="line-number" data-v-47862caa>1</span><br data-v-47862caa><span class="line-number" data-v-47862caa>2</span><br data-v-47862caa><span class="line-number" data-v-47862caa>3</span><br data-v-47862caa></div></div><h2 id="推荐链接" data-v-47862caa><a href="#推荐链接" class="header-anchor" data-v-47862caa>#</a> 推荐链接</h2> <p data-v-47862caa><a href="https://rxjs-dev.firebaseapp.com/" data-v-47862caa>RxJS官方文档</a></p> <p data-v-47862caa><a href="https://cn.rx.js.org/class/es6/Observable.js~Observable.html" data-v-47862caa>RxJS中文手册</a></p> <p data-v-47862caa><a href="https://www.learnrxjs.io/learn-rxjs/operators/combination/combineall" data-v-47862caa>Learn RxJS</a></p> <p data-v-47862caa><a href="https://github.com/RxJS-CN" data-v-47862caa>RxJS中文社区</a></p> <p data-v-47862caa><a href="https://github.com/moroshko/rxviz" data-v-47862caa>rxviz本地运行环境</a></p> <p data-v-47862caa><a href="https://rxmarbles.com/" data-v-47862caa>RxJS Marbles</a></p> <p data-v-47862caa><a href="https://www.w3cschool.cn/rxjs/rxjs-41hi3cic.html" data-v-47862caa>w3cschool</a></p> <h2 id="文末" data-v-47862caa><a href="#文末" class="header-anchor" data-v-47862caa>#</a> 文末</h2> <p data-v-47862caa>结尾说明，在我有新的想法那会我会继续更新本文，最后想说的是，我们都在真理面前心安理得，当我们还没发现真理的时候，往往那会都是在摸爬滚打的过程中吃了不少苦头，而这也是必经过程，当某一天你有了新的见解那会，把它记录下来，这往往会是值得的。</p></div> <div class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">4/19/2021, 2:21:19 PM</span></div></div> <!----> </div> <!----></div><div class="global-ui"></div></div>
    <script src="/vuebloger/assets/js/app.ff1851b0.js" defer></script><script src="/vuebloger/assets/js/5.82db9be2.js" defer></script><script src="/vuebloger/assets/js/1.b1b3586e.js" defer></script><script src="/vuebloger/assets/js/61.2fa2f12b.js" defer></script><script src="/vuebloger/assets/js/45.c7e679aa.js" defer></script>
  </body>
</html>
