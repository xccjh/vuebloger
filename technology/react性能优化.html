<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>react性能优化 | 邹先生博客记录</title>
    <meta name="generator" content="VuePress 1.4.1">
    <link rel="icon" href="/vuebloger/img/logo.jpeg">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.2/jquery.fancybox.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.2/jquery.fancybox.min.css">
    <meta name="description" content="">
    <link rel="preload" href="/vuebloger/assets/css/0.styles.2e2748f8.css" as="style"><link rel="preload" href="/vuebloger/assets/js/app.a65085b2.js" as="script"><link rel="preload" href="/vuebloger/assets/js/7.02fe805f.js" as="script"><link rel="preload" href="/vuebloger/assets/js/1.252ffbfc.js" as="script"><link rel="preload" href="/vuebloger/assets/js/73.686450b9.js" as="script"><link rel="preload" href="/vuebloger/assets/js/49.3a1b9aa9.js" as="script"><link rel="prefetch" href="/vuebloger/assets/js/10.2fc7b3fc.js"><link rel="prefetch" href="/vuebloger/assets/js/100.fcf6680d.js"><link rel="prefetch" href="/vuebloger/assets/js/101.69820fcb.js"><link rel="prefetch" href="/vuebloger/assets/js/102.62596cc1.js"><link rel="prefetch" href="/vuebloger/assets/js/103.735a2268.js"><link rel="prefetch" href="/vuebloger/assets/js/104.421b6620.js"><link rel="prefetch" href="/vuebloger/assets/js/105.f5e2a7d0.js"><link rel="prefetch" href="/vuebloger/assets/js/106.afec1c9e.js"><link rel="prefetch" href="/vuebloger/assets/js/107.666053ae.js"><link rel="prefetch" href="/vuebloger/assets/js/108.a0cc6c24.js"><link rel="prefetch" href="/vuebloger/assets/js/109.6164bbd7.js"><link rel="prefetch" href="/vuebloger/assets/js/11.ad6acc3a.js"><link rel="prefetch" href="/vuebloger/assets/js/110.4960b345.js"><link rel="prefetch" href="/vuebloger/assets/js/111.ef01f6bb.js"><link rel="prefetch" href="/vuebloger/assets/js/112.a1ad976d.js"><link rel="prefetch" href="/vuebloger/assets/js/113.9f62ab74.js"><link rel="prefetch" href="/vuebloger/assets/js/114.4de2eed2.js"><link rel="prefetch" href="/vuebloger/assets/js/115.eda457c5.js"><link rel="prefetch" href="/vuebloger/assets/js/116.5a94abc8.js"><link rel="prefetch" href="/vuebloger/assets/js/117.e51edec8.js"><link rel="prefetch" href="/vuebloger/assets/js/118.3a4dcc09.js"><link rel="prefetch" href="/vuebloger/assets/js/119.f75dc0b8.js"><link rel="prefetch" href="/vuebloger/assets/js/12.831b2cd3.js"><link rel="prefetch" href="/vuebloger/assets/js/120.57bbd4e8.js"><link rel="prefetch" href="/vuebloger/assets/js/121.694f16e2.js"><link rel="prefetch" href="/vuebloger/assets/js/122.31dd7130.js"><link rel="prefetch" href="/vuebloger/assets/js/123.78b6861a.js"><link rel="prefetch" href="/vuebloger/assets/js/124.f6b84355.js"><link rel="prefetch" href="/vuebloger/assets/js/125.54d2fff1.js"><link rel="prefetch" href="/vuebloger/assets/js/126.8531be65.js"><link rel="prefetch" href="/vuebloger/assets/js/127.3d4251de.js"><link rel="prefetch" href="/vuebloger/assets/js/128.8169e335.js"><link rel="prefetch" href="/vuebloger/assets/js/129.4ce9bd80.js"><link rel="prefetch" href="/vuebloger/assets/js/13.930f2726.js"><link rel="prefetch" href="/vuebloger/assets/js/130.56c84295.js"><link rel="prefetch" href="/vuebloger/assets/js/131.6ab9a2c3.js"><link rel="prefetch" href="/vuebloger/assets/js/132.4d0c08ec.js"><link rel="prefetch" href="/vuebloger/assets/js/133.b79e7f13.js"><link rel="prefetch" href="/vuebloger/assets/js/134.79b04327.js"><link rel="prefetch" href="/vuebloger/assets/js/135.e9635342.js"><link rel="prefetch" href="/vuebloger/assets/js/136.7d1f576e.js"><link rel="prefetch" href="/vuebloger/assets/js/137.5ae3251d.js"><link rel="prefetch" href="/vuebloger/assets/js/138.2cf72827.js"><link rel="prefetch" href="/vuebloger/assets/js/139.7ff3499f.js"><link rel="prefetch" href="/vuebloger/assets/js/14.f14b2abd.js"><link rel="prefetch" href="/vuebloger/assets/js/140.f3c55ed2.js"><link rel="prefetch" href="/vuebloger/assets/js/141.b375515e.js"><link rel="prefetch" href="/vuebloger/assets/js/142.5e65016a.js"><link rel="prefetch" href="/vuebloger/assets/js/143.5f8e60fd.js"><link rel="prefetch" href="/vuebloger/assets/js/144.04214c0d.js"><link rel="prefetch" href="/vuebloger/assets/js/145.cc1be544.js"><link rel="prefetch" href="/vuebloger/assets/js/146.5cfc76ba.js"><link rel="prefetch" href="/vuebloger/assets/js/147.bb3dea71.js"><link rel="prefetch" href="/vuebloger/assets/js/148.7b2156a8.js"><link rel="prefetch" href="/vuebloger/assets/js/149.89021d4c.js"><link rel="prefetch" href="/vuebloger/assets/js/15.1c88a8a2.js"><link rel="prefetch" href="/vuebloger/assets/js/150.fc0ec16e.js"><link rel="prefetch" href="/vuebloger/assets/js/151.9788296d.js"><link rel="prefetch" href="/vuebloger/assets/js/152.87a7322d.js"><link rel="prefetch" href="/vuebloger/assets/js/153.e0ee9fa6.js"><link rel="prefetch" href="/vuebloger/assets/js/154.a0686333.js"><link rel="prefetch" href="/vuebloger/assets/js/155.46ac504c.js"><link rel="prefetch" href="/vuebloger/assets/js/156.d002f6a4.js"><link rel="prefetch" href="/vuebloger/assets/js/157.600eb354.js"><link rel="prefetch" href="/vuebloger/assets/js/158.37e5b3b9.js"><link rel="prefetch" href="/vuebloger/assets/js/16.dba8d6aa.js"><link rel="prefetch" href="/vuebloger/assets/js/17.5c9ff2d7.js"><link rel="prefetch" href="/vuebloger/assets/js/18.e86518d9.js"><link rel="prefetch" href="/vuebloger/assets/js/19.08ad6258.js"><link rel="prefetch" href="/vuebloger/assets/js/20.e6061b25.js"><link rel="prefetch" href="/vuebloger/assets/js/21.6de1dc73.js"><link rel="prefetch" href="/vuebloger/assets/js/22.8a055d98.js"><link rel="prefetch" href="/vuebloger/assets/js/23.5c9f8550.js"><link rel="prefetch" href="/vuebloger/assets/js/24.6502b332.js"><link rel="prefetch" href="/vuebloger/assets/js/25.8e94c39a.js"><link rel="prefetch" href="/vuebloger/assets/js/26.669df298.js"><link rel="prefetch" href="/vuebloger/assets/js/27.7db7ccee.js"><link rel="prefetch" href="/vuebloger/assets/js/28.6468cb48.js"><link rel="prefetch" href="/vuebloger/assets/js/29.495e8d7d.js"><link rel="prefetch" href="/vuebloger/assets/js/30.44efcc4f.js"><link rel="prefetch" href="/vuebloger/assets/js/31.dd3dd93a.js"><link rel="prefetch" href="/vuebloger/assets/js/32.3297950b.js"><link rel="prefetch" href="/vuebloger/assets/js/33.f5a6ecda.js"><link rel="prefetch" href="/vuebloger/assets/js/34.1b52aba9.js"><link rel="prefetch" href="/vuebloger/assets/js/35.af4f0ea3.js"><link rel="prefetch" href="/vuebloger/assets/js/36.3723753e.js"><link rel="prefetch" href="/vuebloger/assets/js/37.8d3ce716.js"><link rel="prefetch" href="/vuebloger/assets/js/38.272cc2ad.js"><link rel="prefetch" href="/vuebloger/assets/js/39.2a3b492f.js"><link rel="prefetch" href="/vuebloger/assets/js/4.7444c5d9.js"><link rel="prefetch" href="/vuebloger/assets/js/40.59f97e36.js"><link rel="prefetch" href="/vuebloger/assets/js/41.03245b0d.js"><link rel="prefetch" href="/vuebloger/assets/js/42.d5021c9c.js"><link rel="prefetch" href="/vuebloger/assets/js/43.bdf0e763.js"><link rel="prefetch" href="/vuebloger/assets/js/44.2cb98cc3.js"><link rel="prefetch" href="/vuebloger/assets/js/45.63e6440b.js"><link rel="prefetch" href="/vuebloger/assets/js/46.7784e388.js"><link rel="prefetch" href="/vuebloger/assets/js/47.d8020da4.js"><link rel="prefetch" href="/vuebloger/assets/js/48.05b856ec.js"><link rel="prefetch" href="/vuebloger/assets/js/5.b7de26b2.js"><link rel="prefetch" href="/vuebloger/assets/js/50.d01555de.js"><link rel="prefetch" href="/vuebloger/assets/js/51.64762b1b.js"><link rel="prefetch" href="/vuebloger/assets/js/52.f47836ab.js"><link rel="prefetch" href="/vuebloger/assets/js/53.dbf9bd48.js"><link rel="prefetch" href="/vuebloger/assets/js/54.325da55e.js"><link rel="prefetch" href="/vuebloger/assets/js/55.39d24d6d.js"><link rel="prefetch" href="/vuebloger/assets/js/56.44fb3971.js"><link rel="prefetch" href="/vuebloger/assets/js/57.a282179c.js"><link rel="prefetch" href="/vuebloger/assets/js/58.83e3f4da.js"><link rel="prefetch" href="/vuebloger/assets/js/59.5d965a8a.js"><link rel="prefetch" href="/vuebloger/assets/js/6.2de6d4b4.js"><link rel="prefetch" href="/vuebloger/assets/js/60.3b4ad761.js"><link rel="prefetch" href="/vuebloger/assets/js/61.4571dd6e.js"><link rel="prefetch" href="/vuebloger/assets/js/62.19e53228.js"><link rel="prefetch" href="/vuebloger/assets/js/63.d11aae48.js"><link rel="prefetch" href="/vuebloger/assets/js/64.c561c612.js"><link rel="prefetch" href="/vuebloger/assets/js/65.5f4ba8d5.js"><link rel="prefetch" href="/vuebloger/assets/js/66.a9e8b7b1.js"><link rel="prefetch" href="/vuebloger/assets/js/67.0f96aa45.js"><link rel="prefetch" href="/vuebloger/assets/js/68.01325833.js"><link rel="prefetch" href="/vuebloger/assets/js/69.6b738fe4.js"><link rel="prefetch" href="/vuebloger/assets/js/70.67695a0a.js"><link rel="prefetch" href="/vuebloger/assets/js/71.4efef8a4.js"><link rel="prefetch" href="/vuebloger/assets/js/72.5d0b2873.js"><link rel="prefetch" href="/vuebloger/assets/js/74.6d8aba46.js"><link rel="prefetch" href="/vuebloger/assets/js/75.2309bb3b.js"><link rel="prefetch" href="/vuebloger/assets/js/76.db109f33.js"><link rel="prefetch" href="/vuebloger/assets/js/77.ed0537f8.js"><link rel="prefetch" href="/vuebloger/assets/js/78.234b59da.js"><link rel="prefetch" href="/vuebloger/assets/js/79.69b7c8e1.js"><link rel="prefetch" href="/vuebloger/assets/js/8.9a76c738.js"><link rel="prefetch" href="/vuebloger/assets/js/80.99d930cc.js"><link rel="prefetch" href="/vuebloger/assets/js/81.5ccfa044.js"><link rel="prefetch" href="/vuebloger/assets/js/82.c21e1eb7.js"><link rel="prefetch" href="/vuebloger/assets/js/83.b02f9c93.js"><link rel="prefetch" href="/vuebloger/assets/js/84.01512726.js"><link rel="prefetch" href="/vuebloger/assets/js/85.9af400d0.js"><link rel="prefetch" href="/vuebloger/assets/js/86.c0203f6e.js"><link rel="prefetch" href="/vuebloger/assets/js/87.222e425f.js"><link rel="prefetch" href="/vuebloger/assets/js/88.6a15da03.js"><link rel="prefetch" href="/vuebloger/assets/js/89.08e31365.js"><link rel="prefetch" href="/vuebloger/assets/js/9.6529d756.js"><link rel="prefetch" href="/vuebloger/assets/js/90.9da867ce.js"><link rel="prefetch" href="/vuebloger/assets/js/91.b3adfbbe.js"><link rel="prefetch" href="/vuebloger/assets/js/92.56e9a0a5.js"><link rel="prefetch" href="/vuebloger/assets/js/93.6911059d.js"><link rel="prefetch" href="/vuebloger/assets/js/94.822df84f.js"><link rel="prefetch" href="/vuebloger/assets/js/95.892eb3bf.js"><link rel="prefetch" href="/vuebloger/assets/js/96.5773ad19.js"><link rel="prefetch" href="/vuebloger/assets/js/97.f82abdcd.js"><link rel="prefetch" href="/vuebloger/assets/js/98.b78771dc.js"><link rel="prefetch" href="/vuebloger/assets/js/99.2404420f.js"><link rel="prefetch" href="/vuebloger/assets/js/vendors~docsearch.1b4e1257.js">
    <link rel="stylesheet" href="/vuebloger/assets/css/0.styles.2e2748f8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/vuebloger/" class="home-link router-link-active"><img src="/vuebloger/img/logo.jpeg" alt="邹先生博客记录" class="logo"> <span class="site-name can-hide">邹先生博客记录</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/vuebloger/timeLine/" class="nav-link">首页</a></div><div class="nav-item"><a href="/vuebloger/technology/" class="nav-link router-link-active">技术</a></div><div class="nav-item"><a href="/vuebloger/life/" class="nav-link">生活</a></div><div class="nav-item"><a href="/vuebloger/workplace/" class="nav-link">职场</a></div><div class="nav-item"><a href="/vuebloger/bake/" class="nav-link">备忘</a></div><div class="nav-item"><a href="/vuebloger/tags/" class="nav-link">标签库</a></div><div class="nav-item"><a href="/vuebloger/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/vuebloger/massage/" class="nav-link">留言板</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">链接</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://gitee.com/xccjh" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Gitee
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/xccjh" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://nextjs.frontendx.cn/docs/#%E5%AE%89%E8%A3%85" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Nextjs
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://zh.nuxtjs.org/guide/installation" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Nuxtjs
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://angularjs.org/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  AngularJS
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://reactnative.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ReactNative
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="http://element-cn.eleme.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ElementUI
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://youzan.github.io/vant/#/zh-CN/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Vant
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://developer.mozilla.org/zh-CN/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  MDN
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="http://www.fontawesome.com.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Fontawesome
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://developers.weixin.qq.com/miniprogram/dev/index.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  MiniProgram
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://reacttraining.com/react-router/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  react-router-dom
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://webpack.js.org/concepts/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  webpack
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://www.babeljs.cn/docs/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  babel
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="http://eslint.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  eslint
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://www.swiper.com.cn/api/index.html/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  swiper
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="http://momentjs.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  momentjs
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://www.runoob.com/linux/linux-shell.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  shell
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://lodash.com/docs/4.17.15#template" target="_blank" rel="noopener noreferrer" class="nav-link external">
  lodash
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://koa.bootcss.com/#links" target="_blank" rel="noopener noreferrer" class="nav-link external">
  koa
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://jestjs.io/docs/en/getting-started" target="_blank" rel="noopener noreferrer" class="nav-link external">
  jest
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://aui.github.io/art-template/zh-cn/docs/index.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  art-template
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://ejs.bootcss.com/#docs" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ejs
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://www.layui.com/doc/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  layui
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://antv-g2.gitee.io/zh/examples/gallery" target="_blank" rel="noopener noreferrer" class="nav-link external">
  G2
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://www.echartsjs.com/zh/option.html#title" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ECharts
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://www.vagrantup.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  vagrant
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://docs.docker.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  docker
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="/vuebloger/technology/ https:/www.runoob.com/redis/redis-tutorial.html" class="nav-link">redis</a></li><li class="dropdown-item"><!----> <a href="https://www.runoob.com/mysql/mysql-tutorial.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  mysql
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://leafletjs.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  leaflet
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://www.tslang.cn/docs/home.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  TypeScript
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://docschina.org/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  印记中文
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav> <div style="margin-left:20px;margin-right:20px;">
    音乐
    <div role="switch" class="el-switch"><input type="checkbox" name="" true-value="true" class="el-switch__input"><!----><span class="el-switch__core" style="width:40px;"></span><!----></div> <audio><source src="/vuebloger/mp3/065b_520b_0409_111c898908eab454414c3c326fe77c36.mp3" type="audio/mpeg"></audio></div></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/vuebloger/timeLine/" class="nav-link">首页</a></div><div class="nav-item"><a href="/vuebloger/technology/" class="nav-link router-link-active">技术</a></div><div class="nav-item"><a href="/vuebloger/life/" class="nav-link">生活</a></div><div class="nav-item"><a href="/vuebloger/workplace/" class="nav-link">职场</a></div><div class="nav-item"><a href="/vuebloger/bake/" class="nav-link">备忘</a></div><div class="nav-item"><a href="/vuebloger/tags/" class="nav-link">标签库</a></div><div class="nav-item"><a href="/vuebloger/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/vuebloger/massage/" class="nav-link">留言板</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">链接</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://gitee.com/xccjh" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Gitee
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/xccjh" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://nextjs.frontendx.cn/docs/#%E5%AE%89%E8%A3%85" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Nextjs
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://zh.nuxtjs.org/guide/installation" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Nuxtjs
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://angularjs.org/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  AngularJS
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://reactnative.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ReactNative
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="http://element-cn.eleme.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ElementUI
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://youzan.github.io/vant/#/zh-CN/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Vant
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://developer.mozilla.org/zh-CN/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  MDN
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="http://www.fontawesome.com.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Fontawesome
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://developers.weixin.qq.com/miniprogram/dev/index.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  MiniProgram
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://reacttraining.com/react-router/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  react-router-dom
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://webpack.js.org/concepts/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  webpack
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://www.babeljs.cn/docs/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  babel
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="http://eslint.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  eslint
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://www.swiper.com.cn/api/index.html/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  swiper
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="http://momentjs.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  momentjs
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://www.runoob.com/linux/linux-shell.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  shell
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://lodash.com/docs/4.17.15#template" target="_blank" rel="noopener noreferrer" class="nav-link external">
  lodash
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://koa.bootcss.com/#links" target="_blank" rel="noopener noreferrer" class="nav-link external">
  koa
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://jestjs.io/docs/en/getting-started" target="_blank" rel="noopener noreferrer" class="nav-link external">
  jest
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://aui.github.io/art-template/zh-cn/docs/index.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  art-template
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://ejs.bootcss.com/#docs" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ejs
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://www.layui.com/doc/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  layui
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://antv-g2.gitee.io/zh/examples/gallery" target="_blank" rel="noopener noreferrer" class="nav-link external">
  G2
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://www.echartsjs.com/zh/option.html#title" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ECharts
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://www.vagrantup.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  vagrant
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://docs.docker.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  docker
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="/vuebloger/technology/ https:/www.runoob.com/redis/redis-tutorial.html" class="nav-link">redis</a></li><li class="dropdown-item"><!----> <a href="https://www.runoob.com/mysql/mysql-tutorial.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  mysql
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://leafletjs.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  leaflet
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://www.tslang.cn/docs/home.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  TypeScript
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://docschina.org/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  印记中文
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>react性能优化</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/vuebloger/technology/react%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96.html#受控性组件颗粒化" class="sidebar-link">受控性组件颗粒化</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vuebloger/technology/react%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96.html#建立独立的请求渲染单元" class="sidebar-link">建立独立的请求渲染单元</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vuebloger/technology/react%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96.html#memo-shouldcomponentupdate" class="sidebar-link">memo/shouldComponentUpdate</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuebloger/technology/react%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96.html#purecomponent-react-memo" class="sidebar-link">PureComponent/React.memo</a></li><li class="sidebar-sub-header"><a href="/vuebloger/technology/react%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96.html#shouldcomponentupdate" class="sidebar-link">shouldComponentUpdate</a></li><li class="sidebar-sub-header"><a href="/vuebloger/technology/react%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96.html#immetable-jsx" class="sidebar-link">immetable.jsx</a></li></ul></li><li><a href="/vuebloger/technology/react%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96.html#规范写法，合理处理细节问题" class="sidebar-link">规范写法，合理处理细节问题</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuebloger/technology/react%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96.html#绑定事件尽量不要使用箭头函数" class="sidebar-link">绑定事件尽量不要使用箭头函数</a></li><li class="sidebar-sub-header"><a href="/vuebloger/technology/react%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96.html#循环正确使用key" class="sidebar-link">循环正确使用key</a></li><li class="sidebar-sub-header"><a href="/vuebloger/technology/react%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96.html#usememo-避免重复声明" class="sidebar-link">useMemo 避免重复声明</a></li><li class="sidebar-sub-header"><a href="/vuebloger/technology/react%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96.html#懒加载-suspense-和-lazy" class="sidebar-link">懒加载 Suspense 和 lazy</a></li></ul></li><li><a href="/vuebloger/technology/react%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96.html#多种方式避免重复渲染" class="sidebar-link">多种方式避免重复渲染</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuebloger/technology/react%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96.html#学会使用的批量更新" class="sidebar-link">学会使用的批量更新</a></li><li class="sidebar-sub-header"><a href="/vuebloger/technology/react%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96.html#合并state" class="sidebar-link">合并state</a></li><li class="sidebar-sub-header"><a href="/vuebloger/technology/react%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96.html#usememo-react-memo隔离单元" class="sidebar-link">useMemo React.memo隔离单元</a></li><li class="sidebar-sub-header"><a href="/vuebloger/technology/react%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96.html#取缔state，学会使用缓存。" class="sidebar-link">取缔state，学会使用缓存。</a></li><li class="sidebar-sub-header"><a href="/vuebloger/technology/react%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96.html#usecallback回调" class="sidebar-link">useCallback回调</a></li></ul></li><li><a href="/vuebloger/technology/react%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96.html#海量数据优化-时间分片，虚拟列表" class="sidebar-link">海量数据优化-时间分片，虚拟列表</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuebloger/technology/react%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96.html#时间分片" class="sidebar-link">时间分片</a></li><li class="sidebar-sub-header"><a href="/vuebloger/technology/react%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96.html#虚拟列表" class="sidebar-link">虚拟列表</a></li></ul></li><li><a href="/vuebloger/technology/react%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96.html#usememo-usecallback" class="sidebar-link">useMemo/useCallback</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuebloger/technology/react%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96.html#usememo" class="sidebar-link">useMemo</a></li><li class="sidebar-sub-header"><a href="/vuebloger/technology/react%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96.html#usecallback" class="sidebar-link">useCallback</a></li><li class="sidebar-sub-header"><a href="/vuebloger/technology/react%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96.html#usememo当usecallback" class="sidebar-link">useMemo当useCallback</a></li></ul></li><li><a href="/vuebloger/technology/react%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96.html#usecallback使用场景" class="sidebar-link">useCallback使用场景</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vuebloger/technology/react%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96.html#路由懒加载，路由监听器" class="sidebar-link">路由懒加载，路由监听器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuebloger/technology/react%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96.html#传统路由" class="sidebar-link">传统路由</a></li><li class="sidebar-sub-header"><a href="/vuebloger/technology/react%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96.html#asyncrouter懒加载-并实现路由监听" class="sidebar-link">asyncRouter懒加载,并实现路由监听</a></li></ul></li></ul></div></li></ul> </div> <div class="page"> <div class="content__default" data-v-343c80ca data-v-343c80ca><h2 id="受控性组件颗粒化" data-v-343c80ca><a href="#受控性组件颗粒化" class="header-anchor" data-v-343c80ca>#</a> 受控性组件颗粒化</h2> <p data-v-343c80ca>可控性组件和非可控性的区别就是dom元素值是否与受到react数据状态state控制。一旦由react的state控制数据状态，比如input输入框的值，就会造成这样一个场景，为了使input值实时变化，会不断setState，就会不断触发render函数，如果父组件内容简单还好，如果父组件比较复杂，会造成牵一发动全身，如果其他的子组件中componentWillReceiveProps这种带有副作用的钩子，那么引发的蝴蝶效应不敢想象。比如如下demo。</p> <div class="language-jsx line-numbers-mode" data-v-343c80ca><pre class="language-jsx" data-v-343c80ca><code data-v-343c80ca><span class="token keyword" data-v-343c80ca>class</span> <span class="token class-name" data-v-343c80ca>index</span> <span class="token keyword" data-v-343c80ca>extends</span> <span class="token class-name" data-v-343c80ca>React<span class="token punctuation" data-v-343c80ca>.</span>Component</span><span class="token operator" data-v-343c80ca>&lt;</span>any<span class="token punctuation" data-v-343c80ca>,</span>any<span class="token operator" data-v-343c80ca>&gt;</span><span class="token punctuation" data-v-343c80ca>{</span>
    <span class="token function" data-v-343c80ca>constructor</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token parameter" data-v-343c80ca>props</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>{</span>
        <span class="token keyword" data-v-343c80ca>super</span><span class="token punctuation" data-v-343c80ca>(</span>props<span class="token punctuation" data-v-343c80ca>)</span>
        <span class="token keyword" data-v-343c80ca>this</span><span class="token punctuation" data-v-343c80ca>.</span>state<span class="token operator" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span>
            inputValue<span class="token operator" data-v-343c80ca>:</span><span class="token string" data-v-343c80ca>''</span>
        <span class="token punctuation" data-v-343c80ca>}</span>
    <span class="token punctuation" data-v-343c80ca>}</span>
    <span class="token function-variable function" data-v-343c80ca>handerChange</span><span class="token operator" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token parameter" data-v-343c80ca>e</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token operator" data-v-343c80ca>=&gt;</span> <span class="token keyword" data-v-343c80ca>this</span><span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>setState</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>{</span> inputValue<span class="token operator" data-v-343c80ca>:</span>e<span class="token punctuation" data-v-343c80ca>.</span>target<span class="token punctuation" data-v-343c80ca>.</span>value  <span class="token punctuation" data-v-343c80ca>}</span><span class="token punctuation" data-v-343c80ca>)</span>
    <span class="token function" data-v-343c80ca>render</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>{</span>
        <span class="token keyword" data-v-343c80ca>const</span> <span class="token punctuation" data-v-343c80ca>{</span> inputValue <span class="token punctuation" data-v-343c80ca>}</span> <span class="token operator" data-v-343c80ca>=</span> <span class="token keyword" data-v-343c80ca>this</span><span class="token punctuation" data-v-343c80ca>.</span>state
        <span class="token keyword" data-v-343c80ca>return</span> <span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
            </span><span class="token punctuation" data-v-343c80ca>{</span> <span class="token comment" data-v-343c80ca>/*  我们增加三个子组件 */</span> <span class="token punctuation" data-v-343c80ca>}</span><span class="token plain-text" data-v-343c80ca>
            </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span><span class="token class-name" data-v-343c80ca>ComA</span></span> <span class="token punctuation" data-v-343c80ca>/&gt;</span></span><span class="token plain-text" data-v-343c80ca>
            </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span><span class="token class-name" data-v-343c80ca>ComB</span></span> <span class="token punctuation" data-v-343c80ca>/&gt;</span></span><span class="token plain-text" data-v-343c80ca>
            </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span><span class="token class-name" data-v-343c80ca>ComC</span></span> <span class="token punctuation" data-v-343c80ca>/&gt;</span></span><span class="token plain-text" data-v-343c80ca>
            </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>div</span> <span class="token attr-name" data-v-343c80ca>className</span><span class="token attr-value" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>&quot;</span>box<span class="token punctuation" data-v-343c80ca>&quot;</span></span> <span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
                </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span><span class="token class-name" data-v-343c80ca>Input</span></span>  <span class="token attr-name" data-v-343c80ca>value</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span>inputValue<span class="token punctuation" data-v-343c80ca>}</span></span>  <span class="token attr-name" data-v-343c80ca>onChange</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span> <span class="token punctuation" data-v-343c80ca>(</span><span class="token parameter" data-v-343c80ca>e</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token operator" data-v-343c80ca>=&gt;</span> <span class="token keyword" data-v-343c80ca>this</span><span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>handerChange</span><span class="token punctuation" data-v-343c80ca>(</span>e<span class="token punctuation" data-v-343c80ca>)</span> <span class="token punctuation" data-v-343c80ca>}</span></span> <span class="token punctuation" data-v-343c80ca>/&gt;</span></span><span class="token plain-text" data-v-343c80ca>
            </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
            </span><span class="token punctuation" data-v-343c80ca>{</span><span class="token comment" data-v-343c80ca>/* 我们首先来一个列表循环 */</span><span class="token punctuation" data-v-343c80ca>}</span><span class="token plain-text" data-v-343c80ca>
            </span><span class="token punctuation" data-v-343c80ca>{</span>
                <span class="token keyword" data-v-343c80ca>new</span> <span class="token class-name" data-v-343c80ca>Array</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token number" data-v-343c80ca>10</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>fill</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token number" data-v-343c80ca>0</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>map</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token parameter" data-v-343c80ca>item<span class="token punctuation" data-v-343c80ca>,</span>index</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token operator" data-v-343c80ca>=&gt;</span><span class="token punctuation" data-v-343c80ca>{</span>
                    console<span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>log</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token string" data-v-343c80ca>'列表循环了'</span> <span class="token punctuation" data-v-343c80ca>)</span>
                    <span class="token keyword" data-v-343c80ca>return</span> <span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>div</span> <span class="token attr-name" data-v-343c80ca>key</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span>index<span class="token punctuation" data-v-343c80ca>}</span></span> <span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token punctuation" data-v-343c80ca>{</span>item<span class="token punctuation" data-v-343c80ca>}</span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span>
                <span class="token punctuation" data-v-343c80ca>}</span><span class="token punctuation" data-v-343c80ca>)</span>
            <span class="token punctuation" data-v-343c80ca>}</span><span class="token plain-text" data-v-343c80ca>
            </span><span class="token punctuation" data-v-343c80ca>{</span>
              <span class="token comment" data-v-343c80ca>/* 这里可能是更复杂的结构 */</span>
              <span class="token comment" data-v-343c80ca>/* ------------------ */</span>
            <span class="token punctuation" data-v-343c80ca>}</span><span class="token plain-text" data-v-343c80ca>
        </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span>
    <span class="token punctuation" data-v-343c80ca>}</span>
<span class="token punctuation" data-v-343c80ca>}</span>

</code></pre> <div class="line-numbers-wrapper" data-v-343c80ca><span class="line-number" data-v-343c80ca>1</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>2</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>3</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>4</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>5</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>6</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>7</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>8</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>9</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>10</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>11</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>12</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>13</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>14</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>15</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>16</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>17</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>18</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>19</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>20</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>21</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>22</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>23</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>24</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>25</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>26</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>27</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>28</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>29</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>30</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>31</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>32</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>33</span><br data-v-343c80ca></div></div><blockquote data-v-343c80ca><p data-v-343c80ca>组件A</p></blockquote> <div class="language-jsx line-numbers-mode" data-v-343c80ca><pre class="language-jsx" data-v-343c80ca><code data-v-343c80ca><span class="token keyword" data-v-343c80ca>function</span> <span class="token function" data-v-343c80ca>index</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>{</span>
    console<span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>log</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token string" data-v-343c80ca>'组件A渲染'</span><span class="token punctuation" data-v-343c80ca>)</span>
   <span class="token keyword" data-v-343c80ca>return</span> <span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>我是组件A</span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span>
<span class="token punctuation" data-v-343c80ca>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-343c80ca><span class="line-number" data-v-343c80ca>1</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>2</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>3</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>4</span><br data-v-343c80ca></div></div><blockquote data-v-343c80ca><p data-v-343c80ca>组件B，有一个componentWillReceiveProps钩子</p></blockquote> <div class="language-jsx line-numbers-mode" data-v-343c80ca><pre class="language-jsx" data-v-343c80ca><code data-v-343c80ca><span class="token keyword" data-v-343c80ca>class</span> <span class="token class-name" data-v-343c80ca>Index</span> <span class="token keyword" data-v-343c80ca>extends</span> <span class="token class-name" data-v-343c80ca>React<span class="token punctuation" data-v-343c80ca>.</span>Component</span><span class="token punctuation" data-v-343c80ca>{</span>
    <span class="token function" data-v-343c80ca>constructor</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token parameter" data-v-343c80ca>props</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>{</span>
        <span class="token keyword" data-v-343c80ca>super</span><span class="token punctuation" data-v-343c80ca>(</span>props<span class="token punctuation" data-v-343c80ca>)</span>
    <span class="token punctuation" data-v-343c80ca>}</span>
    <span class="token function" data-v-343c80ca>componentWillReceiveProps</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>{</span>
        console<span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>log</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token string" data-v-343c80ca>'componentWillReceiveProps执行'</span><span class="token punctuation" data-v-343c80ca>)</span>
        <span class="token comment" data-v-343c80ca>/* 可能做一些骚操作 wu lian */</span>
    <span class="token punctuation" data-v-343c80ca>}</span>
    <span class="token function" data-v-343c80ca>render</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>{</span>
        console<span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>log</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token string" data-v-343c80ca>'组件B渲染'</span><span class="token punctuation" data-v-343c80ca>)</span>
        <span class="token keyword" data-v-343c80ca>return</span> <span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
            我是组件B
        </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span>
    <span class="token punctuation" data-v-343c80ca>}</span>
<span class="token punctuation" data-v-343c80ca>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-343c80ca><span class="line-number" data-v-343c80ca>1</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>2</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>3</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>4</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>5</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>6</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>7</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>8</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>9</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>10</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>11</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>12</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>13</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>14</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>15</span><br data-v-343c80ca></div></div><blockquote data-v-343c80ca><p data-v-343c80ca>组件C有一个列表循环</p></blockquote> <div class="language-jsx line-numbers-mode" data-v-343c80ca><pre class="language-jsx" data-v-343c80ca><code data-v-343c80ca><span class="token keyword" data-v-343c80ca>class</span> <span class="token class-name" data-v-343c80ca>Index</span> <span class="token keyword" data-v-343c80ca>extends</span> <span class="token class-name" data-v-343c80ca>React<span class="token punctuation" data-v-343c80ca>.</span>Component</span><span class="token punctuation" data-v-343c80ca>{</span>
    <span class="token function" data-v-343c80ca>constructor</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token parameter" data-v-343c80ca>props</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>{</span>
        <span class="token keyword" data-v-343c80ca>super</span><span class="token punctuation" data-v-343c80ca>(</span>props<span class="token punctuation" data-v-343c80ca>)</span>
    <span class="token punctuation" data-v-343c80ca>}</span>

    <span class="token function" data-v-343c80ca>render</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>{</span>
        console<span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>log</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token string" data-v-343c80ca>'组件c渲染'</span><span class="token punctuation" data-v-343c80ca>)</span>
        <span class="token keyword" data-v-343c80ca>return</span> <span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
              我是组件c
             </span><span class="token punctuation" data-v-343c80ca>{</span>
                <span class="token keyword" data-v-343c80ca>new</span> <span class="token class-name" data-v-343c80ca>Array</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token number" data-v-343c80ca>10</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>fill</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token number" data-v-343c80ca>0</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>map</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token parameter" data-v-343c80ca>item<span class="token punctuation" data-v-343c80ca>,</span>index</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token operator" data-v-343c80ca>=&gt;</span><span class="token punctuation" data-v-343c80ca>{</span>
                    console<span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>log</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token string" data-v-343c80ca>'组件C列表循环了'</span> <span class="token punctuation" data-v-343c80ca>)</span>
                    <span class="token keyword" data-v-343c80ca>return</span> <span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>div</span> <span class="token attr-name" data-v-343c80ca>key</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span>index<span class="token punctuation" data-v-343c80ca>}</span></span> <span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token punctuation" data-v-343c80ca>{</span>item<span class="token punctuation" data-v-343c80ca>}</span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span>
                <span class="token punctuation" data-v-343c80ca>}</span><span class="token punctuation" data-v-343c80ca>)</span>
            <span class="token punctuation" data-v-343c80ca>}</span><span class="token plain-text" data-v-343c80ca>
        </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span>
    <span class="token punctuation" data-v-343c80ca>}</span>
<span class="token punctuation" data-v-343c80ca>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-343c80ca><span class="line-number" data-v-343c80ca>1</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>2</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>3</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>4</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>5</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>6</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>7</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>8</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>9</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>10</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>11</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>12</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>13</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>14</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>15</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>16</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>17</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>18</span><br data-v-343c80ca></div></div><p data-v-343c80ca>效果:</p> <p data-v-343c80ca><img src="/vuebloger/img/post/asdasdad.gif" alt="" data-v-343c80ca></p> <p data-v-343c80ca>当我们在input输入内容的时候。就会造成如上的现象，所有的不该重新更新的地方，全部重新执行了一遍，这无疑是巨大的性能损耗。这个一个setState触发带来的一股巨大的由此组件到子组件可能更深的更新流，带来的副作用是不可估量的。所以我们可以思考一下，是否将这种受控性组件颗粒化，让自己更新 -&gt; 渲染过程由自身调度。我们对上面的input表单单独颗粒化处理。</p> <div class="language-jsx line-numbers-mode" data-v-343c80ca><pre class="language-jsx" data-v-343c80ca><code data-v-343c80ca><span class="token keyword" data-v-343c80ca>const</span> ComponentInput <span class="token operator" data-v-343c80ca>=</span> <span class="token function" data-v-343c80ca>memo</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token keyword" data-v-343c80ca>function</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token parameter" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>{</span> notifyFatherChange <span class="token punctuation" data-v-343c80ca>}</span><span class="token operator" data-v-343c80ca>:</span>any</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>{</span>
    <span class="token keyword" data-v-343c80ca>const</span> <span class="token punctuation" data-v-343c80ca>[</span> inputValue <span class="token punctuation" data-v-343c80ca>,</span> setInputValue <span class="token punctuation" data-v-343c80ca>]</span> <span class="token operator" data-v-343c80ca>=</span> <span class="token function" data-v-343c80ca>useState</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token string" data-v-343c80ca>''</span><span class="token punctuation" data-v-343c80ca>)</span>
    <span class="token keyword" data-v-343c80ca>const</span> handerChange <span class="token operator" data-v-343c80ca>=</span> <span class="token function" data-v-343c80ca>useMemo</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span> <span class="token operator" data-v-343c80ca>=&gt;</span> <span class="token punctuation" data-v-343c80ca>(</span><span class="token parameter" data-v-343c80ca>e</span><span class="token punctuation" data-v-343c80ca>)</span> <span class="token operator" data-v-343c80ca>=&gt;</span> <span class="token punctuation" data-v-343c80ca>{</span>
        <span class="token function" data-v-343c80ca>setInputValue</span><span class="token punctuation" data-v-343c80ca>(</span>e<span class="token punctuation" data-v-343c80ca>.</span>target<span class="token punctuation" data-v-343c80ca>.</span>value<span class="token punctuation" data-v-343c80ca>)</span>
        notifyFatherChange <span class="token operator" data-v-343c80ca>&amp;&amp;</span> <span class="token function" data-v-343c80ca>notifyFatherChange</span><span class="token punctuation" data-v-343c80ca>(</span>e<span class="token punctuation" data-v-343c80ca>.</span>target<span class="token punctuation" data-v-343c80ca>.</span>value<span class="token punctuation" data-v-343c80ca>)</span>
    <span class="token punctuation" data-v-343c80ca>}</span><span class="token punctuation" data-v-343c80ca>,</span><span class="token punctuation" data-v-343c80ca>[</span><span class="token punctuation" data-v-343c80ca>]</span><span class="token punctuation" data-v-343c80ca>)</span>
    <span class="token keyword" data-v-343c80ca>return</span> <span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span><span class="token class-name" data-v-343c80ca>Input</span></span>   <span class="token attr-name" data-v-343c80ca>value</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span>inputValue<span class="token punctuation" data-v-343c80ca>}</span></span> <span class="token attr-name" data-v-343c80ca>onChange</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span> handerChange  <span class="token punctuation" data-v-343c80ca>}</span></span>  <span class="token punctuation" data-v-343c80ca>/&gt;</span></span>
<span class="token punctuation" data-v-343c80ca>}</span><span class="token punctuation" data-v-343c80ca>)</span>
</code></pre> <div class="line-numbers-wrapper" data-v-343c80ca><span class="line-number" data-v-343c80ca>1</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>2</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>3</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>4</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>5</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>6</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>7</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>8</span><br data-v-343c80ca></div></div><p data-v-343c80ca>此时的组件更新由组件单元自行控制，不需要父组件的更新，所以不需要父组件设置独立state保留状态。只需要绑定到this上即可。不是所有状态都应该放在组件的 state 中. 例如缓存数据。如果需要组件响应它的变动, 或者需要渲染到视图中的数据才应该放到 state 中。这样可以避免不必要的数据变动导致组件重新渲染.</p> <div class="language-jsx line-numbers-mode" data-v-343c80ca><pre class="language-jsx" data-v-343c80ca><code data-v-343c80ca><span class="token keyword" data-v-343c80ca>class</span> <span class="token class-name" data-v-343c80ca>index</span> <span class="token keyword" data-v-343c80ca>extends</span> <span class="token class-name" data-v-343c80ca>React<span class="token punctuation" data-v-343c80ca>.</span>Component</span><span class="token operator" data-v-343c80ca>&lt;</span>any<span class="token punctuation" data-v-343c80ca>,</span>any<span class="token operator" data-v-343c80ca>&gt;</span><span class="token punctuation" data-v-343c80ca>{</span>   
    formData <span class="token operator" data-v-343c80ca>:</span>any <span class="token operator" data-v-343c80ca>=</span> <span class="token punctuation" data-v-343c80ca>{</span><span class="token punctuation" data-v-343c80ca>}</span>
    <span class="token function" data-v-343c80ca>render</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>{</span>
        <span class="token keyword" data-v-343c80ca>return</span> <span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
            </span><span class="token punctuation" data-v-343c80ca>{</span> <span class="token comment" data-v-343c80ca>/*  我们增加三个子组件 */</span> <span class="token punctuation" data-v-343c80ca>}</span><span class="token plain-text" data-v-343c80ca>
            </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span><span class="token class-name" data-v-343c80ca>ComA</span></span> <span class="token punctuation" data-v-343c80ca>/&gt;</span></span><span class="token plain-text" data-v-343c80ca>
            </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span><span class="token class-name" data-v-343c80ca>ComB</span></span> <span class="token punctuation" data-v-343c80ca>/&gt;</span></span><span class="token plain-text" data-v-343c80ca>
            </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span><span class="token class-name" data-v-343c80ca>ComC</span></span> <span class="token punctuation" data-v-343c80ca>/&gt;</span></span><span class="token plain-text" data-v-343c80ca>
            </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>div</span> <span class="token attr-name" data-v-343c80ca>className</span><span class="token attr-value" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>&quot;</span>box<span class="token punctuation" data-v-343c80ca>&quot;</span></span> <span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
               </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span><span class="token class-name" data-v-343c80ca>ComponentInput</span></span> <span class="token attr-name" data-v-343c80ca>notifyFatherChange</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span> <span class="token punctuation" data-v-343c80ca>(</span><span class="token parameter" data-v-343c80ca>value</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token operator" data-v-343c80ca>=&gt;</span><span class="token punctuation" data-v-343c80ca>{</span> <span class="token keyword" data-v-343c80ca>this</span><span class="token punctuation" data-v-343c80ca>.</span>formData<span class="token punctuation" data-v-343c80ca>.</span>inputValue <span class="token operator" data-v-343c80ca>=</span> value <span class="token punctuation" data-v-343c80ca>}</span> <span class="token punctuation" data-v-343c80ca>}</span></span>  <span class="token punctuation" data-v-343c80ca>/&gt;</span></span><span class="token plain-text" data-v-343c80ca>
               </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span><span class="token class-name" data-v-343c80ca>Button</span></span> <span class="token attr-name" data-v-343c80ca>onClick</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token operator" data-v-343c80ca>=&gt;</span> console<span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>log</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token keyword" data-v-343c80ca>this</span><span class="token punctuation" data-v-343c80ca>.</span>formData<span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>}</span></span> <span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>打印数据</span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span><span class="token class-name" data-v-343c80ca>Button</span></span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
            </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
            </span><span class="token punctuation" data-v-343c80ca>{</span><span class="token comment" data-v-343c80ca>/* 我们首先来一个列表循环 */</span><span class="token punctuation" data-v-343c80ca>}</span><span class="token plain-text" data-v-343c80ca>
            </span><span class="token punctuation" data-v-343c80ca>{</span>
                <span class="token keyword" data-v-343c80ca>new</span> <span class="token class-name" data-v-343c80ca>Array</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token number" data-v-343c80ca>10</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>fill</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token number" data-v-343c80ca>0</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>map</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token parameter" data-v-343c80ca>item<span class="token punctuation" data-v-343c80ca>,</span>index</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token operator" data-v-343c80ca>=&gt;</span><span class="token punctuation" data-v-343c80ca>{</span>
                    console<span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>log</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token string" data-v-343c80ca>'列表循环了'</span> <span class="token punctuation" data-v-343c80ca>)</span>
                    <span class="token keyword" data-v-343c80ca>return</span> <span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>div</span> <span class="token attr-name" data-v-343c80ca>key</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span>index<span class="token punctuation" data-v-343c80ca>}</span></span> <span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token punctuation" data-v-343c80ca>{</span>item<span class="token punctuation" data-v-343c80ca>}</span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span>
                <span class="token punctuation" data-v-343c80ca>}</span><span class="token punctuation" data-v-343c80ca>)</span>
            <span class="token punctuation" data-v-343c80ca>}</span><span class="token plain-text" data-v-343c80ca>
            </span><span class="token punctuation" data-v-343c80ca>{</span>
              <span class="token comment" data-v-343c80ca>/* 这里可能是更复杂的结构 */</span>
              <span class="token comment" data-v-343c80ca>/* ------------------ */</span>
            <span class="token punctuation" data-v-343c80ca>}</span><span class="token plain-text" data-v-343c80ca>
        </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span>
    <span class="token punctuation" data-v-343c80ca>}</span>
<span class="token punctuation" data-v-343c80ca>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-343c80ca><span class="line-number" data-v-343c80ca>1</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>2</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>3</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>4</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>5</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>6</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>7</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>8</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>9</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>10</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>11</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>12</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>13</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>14</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>15</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>16</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>17</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>18</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>19</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>20</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>21</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>22</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>23</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>24</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>25</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>26</span><br data-v-343c80ca></div></div><p data-v-343c80ca>效果:
</p><div style="width:1200px;margin:auto;" data-v-343c80ca><img src="/vuebloger/img/post/asdasdaasd.gif" alt="" data-v-343c80ca></div><p data-v-343c80ca></p> <p data-v-343c80ca>这样除了当前组件外，其他地方没有收到任何渲染波动，达到了我们想要的目的。</p> <h2 id="建立独立的请求渲染单元" data-v-343c80ca><a href="#建立独立的请求渲染单元" class="header-anchor" data-v-343c80ca>#</a> 建立独立的请求渲染单元</h2> <p data-v-343c80ca>建立独立的请求渲染单元，直接理解就是，如果我们把页面，分为请求数据展示部分(通过调用后端接口，获取数据)，和基础部分(不需要请求数据，已经直接写好的)，对于一些逻辑交互不是很复杂的数据展示部分，我推荐用一种独立组件，独立请求数据，独立控制渲染的模式。至于为什么我们可以慢慢分析。</p> <p data-v-343c80ca>首先我们看一下传统的页面模式。
</p><div style="width:800px;margin:auto;" data-v-343c80ca><img src="/vuebloger/img/post/Snipaste_2021-10-05_14-28-16.jpg" alt="" data-v-343c80ca></div>
页面有三个展示区域分别，做了三次请求，触发了三次setState,渲染三次页面，即使用Promise.all等方法，但是也不保证接下来交互中，会有部分展示区重新拉取数据的可能。一旦有一个区域重新拉取数据，另外两个区域也会说、受到牵连，这种效应是不可避免的，即便react有很好的ddiff算法去调协相同的节点，但是比如长列表等情况，循环在所难免。<p data-v-343c80ca></p> <div class="language-jsx line-numbers-mode" data-v-343c80ca><pre class="language-jsx" data-v-343c80ca><code data-v-343c80ca><span class="token keyword" data-v-343c80ca>class</span> <span class="token class-name" data-v-343c80ca>Index</span> <span class="token keyword" data-v-343c80ca>extends</span> <span class="token class-name" data-v-343c80ca>React<span class="token punctuation" data-v-343c80ca>.</span>Component</span><span class="token punctuation" data-v-343c80ca>{</span>
    state <span class="token operator" data-v-343c80ca>:</span>any<span class="token operator" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span>
        dataA<span class="token operator" data-v-343c80ca>:</span><span class="token keyword" data-v-343c80ca>null</span><span class="token punctuation" data-v-343c80ca>,</span>
        dataB<span class="token operator" data-v-343c80ca>:</span><span class="token keyword" data-v-343c80ca>null</span><span class="token punctuation" data-v-343c80ca>,</span>
        dataC<span class="token operator" data-v-343c80ca>:</span><span class="token keyword" data-v-343c80ca>null</span>
    <span class="token punctuation" data-v-343c80ca>}</span>
    <span class="token keyword" data-v-343c80ca>async</span> <span class="token function" data-v-343c80ca>componentDidMount</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>{</span>
        <span class="token comment" data-v-343c80ca>/* 获取A区域数据 */</span>
        <span class="token keyword" data-v-343c80ca>const</span> dataA <span class="token operator" data-v-343c80ca>=</span> <span class="token keyword" data-v-343c80ca>await</span> <span class="token function" data-v-343c80ca>getDataA</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span>
        <span class="token keyword" data-v-343c80ca>this</span><span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>setState</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>{</span> dataA <span class="token punctuation" data-v-343c80ca>}</span><span class="token punctuation" data-v-343c80ca>)</span>
        <span class="token comment" data-v-343c80ca>/* 获取B区域数据 */</span>
        <span class="token keyword" data-v-343c80ca>const</span> dataB <span class="token operator" data-v-343c80ca>=</span> <span class="token keyword" data-v-343c80ca>await</span> <span class="token function" data-v-343c80ca>getDataB</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span>
        <span class="token keyword" data-v-343c80ca>this</span><span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>setState</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>{</span> dataB <span class="token punctuation" data-v-343c80ca>}</span><span class="token punctuation" data-v-343c80ca>)</span>
        <span class="token comment" data-v-343c80ca>/* 获取C区域数据 */</span>
        <span class="token keyword" data-v-343c80ca>const</span> dataC <span class="token operator" data-v-343c80ca>=</span> <span class="token keyword" data-v-343c80ca>await</span> <span class="token function" data-v-343c80ca>getDataC</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span>
        <span class="token keyword" data-v-343c80ca>this</span><span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>setState</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>{</span> dataC <span class="token punctuation" data-v-343c80ca>}</span><span class="token punctuation" data-v-343c80ca>)</span>
    <span class="token punctuation" data-v-343c80ca>}</span>
    <span class="token function" data-v-343c80ca>render</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>{</span>
        <span class="token keyword" data-v-343c80ca>const</span> <span class="token punctuation" data-v-343c80ca>{</span> dataA <span class="token punctuation" data-v-343c80ca>,</span> dataB <span class="token punctuation" data-v-343c80ca>,</span> dataC <span class="token punctuation" data-v-343c80ca>}</span> <span class="token operator" data-v-343c80ca>=</span> <span class="token keyword" data-v-343c80ca>this</span><span class="token punctuation" data-v-343c80ca>.</span>state
        console<span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>log</span><span class="token punctuation" data-v-343c80ca>(</span>dataA<span class="token punctuation" data-v-343c80ca>,</span>dataB<span class="token punctuation" data-v-343c80ca>,</span>dataC<span class="token punctuation" data-v-343c80ca>)</span>
        <span class="token keyword" data-v-343c80ca>return</span> <span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
            </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca> </span><span class="token punctuation" data-v-343c80ca>{</span> <span class="token comment" data-v-343c80ca>/* 用 dataA 数据做展示渲染 */</span> <span class="token punctuation" data-v-343c80ca>}</span><span class="token plain-text" data-v-343c80ca> </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
            </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca> </span><span class="token punctuation" data-v-343c80ca>{</span> <span class="token comment" data-v-343c80ca>/* 用 dataB 数据做展示渲染 */</span> <span class="token punctuation" data-v-343c80ca>}</span><span class="token plain-text" data-v-343c80ca> </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
            </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca> </span><span class="token punctuation" data-v-343c80ca>{</span> <span class="token comment" data-v-343c80ca>/* 用 dataC 数据做展示渲染 */</span> <span class="token punctuation" data-v-343c80ca>}</span><span class="token plain-text" data-v-343c80ca> </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
        </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span>
    <span class="token punctuation" data-v-343c80ca>}</span>
<span class="token punctuation" data-v-343c80ca>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-343c80ca><span class="line-number" data-v-343c80ca>1</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>2</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>3</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>4</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>5</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>6</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>7</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>8</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>9</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>10</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>11</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>12</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>13</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>14</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>15</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>16</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>17</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>18</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>19</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>20</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>21</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>22</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>23</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>24</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>25</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>26</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>27</span><br data-v-343c80ca></div></div><p data-v-343c80ca>接下来我们，把每一部分抽取出来，形成独立的渲染单元，每个组件都独立数据请求到独立渲染。</p> <div class="language-jsx line-numbers-mode" data-v-343c80ca><pre class="language-jsx" data-v-343c80ca><code data-v-343c80ca><span class="token keyword" data-v-343c80ca>function</span> <span class="token function" data-v-343c80ca>ComponentA</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>{</span>
    <span class="token keyword" data-v-343c80ca>const</span> <span class="token punctuation" data-v-343c80ca>[</span> dataA<span class="token punctuation" data-v-343c80ca>,</span> setDataA <span class="token punctuation" data-v-343c80ca>]</span> <span class="token operator" data-v-343c80ca>=</span> <span class="token function" data-v-343c80ca>useState</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token keyword" data-v-343c80ca>null</span><span class="token punctuation" data-v-343c80ca>)</span>
    <span class="token function" data-v-343c80ca>useEffect</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token operator" data-v-343c80ca>=&gt;</span><span class="token punctuation" data-v-343c80ca>{</span>
       <span class="token function" data-v-343c80ca>getDataA</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>then</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token parameter" data-v-343c80ca>res</span><span class="token operator" data-v-343c80ca>=&gt;</span> <span class="token function" data-v-343c80ca>setDataA</span><span class="token punctuation" data-v-343c80ca>(</span>res<span class="token punctuation" data-v-343c80ca>.</span>data<span class="token punctuation" data-v-343c80ca>)</span>  <span class="token punctuation" data-v-343c80ca>)</span>
    <span class="token punctuation" data-v-343c80ca>}</span><span class="token punctuation" data-v-343c80ca>,</span><span class="token punctuation" data-v-343c80ca>[</span><span class="token punctuation" data-v-343c80ca>]</span><span class="token punctuation" data-v-343c80ca>)</span>
    <span class="token keyword" data-v-343c80ca>return</span>  <span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca> </span><span class="token punctuation" data-v-343c80ca>{</span> <span class="token comment" data-v-343c80ca>/* 用 dataA 数据做展示渲染 */</span> <span class="token punctuation" data-v-343c80ca>}</span><span class="token plain-text" data-v-343c80ca> </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span>
<span class="token punctuation" data-v-343c80ca>}</span> 

<span class="token keyword" data-v-343c80ca>function</span> <span class="token function" data-v-343c80ca>ComponentB</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>{</span>
    <span class="token keyword" data-v-343c80ca>const</span> <span class="token punctuation" data-v-343c80ca>[</span> dataB<span class="token punctuation" data-v-343c80ca>,</span> setDataB <span class="token punctuation" data-v-343c80ca>]</span> <span class="token operator" data-v-343c80ca>=</span> <span class="token function" data-v-343c80ca>useState</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token keyword" data-v-343c80ca>null</span><span class="token punctuation" data-v-343c80ca>)</span>
    <span class="token function" data-v-343c80ca>useEffect</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token operator" data-v-343c80ca>=&gt;</span><span class="token punctuation" data-v-343c80ca>{</span>
       <span class="token function" data-v-343c80ca>getDataB</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>then</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token parameter" data-v-343c80ca>res</span><span class="token operator" data-v-343c80ca>=&gt;</span> <span class="token function" data-v-343c80ca>setDataB</span><span class="token punctuation" data-v-343c80ca>(</span>res<span class="token punctuation" data-v-343c80ca>.</span>data<span class="token punctuation" data-v-343c80ca>)</span>  <span class="token punctuation" data-v-343c80ca>)</span>
    <span class="token punctuation" data-v-343c80ca>}</span><span class="token punctuation" data-v-343c80ca>,</span><span class="token punctuation" data-v-343c80ca>[</span><span class="token punctuation" data-v-343c80ca>]</span><span class="token punctuation" data-v-343c80ca>)</span>
    <span class="token keyword" data-v-343c80ca>return</span>  <span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca> </span><span class="token punctuation" data-v-343c80ca>{</span> <span class="token comment" data-v-343c80ca>/* 用 dataB 数据做展示渲染 */</span> <span class="token punctuation" data-v-343c80ca>}</span><span class="token plain-text" data-v-343c80ca> </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span>
<span class="token punctuation" data-v-343c80ca>}</span> 

<span class="token keyword" data-v-343c80ca>function</span> <span class="token function" data-v-343c80ca>ComponentC</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>{</span>
    <span class="token keyword" data-v-343c80ca>const</span> <span class="token punctuation" data-v-343c80ca>[</span> dataC<span class="token punctuation" data-v-343c80ca>,</span> setDataC <span class="token punctuation" data-v-343c80ca>]</span> <span class="token operator" data-v-343c80ca>=</span> <span class="token function" data-v-343c80ca>useState</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token keyword" data-v-343c80ca>null</span><span class="token punctuation" data-v-343c80ca>)</span>
    <span class="token function" data-v-343c80ca>useEffect</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token operator" data-v-343c80ca>=&gt;</span><span class="token punctuation" data-v-343c80ca>{</span>
       <span class="token function" data-v-343c80ca>getDataC</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>then</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token parameter" data-v-343c80ca>res</span><span class="token operator" data-v-343c80ca>=&gt;</span> <span class="token function" data-v-343c80ca>setDataC</span><span class="token punctuation" data-v-343c80ca>(</span>res<span class="token punctuation" data-v-343c80ca>.</span>data<span class="token punctuation" data-v-343c80ca>)</span>  <span class="token punctuation" data-v-343c80ca>)</span>
    <span class="token punctuation" data-v-343c80ca>}</span><span class="token punctuation" data-v-343c80ca>,</span><span class="token punctuation" data-v-343c80ca>[</span><span class="token punctuation" data-v-343c80ca>]</span><span class="token punctuation" data-v-343c80ca>)</span>
    <span class="token keyword" data-v-343c80ca>return</span>  <span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca> </span><span class="token punctuation" data-v-343c80ca>{</span> <span class="token comment" data-v-343c80ca>/* 用 dataC 数据做展示渲染 */</span> <span class="token punctuation" data-v-343c80ca>}</span><span class="token plain-text" data-v-343c80ca> </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span>
<span class="token punctuation" data-v-343c80ca>}</span>  

<span class="token keyword" data-v-343c80ca>function</span> <span class="token function" data-v-343c80ca>Index</span> <span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>{</span>
    <span class="token keyword" data-v-343c80ca>return</span> <span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
        </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span><span class="token class-name" data-v-343c80ca>ComponentA</span></span> <span class="token punctuation" data-v-343c80ca>/&gt;</span></span><span class="token plain-text" data-v-343c80ca>
        </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span><span class="token class-name" data-v-343c80ca>ComponentB</span></span> <span class="token punctuation" data-v-343c80ca>/&gt;</span></span><span class="token plain-text" data-v-343c80ca>
        </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span><span class="token class-name" data-v-343c80ca>ComponentC</span></span> <span class="token punctuation" data-v-343c80ca>/&gt;</span></span><span class="token plain-text" data-v-343c80ca>
    </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span>
<span class="token punctuation" data-v-343c80ca>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-343c80ca><span class="line-number" data-v-343c80ca>1</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>2</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>3</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>4</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>5</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>6</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>7</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>8</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>9</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>10</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>11</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>12</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>13</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>14</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>15</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>16</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>17</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>18</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>19</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>20</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>21</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>22</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>23</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>24</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>25</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>26</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>27</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>28</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>29</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>30</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>31</span><br data-v-343c80ca></div></div><p data-v-343c80ca>这样一来，彼此的数据更新都不会相互影响。
</p><div style="width:800px;margin:auto;" data-v-343c80ca><img src="/vuebloger/img/post/Snipaste_2021-10-05_14-33-08.jpg" alt="" data-v-343c80ca></div><p data-v-343c80ca></p> <h2 id="memo-shouldcomponentupdate" data-v-343c80ca><a href="#memo-shouldcomponentupdate" class="header-anchor" data-v-343c80ca>#</a> memo/shouldComponentUpdate</h2> <h3 id="purecomponent-react-memo" data-v-343c80ca><a href="#purecomponent-react-memo" class="header-anchor" data-v-343c80ca>#</a> PureComponent/React.memo</h3> <p data-v-343c80ca>React.PureComponent  与 React.Component 用法差不多 ,但 React.PureComponent 通过props和state的浅对比来实现 shouldComponentUpate()。如果对象包含复杂的数据结构(比如对象和数组)，他会浅比较，如果深层次的改变，是无法作出判断的，React.PureComponent 认为没有变化，而没有渲染试图。
如这个例子</p> <div class="language-jsx line-numbers-mode" data-v-343c80ca><pre class="language-jsx" data-v-343c80ca><code data-v-343c80ca><span class="token keyword" data-v-343c80ca>class</span> <span class="token class-name" data-v-343c80ca>Text</span> <span class="token keyword" data-v-343c80ca>extends</span> <span class="token class-name" data-v-343c80ca>React<span class="token punctuation" data-v-343c80ca>.</span>PureComponent</span><span class="token operator" data-v-343c80ca>&lt;</span>any<span class="token punctuation" data-v-343c80ca>,</span>any<span class="token operator" data-v-343c80ca>&gt;</span><span class="token punctuation" data-v-343c80ca>{</span>
    <span class="token function" data-v-343c80ca>render</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>{</span>
        console<span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>log</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token keyword" data-v-343c80ca>this</span><span class="token punctuation" data-v-343c80ca>.</span>props<span class="token punctuation" data-v-343c80ca>)</span>
        <span class="token keyword" data-v-343c80ca>return</span> <span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>hello,wrold</span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span>
    <span class="token punctuation" data-v-343c80ca>}</span>
<span class="token punctuation" data-v-343c80ca>}</span>
<span class="token keyword" data-v-343c80ca>class</span> <span class="token class-name" data-v-343c80ca>Index</span> <span class="token keyword" data-v-343c80ca>extends</span> <span class="token class-name" data-v-343c80ca>React<span class="token punctuation" data-v-343c80ca>.</span>Component</span><span class="token operator" data-v-343c80ca>&lt;</span>any<span class="token punctuation" data-v-343c80ca>,</span>any<span class="token operator" data-v-343c80ca>&gt;</span><span class="token punctuation" data-v-343c80ca>{</span>
    state<span class="token operator" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span>
        data<span class="token operator" data-v-343c80ca>:</span><span class="token punctuation" data-v-343c80ca>{</span> a <span class="token operator" data-v-343c80ca>:</span> <span class="token number" data-v-343c80ca>1</span> <span class="token punctuation" data-v-343c80ca>,</span> b <span class="token operator" data-v-343c80ca>:</span> <span class="token number" data-v-343c80ca>2</span> <span class="token punctuation" data-v-343c80ca>}</span>
    <span class="token punctuation" data-v-343c80ca>}</span>
    <span class="token function-variable function" data-v-343c80ca>handerClick</span><span class="token operator" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token operator" data-v-343c80ca>=&gt;</span><span class="token punctuation" data-v-343c80ca>{</span>
        <span class="token keyword" data-v-343c80ca>const</span> <span class="token punctuation" data-v-343c80ca>{</span> data <span class="token punctuation" data-v-343c80ca>}</span> <span class="token operator" data-v-343c80ca>=</span> <span class="token keyword" data-v-343c80ca>this</span><span class="token punctuation" data-v-343c80ca>.</span>state
        data<span class="token punctuation" data-v-343c80ca>.</span>a<span class="token operator" data-v-343c80ca>++</span>
        <span class="token keyword" data-v-343c80ca>this</span><span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>setState</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>{</span> data <span class="token punctuation" data-v-343c80ca>}</span><span class="token punctuation" data-v-343c80ca>)</span>
    <span class="token punctuation" data-v-343c80ca>}</span>
    <span class="token function" data-v-343c80ca>render</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>{</span>
        <span class="token keyword" data-v-343c80ca>const</span> <span class="token punctuation" data-v-343c80ca>{</span> data <span class="token punctuation" data-v-343c80ca>}</span> <span class="token operator" data-v-343c80ca>=</span> <span class="token keyword" data-v-343c80ca>this</span><span class="token punctuation" data-v-343c80ca>.</span>state
        <span class="token keyword" data-v-343c80ca>return</span> <span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
            </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>button</span> <span class="token attr-name" data-v-343c80ca>onClick</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span> <span class="token keyword" data-v-343c80ca>this</span><span class="token punctuation" data-v-343c80ca>.</span>handerClick <span class="token punctuation" data-v-343c80ca>}</span></span> <span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>点击</span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>button</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
            </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span><span class="token class-name" data-v-343c80ca>Text</span></span> <span class="token attr-name" data-v-343c80ca>data</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span>data<span class="token punctuation" data-v-343c80ca>}</span></span> <span class="token punctuation" data-v-343c80ca>/&gt;</span></span><span class="token plain-text" data-v-343c80ca>
        </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span>
    <span class="token punctuation" data-v-343c80ca>}</span>
<span class="token punctuation" data-v-343c80ca>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-343c80ca><span class="line-number" data-v-343c80ca>1</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>2</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>3</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>4</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>5</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>6</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>7</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>8</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>9</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>10</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>11</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>12</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>13</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>14</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>15</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>16</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>17</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>18</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>19</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>20</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>21</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>22</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>23</span><br data-v-343c80ca></div></div><p data-v-343c80ca>效果:
</p><div style="width:1200px;margin:auto;" data-v-343c80ca><img src="/vuebloger/img/post/34234234234.gif" alt="" data-v-343c80ca></div>
我们点击按钮，发现 <Text data-v-343c80ca></Text> 根本没有重新更新。这里虽然改了data但是只是改变了data下的属性，所以 PureComponent 进行浅比较不会update。<p data-v-343c80ca></p> <p data-v-343c80ca>想要解决这个问题实际也很容易。</p> <div class="language-jsx line-numbers-mode" data-v-343c80ca><pre class="language-jsx" data-v-343c80ca><code data-v-343c80ca> <span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span><span class="token class-name" data-v-343c80ca>Text</span></span> <span class="token attr-name" data-v-343c80ca>data</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span><span class="token punctuation" data-v-343c80ca>{</span> <span class="token operator" data-v-343c80ca>...</span>data <span class="token punctuation" data-v-343c80ca>}</span><span class="token punctuation" data-v-343c80ca>}</span></span> <span class="token punctuation" data-v-343c80ca>/&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper" data-v-343c80ca><span class="line-number" data-v-343c80ca>1</span><br data-v-343c80ca></div></div><p data-v-343c80ca>无论组件是否是 PureComponent，如果定义了 shouldComponentUpdate()，那么会调用它并以它的执行结果来判断是否 update。在组件未定义 shouldComponentUpdate() 的情况下，会判断该组件是否是 PureComponent，如果是的话，会对新旧 props、state 进行 shallowEqual 比较，一旦新旧不一致，会触发渲染更新。
react.memo 和 PureComponent 功能类似 ，react.memo 作为第一个高阶组件，第二个参数 可以对props 进行比较 ，和shouldComponentUpdate不同的, 当第二个参数返回 true 的时候，证明props没有改变，不渲染组件，反之渲染组件。</p> <h3 id="shouldcomponentupdate" data-v-343c80ca><a href="#shouldcomponentupdate" class="header-anchor" data-v-343c80ca>#</a> shouldComponentUpdate</h3> <p data-v-343c80ca>使用 shouldComponentUpdate()  以让React知道当state或props的改变是否影响组件的重新render，默认返回ture，返回false时不会重新渲染更新，而且该方法并不会在初始化渲染或当使用 forceUpdate() 时被调用，通常一个shouldComponentUpdate 应用是这么写的。</p> <p data-v-343c80ca>控制状态</p> <div class="language-jsx line-numbers-mode" data-v-343c80ca><pre class="language-jsx" data-v-343c80ca><code data-v-343c80ca><span class="token function" data-v-343c80ca>shouldComponentUpdate</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token parameter" data-v-343c80ca>nextProps<span class="token punctuation" data-v-343c80ca>,</span> nextState</span><span class="token punctuation" data-v-343c80ca>)</span> <span class="token punctuation" data-v-343c80ca>{</span>
  <span class="token comment" data-v-343c80ca>/* 当 state 中 data1 发生改变的时候，重新更新组件 */</span>  
  <span class="token keyword" data-v-343c80ca>return</span> nextState<span class="token punctuation" data-v-343c80ca>.</span>data1 <span class="token operator" data-v-343c80ca>!==</span> <span class="token keyword" data-v-343c80ca>this</span><span class="token punctuation" data-v-343c80ca>.</span>state<span class="token punctuation" data-v-343c80ca>.</span>data1
<span class="token punctuation" data-v-343c80ca>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-343c80ca><span class="line-number" data-v-343c80ca>1</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>2</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>3</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>4</span><br data-v-343c80ca></div></div><p data-v-343c80ca>这个的意思就是 仅当state 中 data1 发生改变的时候，重新更新组件。 控制prop属性</p> <div class="language-jsx line-numbers-mode" data-v-343c80ca><pre class="language-jsx" data-v-343c80ca><code data-v-343c80ca><span class="token function" data-v-343c80ca>shouldComponentUpdate</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token parameter" data-v-343c80ca>nextProps<span class="token punctuation" data-v-343c80ca>,</span> nextState</span><span class="token punctuation" data-v-343c80ca>)</span> <span class="token punctuation" data-v-343c80ca>{</span>
  <span class="token comment" data-v-343c80ca>/* 当 props 中 data2发生改变的时候，重新更新组件 */</span>  
  <span class="token keyword" data-v-343c80ca>return</span> nextProps<span class="token punctuation" data-v-343c80ca>.</span>data2 <span class="token operator" data-v-343c80ca>!==</span> <span class="token keyword" data-v-343c80ca>this</span><span class="token punctuation" data-v-343c80ca>.</span>props<span class="token punctuation" data-v-343c80ca>.</span>data2
<span class="token punctuation" data-v-343c80ca>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-343c80ca><span class="line-number" data-v-343c80ca>1</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>2</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>3</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>4</span><br data-v-343c80ca></div></div><h3 id="immetable-jsx" data-v-343c80ca><a href="#immetable-jsx" class="header-anchor" data-v-343c80ca>#</a> immetable.jsx</h3> <p data-v-343c80ca>immetable.jsx 是Facebook 开发的一个js库，可以提高对象的比较性能，像之前所说的pureComponent 只能对对象进行浅比较，,对于对象的数据类型,却束手无策,所以我们可以用 immetable.jsx 配合 shouldComponentUpdate 或者  react.memo来使用。immutable 中</p> <p data-v-343c80ca>我们用react-redux来简单举一个例子，如下所示 数据都已经被 immetable.js处理。</p> <div class="language-jsx line-numbers-mode" data-v-343c80ca><pre class="language-jsx" data-v-343c80ca><code data-v-343c80ca><span class="token keyword" data-v-343c80ca>import</span> <span class="token punctuation" data-v-343c80ca>{</span> is  <span class="token punctuation" data-v-343c80ca>}</span> <span class="token keyword" data-v-343c80ca>from</span> <span class="token string" data-v-343c80ca>'immutable'</span>
<span class="token keyword" data-v-343c80ca>const</span> GoodItems <span class="token operator" data-v-343c80ca>=</span> <span class="token function" data-v-343c80ca>connect</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token parameter" data-v-343c80ca>state</span> <span class="token operator" data-v-343c80ca>=&gt;</span>
    <span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>{</span> GoodItems<span class="token operator" data-v-343c80ca>:</span> <span class="token function" data-v-343c80ca>filter</span><span class="token punctuation" data-v-343c80ca>(</span>state<span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>getIn</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>[</span><span class="token string" data-v-343c80ca>'Items'</span><span class="token punctuation" data-v-343c80ca>,</span> <span class="token string" data-v-343c80ca>'payload'</span><span class="token punctuation" data-v-343c80ca>,</span> <span class="token string" data-v-343c80ca>'list'</span><span class="token punctuation" data-v-343c80ca>]</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>,</span> state<span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>getIn</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>[</span><span class="token string" data-v-343c80ca>'customItems'</span><span class="token punctuation" data-v-343c80ca>,</span> <span class="token string" data-v-343c80ca>'payload'</span><span class="token punctuation" data-v-343c80ca>,</span> <span class="token string" data-v-343c80ca>'list'</span><span class="token punctuation" data-v-343c80ca>]</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>)</span> <span class="token operator" data-v-343c80ca>||</span> Immutable<span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>List</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>,</span> <span class="token punctuation" data-v-343c80ca>}</span><span class="token punctuation" data-v-343c80ca>)</span>
    <span class="token comment" data-v-343c80ca>/* 此处省略很多代码～～～～～～ */</span>
<span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token function" data-v-343c80ca>memo</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token parameter" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>{</span> Items<span class="token punctuation" data-v-343c80ca>,</span> dispatch<span class="token punctuation" data-v-343c80ca>,</span> setSeivceId <span class="token punctuation" data-v-343c80ca>}</span></span><span class="token punctuation" data-v-343c80ca>)</span> <span class="token operator" data-v-343c80ca>=&gt;</span> <span class="token punctuation" data-v-343c80ca>{</span>
   <span class="token comment" data-v-343c80ca>/*  */</span>
<span class="token punctuation" data-v-343c80ca>}</span><span class="token punctuation" data-v-343c80ca>,</span> <span class="token punctuation" data-v-343c80ca>(</span><span class="token parameter" data-v-343c80ca>pre<span class="token punctuation" data-v-343c80ca>,</span> next</span><span class="token punctuation" data-v-343c80ca>)</span> <span class="token operator" data-v-343c80ca>=&gt;</span> <span class="token function" data-v-343c80ca>is</span><span class="token punctuation" data-v-343c80ca>(</span>pre<span class="token punctuation" data-v-343c80ca>.</span>Items<span class="token punctuation" data-v-343c80ca>,</span> next<span class="token punctuation" data-v-343c80ca>.</span>Items<span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>)</span>
</code></pre> <div class="line-numbers-wrapper" data-v-343c80ca><span class="line-number" data-v-343c80ca>1</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>2</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>3</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>4</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>5</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>6</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>7</span><br data-v-343c80ca></div></div><p data-v-343c80ca>通过 is 方法来判断，前后Items(对象数据类型)是否发生变化。</p> <h2 id="规范写法，合理处理细节问题" data-v-343c80ca><a href="#规范写法，合理处理细节问题" class="header-anchor" data-v-343c80ca>#</a> 规范写法，合理处理细节问题</h2> <h3 id="绑定事件尽量不要使用箭头函数" data-v-343c80ca><a href="#绑定事件尽量不要使用箭头函数" class="header-anchor" data-v-343c80ca>#</a> 绑定事件尽量不要使用箭头函数</h3> <ol data-v-343c80ca><li data-v-343c80ca>面临问题</li></ol> <p data-v-343c80ca>众所周知，react更新来大部分情况自于props的改变(被动渲染)，和state改变(主动渲染)。当我们给未加任何更新限定条件子组件绑定事件的时候，或者是PureComponent 纯组件， 如果我们箭头函数使用的话。</p> <div class="language-jsx line-numbers-mode" data-v-343c80ca><pre class="language-jsx" data-v-343c80ca><code data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span><span class="token class-name" data-v-343c80ca>ChildComponent</span></span> <span class="token attr-name" data-v-343c80ca>handerClick</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token operator" data-v-343c80ca>=&gt;</span><span class="token punctuation" data-v-343c80ca>{</span> console<span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>log</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token number" data-v-343c80ca>666</span><span class="token punctuation" data-v-343c80ca>)</span> <span class="token punctuation" data-v-343c80ca>}</span><span class="token punctuation" data-v-343c80ca>}</span></span>  <span class="token punctuation" data-v-343c80ca>/&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper" data-v-343c80ca><span class="line-number" data-v-343c80ca>1</span><br data-v-343c80ca></div></div><p data-v-343c80ca>每次渲染时都会创建一个新的事件处理器，这会导致 ChildComponent 每次都会被渲染。</p> <p data-v-343c80ca>即便我们用箭头函数绑定给dom元素。</p> <div class="language-jsx line-numbers-mode" data-v-343c80ca><pre class="language-jsx" data-v-343c80ca><code data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>div</span> <span class="token attr-name" data-v-343c80ca>onClick</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span> <span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token operator" data-v-343c80ca>=&gt;</span><span class="token punctuation" data-v-343c80ca>{</span> console<span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>log</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token number" data-v-343c80ca>777</span><span class="token punctuation" data-v-343c80ca>)</span> <span class="token punctuation" data-v-343c80ca>}</span> <span class="token punctuation" data-v-343c80ca>}</span></span> <span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>hello,world</span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span>

</code></pre> <div class="line-numbers-wrapper" data-v-343c80ca><span class="line-number" data-v-343c80ca>1</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>2</span><br data-v-343c80ca></div></div><p data-v-343c80ca>每次react合成事件事件的时候，也都会重新声明一个新事件。</p> <ol start="2" data-v-343c80ca><li data-v-343c80ca>解决问题</li></ol> <p data-v-343c80ca>解决这个问题事件很简单，分为无状态组件和有状态组件。</p> <blockquote data-v-343c80ca><p data-v-343c80ca>有状态组件</p></blockquote> <div class="language-jsx line-numbers-mode" data-v-343c80ca><pre class="language-jsx" data-v-343c80ca><code data-v-343c80ca><span class="token keyword" data-v-343c80ca>class</span> <span class="token class-name" data-v-343c80ca>index</span> <span class="token keyword" data-v-343c80ca>extends</span> <span class="token class-name" data-v-343c80ca>React<span class="token punctuation" data-v-343c80ca>.</span>Component</span><span class="token punctuation" data-v-343c80ca>{</span>
    <span class="token function-variable function" data-v-343c80ca>handerClick</span><span class="token operator" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token operator" data-v-343c80ca>=&gt;</span><span class="token punctuation" data-v-343c80ca>{</span>
        console<span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>log</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token number" data-v-343c80ca>666</span><span class="token punctuation" data-v-343c80ca>)</span>
    <span class="token punctuation" data-v-343c80ca>}</span>
    <span class="token function-variable function" data-v-343c80ca>handerClick1</span><span class="token operator" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token operator" data-v-343c80ca>=&gt;</span><span class="token punctuation" data-v-343c80ca>{</span>
        console<span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>log</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token number" data-v-343c80ca>777</span><span class="token punctuation" data-v-343c80ca>)</span>
    <span class="token punctuation" data-v-343c80ca>}</span>
    <span class="token function" data-v-343c80ca>render</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>{</span>
        <span class="token keyword" data-v-343c80ca>return</span> <span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
            </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span><span class="token class-name" data-v-343c80ca>ChildComponent</span></span> <span class="token attr-name" data-v-343c80ca>handerClick</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span> <span class="token keyword" data-v-343c80ca>this</span><span class="token punctuation" data-v-343c80ca>.</span>handerClick <span class="token punctuation" data-v-343c80ca>}</span></span>  <span class="token punctuation" data-v-343c80ca>/&gt;</span></span><span class="token plain-text" data-v-343c80ca>
            </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>div</span> <span class="token attr-name" data-v-343c80ca>onClick</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span> <span class="token keyword" data-v-343c80ca>this</span><span class="token punctuation" data-v-343c80ca>.</span>handerClick1 <span class="token punctuation" data-v-343c80ca>}</span></span>  <span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>hello,world</span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
        </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span>
    <span class="token punctuation" data-v-343c80ca>}</span>
<span class="token punctuation" data-v-343c80ca>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-343c80ca><span class="line-number" data-v-343c80ca>1</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>2</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>3</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>4</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>5</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>6</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>7</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>8</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>9</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>10</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>11</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>12</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>13</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>14</span><br data-v-343c80ca></div></div><blockquote data-v-343c80ca><p data-v-343c80ca>无状态组件</p></blockquote> <div class="language-jsx line-numbers-mode" data-v-343c80ca><pre class="language-jsx" data-v-343c80ca><code data-v-343c80ca><span class="token keyword" data-v-343c80ca>function</span> <span class="token function" data-v-343c80ca>index</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>{</span>
   
    <span class="token keyword" data-v-343c80ca>const</span> handerClick1 <span class="token operator" data-v-343c80ca>=</span> <span class="token function" data-v-343c80ca>useMemo</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token operator" data-v-343c80ca>=&gt;</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token operator" data-v-343c80ca>=&gt;</span><span class="token punctuation" data-v-343c80ca>{</span>
       console<span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>log</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token number" data-v-343c80ca>777</span><span class="token punctuation" data-v-343c80ca>)</span>
    <span class="token punctuation" data-v-343c80ca>}</span><span class="token punctuation" data-v-343c80ca>,</span><span class="token punctuation" data-v-343c80ca>[</span><span class="token punctuation" data-v-343c80ca>]</span><span class="token punctuation" data-v-343c80ca>)</span>  <span class="token comment" data-v-343c80ca>/* [] 存在当前 handerClick1 的依赖项*/</span>
    <span class="token keyword" data-v-343c80ca>const</span> handerClick <span class="token operator" data-v-343c80ca>=</span> <span class="token function" data-v-343c80ca>useCallback</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token operator" data-v-343c80ca>=&gt;</span><span class="token punctuation" data-v-343c80ca>{</span> console<span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>log</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token number" data-v-343c80ca>666</span><span class="token punctuation" data-v-343c80ca>)</span> <span class="token punctuation" data-v-343c80ca>}</span><span class="token punctuation" data-v-343c80ca>,</span><span class="token punctuation" data-v-343c80ca>[</span><span class="token punctuation" data-v-343c80ca>]</span><span class="token punctuation" data-v-343c80ca>)</span>  <span class="token comment" data-v-343c80ca>/* [] 存在当前 handerClick 的依赖项*/</span>
    <span class="token keyword" data-v-343c80ca>return</span> <span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
        </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span><span class="token class-name" data-v-343c80ca>ChildComponent</span></span> <span class="token attr-name" data-v-343c80ca>handerClick</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span> handerClick <span class="token punctuation" data-v-343c80ca>}</span></span>  <span class="token punctuation" data-v-343c80ca>/&gt;</span></span><span class="token plain-text" data-v-343c80ca>
        </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>div</span> <span class="token attr-name" data-v-343c80ca>onClick</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span> handerClick1 <span class="token punctuation" data-v-343c80ca>}</span></span>  <span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>hello,world</span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
    </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span>
<span class="token punctuation" data-v-343c80ca>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-343c80ca><span class="line-number" data-v-343c80ca>1</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>2</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>3</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>4</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>5</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>6</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>7</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>8</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>9</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>10</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>11</span><br data-v-343c80ca></div></div><p data-v-343c80ca>对于dom，如果我们需要传递参数。我们可以这么写。</p> <div class="language-jsx line-numbers-mode" data-v-343c80ca><pre class="language-jsx" data-v-343c80ca><code data-v-343c80ca><span class="token keyword" data-v-343c80ca>function</span> <span class="token function" data-v-343c80ca>index</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>{</span>
    <span class="token keyword" data-v-343c80ca>const</span> handerClick1 <span class="token operator" data-v-343c80ca>=</span> <span class="token function" data-v-343c80ca>useMemo</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token operator" data-v-343c80ca>=&gt;</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token parameter" data-v-343c80ca>event</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token operator" data-v-343c80ca>=&gt;</span><span class="token punctuation" data-v-343c80ca>{</span>
        <span class="token keyword" data-v-343c80ca>const</span> mes <span class="token operator" data-v-343c80ca>=</span> event<span class="token punctuation" data-v-343c80ca>.</span>currentTarget<span class="token punctuation" data-v-343c80ca>.</span>dataset<span class="token punctuation" data-v-343c80ca>.</span>mes
        console<span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>log</span><span class="token punctuation" data-v-343c80ca>(</span>mes<span class="token punctuation" data-v-343c80ca>)</span> <span class="token comment" data-v-343c80ca>/* hello,world */</span>
    <span class="token punctuation" data-v-343c80ca>}</span><span class="token punctuation" data-v-343c80ca>,</span><span class="token punctuation" data-v-343c80ca>[</span><span class="token punctuation" data-v-343c80ca>]</span><span class="token punctuation" data-v-343c80ca>)</span>
    <span class="token keyword" data-v-343c80ca>return</span> <span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
        </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>div</span>  <span class="token attr-name" data-v-343c80ca>data-mes</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span> <span class="token string" data-v-343c80ca>'hello,world'</span> <span class="token punctuation" data-v-343c80ca>}</span></span> <span class="token attr-name" data-v-343c80ca>onClick</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span> handerClick1 <span class="token punctuation" data-v-343c80ca>}</span></span>  <span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>hello,world</span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
    </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span>
<span class="token punctuation" data-v-343c80ca>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-343c80ca><span class="line-number" data-v-343c80ca>1</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>2</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>3</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>4</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>5</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>6</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>7</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>8</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>9</span><br data-v-343c80ca></div></div><h3 id="循环正确使用key" data-v-343c80ca><a href="#循环正确使用key" class="header-anchor" data-v-343c80ca>#</a> 循环正确使用key</h3> <p data-v-343c80ca>无论是react 和 vue,正确使用key,目的就是在一次循环中，找到与新节点对应的老节点，复用节点，节省开销。想深入理解的同学可以看一下笔者的另外一篇文章 全面解析 vue3.0 diff算法 里面有对key详细说明。我们今天来看以下key正确用法,和错误用法。</p> <ol data-v-343c80ca><li data-v-343c80ca>错误用法</li></ol> <blockquote data-v-343c80ca><p data-v-343c80ca>错误用法一：用index做key</p></blockquote> <div class="language-jsx line-numbers-mode" data-v-343c80ca><pre class="language-jsx" data-v-343c80ca><code data-v-343c80ca><span class="token keyword" data-v-343c80ca>function</span> <span class="token function" data-v-343c80ca>index</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>{</span>
    <span class="token keyword" data-v-343c80ca>const</span> list <span class="token operator" data-v-343c80ca>=</span> <span class="token punctuation" data-v-343c80ca>[</span> <span class="token punctuation" data-v-343c80ca>{</span> id<span class="token operator" data-v-343c80ca>:</span><span class="token number" data-v-343c80ca>1</span> <span class="token punctuation" data-v-343c80ca>,</span> name<span class="token operator" data-v-343c80ca>:</span><span class="token string" data-v-343c80ca>'哈哈'</span> <span class="token punctuation" data-v-343c80ca>}</span> <span class="token punctuation" data-v-343c80ca>,</span> <span class="token punctuation" data-v-343c80ca>{</span> id<span class="token operator" data-v-343c80ca>:</span><span class="token number" data-v-343c80ca>2</span><span class="token punctuation" data-v-343c80ca>,</span> name<span class="token operator" data-v-343c80ca>:</span><span class="token string" data-v-343c80ca>'嘿嘿'</span> <span class="token punctuation" data-v-343c80ca>}</span> <span class="token punctuation" data-v-343c80ca>,</span><span class="token punctuation" data-v-343c80ca>{</span> id<span class="token operator" data-v-343c80ca>:</span><span class="token number" data-v-343c80ca>3</span> <span class="token punctuation" data-v-343c80ca>,</span> name<span class="token operator" data-v-343c80ca>:</span><span class="token string" data-v-343c80ca>'嘻嘻'</span> <span class="token punctuation" data-v-343c80ca>}</span> <span class="token punctuation" data-v-343c80ca>]</span>
    <span class="token keyword" data-v-343c80ca>return</span> <span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
       </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>ul</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
         </span><span class="token punctuation" data-v-343c80ca>{</span>  list<span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>map</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token parameter" data-v-343c80ca>item<span class="token punctuation" data-v-343c80ca>,</span>index</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token operator" data-v-343c80ca>=&gt;</span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>li</span> <span class="token attr-name" data-v-343c80ca>key</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span>index<span class="token punctuation" data-v-343c80ca>}</span></span> <span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token punctuation" data-v-343c80ca>{</span> item<span class="token punctuation" data-v-343c80ca>.</span>name <span class="token punctuation" data-v-343c80ca>}</span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>li</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token punctuation" data-v-343c80ca>)</span>  <span class="token punctuation" data-v-343c80ca>}</span><span class="token plain-text" data-v-343c80ca>
       </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>ul</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
    </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span>
<span class="token punctuation" data-v-343c80ca>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-343c80ca><span class="line-number" data-v-343c80ca>1</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>2</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>3</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>4</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>5</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>6</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>7</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>8</span><br data-v-343c80ca></div></div><p data-v-343c80ca>这种加key的性能,实际和不加key效果差不多，每次还是从头到尾diff。</p> <blockquote data-v-343c80ca><p data-v-343c80ca>错误用法二:用index拼接其他的字段</p></blockquote> <div class="language-jsx line-numbers-mode" data-v-343c80ca><pre class="language-jsx" data-v-343c80ca><code data-v-343c80ca><span class="token keyword" data-v-343c80ca>function</span> <span class="token function" data-v-343c80ca>index</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>{</span>
    <span class="token keyword" data-v-343c80ca>const</span> list <span class="token operator" data-v-343c80ca>=</span> <span class="token punctuation" data-v-343c80ca>[</span> <span class="token punctuation" data-v-343c80ca>{</span> id<span class="token operator" data-v-343c80ca>:</span><span class="token number" data-v-343c80ca>1</span> <span class="token punctuation" data-v-343c80ca>,</span> name<span class="token operator" data-v-343c80ca>:</span><span class="token string" data-v-343c80ca>'哈哈'</span> <span class="token punctuation" data-v-343c80ca>}</span> <span class="token punctuation" data-v-343c80ca>,</span> <span class="token punctuation" data-v-343c80ca>{</span> id<span class="token operator" data-v-343c80ca>:</span><span class="token number" data-v-343c80ca>2</span><span class="token punctuation" data-v-343c80ca>,</span> name<span class="token operator" data-v-343c80ca>:</span><span class="token string" data-v-343c80ca>'嘿嘿'</span> <span class="token punctuation" data-v-343c80ca>}</span> <span class="token punctuation" data-v-343c80ca>,</span><span class="token punctuation" data-v-343c80ca>{</span> id<span class="token operator" data-v-343c80ca>:</span><span class="token number" data-v-343c80ca>3</span> <span class="token punctuation" data-v-343c80ca>,</span> name<span class="token operator" data-v-343c80ca>:</span><span class="token string" data-v-343c80ca>'嘻嘻'</span> <span class="token punctuation" data-v-343c80ca>}</span> <span class="token punctuation" data-v-343c80ca>]</span>
    <span class="token keyword" data-v-343c80ca>return</span> <span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
       </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>ul</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
         </span><span class="token punctuation" data-v-343c80ca>{</span>  list<span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>map</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token parameter" data-v-343c80ca>item<span class="token punctuation" data-v-343c80ca>,</span>index</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token operator" data-v-343c80ca>=&gt;</span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>li</span> <span class="token attr-name" data-v-343c80ca>key</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span>index <span class="token operator" data-v-343c80ca>+</span> item<span class="token punctuation" data-v-343c80ca>.</span>name <span class="token punctuation" data-v-343c80ca>}</span></span> <span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token punctuation" data-v-343c80ca>{</span> item<span class="token punctuation" data-v-343c80ca>.</span>name <span class="token punctuation" data-v-343c80ca>}</span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>li</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token punctuation" data-v-343c80ca>)</span>  <span class="token punctuation" data-v-343c80ca>}</span><span class="token plain-text" data-v-343c80ca>
       </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>ul</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
    </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span>
<span class="token punctuation" data-v-343c80ca>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-343c80ca><span class="line-number" data-v-343c80ca>1</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>2</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>3</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>4</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>5</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>6</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>7</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>8</span><br data-v-343c80ca></div></div><p data-v-343c80ca>如果有元素移动或者删除，那么就失去了一一对应关系，剩下的节点都不能有效复用。</p> <p data-v-343c80ca>2 正确用法
用唯一的健id作为key,能够做到有效复用元素节点。</p> <div class="language-jsx line-numbers-mode" data-v-343c80ca><pre class="language-jsx" data-v-343c80ca><code data-v-343c80ca><span class="token keyword" data-v-343c80ca>function</span> <span class="token function" data-v-343c80ca>index</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>{</span>
    <span class="token keyword" data-v-343c80ca>const</span> list <span class="token operator" data-v-343c80ca>=</span> <span class="token punctuation" data-v-343c80ca>[</span> <span class="token punctuation" data-v-343c80ca>{</span> id<span class="token operator" data-v-343c80ca>:</span><span class="token number" data-v-343c80ca>1</span> <span class="token punctuation" data-v-343c80ca>,</span> name<span class="token operator" data-v-343c80ca>:</span><span class="token string" data-v-343c80ca>'哈哈'</span> <span class="token punctuation" data-v-343c80ca>}</span> <span class="token punctuation" data-v-343c80ca>,</span> <span class="token punctuation" data-v-343c80ca>{</span> id<span class="token operator" data-v-343c80ca>:</span><span class="token number" data-v-343c80ca>2</span><span class="token punctuation" data-v-343c80ca>,</span> name<span class="token operator" data-v-343c80ca>:</span><span class="token string" data-v-343c80ca>'嘿嘿'</span> <span class="token punctuation" data-v-343c80ca>}</span> <span class="token punctuation" data-v-343c80ca>,</span><span class="token punctuation" data-v-343c80ca>{</span> id<span class="token operator" data-v-343c80ca>:</span><span class="token number" data-v-343c80ca>3</span> <span class="token punctuation" data-v-343c80ca>,</span> name<span class="token operator" data-v-343c80ca>:</span><span class="token string" data-v-343c80ca>'嘻嘻'</span> <span class="token punctuation" data-v-343c80ca>}</span> <span class="token punctuation" data-v-343c80ca>]</span>
    <span class="token keyword" data-v-343c80ca>return</span> <span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
       </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>ul</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
         </span><span class="token punctuation" data-v-343c80ca>{</span>  list<span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>map</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token parameter" data-v-343c80ca>item<span class="token punctuation" data-v-343c80ca>,</span>index</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token operator" data-v-343c80ca>=&gt;</span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>li</span> <span class="token attr-name" data-v-343c80ca>key</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span> item<span class="token punctuation" data-v-343c80ca>.</span>id <span class="token punctuation" data-v-343c80ca>}</span></span> <span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token punctuation" data-v-343c80ca>{</span> item<span class="token punctuation" data-v-343c80ca>.</span>name <span class="token punctuation" data-v-343c80ca>}</span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>li</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token punctuation" data-v-343c80ca>)</span>  <span class="token punctuation" data-v-343c80ca>}</span><span class="token plain-text" data-v-343c80ca>
       </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>ul</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
    </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span>
<span class="token punctuation" data-v-343c80ca>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-343c80ca><span class="line-number" data-v-343c80ca>1</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>2</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>3</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>4</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>5</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>6</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>7</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>8</span><br data-v-343c80ca></div></div><h3 id="usememo-避免重复声明" data-v-343c80ca><a href="#usememo-避免重复声明" class="header-anchor" data-v-343c80ca>#</a> useMemo 避免重复声明</h3> <p data-v-343c80ca>对于无状态组件，数据更新就等于函数上下文的重复执行。那么函数里面的变量，方法就会重新声明。比如如下情况。</p> <div class="language-jsx line-numbers-mode" data-v-343c80ca><pre class="language-jsx" data-v-343c80ca><code data-v-343c80ca><span class="token keyword" data-v-343c80ca>function</span> <span class="token function" data-v-343c80ca>Index</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>{</span>
    <span class="token keyword" data-v-343c80ca>const</span> <span class="token punctuation" data-v-343c80ca>[</span> number <span class="token punctuation" data-v-343c80ca>,</span> setNumber  <span class="token punctuation" data-v-343c80ca>]</span> <span class="token operator" data-v-343c80ca>=</span> <span class="token function" data-v-343c80ca>useState</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token number" data-v-343c80ca>0</span><span class="token punctuation" data-v-343c80ca>)</span>
    <span class="token keyword" data-v-343c80ca>const</span> <span class="token function-variable function" data-v-343c80ca>handerClick1</span> <span class="token operator" data-v-343c80ca>=</span> <span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token operator" data-v-343c80ca>=&gt;</span><span class="token punctuation" data-v-343c80ca>{</span>
        <span class="token comment" data-v-343c80ca>/* 一些操作 */</span>
    <span class="token punctuation" data-v-343c80ca>}</span>
    <span class="token keyword" data-v-343c80ca>const</span> <span class="token function-variable function" data-v-343c80ca>handerClick2</span> <span class="token operator" data-v-343c80ca>=</span> <span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token operator" data-v-343c80ca>=&gt;</span><span class="token punctuation" data-v-343c80ca>{</span>
        <span class="token comment" data-v-343c80ca>/* 一些操作 */</span>
    <span class="token punctuation" data-v-343c80ca>}</span>
    <span class="token keyword" data-v-343c80ca>const</span> <span class="token function-variable function" data-v-343c80ca>handerClick3</span> <span class="token operator" data-v-343c80ca>=</span> <span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token operator" data-v-343c80ca>=&gt;</span><span class="token punctuation" data-v-343c80ca>{</span>
        <span class="token comment" data-v-343c80ca>/* 一些操作 */</span>
    <span class="token punctuation" data-v-343c80ca>}</span>
    <span class="token keyword" data-v-343c80ca>return</span> <span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
        </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>a</span> <span class="token attr-name" data-v-343c80ca>onClick</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span> handerClick1 <span class="token punctuation" data-v-343c80ca>}</span></span> <span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>点我有惊喜1</span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>a</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
        </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>a</span> <span class="token attr-name" data-v-343c80ca>onClick</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span> handerClick2 <span class="token punctuation" data-v-343c80ca>}</span></span> <span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>点我有惊喜2</span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>a</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
        </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>a</span> <span class="token attr-name" data-v-343c80ca>onClick</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span> handerClick3 <span class="token punctuation" data-v-343c80ca>}</span></span> <span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>点我有惊喜3</span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>a</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
        </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>button</span> <span class="token attr-name" data-v-343c80ca>onClick</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span> <span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token operator" data-v-343c80ca>=&gt;</span> <span class="token function" data-v-343c80ca>setNumber</span><span class="token punctuation" data-v-343c80ca>(</span>number<span class="token operator" data-v-343c80ca>+</span><span class="token number" data-v-343c80ca>1</span><span class="token punctuation" data-v-343c80ca>)</span> <span class="token punctuation" data-v-343c80ca>}</span></span> <span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca> 点击 </span><span class="token punctuation" data-v-343c80ca>{</span> number <span class="token punctuation" data-v-343c80ca>}</span><span class="token plain-text" data-v-343c80ca> </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>button</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
    </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span>
<span class="token punctuation" data-v-343c80ca>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-343c80ca><span class="line-number" data-v-343c80ca>1</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>2</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>3</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>4</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>5</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>6</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>7</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>8</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>9</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>10</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>11</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>12</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>13</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>14</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>15</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>16</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>17</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>18</span><br data-v-343c80ca></div></div><p data-v-343c80ca>每次点击button的时候,都会执行Index函数。handerClick1 , handerClick2,handerClick3都会重新声明。为了避免这个情况的发生，我们可以用 useMemo 做缓存，我们可以改成如下。</p> <div class="language-jsx line-numbers-mode" data-v-343c80ca><pre class="language-jsx" data-v-343c80ca><code data-v-343c80ca><span class="token keyword" data-v-343c80ca>function</span> <span class="token function" data-v-343c80ca>Index</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>{</span>
    <span class="token keyword" data-v-343c80ca>const</span> <span class="token punctuation" data-v-343c80ca>[</span> number <span class="token punctuation" data-v-343c80ca>,</span> setNumber  <span class="token punctuation" data-v-343c80ca>]</span> <span class="token operator" data-v-343c80ca>=</span> <span class="token function" data-v-343c80ca>useState</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token number" data-v-343c80ca>0</span><span class="token punctuation" data-v-343c80ca>)</span>
    <span class="token keyword" data-v-343c80ca>const</span> <span class="token punctuation" data-v-343c80ca>[</span> handerClick1 <span class="token punctuation" data-v-343c80ca>,</span> handerClick2  <span class="token punctuation" data-v-343c80ca>,</span>handerClick3<span class="token punctuation" data-v-343c80ca>]</span> <span class="token operator" data-v-343c80ca>=</span> <span class="token function" data-v-343c80ca>useMemo</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token operator" data-v-343c80ca>=&gt;</span><span class="token punctuation" data-v-343c80ca>{</span>
        <span class="token keyword" data-v-343c80ca>const</span> <span class="token function-variable function" data-v-343c80ca>fn1</span> <span class="token operator" data-v-343c80ca>=</span> <span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token operator" data-v-343c80ca>=&gt;</span><span class="token punctuation" data-v-343c80ca>{</span>
            <span class="token comment" data-v-343c80ca>/* 一些操作 */</span>
        <span class="token punctuation" data-v-343c80ca>}</span>
        <span class="token keyword" data-v-343c80ca>const</span> <span class="token function-variable function" data-v-343c80ca>fn2</span> <span class="token operator" data-v-343c80ca>=</span> <span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token operator" data-v-343c80ca>=&gt;</span><span class="token punctuation" data-v-343c80ca>{</span>
            <span class="token comment" data-v-343c80ca>/* 一些操作 */</span>
        <span class="token punctuation" data-v-343c80ca>}</span>
        <span class="token keyword" data-v-343c80ca>const</span>  <span class="token function-variable function" data-v-343c80ca>fn3</span><span class="token operator" data-v-343c80ca>=</span> <span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token operator" data-v-343c80ca>=&gt;</span><span class="token punctuation" data-v-343c80ca>{</span>
            <span class="token comment" data-v-343c80ca>/* 一些操作 */</span>
        <span class="token punctuation" data-v-343c80ca>}</span>
        <span class="token keyword" data-v-343c80ca>return</span> <span class="token punctuation" data-v-343c80ca>[</span>fn1 <span class="token punctuation" data-v-343c80ca>,</span> fn2 <span class="token punctuation" data-v-343c80ca>,</span>fn3<span class="token punctuation" data-v-343c80ca>]</span>
    <span class="token punctuation" data-v-343c80ca>}</span><span class="token punctuation" data-v-343c80ca>,</span><span class="token punctuation" data-v-343c80ca>[</span><span class="token punctuation" data-v-343c80ca>]</span><span class="token punctuation" data-v-343c80ca>)</span> <span class="token comment" data-v-343c80ca>/* 只有当数据里面的依赖项，发生改变的时候，才会重新声明函数。 */</span>
    <span class="token keyword" data-v-343c80ca>return</span> <span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
        </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>a</span> <span class="token attr-name" data-v-343c80ca>onClick</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span> handerClick1 <span class="token punctuation" data-v-343c80ca>}</span></span> <span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>点我有惊喜1</span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>a</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
        </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>a</span> <span class="token attr-name" data-v-343c80ca>onClick</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span> handerClick2 <span class="token punctuation" data-v-343c80ca>}</span></span> <span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>点我有惊喜2</span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>a</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
        </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>a</span> <span class="token attr-name" data-v-343c80ca>onClick</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span> handerClick3 <span class="token punctuation" data-v-343c80ca>}</span></span> <span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>点我有惊喜3</span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>a</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
        </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>button</span> <span class="token attr-name" data-v-343c80ca>onClick</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span> <span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token operator" data-v-343c80ca>=&gt;</span> <span class="token function" data-v-343c80ca>setNumber</span><span class="token punctuation" data-v-343c80ca>(</span>number<span class="token operator" data-v-343c80ca>+</span><span class="token number" data-v-343c80ca>1</span><span class="token punctuation" data-v-343c80ca>)</span> <span class="token punctuation" data-v-343c80ca>}</span></span> <span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca> 点击 </span><span class="token punctuation" data-v-343c80ca>{</span> number <span class="token punctuation" data-v-343c80ca>}</span><span class="token plain-text" data-v-343c80ca> </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>button</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
    </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span>
<span class="token punctuation" data-v-343c80ca>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-343c80ca><span class="line-number" data-v-343c80ca>1</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>2</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>3</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>4</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>5</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>6</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>7</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>8</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>9</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>10</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>11</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>12</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>13</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>14</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>15</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>16</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>17</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>18</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>19</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>20</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>21</span><br data-v-343c80ca></div></div><p data-v-343c80ca>如下改变之后，handerClick1 , handerClick2,handerClick3 会被缓存下来。</p> <h3 id="懒加载-suspense-和-lazy" data-v-343c80ca><a href="#懒加载-suspense-和-lazy" class="header-anchor" data-v-343c80ca>#</a> 懒加载 Suspense 和 lazy</h3> <p data-v-343c80ca>Suspense 和 lazy 可以实现 dynamic import 懒加载效果，原理和上述的路由懒加载差不多。在 React 中的使用方法是在 Suspense 组件中使用 <code data-v-343c80ca>&lt;LazyComponent&gt;</code> 组件。</p> <div class="language-jsx line-numbers-mode" data-v-343c80ca><pre class="language-jsx" data-v-343c80ca><code data-v-343c80ca><span class="token keyword" data-v-343c80ca>const</span> LazyComponent <span class="token operator" data-v-343c80ca>=</span> React<span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>lazy</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span> <span class="token operator" data-v-343c80ca>=&gt;</span> <span class="token keyword" data-v-343c80ca>import</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token string" data-v-343c80ca>'./LazyComponent'</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>;</span>

<span class="token keyword" data-v-343c80ca>function</span> <span class="token function" data-v-343c80ca>demo</span> <span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span> <span class="token punctuation" data-v-343c80ca>{</span>
  <span class="token keyword" data-v-343c80ca>return</span> <span class="token punctuation" data-v-343c80ca>(</span>
    <span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
      </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span><span class="token class-name" data-v-343c80ca>Suspense</span></span> <span class="token attr-name" data-v-343c80ca>fallback</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>Loading...</span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token punctuation" data-v-343c80ca>}</span></span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
        </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span><span class="token class-name" data-v-343c80ca>LazyComponent</span></span> <span class="token punctuation" data-v-343c80ca>/&gt;</span></span><span class="token plain-text" data-v-343c80ca>
      </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span><span class="token class-name" data-v-343c80ca>Suspense</span></span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
    </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span>
  <span class="token punctuation" data-v-343c80ca>)</span>
<span class="token punctuation" data-v-343c80ca>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-343c80ca><span class="line-number" data-v-343c80ca>1</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>2</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>3</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>4</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>5</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>6</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>7</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>8</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>9</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>10</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>11</span><br data-v-343c80ca></div></div><p data-v-343c80ca>LazyComponent 是通过懒加载加载进来的，所以渲染页面的时候可能会有延迟，但使用了 Suspense 之后，在加载状态下，可以用<code data-v-343c80ca>&lt;div&gt;Loading...&lt;/div&gt;</code>作为loading效果。</p> <p data-v-343c80ca>Suspense 可以包裹多个懒加载组件。</p> <div class="language-jsx line-numbers-mode" data-v-343c80ca><pre class="language-jsx" data-v-343c80ca><code data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span><span class="token class-name" data-v-343c80ca>Suspense</span></span> <span class="token attr-name" data-v-343c80ca>fallback</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>Loading...</span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token punctuation" data-v-343c80ca>}</span></span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
    </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span><span class="token class-name" data-v-343c80ca>LazyComponent</span></span> <span class="token punctuation" data-v-343c80ca>/&gt;</span></span><span class="token plain-text" data-v-343c80ca>
    </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span><span class="token class-name" data-v-343c80ca>LazyComponent1</span></span> <span class="token punctuation" data-v-343c80ca>/&gt;</span></span><span class="token plain-text" data-v-343c80ca>
</span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span><span class="token class-name" data-v-343c80ca>Suspense</span></span><span class="token punctuation" data-v-343c80ca>&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper" data-v-343c80ca><span class="line-number" data-v-343c80ca>1</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>2</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>3</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>4</span><br data-v-343c80ca></div></div><h2 id="多种方式避免重复渲染" data-v-343c80ca><a href="#多种方式避免重复渲染" class="header-anchor" data-v-343c80ca>#</a> 多种方式避免重复渲染</h2> <p data-v-343c80ca>避免重复渲染,是react性能优化的重要方向。如果想尽心尽力处理好react项目每一个细节，那么就要从每一行代码开始，从每一组件开始。正所谓不积硅步无以至千里。</p> <h3 id="学会使用的批量更新" data-v-343c80ca><a href="#学会使用的批量更新" class="header-anchor" data-v-343c80ca>#</a> 学会使用的批量更新</h3> <ol data-v-343c80ca><li data-v-343c80ca>批量更新
这次讲的批量更新的概念，实际主要是针对无状态组件和hooks中useState,和 class有状态组件中的this.setState，两种方法已经做了批量更新的处理。比如如下例子</li></ol> <blockquote data-v-343c80ca><p data-v-343c80ca>一次更新中</p></blockquote> <div class="language-jsx line-numbers-mode" data-v-343c80ca><pre class="language-jsx" data-v-343c80ca><code data-v-343c80ca><span class="token keyword" data-v-343c80ca>class</span> <span class="token class-name" data-v-343c80ca>index</span> <span class="token keyword" data-v-343c80ca>extends</span> <span class="token class-name" data-v-343c80ca>React<span class="token punctuation" data-v-343c80ca>.</span>Component</span><span class="token punctuation" data-v-343c80ca>{</span>
    <span class="token function" data-v-343c80ca>constructor</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token parameter" data-v-343c80ca>prop</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>{</span>
        <span class="token keyword" data-v-343c80ca>super</span><span class="token punctuation" data-v-343c80ca>(</span>prop<span class="token punctuation" data-v-343c80ca>)</span>
        <span class="token keyword" data-v-343c80ca>this</span><span class="token punctuation" data-v-343c80ca>.</span>state <span class="token operator" data-v-343c80ca>=</span> <span class="token punctuation" data-v-343c80ca>{</span>
            a<span class="token operator" data-v-343c80ca>:</span><span class="token number" data-v-343c80ca>1</span><span class="token punctuation" data-v-343c80ca>,</span>
            b<span class="token operator" data-v-343c80ca>:</span><span class="token number" data-v-343c80ca>2</span><span class="token punctuation" data-v-343c80ca>,</span>
            c<span class="token operator" data-v-343c80ca>:</span><span class="token number" data-v-343c80ca>3</span><span class="token punctuation" data-v-343c80ca>,</span>
        <span class="token punctuation" data-v-343c80ca>}</span>
    <span class="token punctuation" data-v-343c80ca>}</span>
    <span class="token function-variable function" data-v-343c80ca>handerClick</span><span class="token operator" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token operator" data-v-343c80ca>=&gt;</span><span class="token punctuation" data-v-343c80ca>{</span>
        <span class="token keyword" data-v-343c80ca>const</span> <span class="token punctuation" data-v-343c80ca>{</span> a<span class="token punctuation" data-v-343c80ca>,</span>b<span class="token punctuation" data-v-343c80ca>,</span>c <span class="token punctuation" data-v-343c80ca>}</span> <span class="token operator" data-v-343c80ca>:</span>any <span class="token operator" data-v-343c80ca>=</span> <span class="token keyword" data-v-343c80ca>this</span><span class="token punctuation" data-v-343c80ca>.</span>state
        <span class="token keyword" data-v-343c80ca>this</span><span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>setState</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>{</span> a<span class="token operator" data-v-343c80ca>:</span>a<span class="token operator" data-v-343c80ca>+</span><span class="token number" data-v-343c80ca>1</span> <span class="token punctuation" data-v-343c80ca>}</span><span class="token punctuation" data-v-343c80ca>)</span>
        <span class="token keyword" data-v-343c80ca>this</span><span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>setState</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>{</span> b<span class="token operator" data-v-343c80ca>:</span>b<span class="token operator" data-v-343c80ca>+</span><span class="token number" data-v-343c80ca>1</span> <span class="token punctuation" data-v-343c80ca>}</span><span class="token punctuation" data-v-343c80ca>)</span>
        <span class="token keyword" data-v-343c80ca>this</span><span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>setState</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>{</span> c<span class="token operator" data-v-343c80ca>:</span>c<span class="token operator" data-v-343c80ca>+</span><span class="token number" data-v-343c80ca>1</span> <span class="token punctuation" data-v-343c80ca>}</span><span class="token punctuation" data-v-343c80ca>)</span>
    <span class="token punctuation" data-v-343c80ca>}</span>
    <span class="token function-variable function" data-v-343c80ca>render</span><span class="token operator" data-v-343c80ca>=</span> <span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span> <span class="token operator" data-v-343c80ca>=&gt;</span> <span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>div</span> <span class="token attr-name" data-v-343c80ca>onClick</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span><span class="token keyword" data-v-343c80ca>this</span><span class="token punctuation" data-v-343c80ca>.</span>handerClick<span class="token punctuation" data-v-343c80ca>}</span></span> <span class="token punctuation" data-v-343c80ca>/&gt;</span></span>
<span class="token punctuation" data-v-343c80ca>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-343c80ca><span class="line-number" data-v-343c80ca>1</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>2</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>3</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>4</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>5</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>6</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>7</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>8</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>9</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>10</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>11</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>12</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>13</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>14</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>15</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>16</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>17</span><br data-v-343c80ca></div></div><p data-v-343c80ca>点击事件发生之后，会触发三次 setState,但是不会渲染三次，因为有一个批量更新batchUpdate批量更新的概念。三次setState最后被合成类似如下样子</p> <div class="language-jsx line-numbers-mode" data-v-343c80ca><pre class="language-jsx" data-v-343c80ca><code data-v-343c80ca><span class="token keyword" data-v-343c80ca>this</span><span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>setState</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>{</span>
    a<span class="token operator" data-v-343c80ca>:</span>a<span class="token operator" data-v-343c80ca>+</span><span class="token number" data-v-343c80ca>1</span> <span class="token punctuation" data-v-343c80ca>,</span>
    b<span class="token operator" data-v-343c80ca>:</span>b<span class="token operator" data-v-343c80ca>+</span><span class="token number" data-v-343c80ca>1</span> <span class="token punctuation" data-v-343c80ca>,</span>
    c<span class="token operator" data-v-343c80ca>:</span>c<span class="token operator" data-v-343c80ca>+</span><span class="token number" data-v-343c80ca>1</span> 
<span class="token punctuation" data-v-343c80ca>}</span><span class="token punctuation" data-v-343c80ca>)</span>
</code></pre> <div class="line-numbers-wrapper" data-v-343c80ca><span class="line-number" data-v-343c80ca>1</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>2</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>3</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>4</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>5</span><br data-v-343c80ca></div></div><p data-v-343c80ca>无状态组件中也是</p> <div class="language-jsx line-numbers-mode" data-v-343c80ca><pre class="language-jsx" data-v-343c80ca><code data-v-343c80ca>    <span class="token keyword" data-v-343c80ca>const</span>  <span class="token punctuation" data-v-343c80ca>[</span> a <span class="token punctuation" data-v-343c80ca>,</span> setA <span class="token punctuation" data-v-343c80ca>]</span> <span class="token operator" data-v-343c80ca>=</span> <span class="token function" data-v-343c80ca>useState</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token number" data-v-343c80ca>1</span><span class="token punctuation" data-v-343c80ca>)</span>
    <span class="token keyword" data-v-343c80ca>const</span>  <span class="token punctuation" data-v-343c80ca>[</span> b <span class="token punctuation" data-v-343c80ca>,</span> setB <span class="token punctuation" data-v-343c80ca>]</span> <span class="token operator" data-v-343c80ca>=</span> <span class="token function" data-v-343c80ca>useState</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>{</span><span class="token punctuation" data-v-343c80ca>}</span><span class="token punctuation" data-v-343c80ca>)</span>
    <span class="token keyword" data-v-343c80ca>const</span>  <span class="token punctuation" data-v-343c80ca>[</span> c <span class="token punctuation" data-v-343c80ca>,</span> setC <span class="token punctuation" data-v-343c80ca>]</span> <span class="token operator" data-v-343c80ca>=</span> <span class="token function" data-v-343c80ca>useState</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token number" data-v-343c80ca>1</span><span class="token punctuation" data-v-343c80ca>)</span>
    <span class="token keyword" data-v-343c80ca>const</span> <span class="token function-variable function" data-v-343c80ca>handerClick</span> <span class="token operator" data-v-343c80ca>=</span> <span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span> <span class="token operator" data-v-343c80ca>=&gt;</span> <span class="token punctuation" data-v-343c80ca>{</span>
        <span class="token function" data-v-343c80ca>setB</span><span class="token punctuation" data-v-343c80ca>(</span> <span class="token punctuation" data-v-343c80ca>{</span> <span class="token operator" data-v-343c80ca>...</span>b <span class="token punctuation" data-v-343c80ca>}</span> <span class="token punctuation" data-v-343c80ca>)</span> 
        <span class="token function" data-v-343c80ca>setC</span><span class="token punctuation" data-v-343c80ca>(</span> c<span class="token operator" data-v-343c80ca>+</span><span class="token number" data-v-343c80ca>1</span> <span class="token punctuation" data-v-343c80ca>)</span> 
        <span class="token function" data-v-343c80ca>setA</span><span class="token punctuation" data-v-343c80ca>(</span> a<span class="token operator" data-v-343c80ca>+</span><span class="token number" data-v-343c80ca>1</span> <span class="token punctuation" data-v-343c80ca>)</span>
    <span class="token punctuation" data-v-343c80ca>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-343c80ca><span class="line-number" data-v-343c80ca>1</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>2</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>3</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>4</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>5</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>6</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>7</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>8</span><br data-v-343c80ca></div></div><p data-v-343c80ca>批量更新失效常常发生在异步，比如：</p> <div class="language-jsx line-numbers-mode" data-v-343c80ca><pre class="language-jsx" data-v-343c80ca><code data-v-343c80ca><span class="token function-variable function" data-v-343c80ca>handerClick</span><span class="token operator" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token operator" data-v-343c80ca>=&gt;</span><span class="token punctuation" data-v-343c80ca>{</span>
    <span class="token function" data-v-343c80ca>setTimeout</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span> <span class="token operator" data-v-343c80ca>=&gt;</span> <span class="token punctuation" data-v-343c80ca>{</span>
        <span class="token keyword" data-v-343c80ca>this</span><span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>setState</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>{</span> a<span class="token operator" data-v-343c80ca>:</span>a<span class="token operator" data-v-343c80ca>+</span><span class="token number" data-v-343c80ca>1</span> <span class="token punctuation" data-v-343c80ca>}</span><span class="token punctuation" data-v-343c80ca>)</span>
        <span class="token keyword" data-v-343c80ca>this</span><span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>setState</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>{</span> b<span class="token operator" data-v-343c80ca>:</span>b<span class="token operator" data-v-343c80ca>+</span><span class="token number" data-v-343c80ca>1</span> <span class="token punctuation" data-v-343c80ca>}</span><span class="token punctuation" data-v-343c80ca>)</span>
        <span class="token keyword" data-v-343c80ca>this</span><span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>setState</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>{</span> c<span class="token operator" data-v-343c80ca>:</span>c<span class="token operator" data-v-343c80ca>+</span><span class="token number" data-v-343c80ca>1</span> <span class="token punctuation" data-v-343c80ca>}</span><span class="token punctuation" data-v-343c80ca>)</span>
    <span class="token punctuation" data-v-343c80ca>}</span><span class="token punctuation" data-v-343c80ca>,</span> <span class="token number" data-v-343c80ca>0</span><span class="token punctuation" data-v-343c80ca>)</span>
<span class="token punctuation" data-v-343c80ca>}</span>

<span class="token comment" data-v-343c80ca>// 或</span>

 <span class="token keyword" data-v-343c80ca>const</span> <span class="token function-variable function" data-v-343c80ca>handerClick</span> <span class="token operator" data-v-343c80ca>=</span> <span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span> <span class="token operator" data-v-343c80ca>=&gt;</span> <span class="token punctuation" data-v-343c80ca>{</span>
    Promise<span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>resolve</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>then</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token operator" data-v-343c80ca>=&gt;</span><span class="token punctuation" data-v-343c80ca>{</span>
    <span class="token function" data-v-343c80ca>setB</span><span class="token punctuation" data-v-343c80ca>(</span> <span class="token punctuation" data-v-343c80ca>{</span> <span class="token operator" data-v-343c80ca>...</span>b <span class="token punctuation" data-v-343c80ca>}</span> <span class="token punctuation" data-v-343c80ca>)</span> 
    <span class="token function" data-v-343c80ca>setC</span><span class="token punctuation" data-v-343c80ca>(</span> c<span class="token operator" data-v-343c80ca>+</span><span class="token number" data-v-343c80ca>1</span> <span class="token punctuation" data-v-343c80ca>)</span> 
    <span class="token function" data-v-343c80ca>setA</span><span class="token punctuation" data-v-343c80ca>(</span> a<span class="token operator" data-v-343c80ca>+</span><span class="token number" data-v-343c80ca>1</span> <span class="token punctuation" data-v-343c80ca>)</span>
    <span class="token punctuation" data-v-343c80ca>}</span><span class="token punctuation" data-v-343c80ca>)</span>
<span class="token punctuation" data-v-343c80ca>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-343c80ca><span class="line-number" data-v-343c80ca>1</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>2</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>3</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>4</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>5</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>6</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>7</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>8</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>9</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>10</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>11</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>12</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>13</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>14</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>15</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>16</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>17</span><br data-v-343c80ca></div></div><p data-v-343c80ca>我们会发现，上述两种情况 ，组件都更新渲染了三次 ，此时的批量更新失效了。这种情况在react-hooks中也普遍存在，这种情况甚至在hooks中更加明显，因为我们都知道hooks中每个useState保存了一个状态，并不是让class声明组件中，可以通过this.state统一协调状态，再一次异步函数中，比如说一次ajax请求后，想通过多个useState改变状态，会造成多次渲染页面，为了解决这个问题，我们可以手动批量更新。</p> <p data-v-343c80ca>react-dom 中提供了unstable_batchedUpdates方法进行手动批量更新。这个api更契合react-hooks，我们可以这样做。</p> <div class="language-jsx line-numbers-mode" data-v-343c80ca><pre class="language-jsx" data-v-343c80ca><code data-v-343c80ca> <span class="token keyword" data-v-343c80ca>const</span> <span class="token function-variable function" data-v-343c80ca>handerClick</span> <span class="token operator" data-v-343c80ca>=</span> <span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span> <span class="token operator" data-v-343c80ca>=&gt;</span> <span class="token punctuation" data-v-343c80ca>{</span>
    Promise<span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>resolve</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>then</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token operator" data-v-343c80ca>=&gt;</span><span class="token punctuation" data-v-343c80ca>{</span>
        <span class="token function" data-v-343c80ca>unstable_batchedUpdates</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token operator" data-v-343c80ca>=&gt;</span><span class="token punctuation" data-v-343c80ca>{</span>
            <span class="token function" data-v-343c80ca>setB</span><span class="token punctuation" data-v-343c80ca>(</span> <span class="token punctuation" data-v-343c80ca>{</span> <span class="token operator" data-v-343c80ca>...</span>b <span class="token punctuation" data-v-343c80ca>}</span> <span class="token punctuation" data-v-343c80ca>)</span> 
            <span class="token function" data-v-343c80ca>setC</span><span class="token punctuation" data-v-343c80ca>(</span> c<span class="token operator" data-v-343c80ca>+</span><span class="token number" data-v-343c80ca>1</span> <span class="token punctuation" data-v-343c80ca>)</span> 
            <span class="token function" data-v-343c80ca>setA</span><span class="token punctuation" data-v-343c80ca>(</span> a<span class="token operator" data-v-343c80ca>+</span><span class="token number" data-v-343c80ca>1</span> <span class="token punctuation" data-v-343c80ca>)</span>
        <span class="token punctuation" data-v-343c80ca>}</span><span class="token punctuation" data-v-343c80ca>)</span>
    <span class="token punctuation" data-v-343c80ca>}</span><span class="token punctuation" data-v-343c80ca>)</span>
<span class="token punctuation" data-v-343c80ca>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-343c80ca><span class="line-number" data-v-343c80ca>1</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>2</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>3</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>4</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>5</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>6</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>7</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>8</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>9</span><br data-v-343c80ca></div></div><p data-v-343c80ca>这样三次更新，就会合并成一次。同样达到了批量更新的效果。</p> <h3 id="合并state" data-v-343c80ca><a href="#合并state" class="header-anchor" data-v-343c80ca>#</a> 合并state</h3> <ol data-v-343c80ca><li data-v-343c80ca>class类组件(有状态组件)
合并state这种，是一种我们在react项目开发中要养成的习惯。我看过有些同学的代码中可能会这么写(如下demo是模拟的情况，实际要比这复杂的多)。</li></ol> <div class="language-jsx line-numbers-mode" data-v-343c80ca><pre class="language-jsx" data-v-343c80ca><code data-v-343c80ca><span class="token keyword" data-v-343c80ca>class</span> <span class="token class-name" data-v-343c80ca>Index</span> <span class="token keyword" data-v-343c80ca>extends</span> <span class="token class-name" data-v-343c80ca>React<span class="token punctuation" data-v-343c80ca>.</span>Component</span><span class="token operator" data-v-343c80ca>&lt;</span>any <span class="token punctuation" data-v-343c80ca>,</span> any<span class="token operator" data-v-343c80ca>&gt;</span><span class="token punctuation" data-v-343c80ca>{</span>
    state <span class="token operator" data-v-343c80ca>=</span> <span class="token punctuation" data-v-343c80ca>{</span>
          loading<span class="token operator" data-v-343c80ca>:</span><span class="token boolean" data-v-343c80ca>false</span> <span class="token comment" data-v-343c80ca>/* 用来模拟loading效果 */</span><span class="token punctuation" data-v-343c80ca>,</span>
          list<span class="token operator" data-v-343c80ca>:</span><span class="token punctuation" data-v-343c80ca>[</span><span class="token punctuation" data-v-343c80ca>]</span><span class="token punctuation" data-v-343c80ca>,</span>
    <span class="token punctuation" data-v-343c80ca>}</span>
    <span class="token function" data-v-343c80ca>componentDidMount</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>{</span>
        <span class="token comment" data-v-343c80ca>/* 模拟一个异步请求数据场景 */</span>
        <span class="token keyword" data-v-343c80ca>this</span><span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>setState</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>{</span> loading <span class="token operator" data-v-343c80ca>:</span> <span class="token boolean" data-v-343c80ca>true</span> <span class="token punctuation" data-v-343c80ca>}</span><span class="token punctuation" data-v-343c80ca>)</span> <span class="token comment" data-v-343c80ca>/* 开启loading效果 */</span>
        Promise<span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>resolve</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>then</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token operator" data-v-343c80ca>=&gt;</span><span class="token punctuation" data-v-343c80ca>{</span>
            <span class="token keyword" data-v-343c80ca>const</span> list <span class="token operator" data-v-343c80ca>=</span> <span class="token punctuation" data-v-343c80ca>[</span> <span class="token punctuation" data-v-343c80ca>{</span> id<span class="token operator" data-v-343c80ca>:</span><span class="token number" data-v-343c80ca>1</span> <span class="token punctuation" data-v-343c80ca>,</span> name<span class="token operator" data-v-343c80ca>:</span> <span class="token string" data-v-343c80ca>'xixi'</span> <span class="token punctuation" data-v-343c80ca>}</span> <span class="token punctuation" data-v-343c80ca>,</span><span class="token punctuation" data-v-343c80ca>{</span> id<span class="token operator" data-v-343c80ca>:</span><span class="token number" data-v-343c80ca>2</span> <span class="token punctuation" data-v-343c80ca>,</span> name<span class="token operator" data-v-343c80ca>:</span> <span class="token string" data-v-343c80ca>'haha'</span> <span class="token punctuation" data-v-343c80ca>}</span><span class="token punctuation" data-v-343c80ca>,</span><span class="token punctuation" data-v-343c80ca>{</span> id<span class="token operator" data-v-343c80ca>:</span><span class="token number" data-v-343c80ca>3</span> <span class="token punctuation" data-v-343c80ca>,</span> name<span class="token operator" data-v-343c80ca>:</span> <span class="token string" data-v-343c80ca>'heihei'</span> <span class="token punctuation" data-v-343c80ca>}</span> <span class="token punctuation" data-v-343c80ca>]</span>
            <span class="token keyword" data-v-343c80ca>this</span><span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>setState</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>{</span> loading <span class="token operator" data-v-343c80ca>:</span> <span class="token boolean" data-v-343c80ca>false</span> <span class="token punctuation" data-v-343c80ca>}</span><span class="token punctuation" data-v-343c80ca>,</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token operator" data-v-343c80ca>=&gt;</span><span class="token punctuation" data-v-343c80ca>{</span>
                <span class="token keyword" data-v-343c80ca>this</span><span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>setState</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>{</span>
                    list<span class="token operator" data-v-343c80ca>:</span>list<span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>map</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token parameter" data-v-343c80ca>item</span><span class="token operator" data-v-343c80ca>=&gt;</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>{</span>
                        <span class="token operator" data-v-343c80ca>...</span>item<span class="token punctuation" data-v-343c80ca>,</span>
                        name<span class="token operator" data-v-343c80ca>:</span>item<span class="token punctuation" data-v-343c80ca>.</span>name<span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>toLocaleUpperCase</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span>
                    <span class="token punctuation" data-v-343c80ca>}</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>)</span>
                <span class="token punctuation" data-v-343c80ca>}</span><span class="token punctuation" data-v-343c80ca>)</span>
            <span class="token punctuation" data-v-343c80ca>}</span><span class="token punctuation" data-v-343c80ca>)</span>
        <span class="token punctuation" data-v-343c80ca>}</span><span class="token punctuation" data-v-343c80ca>)</span>
    <span class="token punctuation" data-v-343c80ca>}</span>
    <span class="token function" data-v-343c80ca>render</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>{</span>
    <span class="token keyword" data-v-343c80ca>const</span> <span class="token punctuation" data-v-343c80ca>{</span> list <span class="token punctuation" data-v-343c80ca>}</span> <span class="token operator" data-v-343c80ca>=</span> <span class="token keyword" data-v-343c80ca>this</span><span class="token punctuation" data-v-343c80ca>.</span>state
    <span class="token keyword" data-v-343c80ca>return</span> <span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token punctuation" data-v-343c80ca>{</span>
            list<span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>map</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token parameter" data-v-343c80ca>item</span><span class="token operator" data-v-343c80ca>=&gt;</span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>div</span> <span class="token attr-name" data-v-343c80ca>key</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span>item<span class="token punctuation" data-v-343c80ca>.</span>id<span class="token punctuation" data-v-343c80ca>}</span></span>  <span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token punctuation" data-v-343c80ca>{</span> item<span class="token punctuation" data-v-343c80ca>.</span>name <span class="token punctuation" data-v-343c80ca>}</span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token punctuation" data-v-343c80ca>)</span>
        <span class="token punctuation" data-v-343c80ca>}</span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span>
    <span class="token punctuation" data-v-343c80ca>}</span>
<span class="token punctuation" data-v-343c80ca>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-343c80ca><span class="line-number" data-v-343c80ca>1</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>2</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>3</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>4</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>5</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>6</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>7</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>8</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>9</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>10</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>11</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>12</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>13</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>14</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>15</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>16</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>17</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>18</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>19</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>20</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>21</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>22</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>23</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>24</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>25</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>26</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>27</span><br data-v-343c80ca></div></div><p data-v-343c80ca>分别用两次this.state第一次解除loading状态，第二次格式化数据列表。这另两次更新完全没有必要，可以用一次setState更新完美解决。不这样做的原因是，对于像demo这样的简单结构还好，对于复杂的结构，一次更新可能都是宝贵的，所以我们应该学会去合并state。将上述demo这样修改。</p> <div class="language-jsx line-numbers-mode" data-v-343c80ca><pre class="language-jsx" data-v-343c80ca><code data-v-343c80ca><span class="token keyword" data-v-343c80ca>this</span><span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>setState</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>{</span>
    loading <span class="token operator" data-v-343c80ca>:</span> <span class="token boolean" data-v-343c80ca>false</span><span class="token punctuation" data-v-343c80ca>,</span>
    list<span class="token operator" data-v-343c80ca>:</span>list<span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>map</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token parameter" data-v-343c80ca>item</span><span class="token operator" data-v-343c80ca>=&gt;</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>{</span>
        <span class="token operator" data-v-343c80ca>...</span>item<span class="token punctuation" data-v-343c80ca>,</span>
        name<span class="token operator" data-v-343c80ca>:</span>item<span class="token punctuation" data-v-343c80ca>.</span>name<span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>toLocaleUpperCase</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span>
    <span class="token punctuation" data-v-343c80ca>}</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>)</span>
<span class="token punctuation" data-v-343c80ca>}</span><span class="token punctuation" data-v-343c80ca>)</span>
</code></pre> <div class="line-numbers-wrapper" data-v-343c80ca><span class="line-number" data-v-343c80ca>1</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>2</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>3</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>4</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>5</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>6</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>7</span><br data-v-343c80ca></div></div><ol start="2" data-v-343c80ca><li data-v-343c80ca>函数组件(无状态组件)
对于无状态组件，我们可以通过一个useState保存多个状态，没有必要每一个状态都用一个useState。</li></ol> <p data-v-343c80ca>对于这样的情况。</p> <div class="language-jsx line-numbers-mode" data-v-343c80ca><pre class="language-jsx" data-v-343c80ca><code data-v-343c80ca><span class="token keyword" data-v-343c80ca>const</span> <span class="token punctuation" data-v-343c80ca>[</span> a <span class="token punctuation" data-v-343c80ca>,</span>setA <span class="token punctuation" data-v-343c80ca>]</span> <span class="token operator" data-v-343c80ca>=</span> <span class="token function" data-v-343c80ca>useState</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token number" data-v-343c80ca>1</span><span class="token punctuation" data-v-343c80ca>)</span>
<span class="token keyword" data-v-343c80ca>const</span> <span class="token punctuation" data-v-343c80ca>[</span> b <span class="token punctuation" data-v-343c80ca>,</span>setB <span class="token punctuation" data-v-343c80ca>]</span> <span class="token operator" data-v-343c80ca>=</span> <span class="token function" data-v-343c80ca>useState</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token number" data-v-343c80ca>2</span><span class="token punctuation" data-v-343c80ca>)</span>
</code></pre> <div class="line-numbers-wrapper" data-v-343c80ca><span class="line-number" data-v-343c80ca>1</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>2</span><br data-v-343c80ca></div></div><p data-v-343c80ca>我们完全可以一个state搞定。</p> <div class="language-jsx line-numbers-mode" data-v-343c80ca><pre class="language-jsx" data-v-343c80ca><code data-v-343c80ca><span class="token keyword" data-v-343c80ca>const</span> <span class="token punctuation" data-v-343c80ca>[</span> numberState <span class="token punctuation" data-v-343c80ca>,</span> setNumberState <span class="token punctuation" data-v-343c80ca>]</span> <span class="token operator" data-v-343c80ca>=</span> <span class="token function" data-v-343c80ca>useState</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>{</span> a<span class="token operator" data-v-343c80ca>:</span><span class="token number" data-v-343c80ca>1</span> <span class="token punctuation" data-v-343c80ca>,</span> b <span class="token operator" data-v-343c80ca>:</span><span class="token number" data-v-343c80ca>2</span><span class="token punctuation" data-v-343c80ca>}</span><span class="token punctuation" data-v-343c80ca>)</span>
</code></pre> <div class="line-numbers-wrapper" data-v-343c80ca><span class="line-number" data-v-343c80ca>1</span><br data-v-343c80ca></div></div><p data-v-343c80ca>但是要注意，如果我们的state已经成为 useEffect , useCallback , useMemo依赖项，请慎用如上方法。</p> <h3 id="usememo-react-memo隔离单元" data-v-343c80ca><a href="#usememo-react-memo隔离单元" class="header-anchor" data-v-343c80ca>#</a> useMemo React.memo隔离单元</h3> <p data-v-343c80ca>react正常的更新流，就像利剑一下，从父组件项子组件穿透，为了避免这些重复的更新渲染，shouldComponentUpdate , React.memo等api也应运而生。但是有的情况下，多余的更新在所难免，比如如下这种情况。这种更新会由父组件 -&gt; 子组件 传递下去。
</p><div style="width:400px;" data-v-343c80ca><img src="/vuebloger/img/post/Snipaste_2021-10-05_14-34-56.jpg" alt="" data-v-343c80ca></div><p data-v-343c80ca></p> <div class="language-jsx line-numbers-mode" data-v-343c80ca><pre class="language-jsx" data-v-343c80ca><code data-v-343c80ca><span class="token keyword" data-v-343c80ca>function</span> <span class="token function" data-v-343c80ca>ChildrenComponent</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>{</span>
    console<span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>log</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token number" data-v-343c80ca>2222</span><span class="token punctuation" data-v-343c80ca>)</span>
    <span class="token keyword" data-v-343c80ca>return</span> <span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>hello,world</span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span>
<span class="token punctuation" data-v-343c80ca>}</span>
<span class="token keyword" data-v-343c80ca>function</span> <span class="token function" data-v-343c80ca>Index</span> <span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>{</span>
    <span class="token keyword" data-v-343c80ca>const</span> <span class="token punctuation" data-v-343c80ca>[</span> list  <span class="token punctuation" data-v-343c80ca>]</span> <span class="token operator" data-v-343c80ca>=</span> <span class="token function" data-v-343c80ca>useState</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>[</span> <span class="token punctuation" data-v-343c80ca>{</span> id<span class="token operator" data-v-343c80ca>:</span><span class="token number" data-v-343c80ca>1</span> <span class="token punctuation" data-v-343c80ca>,</span> name<span class="token operator" data-v-343c80ca>:</span> <span class="token string" data-v-343c80ca>'xixi'</span> <span class="token punctuation" data-v-343c80ca>}</span> <span class="token punctuation" data-v-343c80ca>,</span><span class="token punctuation" data-v-343c80ca>{</span> id<span class="token operator" data-v-343c80ca>:</span><span class="token number" data-v-343c80ca>2</span> <span class="token punctuation" data-v-343c80ca>,</span> name<span class="token operator" data-v-343c80ca>:</span> <span class="token string" data-v-343c80ca>'haha'</span> <span class="token punctuation" data-v-343c80ca>}</span><span class="token punctuation" data-v-343c80ca>,</span><span class="token punctuation" data-v-343c80ca>{</span> id<span class="token operator" data-v-343c80ca>:</span><span class="token number" data-v-343c80ca>3</span> <span class="token punctuation" data-v-343c80ca>,</span> name<span class="token operator" data-v-343c80ca>:</span> <span class="token string" data-v-343c80ca>'heihei'</span> <span class="token punctuation" data-v-343c80ca>}</span> <span class="token punctuation" data-v-343c80ca>]</span><span class="token punctuation" data-v-343c80ca>)</span>
    <span class="token keyword" data-v-343c80ca>const</span> <span class="token punctuation" data-v-343c80ca>[</span> number <span class="token punctuation" data-v-343c80ca>,</span> setNumber <span class="token punctuation" data-v-343c80ca>]</span> <span class="token operator" data-v-343c80ca>=</span> <span class="token function" data-v-343c80ca>useState</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token number" data-v-343c80ca>0</span><span class="token punctuation" data-v-343c80ca>)</span>
    <span class="token keyword" data-v-343c80ca>return</span> <span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
       </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>span</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token punctuation" data-v-343c80ca>{</span> number <span class="token punctuation" data-v-343c80ca>}</span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>span</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
       </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>button</span> <span class="token attr-name" data-v-343c80ca>onClick</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span> <span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token operator" data-v-343c80ca>=&gt;</span> <span class="token function" data-v-343c80ca>setNumber</span><span class="token punctuation" data-v-343c80ca>(</span>number <span class="token operator" data-v-343c80ca>+</span> <span class="token number" data-v-343c80ca>1</span><span class="token punctuation" data-v-343c80ca>)</span> <span class="token punctuation" data-v-343c80ca>}</span></span> <span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>点击</span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>button</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
           </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>ul</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
               </span><span class="token punctuation" data-v-343c80ca>{</span>
                list<span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>map</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token parameter" data-v-343c80ca>item</span><span class="token operator" data-v-343c80ca>=&gt;</span><span class="token punctuation" data-v-343c80ca>{</span>
                    console<span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>log</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token number" data-v-343c80ca>1111</span><span class="token punctuation" data-v-343c80ca>)</span>
                    <span class="token keyword" data-v-343c80ca>return</span> <span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>li</span> <span class="token attr-name" data-v-343c80ca>key</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span> item<span class="token punctuation" data-v-343c80ca>.</span>id <span class="token punctuation" data-v-343c80ca>}</span></span>  <span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token punctuation" data-v-343c80ca>{</span> item<span class="token punctuation" data-v-343c80ca>.</span>name <span class="token punctuation" data-v-343c80ca>}</span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>li</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span>
                <span class="token punctuation" data-v-343c80ca>}</span><span class="token punctuation" data-v-343c80ca>)</span>
               <span class="token punctuation" data-v-343c80ca>}</span><span class="token plain-text" data-v-343c80ca>
           </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>ul</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
           </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span><span class="token class-name" data-v-343c80ca>ChildrenComponent</span></span> <span class="token punctuation" data-v-343c80ca>/&gt;</span></span><span class="token plain-text" data-v-343c80ca>
    </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span>
<span class="token punctuation" data-v-343c80ca>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-343c80ca><span class="line-number" data-v-343c80ca>1</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>2</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>3</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>4</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>5</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>6</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>7</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>8</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>9</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>10</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>11</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>12</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>13</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>14</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>15</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>16</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>17</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>18</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>19</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>20</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>21</span><br data-v-343c80ca></div></div><p data-v-343c80ca>效果：</p> <p data-v-343c80ca><img src="/vuebloger/img/post/34wdsdfs.gif" alt="" data-v-343c80ca></p> <p data-v-343c80ca>针对这一现象，我们可以通过使用useMemo进行隔离，形成独立的渲染单元，每次更新上一个状态会被缓存，循环不会再执行，子组件也不会再次被渲染,我们可以这么做。</p> <ol data-v-343c80ca><li data-v-343c80ca>无状态组件</li></ol> <div class="language-jsx line-numbers-mode" data-v-343c80ca><pre class="language-jsx" data-v-343c80ca><code data-v-343c80ca><span class="token keyword" data-v-343c80ca>function</span> <span class="token function" data-v-343c80ca>Index</span> <span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>{</span>
    <span class="token keyword" data-v-343c80ca>const</span> <span class="token punctuation" data-v-343c80ca>[</span> list  <span class="token punctuation" data-v-343c80ca>]</span> <span class="token operator" data-v-343c80ca>=</span> <span class="token function" data-v-343c80ca>useState</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>[</span> <span class="token punctuation" data-v-343c80ca>{</span> id<span class="token operator" data-v-343c80ca>:</span><span class="token number" data-v-343c80ca>1</span> <span class="token punctuation" data-v-343c80ca>,</span> name<span class="token operator" data-v-343c80ca>:</span> <span class="token string" data-v-343c80ca>'xixi'</span> <span class="token punctuation" data-v-343c80ca>}</span> <span class="token punctuation" data-v-343c80ca>,</span><span class="token punctuation" data-v-343c80ca>{</span> id<span class="token operator" data-v-343c80ca>:</span><span class="token number" data-v-343c80ca>2</span> <span class="token punctuation" data-v-343c80ca>,</span> name<span class="token operator" data-v-343c80ca>:</span> <span class="token string" data-v-343c80ca>'haha'</span> <span class="token punctuation" data-v-343c80ca>}</span><span class="token punctuation" data-v-343c80ca>,</span><span class="token punctuation" data-v-343c80ca>{</span> id<span class="token operator" data-v-343c80ca>:</span><span class="token number" data-v-343c80ca>3</span> <span class="token punctuation" data-v-343c80ca>,</span> name<span class="token operator" data-v-343c80ca>:</span> <span class="token string" data-v-343c80ca>'heihei'</span> <span class="token punctuation" data-v-343c80ca>}</span> <span class="token punctuation" data-v-343c80ca>]</span><span class="token punctuation" data-v-343c80ca>)</span>
    <span class="token keyword" data-v-343c80ca>const</span> <span class="token punctuation" data-v-343c80ca>[</span> number <span class="token punctuation" data-v-343c80ca>,</span> setNumber <span class="token punctuation" data-v-343c80ca>]</span> <span class="token operator" data-v-343c80ca>=</span> <span class="token function" data-v-343c80ca>useState</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token number" data-v-343c80ca>0</span><span class="token punctuation" data-v-343c80ca>)</span>
    <span class="token keyword" data-v-343c80ca>return</span> <span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
       </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>span</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token punctuation" data-v-343c80ca>{</span> number <span class="token punctuation" data-v-343c80ca>}</span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>span</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
       </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>button</span> <span class="token attr-name" data-v-343c80ca>onClick</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span> <span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token operator" data-v-343c80ca>=&gt;</span> <span class="token function" data-v-343c80ca>setNumber</span><span class="token punctuation" data-v-343c80ca>(</span>number <span class="token operator" data-v-343c80ca>+</span> <span class="token number" data-v-343c80ca>1</span><span class="token punctuation" data-v-343c80ca>)</span> <span class="token punctuation" data-v-343c80ca>}</span></span> <span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>点击</span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>button</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
           </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>ul</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
               </span><span class="token punctuation" data-v-343c80ca>{</span>
                <span class="token function" data-v-343c80ca>useMemo</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token operator" data-v-343c80ca>=&gt;</span><span class="token punctuation" data-v-343c80ca>(</span>list<span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>map</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token parameter" data-v-343c80ca>item</span><span class="token operator" data-v-343c80ca>=&gt;</span><span class="token punctuation" data-v-343c80ca>{</span>
                    console<span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>log</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token number" data-v-343c80ca>1111</span><span class="token punctuation" data-v-343c80ca>)</span>
                    <span class="token keyword" data-v-343c80ca>return</span> <span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>li</span> <span class="token attr-name" data-v-343c80ca>key</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span> item<span class="token punctuation" data-v-343c80ca>.</span>id <span class="token punctuation" data-v-343c80ca>}</span></span>  <span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token punctuation" data-v-343c80ca>{</span> item<span class="token punctuation" data-v-343c80ca>.</span>name <span class="token punctuation" data-v-343c80ca>}</span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>li</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span>
                <span class="token punctuation" data-v-343c80ca>}</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>,</span><span class="token punctuation" data-v-343c80ca>[</span> list <span class="token punctuation" data-v-343c80ca>]</span><span class="token punctuation" data-v-343c80ca>)</span>
               <span class="token punctuation" data-v-343c80ca>}</span><span class="token plain-text" data-v-343c80ca>
           </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>ul</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
        </span><span class="token punctuation" data-v-343c80ca>{</span> <span class="token function" data-v-343c80ca>useMemo</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token operator" data-v-343c80ca>=&gt;</span> <span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span><span class="token class-name" data-v-343c80ca>ChildrenComponent</span></span> <span class="token punctuation" data-v-343c80ca>/&gt;</span></span><span class="token punctuation" data-v-343c80ca>,</span><span class="token punctuation" data-v-343c80ca>[</span><span class="token punctuation" data-v-343c80ca>]</span><span class="token punctuation" data-v-343c80ca>)</span> <span class="token punctuation" data-v-343c80ca>}</span><span class="token plain-text" data-v-343c80ca>
    </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span>
<span class="token punctuation" data-v-343c80ca>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-343c80ca><span class="line-number" data-v-343c80ca>1</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>2</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>3</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>4</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>5</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>6</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>7</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>8</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>9</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>10</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>11</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>12</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>13</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>14</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>15</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>16</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>17</span><br data-v-343c80ca></div></div><ol start="2" data-v-343c80ca><li data-v-343c80ca>有状态组件：
在class声明的组件中，没有像 useMemo 的API ，但是也并不等于束手无策，我们可以通过 react.memo 来阻拦来自组件本身的更新。我们可以写一个组件，来控制react 组件更新的方向。我们通过一个 <code data-v-343c80ca>&lt;NotUpdate&gt;</code> 组件来阻断更新流。</li></ol> <div class="language-jsx line-numbers-mode" data-v-343c80ca><pre class="language-jsx" data-v-343c80ca><code data-v-343c80ca><span class="token comment" data-v-343c80ca>/* 控制更新 ,第二个参数可以作为组件更新的依赖 ， 这里设置为 ()=&gt; true 只渲染一次 */</span>
<span class="token keyword" data-v-343c80ca>const</span> NotUpdate <span class="token operator" data-v-343c80ca>=</span> React<span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>memo</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token parameter" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>{</span> children <span class="token punctuation" data-v-343c80ca>}</span><span class="token operator" data-v-343c80ca>:</span>any</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token operator" data-v-343c80ca>=&gt;</span> <span class="token keyword" data-v-343c80ca>typeof</span> children <span class="token operator" data-v-343c80ca>===</span> <span class="token string" data-v-343c80ca>'function'</span> <span class="token operator" data-v-343c80ca>?</span> <span class="token function" data-v-343c80ca>children</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span> <span class="token operator" data-v-343c80ca>:</span> children <span class="token punctuation" data-v-343c80ca>,</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token operator" data-v-343c80ca>=&gt;</span><span class="token boolean" data-v-343c80ca>true</span><span class="token punctuation" data-v-343c80ca>)</span>

<span class="token keyword" data-v-343c80ca>class</span> <span class="token class-name" data-v-343c80ca>Index</span> <span class="token keyword" data-v-343c80ca>extends</span> <span class="token class-name" data-v-343c80ca>React<span class="token punctuation" data-v-343c80ca>.</span>Component</span><span class="token operator" data-v-343c80ca>&lt;</span>any<span class="token punctuation" data-v-343c80ca>,</span>any<span class="token operator" data-v-343c80ca>&gt;</span><span class="token punctuation" data-v-343c80ca>{</span>
    <span class="token function" data-v-343c80ca>constructor</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token parameter" data-v-343c80ca>prop</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>{</span>
        <span class="token keyword" data-v-343c80ca>super</span><span class="token punctuation" data-v-343c80ca>(</span>prop<span class="token punctuation" data-v-343c80ca>)</span>
        <span class="token keyword" data-v-343c80ca>this</span><span class="token punctuation" data-v-343c80ca>.</span>state <span class="token operator" data-v-343c80ca>=</span> <span class="token punctuation" data-v-343c80ca>{</span> 
            list<span class="token operator" data-v-343c80ca>:</span> <span class="token punctuation" data-v-343c80ca>[</span> <span class="token punctuation" data-v-343c80ca>{</span> id<span class="token operator" data-v-343c80ca>:</span><span class="token number" data-v-343c80ca>1</span> <span class="token punctuation" data-v-343c80ca>,</span> name<span class="token operator" data-v-343c80ca>:</span> <span class="token string" data-v-343c80ca>'xixi'</span> <span class="token punctuation" data-v-343c80ca>}</span> <span class="token punctuation" data-v-343c80ca>,</span><span class="token punctuation" data-v-343c80ca>{</span> id<span class="token operator" data-v-343c80ca>:</span><span class="token number" data-v-343c80ca>2</span> <span class="token punctuation" data-v-343c80ca>,</span> name<span class="token operator" data-v-343c80ca>:</span> <span class="token string" data-v-343c80ca>'haha'</span> <span class="token punctuation" data-v-343c80ca>}</span><span class="token punctuation" data-v-343c80ca>,</span><span class="token punctuation" data-v-343c80ca>{</span> id<span class="token operator" data-v-343c80ca>:</span><span class="token number" data-v-343c80ca>3</span> <span class="token punctuation" data-v-343c80ca>,</span> name<span class="token operator" data-v-343c80ca>:</span> <span class="token string" data-v-343c80ca>'heihei'</span> <span class="token punctuation" data-v-343c80ca>}</span> <span class="token punctuation" data-v-343c80ca>]</span><span class="token punctuation" data-v-343c80ca>,</span>
            number<span class="token operator" data-v-343c80ca>:</span><span class="token number" data-v-343c80ca>0</span><span class="token punctuation" data-v-343c80ca>,</span>
         <span class="token punctuation" data-v-343c80ca>}</span>
    <span class="token punctuation" data-v-343c80ca>}</span>
    <span class="token function-variable function" data-v-343c80ca>handerClick</span> <span class="token operator" data-v-343c80ca>=</span> <span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token operator" data-v-343c80ca>=&gt;</span><span class="token punctuation" data-v-343c80ca>{</span>
        <span class="token keyword" data-v-343c80ca>this</span><span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>setState</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>{</span> number<span class="token operator" data-v-343c80ca>:</span><span class="token keyword" data-v-343c80ca>this</span><span class="token punctuation" data-v-343c80ca>.</span>state<span class="token punctuation" data-v-343c80ca>.</span>number <span class="token operator" data-v-343c80ca>+</span> <span class="token number" data-v-343c80ca>1</span> <span class="token punctuation" data-v-343c80ca>}</span><span class="token punctuation" data-v-343c80ca>)</span>
    <span class="token punctuation" data-v-343c80ca>}</span>
    <span class="token function" data-v-343c80ca>render</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>{</span>
       <span class="token keyword" data-v-343c80ca>const</span> <span class="token punctuation" data-v-343c80ca>{</span> list <span class="token punctuation" data-v-343c80ca>}</span><span class="token operator" data-v-343c80ca>:</span>any <span class="token operator" data-v-343c80ca>=</span> <span class="token keyword" data-v-343c80ca>this</span><span class="token punctuation" data-v-343c80ca>.</span>state
       <span class="token keyword" data-v-343c80ca>return</span> <span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
           </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>button</span> <span class="token attr-name" data-v-343c80ca>onClick</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span> <span class="token keyword" data-v-343c80ca>this</span><span class="token punctuation" data-v-343c80ca>.</span>handerClick <span class="token punctuation" data-v-343c80ca>}</span></span> <span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>点击</span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>button</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
           </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span><span class="token class-name" data-v-343c80ca>NotUpdate</span></span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
              </span><span class="token punctuation" data-v-343c80ca>{</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token operator" data-v-343c80ca>=&gt;</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>ul</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
                    </span><span class="token punctuation" data-v-343c80ca>{</span>
                    list<span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>map</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token parameter" data-v-343c80ca>item</span><span class="token operator" data-v-343c80ca>=&gt;</span><span class="token punctuation" data-v-343c80ca>{</span>
                        console<span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>log</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token number" data-v-343c80ca>1111</span><span class="token punctuation" data-v-343c80ca>)</span>
                        <span class="token keyword" data-v-343c80ca>return</span> <span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>li</span> <span class="token attr-name" data-v-343c80ca>key</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span> item<span class="token punctuation" data-v-343c80ca>.</span>id <span class="token punctuation" data-v-343c80ca>}</span></span>  <span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token punctuation" data-v-343c80ca>{</span> item<span class="token punctuation" data-v-343c80ca>.</span>name <span class="token punctuation" data-v-343c80ca>}</span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>li</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span>
                    <span class="token punctuation" data-v-343c80ca>}</span><span class="token punctuation" data-v-343c80ca>)</span>
                    <span class="token punctuation" data-v-343c80ca>}</span><span class="token plain-text" data-v-343c80ca>
                </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>ul</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>}</span><span class="token plain-text" data-v-343c80ca>
           </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span><span class="token class-name" data-v-343c80ca>NotUpdate</span></span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
           </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span><span class="token class-name" data-v-343c80ca>NotUpdate</span></span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
                </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span><span class="token class-name" data-v-343c80ca>ChildrenComponent</span></span> <span class="token punctuation" data-v-343c80ca>/&gt;</span></span><span class="token plain-text" data-v-343c80ca>
           </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span><span class="token class-name" data-v-343c80ca>NotUpdate</span></span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
          
       </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span>
    <span class="token punctuation" data-v-343c80ca>}</span>
<span class="token punctuation" data-v-343c80ca>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-343c80ca><span class="line-number" data-v-343c80ca>1</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>2</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>3</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>4</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>5</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>6</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>7</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>8</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>9</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>10</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>11</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>12</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>13</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>14</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>15</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>16</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>17</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>18</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>19</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>20</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>21</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>22</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>23</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>24</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>25</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>26</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>27</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>28</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>29</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>30</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>31</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>32</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>33</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>34</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>35</span><br data-v-343c80ca></div></div><p data-v-343c80ca>NotUpdate组件:</p> <div class="language-jsx line-numbers-mode" data-v-343c80ca><pre class="language-jsx" data-v-343c80ca><code data-v-343c80ca><span class="token keyword" data-v-343c80ca>const</span> NotUpdate <span class="token operator" data-v-343c80ca>=</span> React<span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>memo</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token parameter" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>{</span> children <span class="token punctuation" data-v-343c80ca>}</span><span class="token operator" data-v-343c80ca>:</span>any</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token operator" data-v-343c80ca>=&gt;</span> <span class="token keyword" data-v-343c80ca>typeof</span> children <span class="token operator" data-v-343c80ca>===</span> <span class="token string" data-v-343c80ca>'function'</span> <span class="token operator" data-v-343c80ca>?</span> <span class="token function" data-v-343c80ca>children</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span> <span class="token operator" data-v-343c80ca>:</span> children <span class="token punctuation" data-v-343c80ca>,</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token operator" data-v-343c80ca>=&gt;</span><span class="token boolean" data-v-343c80ca>true</span><span class="token punctuation" data-v-343c80ca>)</span>
</code></pre> <div class="line-numbers-wrapper" data-v-343c80ca><span class="line-number" data-v-343c80ca>1</span><br data-v-343c80ca></div></div><p data-v-343c80ca>原理：
</p><div style="width:400px;" data-v-343c80ca><img src="/vuebloger/img/post/Snipaste_2021-10-05_14-37-37.jpg" alt="" data-v-343c80ca></div><p data-v-343c80ca></p> <p data-v-343c80ca>没错，用的就是 React.memo，生成了阻断更新的隔离单元，如果我们想要控制更新，可以对 React.memo 第二个参数入手， demo项目中完全阻断的更新。</p> <h3 id="取缔state，学会使用缓存。" data-v-343c80ca><a href="#取缔state，学会使用缓存。" class="header-anchor" data-v-343c80ca>#</a> 取缔state，学会使用缓存。</h3> <p data-v-343c80ca>这里的取缔state，并完全不使用state来管理数据，而是善于使用state,知道什么时候使用,怎么使用。react 并不像 vue 那样响应式数据流。 在 vue中 有专门的dep做依赖收集，可以自动收集字符串模版的依赖项，只要没有引用的data数据， 通过 this.aaa = bbb ,在vue中是不会更新渲染的。因为 aaa 的dep没有收集渲染watcher依赖项。在react中，我们触发this.setState 或者 useState，只会关心两次state值是否相同，来触发渲染，根本不会在乎jsx语法中是否真正的引入了正确的值。</p> <ol data-v-343c80ca><li data-v-343c80ca>没有更新作用的state
有状态组件中:</li></ol> <div class="language-jsx line-numbers-mode" data-v-343c80ca><pre class="language-jsx" data-v-343c80ca><code data-v-343c80ca><span class="token keyword" data-v-343c80ca>class</span> <span class="token class-name" data-v-343c80ca>Demo</span> <span class="token keyword" data-v-343c80ca>extends</span> <span class="token class-name" data-v-343c80ca>React<span class="token punctuation" data-v-343c80ca>.</span>Component</span><span class="token punctuation" data-v-343c80ca>{</span>
    state<span class="token operator" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span> text<span class="token operator" data-v-343c80ca>:</span><span class="token number" data-v-343c80ca>111</span> <span class="token punctuation" data-v-343c80ca>}</span>
    <span class="token function" data-v-343c80ca>componentDidMount</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>{</span>
        <span class="token keyword" data-v-343c80ca>const</span> <span class="token punctuation" data-v-343c80ca>{</span> a <span class="token punctuation" data-v-343c80ca>}</span> <span class="token operator" data-v-343c80ca>=</span> <span class="token keyword" data-v-343c80ca>this</span><span class="token punctuation" data-v-343c80ca>.</span>props
         <span class="token comment" data-v-343c80ca>/* 我们只是希望在初始化,用text记录 props中 a 的值 */</span>
        <span class="token keyword" data-v-343c80ca>this</span><span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>setState</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>{</span>
            text<span class="token operator" data-v-343c80ca>:</span>a
        <span class="token punctuation" data-v-343c80ca>}</span><span class="token punctuation" data-v-343c80ca>)</span>    
    <span class="token punctuation" data-v-343c80ca>}</span>
    <span class="token function" data-v-343c80ca>render</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>{</span>
        <span class="token comment" data-v-343c80ca>/* 没有引入text */</span>
       <span class="token keyword" data-v-343c80ca>return</span> <span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token punctuation" data-v-343c80ca>{</span><span class="token string" data-v-343c80ca>'hello,world'</span><span class="token punctuation" data-v-343c80ca>}</span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span>
    <span class="token punctuation" data-v-343c80ca>}</span>
<span class="token punctuation" data-v-343c80ca>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-343c80ca><span class="line-number" data-v-343c80ca>1</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>2</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>3</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>4</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>5</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>6</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>7</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>8</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>9</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>10</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>11</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>12</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>13</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>14</span><br data-v-343c80ca></div></div><p data-v-343c80ca>如上例子中,render函数中并没有引入text ,我们只是希望在初始化的时候，用 text 记录 props 中 a 的值。我们却用 setState 触发了一次无用的更新。无状态组件中情况也一样存在，具体如下。</p> <p data-v-343c80ca>无状态组件中:</p> <div class="language-jsx line-numbers-mode" data-v-343c80ca><pre class="language-jsx" data-v-343c80ca><code data-v-343c80ca><span class="token keyword" data-v-343c80ca>function</span> <span class="token function" data-v-343c80ca>Demo</span> <span class="token punctuation" data-v-343c80ca>(</span><span class="token parameter" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>{</span> a <span class="token punctuation" data-v-343c80ca>}</span></span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>{</span>
    <span class="token keyword" data-v-343c80ca>const</span> <span class="token punctuation" data-v-343c80ca>[</span>text <span class="token punctuation" data-v-343c80ca>,</span> setText<span class="token punctuation" data-v-343c80ca>]</span> <span class="token operator" data-v-343c80ca>=</span> <span class="token function" data-v-343c80ca>useState</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token number" data-v-343c80ca>111</span><span class="token punctuation" data-v-343c80ca>)</span>
    <span class="token function" data-v-343c80ca>useEffect</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token operator" data-v-343c80ca>=&gt;</span><span class="token punctuation" data-v-343c80ca>{</span>
        <span class="token function" data-v-343c80ca>setText</span><span class="token punctuation" data-v-343c80ca>(</span>a<span class="token punctuation" data-v-343c80ca>)</span>
    <span class="token punctuation" data-v-343c80ca>}</span><span class="token punctuation" data-v-343c80ca>,</span><span class="token punctuation" data-v-343c80ca>[</span><span class="token punctuation" data-v-343c80ca>]</span><span class="token punctuation" data-v-343c80ca>)</span>
    <span class="token keyword" data-v-343c80ca>return</span> <span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
         </span><span class="token punctuation" data-v-343c80ca>{</span><span class="token string" data-v-343c80ca>'hello,world'</span><span class="token punctuation" data-v-343c80ca>}</span><span class="token plain-text" data-v-343c80ca>
    </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span>
<span class="token punctuation" data-v-343c80ca>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-343c80ca><span class="line-number" data-v-343c80ca>1</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>2</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>3</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>4</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>5</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>6</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>7</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>8</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>9</span><br data-v-343c80ca></div></div><ol start="2" data-v-343c80ca><li data-v-343c80ca>改为缓存
有状态组件中: 在class声明组件中，我们可以直接把数据绑定给this上，来作为数据缓存。</li></ol> <div class="language-jsx line-numbers-mode" data-v-343c80ca><pre class="language-jsx" data-v-343c80ca><code data-v-343c80ca><span class="token keyword" data-v-343c80ca>class</span> <span class="token class-name" data-v-343c80ca>Demo</span> <span class="token keyword" data-v-343c80ca>extends</span> <span class="token class-name" data-v-343c80ca>React<span class="token punctuation" data-v-343c80ca>.</span>Component</span><span class="token punctuation" data-v-343c80ca>{</span>
    text <span class="token operator" data-v-343c80ca>=</span> <span class="token number" data-v-343c80ca>111</span>
    <span class="token function" data-v-343c80ca>componentDidMount</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>{</span>
        <span class="token keyword" data-v-343c80ca>const</span> <span class="token punctuation" data-v-343c80ca>{</span> a <span class="token punctuation" data-v-343c80ca>}</span> <span class="token operator" data-v-343c80ca>=</span> <span class="token keyword" data-v-343c80ca>this</span><span class="token punctuation" data-v-343c80ca>.</span>props
        <span class="token comment" data-v-343c80ca>/* 数据直接保存在text上 */</span>
        <span class="token keyword" data-v-343c80ca>this</span><span class="token punctuation" data-v-343c80ca>.</span>text <span class="token operator" data-v-343c80ca>=</span> a
    <span class="token punctuation" data-v-343c80ca>}</span>
    <span class="token function" data-v-343c80ca>render</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>{</span>
        <span class="token comment" data-v-343c80ca>/* 没有引入text */</span>
       <span class="token keyword" data-v-343c80ca>return</span> <span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token punctuation" data-v-343c80ca>{</span><span class="token string" data-v-343c80ca>'hello,world'</span><span class="token punctuation" data-v-343c80ca>}</span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span>
    <span class="token punctuation" data-v-343c80ca>}</span>
<span class="token punctuation" data-v-343c80ca>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-343c80ca><span class="line-number" data-v-343c80ca>1</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>2</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>3</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>4</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>5</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>6</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>7</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>8</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>9</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>10</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>11</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>12</span><br data-v-343c80ca></div></div><p data-v-343c80ca>无状态组件中: 在无状态组件中, 我们不能往问this,但是我们可以用useRef来解决问题。</p> <div class="language-jsx line-numbers-mode" data-v-343c80ca><pre class="language-jsx" data-v-343c80ca><code data-v-343c80ca><span class="token keyword" data-v-343c80ca>function</span> <span class="token function" data-v-343c80ca>Demo</span> <span class="token punctuation" data-v-343c80ca>(</span><span class="token parameter" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>{</span> a <span class="token punctuation" data-v-343c80ca>}</span></span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>{</span>
    <span class="token keyword" data-v-343c80ca>const</span> text <span class="token operator" data-v-343c80ca>=</span> <span class="token function" data-v-343c80ca>useRef</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token number" data-v-343c80ca>111</span><span class="token punctuation" data-v-343c80ca>)</span>
    <span class="token function" data-v-343c80ca>useEffect</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token operator" data-v-343c80ca>=&gt;</span><span class="token punctuation" data-v-343c80ca>{</span>
        text<span class="token punctuation" data-v-343c80ca>.</span>current <span class="token operator" data-v-343c80ca>=</span> a
    <span class="token punctuation" data-v-343c80ca>}</span><span class="token punctuation" data-v-343c80ca>,</span><span class="token punctuation" data-v-343c80ca>[</span><span class="token punctuation" data-v-343c80ca>]</span><span class="token punctuation" data-v-343c80ca>)</span>
    <span class="token keyword" data-v-343c80ca>return</span> <span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
        </span><span class="token punctuation" data-v-343c80ca>{</span><span class="token string" data-v-343c80ca>'hello,world'</span><span class="token punctuation" data-v-343c80ca>}</span><span class="token plain-text" data-v-343c80ca>
    </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span>
<span class="token punctuation" data-v-343c80ca>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-343c80ca><span class="line-number" data-v-343c80ca>1</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>2</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>3</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>4</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>5</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>6</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>7</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>8</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>9</span><br data-v-343c80ca></div></div><h3 id="usecallback回调" data-v-343c80ca><a href="#usecallback回调" class="header-anchor" data-v-343c80ca>#</a> useCallback回调</h3> <p data-v-343c80ca>useCallback 的真正目的还是在于缓存了每次渲染时 inline callback 的实例，这样方便配合上子组件的 shouldComponentUpdate 或者 React.memo 起到减少不必要的渲染的作用。对子组件的渲染限定来源与，对子组件props比较，但是如果对父组件的callback做比较，无状态组件每次渲染执行，都会形成新的callback ,是无法比较，所以需要对callback做一个 memoize 记忆功能，我们可以理解为useCallback就是 callback加了一个memoize。我们接着往下看👇👇👇。</p> <div class="language-jsx line-numbers-mode" data-v-343c80ca><pre class="language-jsx" data-v-343c80ca><code data-v-343c80ca><span class="token keyword" data-v-343c80ca>function</span> <span class="token function" data-v-343c80ca>demo</span> <span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>{</span>
    <span class="token keyword" data-v-343c80ca>const</span> <span class="token punctuation" data-v-343c80ca>[</span> number <span class="token punctuation" data-v-343c80ca>,</span> setNumber <span class="token punctuation" data-v-343c80ca>]</span> <span class="token operator" data-v-343c80ca>=</span> <span class="token function" data-v-343c80ca>useState</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token number" data-v-343c80ca>0</span><span class="token punctuation" data-v-343c80ca>)</span>
    <span class="token keyword" data-v-343c80ca>return</span> <span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>  
        </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span><span class="token class-name" data-v-343c80ca>DemoComponent</span></span>  <span class="token attr-name" data-v-343c80ca>handerChange</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span> <span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token operator" data-v-343c80ca>=&gt;</span><span class="token punctuation" data-v-343c80ca>{</span> <span class="token function" data-v-343c80ca>setNumber</span><span class="token punctuation" data-v-343c80ca>(</span>number<span class="token operator" data-v-343c80ca>+</span><span class="token number" data-v-343c80ca>1</span><span class="token punctuation" data-v-343c80ca>)</span>  <span class="token punctuation" data-v-343c80ca>}</span> <span class="token punctuation" data-v-343c80ca>}</span></span> <span class="token punctuation" data-v-343c80ca>/&gt;</span></span><span class="token plain-text" data-v-343c80ca>
    </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span>
<span class="token punctuation" data-v-343c80ca>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-343c80ca><span class="line-number" data-v-343c80ca>1</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>2</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>3</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>4</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>5</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>6</span><br data-v-343c80ca></div></div><p data-v-343c80ca>或着</p> <div class="language-jsx line-numbers-mode" data-v-343c80ca><pre class="language-jsx" data-v-343c80ca><code data-v-343c80ca><span class="token keyword" data-v-343c80ca>function</span> <span class="token function" data-v-343c80ca>demo</span> <span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>{</span>
    <span class="token keyword" data-v-343c80ca>const</span> <span class="token punctuation" data-v-343c80ca>[</span> number <span class="token punctuation" data-v-343c80ca>,</span> setNumber <span class="token punctuation" data-v-343c80ca>]</span> <span class="token operator" data-v-343c80ca>=</span> <span class="token function" data-v-343c80ca>useState</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token number" data-v-343c80ca>0</span><span class="token punctuation" data-v-343c80ca>)</span>
    <span class="token keyword" data-v-343c80ca>const</span> <span class="token function-variable function" data-v-343c80ca>handerChange</span> <span class="token operator" data-v-343c80ca>=</span> <span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token operator" data-v-343c80ca>=&gt;</span><span class="token punctuation" data-v-343c80ca>{</span>
        <span class="token function" data-v-343c80ca>setNumber</span><span class="token punctuation" data-v-343c80ca>(</span>number<span class="token operator" data-v-343c80ca>+</span><span class="token number" data-v-343c80ca>1</span><span class="token punctuation" data-v-343c80ca>)</span> 
    <span class="token punctuation" data-v-343c80ca>}</span>
    <span class="token keyword" data-v-343c80ca>return</span> <span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>  
                </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span><span class="token class-name" data-v-343c80ca>DemoComponent</span></span>  <span class="token attr-name" data-v-343c80ca>handerChange</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span> handerChange <span class="token punctuation" data-v-343c80ca>}</span></span> <span class="token punctuation" data-v-343c80ca>/&gt;</span></span><span class="token plain-text" data-v-343c80ca>
            </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span>
<span class="token punctuation" data-v-343c80ca>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-343c80ca><span class="line-number" data-v-343c80ca>1</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>2</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>3</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>4</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>5</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>6</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>7</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>8</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>9</span><br data-v-343c80ca></div></div><p data-v-343c80ca>无论是上述那种方式，pureComponent 和 react.memo 通过浅比较方式，只能判断每次更新都是新的callback，然后触发渲染更新。useCallback给加了一个记忆功能，告诉我们子组件，两次是相同的 callback无需重新更新页面。至于什么时候callback更改，就要取决于 useCallback 第二个参数。好的，将上述demo我们用 useCallback 重写。</p> <div class="language-jsx line-numbers-mode" data-v-343c80ca><pre class="language-jsx" data-v-343c80ca><code data-v-343c80ca><span class="token keyword" data-v-343c80ca>function</span> <span class="token function" data-v-343c80ca>demo</span> <span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>{</span>
    <span class="token keyword" data-v-343c80ca>const</span> <span class="token punctuation" data-v-343c80ca>[</span> number <span class="token punctuation" data-v-343c80ca>,</span> setNumber <span class="token punctuation" data-v-343c80ca>]</span> <span class="token operator" data-v-343c80ca>=</span> <span class="token function" data-v-343c80ca>useState</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token number" data-v-343c80ca>0</span><span class="token punctuation" data-v-343c80ca>)</span>
    <span class="token keyword" data-v-343c80ca>const</span> handerChange <span class="token operator" data-v-343c80ca>=</span> <span class="token function" data-v-343c80ca>useCallback</span><span class="token punctuation" data-v-343c80ca>(</span> <span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token operator" data-v-343c80ca>=&gt;</span><span class="token punctuation" data-v-343c80ca>{</span>
        <span class="token function" data-v-343c80ca>setNumber</span><span class="token punctuation" data-v-343c80ca>(</span>number<span class="token operator" data-v-343c80ca>+</span><span class="token number" data-v-343c80ca>1</span><span class="token punctuation" data-v-343c80ca>)</span> 
    <span class="token punctuation" data-v-343c80ca>}</span><span class="token punctuation" data-v-343c80ca>,</span><span class="token punctuation" data-v-343c80ca>[</span><span class="token punctuation" data-v-343c80ca>]</span><span class="token punctuation" data-v-343c80ca>)</span>
    <span class="token keyword" data-v-343c80ca>return</span> <span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>  
        </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span><span class="token class-name" data-v-343c80ca>DemoComponent</span></span>  <span class="token attr-name" data-v-343c80ca>handerChange</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span> handerChange <span class="token punctuation" data-v-343c80ca>}</span></span> <span class="token punctuation" data-v-343c80ca>/&gt;</span></span><span class="token plain-text" data-v-343c80ca>
    </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span>
<span class="token punctuation" data-v-343c80ca>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-343c80ca><span class="line-number" data-v-343c80ca>1</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>2</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>3</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>4</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>5</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>6</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>7</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>8</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>9</span><br data-v-343c80ca></div></div><p data-v-343c80ca>这样 pureComponent 和 react.memo 可以直接判断是callback没有改变，防止了不必要渲染。</p> <h2 id="海量数据优化-时间分片，虚拟列表" data-v-343c80ca><a href="#海量数据优化-时间分片，虚拟列表" class="header-anchor" data-v-343c80ca>#</a> 海量数据优化-时间分片，虚拟列表</h2> <h3 id="时间分片" data-v-343c80ca><a href="#时间分片" class="header-anchor" data-v-343c80ca>#</a> 时间分片</h3> <p data-v-343c80ca>时间分片的概念，就是一次性渲染大量数据，初始化的时候会出现卡顿等现象。我们必须要明白的一个道理，js执行永远要比dom渲染快的多。 ，所以对于大量的数据，一次性渲染，容易造成卡顿，卡死的情况。我们先来看一下例子</p> <div class="language-jsx line-numbers-mode" data-v-343c80ca><pre class="language-jsx" data-v-343c80ca><code data-v-343c80ca><span class="token keyword" data-v-343c80ca>class</span> <span class="token class-name" data-v-343c80ca>Index</span> <span class="token keyword" data-v-343c80ca>extends</span> <span class="token class-name" data-v-343c80ca>React<span class="token punctuation" data-v-343c80ca>.</span>Component</span><span class="token operator" data-v-343c80ca>&lt;</span>any<span class="token punctuation" data-v-343c80ca>,</span>any<span class="token operator" data-v-343c80ca>&gt;</span><span class="token punctuation" data-v-343c80ca>{</span>
    state<span class="token operator" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span>
       list<span class="token operator" data-v-343c80ca>:</span> <span class="token punctuation" data-v-343c80ca>[</span><span class="token punctuation" data-v-343c80ca>]</span>
    <span class="token punctuation" data-v-343c80ca>}</span>
    <span class="token function-variable function" data-v-343c80ca>handerClick</span><span class="token operator" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token operator" data-v-343c80ca>=&gt;</span><span class="token punctuation" data-v-343c80ca>{</span>
       <span class="token keyword" data-v-343c80ca>let</span> starTime <span class="token operator" data-v-343c80ca>=</span> <span class="token keyword" data-v-343c80ca>new</span> <span class="token class-name" data-v-343c80ca>Date</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>getTime</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span>
       <span class="token keyword" data-v-343c80ca>this</span><span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>setState</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>{</span>
           list<span class="token operator" data-v-343c80ca>:</span> <span class="token keyword" data-v-343c80ca>new</span> <span class="token class-name" data-v-343c80ca>Array</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token number" data-v-343c80ca>40000</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>fill</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token number" data-v-343c80ca>0</span><span class="token punctuation" data-v-343c80ca>)</span>
       <span class="token punctuation" data-v-343c80ca>}</span><span class="token punctuation" data-v-343c80ca>,</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token operator" data-v-343c80ca>=&gt;</span><span class="token punctuation" data-v-343c80ca>{</span>
          <span class="token keyword" data-v-343c80ca>const</span> end <span class="token operator" data-v-343c80ca>=</span>  <span class="token keyword" data-v-343c80ca>new</span> <span class="token class-name" data-v-343c80ca>Date</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>getTime</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span>
          console<span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>log</span><span class="token punctuation" data-v-343c80ca>(</span> <span class="token punctuation" data-v-343c80ca>(</span>end <span class="token operator" data-v-343c80ca>-</span> starTime <span class="token punctuation" data-v-343c80ca>)</span> <span class="token operator" data-v-343c80ca>/</span> <span class="token number" data-v-343c80ca>1000</span> <span class="token operator" data-v-343c80ca>+</span> <span class="token string" data-v-343c80ca>'秒'</span><span class="token punctuation" data-v-343c80ca>)</span>
       <span class="token punctuation" data-v-343c80ca>}</span><span class="token punctuation" data-v-343c80ca>)</span>
    <span class="token punctuation" data-v-343c80ca>}</span>
    <span class="token function" data-v-343c80ca>render</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>{</span>
        <span class="token keyword" data-v-343c80ca>const</span> <span class="token punctuation" data-v-343c80ca>{</span> list <span class="token punctuation" data-v-343c80ca>}</span> <span class="token operator" data-v-343c80ca>=</span> <span class="token keyword" data-v-343c80ca>this</span><span class="token punctuation" data-v-343c80ca>.</span>state
        console<span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>log</span><span class="token punctuation" data-v-343c80ca>(</span>list<span class="token punctuation" data-v-343c80ca>)</span>
        <span class="token keyword" data-v-343c80ca>return</span> <span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
            </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>button</span> <span class="token attr-name" data-v-343c80ca>onClick</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span> <span class="token keyword" data-v-343c80ca>this</span><span class="token punctuation" data-v-343c80ca>.</span>handerClick <span class="token punctuation" data-v-343c80ca>}</span></span> <span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>点击</span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>button</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
            </span><span class="token punctuation" data-v-343c80ca>{</span>
                list<span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>map</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token parameter" data-v-343c80ca>item<span class="token punctuation" data-v-343c80ca>,</span>index</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token operator" data-v-343c80ca>=&gt;</span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>li</span> <span class="token attr-name" data-v-343c80ca>className</span><span class="token attr-value" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>&quot;</span>list<span class="token punctuation" data-v-343c80ca>&quot;</span></span>  <span class="token attr-name" data-v-343c80ca>key</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span>index<span class="token punctuation" data-v-343c80ca>}</span></span> <span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
                    </span><span class="token punctuation" data-v-343c80ca>{</span> item  <span class="token operator" data-v-343c80ca>+</span> <span class="token string" data-v-343c80ca>''</span> <span class="token operator" data-v-343c80ca>+</span> index <span class="token punctuation" data-v-343c80ca>}</span><span class="token plain-text" data-v-343c80ca> Item
                </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>li</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token punctuation" data-v-343c80ca>)</span>
            <span class="token punctuation" data-v-343c80ca>}</span><span class="token plain-text" data-v-343c80ca>
        </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span>
    <span class="token punctuation" data-v-343c80ca>}</span>
<span class="token punctuation" data-v-343c80ca>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-343c80ca><span class="line-number" data-v-343c80ca>1</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>2</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>3</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>4</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>5</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>6</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>7</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>8</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>9</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>10</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>11</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>12</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>13</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>14</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>15</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>16</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>17</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>18</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>19</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>20</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>21</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>22</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>23</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>24</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>25</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>26</span><br data-v-343c80ca></div></div><p data-v-343c80ca>我们模拟一次性渲染 40000 个数据的列表，看一下需要多长时间。
效果：
</p><div style="width:800px;" data-v-343c80ca><img src="/vuebloger/img/post/vasddgasdfasf.gif" alt="" data-v-343c80ca></div><p data-v-343c80ca></p> <p data-v-343c80ca>我们看到 40000 个 简单列表渲染了，将近5秒的时间。为了解决一次性加载大量数据的问题。我们引出了时间分片的概念，就是用setTimeout把任务分割，分成若干次来渲染。一共40000个数据，我们可以每次渲染100个， 分次400渲染。</p> <div class="language-jsx line-numbers-mode" data-v-343c80ca><pre class="language-jsx" data-v-343c80ca><code data-v-343c80ca><span class="token keyword" data-v-343c80ca>class</span> <span class="token class-name" data-v-343c80ca>Index</span> <span class="token keyword" data-v-343c80ca>extends</span> <span class="token class-name" data-v-343c80ca>React<span class="token punctuation" data-v-343c80ca>.</span>Component</span><span class="token operator" data-v-343c80ca>&lt;</span>any<span class="token punctuation" data-v-343c80ca>,</span>any<span class="token operator" data-v-343c80ca>&gt;</span><span class="token punctuation" data-v-343c80ca>{</span>
    state<span class="token operator" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span>
       list<span class="token operator" data-v-343c80ca>:</span> <span class="token punctuation" data-v-343c80ca>[</span><span class="token punctuation" data-v-343c80ca>]</span>
    <span class="token punctuation" data-v-343c80ca>}</span>
    <span class="token function-variable function" data-v-343c80ca>handerClick</span><span class="token operator" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token operator" data-v-343c80ca>=&gt;</span><span class="token punctuation" data-v-343c80ca>{</span>
       <span class="token keyword" data-v-343c80ca>this</span><span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>sliceTime</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token keyword" data-v-343c80ca>new</span> <span class="token class-name" data-v-343c80ca>Array</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token number" data-v-343c80ca>40000</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>fill</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token number" data-v-343c80ca>0</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>,</span> <span class="token number" data-v-343c80ca>0</span><span class="token punctuation" data-v-343c80ca>)</span>
    <span class="token punctuation" data-v-343c80ca>}</span>
    <span class="token function-variable function" data-v-343c80ca>sliceTime</span><span class="token operator" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token parameter" data-v-343c80ca>list<span class="token punctuation" data-v-343c80ca>,</span>times</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token operator" data-v-343c80ca>=&gt;</span><span class="token punctuation" data-v-343c80ca>{</span>
        <span class="token keyword" data-v-343c80ca>if</span><span class="token punctuation" data-v-343c80ca>(</span>times <span class="token operator" data-v-343c80ca>===</span> <span class="token number" data-v-343c80ca>400</span><span class="token punctuation" data-v-343c80ca>)</span> <span class="token keyword" data-v-343c80ca>return</span> 
        <span class="token function" data-v-343c80ca>setTimeout</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span> <span class="token operator" data-v-343c80ca>=&gt;</span> <span class="token punctuation" data-v-343c80ca>{</span>
            <span class="token keyword" data-v-343c80ca>const</span> newList <span class="token operator" data-v-343c80ca>=</span> list<span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>slice</span><span class="token punctuation" data-v-343c80ca>(</span> times <span class="token punctuation" data-v-343c80ca>,</span> <span class="token punctuation" data-v-343c80ca>(</span>times <span class="token operator" data-v-343c80ca>+</span> <span class="token number" data-v-343c80ca>1</span><span class="token punctuation" data-v-343c80ca>)</span> <span class="token operator" data-v-343c80ca>*</span> <span class="token number" data-v-343c80ca>100</span> <span class="token punctuation" data-v-343c80ca>)</span> <span class="token comment" data-v-343c80ca>/* 每次截取 100 个 */</span>
            <span class="token keyword" data-v-343c80ca>this</span><span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>setState</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>{</span>
                list<span class="token operator" data-v-343c80ca>:</span> <span class="token keyword" data-v-343c80ca>this</span><span class="token punctuation" data-v-343c80ca>.</span>state<span class="token punctuation" data-v-343c80ca>.</span>list<span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>concat</span><span class="token punctuation" data-v-343c80ca>(</span>newList<span class="token punctuation" data-v-343c80ca>)</span>
            <span class="token punctuation" data-v-343c80ca>}</span><span class="token punctuation" data-v-343c80ca>)</span>
            <span class="token keyword" data-v-343c80ca>this</span><span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>sliceTime</span><span class="token punctuation" data-v-343c80ca>(</span> list <span class="token punctuation" data-v-343c80ca>,</span>times <span class="token operator" data-v-343c80ca>+</span> <span class="token number" data-v-343c80ca>1</span> <span class="token punctuation" data-v-343c80ca>)</span>
        <span class="token punctuation" data-v-343c80ca>}</span><span class="token punctuation" data-v-343c80ca>,</span> <span class="token number" data-v-343c80ca>0</span><span class="token punctuation" data-v-343c80ca>)</span>
    <span class="token punctuation" data-v-343c80ca>}</span>
    <span class="token function" data-v-343c80ca>render</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>{</span>
        <span class="token keyword" data-v-343c80ca>const</span> <span class="token punctuation" data-v-343c80ca>{</span> list <span class="token punctuation" data-v-343c80ca>}</span> <span class="token operator" data-v-343c80ca>=</span> <span class="token keyword" data-v-343c80ca>this</span><span class="token punctuation" data-v-343c80ca>.</span>state
        <span class="token keyword" data-v-343c80ca>return</span> <span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
            </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>button</span> <span class="token attr-name" data-v-343c80ca>onClick</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span> <span class="token keyword" data-v-343c80ca>this</span><span class="token punctuation" data-v-343c80ca>.</span>handerClick <span class="token punctuation" data-v-343c80ca>}</span></span> <span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>点击</span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>button</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
            </span><span class="token punctuation" data-v-343c80ca>{</span>
                list<span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>map</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token parameter" data-v-343c80ca>item<span class="token punctuation" data-v-343c80ca>,</span>index</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token operator" data-v-343c80ca>=&gt;</span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>li</span> <span class="token attr-name" data-v-343c80ca>className</span><span class="token attr-value" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>&quot;</span>list<span class="token punctuation" data-v-343c80ca>&quot;</span></span>  <span class="token attr-name" data-v-343c80ca>key</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span>index<span class="token punctuation" data-v-343c80ca>}</span></span> <span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
                    </span><span class="token punctuation" data-v-343c80ca>{</span> item  <span class="token operator" data-v-343c80ca>+</span> <span class="token string" data-v-343c80ca>''</span> <span class="token operator" data-v-343c80ca>+</span> index <span class="token punctuation" data-v-343c80ca>}</span><span class="token plain-text" data-v-343c80ca> Item
                </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>li</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token punctuation" data-v-343c80ca>)</span>
            <span class="token punctuation" data-v-343c80ca>}</span><span class="token plain-text" data-v-343c80ca>
        </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span>
    <span class="token punctuation" data-v-343c80ca>}</span>
<span class="token punctuation" data-v-343c80ca>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-343c80ca><span class="line-number" data-v-343c80ca>1</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>2</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>3</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>4</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>5</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>6</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>7</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>8</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>9</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>10</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>11</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>12</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>13</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>14</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>15</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>16</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>17</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>18</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>19</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>20</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>21</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>22</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>23</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>24</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>25</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>26</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>27</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>28</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>29</span><br data-v-343c80ca></div></div><p data-v-343c80ca>效果：
</p><div style="width:800px;" data-v-343c80ca><img src="/vuebloger/img/post/dsfhdfgsdfgsdfgf.gif" alt="" data-v-343c80ca></div><p data-v-343c80ca></p> <p data-v-343c80ca>setTimeout 可以用 window.requestAnimationFrame() 代替，会有更好的渲染效果。 我们demo使用列表做的，实际对于列表来说，最佳方案是虚拟列表，而时间分片，更适合热力图，地图点位比较多的情况。</p> <h3 id="虚拟列表" data-v-343c80ca><a href="#虚拟列表" class="header-anchor" data-v-343c80ca>#</a> 虚拟列表</h3> <p data-v-343c80ca>无论是小程序，或者是h5 ，随着 dom元素越来越多，页面会越来越卡顿,这种情况在小程序更加明显 。虚拟列表是按需显示的一种技术，可以根据用户的滚动，不必渲染所有列表项，而只是渲染可视区域内的一部分列表元素的技术。正常的虚拟列表分为 渲染区，缓冲区 ，虚拟列表区。如下图所示。
</p><div style="width:800px;" data-v-343c80ca><img src="/vuebloger/img/post/b07315beeea84d7c82598327e7985ab1_tplv-k3u1fbpfcp-watermark.png" alt="" data-v-343c80ca></div>
为了防止大量dom存在影响性能，我们只对，渲染区和缓冲区的数据做渲染，，虚拟列表区 没有真实的dom存在。 缓冲区的作用就是防止快速下滑或者上滑过程中，会有空白的现象。<p data-v-343c80ca></p> <p data-v-343c80ca>react-tiny-virtual-list 是一个较为轻量的实现虚拟列表的组件。</p> <div class="language-jsx line-numbers-mode" data-v-343c80ca><pre class="language-jsx" data-v-343c80ca><code data-v-343c80ca><span class="token keyword" data-v-343c80ca>import</span> React <span class="token keyword" data-v-343c80ca>from</span> <span class="token string" data-v-343c80ca>'react'</span><span class="token punctuation" data-v-343c80ca>;</span>
<span class="token keyword" data-v-343c80ca>import</span> <span class="token punctuation" data-v-343c80ca>{</span>render<span class="token punctuation" data-v-343c80ca>}</span> <span class="token keyword" data-v-343c80ca>from</span> <span class="token string" data-v-343c80ca>'react-dom'</span><span class="token punctuation" data-v-343c80ca>;</span>
<span class="token keyword" data-v-343c80ca>import</span> VirtualList <span class="token keyword" data-v-343c80ca>from</span> <span class="token string" data-v-343c80ca>'react-tiny-virtual-list'</span><span class="token punctuation" data-v-343c80ca>;</span>
 
<span class="token keyword" data-v-343c80ca>const</span> data <span class="token operator" data-v-343c80ca>=</span> <span class="token punctuation" data-v-343c80ca>[</span><span class="token string" data-v-343c80ca>'A'</span><span class="token punctuation" data-v-343c80ca>,</span> <span class="token string" data-v-343c80ca>'B'</span><span class="token punctuation" data-v-343c80ca>,</span> <span class="token string" data-v-343c80ca>'C'</span><span class="token punctuation" data-v-343c80ca>,</span> <span class="token string" data-v-343c80ca>'D'</span><span class="token punctuation" data-v-343c80ca>,</span> <span class="token string" data-v-343c80ca>'E'</span><span class="token punctuation" data-v-343c80ca>,</span> <span class="token string" data-v-343c80ca>'F'</span><span class="token punctuation" data-v-343c80ca>,</span> <span class="token operator" data-v-343c80ca>...</span><span class="token punctuation" data-v-343c80ca>]</span><span class="token punctuation" data-v-343c80ca>;</span>
 
<span class="token function" data-v-343c80ca>render</span><span class="token punctuation" data-v-343c80ca>(</span>
  <span class="token operator" data-v-343c80ca>&lt;</span>VirtualList
    width<span class="token operator" data-v-343c80ca>=</span><span class="token string" data-v-343c80ca>'100%'</span>
    height<span class="token operator" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span><span class="token number" data-v-343c80ca>600</span><span class="token punctuation" data-v-343c80ca>}</span>
    itemCount<span class="token operator" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span>data<span class="token punctuation" data-v-343c80ca>.</span>length<span class="token punctuation" data-v-343c80ca>}</span>
    itemSize<span class="token operator" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span><span class="token number" data-v-343c80ca>50</span><span class="token punctuation" data-v-343c80ca>}</span> <span class="token comment" data-v-343c80ca>// Also supports variable heights (array or function getter)</span>
    renderItem<span class="token operator" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token parameter" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>{</span>index<span class="token punctuation" data-v-343c80ca>,</span> style<span class="token punctuation" data-v-343c80ca>}</span></span><span class="token punctuation" data-v-343c80ca>)</span> <span class="token operator" data-v-343c80ca>=&gt;</span>
      <span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>div</span> <span class="token attr-name" data-v-343c80ca>key</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span>index<span class="token punctuation" data-v-343c80ca>}</span></span> <span class="token attr-name" data-v-343c80ca>style</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span>style<span class="token punctuation" data-v-343c80ca>}</span></span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca> // The style property contains the item's absolute position
        Letter: </span><span class="token punctuation" data-v-343c80ca>{</span>data<span class="token punctuation" data-v-343c80ca>[</span>index<span class="token punctuation" data-v-343c80ca>]</span><span class="token punctuation" data-v-343c80ca>}</span><span class="token plain-text" data-v-343c80ca>, Row: #</span><span class="token punctuation" data-v-343c80ca>{</span>index<span class="token punctuation" data-v-343c80ca>}</span><span class="token plain-text" data-v-343c80ca>
      </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span>
    <span class="token punctuation" data-v-343c80ca>}</span>
  <span class="token operator" data-v-343c80ca>/</span><span class="token operator" data-v-343c80ca>&gt;</span><span class="token punctuation" data-v-343c80ca>,</span>
  document<span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>getElementById</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token string" data-v-343c80ca>'root'</span><span class="token punctuation" data-v-343c80ca>)</span>
<span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>;</span>
</code></pre> <div class="line-numbers-wrapper" data-v-343c80ca><span class="line-number" data-v-343c80ca>1</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>2</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>3</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>4</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>5</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>6</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>7</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>8</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>9</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>10</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>11</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>12</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>13</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>14</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>15</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>16</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>17</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>18</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>19</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>20</span><br data-v-343c80ca></div></div><p data-v-343c80ca>手写一个react虚拟列表</p> <div class="language-jsx line-numbers-mode" data-v-343c80ca><pre class="language-jsx" data-v-343c80ca><code data-v-343c80ca><span class="token keyword" data-v-343c80ca>let</span> num  <span class="token operator" data-v-343c80ca>=</span> <span class="token number" data-v-343c80ca>0</span>
<span class="token keyword" data-v-343c80ca>class</span> <span class="token class-name" data-v-343c80ca>Index</span> <span class="token keyword" data-v-343c80ca>extends</span> <span class="token class-name" data-v-343c80ca>React<span class="token punctuation" data-v-343c80ca>.</span>Component</span><span class="token operator" data-v-343c80ca>&lt;</span>any<span class="token punctuation" data-v-343c80ca>,</span> any<span class="token operator" data-v-343c80ca>&gt;</span><span class="token punctuation" data-v-343c80ca>{</span>
    state <span class="token operator" data-v-343c80ca>=</span> <span class="token punctuation" data-v-343c80ca>{</span>
        list<span class="token operator" data-v-343c80ca>:</span> <span class="token keyword" data-v-343c80ca>new</span> <span class="token class-name" data-v-343c80ca>Array</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token number" data-v-343c80ca>9999</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>fill</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token number" data-v-343c80ca>0</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>map</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span> <span class="token operator" data-v-343c80ca>=&gt;</span><span class="token punctuation" data-v-343c80ca>{</span> 
            num<span class="token operator" data-v-343c80ca>++</span>
            <span class="token keyword" data-v-343c80ca>return</span> num
        <span class="token punctuation" data-v-343c80ca>}</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>,</span>
        scorllBoxHeight<span class="token operator" data-v-343c80ca>:</span> <span class="token number" data-v-343c80ca>500</span><span class="token punctuation" data-v-343c80ca>,</span> <span class="token comment" data-v-343c80ca>/* 容器高度(初始化高度) */</span>
        renderList<span class="token operator" data-v-343c80ca>:</span> <span class="token punctuation" data-v-343c80ca>[</span><span class="token punctuation" data-v-343c80ca>]</span><span class="token punctuation" data-v-343c80ca>,</span>       <span class="token comment" data-v-343c80ca>/* 渲染列表 */</span>
        itemHeight<span class="token operator" data-v-343c80ca>:</span> <span class="token number" data-v-343c80ca>60</span><span class="token punctuation" data-v-343c80ca>,</span>       <span class="token comment" data-v-343c80ca>/* 每一个列表高度 */</span>
        bufferCount<span class="token operator" data-v-343c80ca>:</span> <span class="token number" data-v-343c80ca>8</span><span class="token punctuation" data-v-343c80ca>,</span>       <span class="token comment" data-v-343c80ca>/* 缓冲个数 上下四个 */</span>
        renderCount<span class="token operator" data-v-343c80ca>:</span> <span class="token number" data-v-343c80ca>0</span><span class="token punctuation" data-v-343c80ca>,</span>       <span class="token comment" data-v-343c80ca>/* 渲染数量 */</span>
        start<span class="token operator" data-v-343c80ca>:</span> <span class="token number" data-v-343c80ca>0</span><span class="token punctuation" data-v-343c80ca>,</span>             <span class="token comment" data-v-343c80ca>/* 起始索引 */</span>
        end<span class="token operator" data-v-343c80ca>:</span> <span class="token number" data-v-343c80ca>0</span>                <span class="token comment" data-v-343c80ca>/* 终止索引 */</span>
    <span class="token punctuation" data-v-343c80ca>}</span>
    listBox<span class="token operator" data-v-343c80ca>:</span> any <span class="token operator" data-v-343c80ca>=</span> <span class="token keyword" data-v-343c80ca>null</span>
    scrollBox <span class="token operator" data-v-343c80ca>:</span> any <span class="token operator" data-v-343c80ca>=</span> <span class="token keyword" data-v-343c80ca>null</span>
    scrollContent<span class="token operator" data-v-343c80ca>:</span>any <span class="token operator" data-v-343c80ca>=</span> <span class="token keyword" data-v-343c80ca>null</span>
    <span class="token function" data-v-343c80ca>componentDidMount</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span> <span class="token punctuation" data-v-343c80ca>{</span>
        <span class="token keyword" data-v-343c80ca>const</span> <span class="token punctuation" data-v-343c80ca>{</span> itemHeight<span class="token punctuation" data-v-343c80ca>,</span> bufferCount <span class="token punctuation" data-v-343c80ca>}</span> <span class="token operator" data-v-343c80ca>=</span> <span class="token keyword" data-v-343c80ca>this</span><span class="token punctuation" data-v-343c80ca>.</span>state
        <span class="token comment" data-v-343c80ca>/* 计算容器高度 */</span>
        <span class="token keyword" data-v-343c80ca>const</span> scorllBoxHeight <span class="token operator" data-v-343c80ca>=</span> <span class="token keyword" data-v-343c80ca>this</span><span class="token punctuation" data-v-343c80ca>.</span>listBox<span class="token punctuation" data-v-343c80ca>.</span>offsetHeight
        <span class="token keyword" data-v-343c80ca>const</span> renderCount <span class="token operator" data-v-343c80ca>=</span> Math<span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>ceil</span><span class="token punctuation" data-v-343c80ca>(</span>scorllBoxHeight <span class="token operator" data-v-343c80ca>/</span> itemHeight<span class="token punctuation" data-v-343c80ca>)</span> <span class="token operator" data-v-343c80ca>+</span> bufferCount
        <span class="token keyword" data-v-343c80ca>const</span> end <span class="token operator" data-v-343c80ca>=</span> renderCount <span class="token operator" data-v-343c80ca>+</span> <span class="token number" data-v-343c80ca>1</span>
        <span class="token keyword" data-v-343c80ca>this</span><span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>setState</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>{</span>
            scorllBoxHeight<span class="token punctuation" data-v-343c80ca>,</span>
            end<span class="token punctuation" data-v-343c80ca>,</span>
            renderCount<span class="token punctuation" data-v-343c80ca>,</span>
        <span class="token punctuation" data-v-343c80ca>}</span><span class="token punctuation" data-v-343c80ca>)</span>
    <span class="token punctuation" data-v-343c80ca>}</span>
    <span class="token comment" data-v-343c80ca>/* 处理滚动效果 */</span>
    <span class="token function-variable function" data-v-343c80ca>handerScroll</span><span class="token operator" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token operator" data-v-343c80ca>=&gt;</span><span class="token punctuation" data-v-343c80ca>{</span>
        <span class="token keyword" data-v-343c80ca>const</span> <span class="token punctuation" data-v-343c80ca>{</span> scrollTop <span class="token punctuation" data-v-343c80ca>}</span> <span class="token operator" data-v-343c80ca>:</span>any <span class="token operator" data-v-343c80ca>=</span>  <span class="token keyword" data-v-343c80ca>this</span><span class="token punctuation" data-v-343c80ca>.</span>scrollBox
        <span class="token keyword" data-v-343c80ca>const</span> <span class="token punctuation" data-v-343c80ca>{</span> itemHeight <span class="token punctuation" data-v-343c80ca>,</span> renderCount <span class="token punctuation" data-v-343c80ca>}</span> <span class="token operator" data-v-343c80ca>=</span> <span class="token keyword" data-v-343c80ca>this</span><span class="token punctuation" data-v-343c80ca>.</span>state
        <span class="token keyword" data-v-343c80ca>const</span> currentOffset <span class="token operator" data-v-343c80ca>=</span> scrollTop <span class="token operator" data-v-343c80ca>-</span> <span class="token punctuation" data-v-343c80ca>(</span>scrollTop <span class="token operator" data-v-343c80ca>%</span> itemHeight<span class="token punctuation" data-v-343c80ca>)</span>
        <span class="token comment" data-v-343c80ca>/* translate3d 开启css cpu 加速 */</span>
        <span class="token keyword" data-v-343c80ca>this</span><span class="token punctuation" data-v-343c80ca>.</span>scrollContent<span class="token punctuation" data-v-343c80ca>.</span>style<span class="token punctuation" data-v-343c80ca>.</span>transform <span class="token operator" data-v-343c80ca>=</span> <span class="token template-string" data-v-343c80ca><span class="token template-punctuation string" data-v-343c80ca>`</span><span class="token string" data-v-343c80ca>translate3d(0, </span><span class="token interpolation" data-v-343c80ca><span class="token interpolation-punctuation punctuation" data-v-343c80ca>${</span>currentOffset<span class="token interpolation-punctuation punctuation" data-v-343c80ca>}</span></span><span class="token string" data-v-343c80ca>px, 0)</span><span class="token template-punctuation string" data-v-343c80ca>`</span></span>
        <span class="token keyword" data-v-343c80ca>const</span> start <span class="token operator" data-v-343c80ca>=</span> Math<span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>floor</span><span class="token punctuation" data-v-343c80ca>(</span>scrollTop <span class="token operator" data-v-343c80ca>/</span> itemHeight<span class="token punctuation" data-v-343c80ca>)</span>
        <span class="token keyword" data-v-343c80ca>const</span> end <span class="token operator" data-v-343c80ca>=</span> Math<span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>floor</span><span class="token punctuation" data-v-343c80ca>(</span>scrollTop <span class="token operator" data-v-343c80ca>/</span> itemHeight <span class="token operator" data-v-343c80ca>+</span> renderCount <span class="token operator" data-v-343c80ca>+</span> <span class="token number" data-v-343c80ca>1</span><span class="token punctuation" data-v-343c80ca>)</span>
        <span class="token keyword" data-v-343c80ca>this</span><span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>setState</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>{</span>
            start<span class="token punctuation" data-v-343c80ca>,</span>
            end<span class="token punctuation" data-v-343c80ca>,</span>
       <span class="token punctuation" data-v-343c80ca>}</span><span class="token punctuation" data-v-343c80ca>)</span>
    <span class="token punctuation" data-v-343c80ca>}</span>
     <span class="token comment" data-v-343c80ca>/* 性能优化：只有在列表start 和 end 改变的时候在渲染列表 */</span>
    <span class="token function" data-v-343c80ca>shouldComponentUpdate</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token parameter" data-v-343c80ca>_nextProps<span class="token punctuation" data-v-343c80ca>,</span> _nextState</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>{</span>
        <span class="token keyword" data-v-343c80ca>const</span> <span class="token punctuation" data-v-343c80ca>{</span> start <span class="token punctuation" data-v-343c80ca>,</span> end <span class="token punctuation" data-v-343c80ca>}</span> <span class="token operator" data-v-343c80ca>=</span> _nextState
        <span class="token keyword" data-v-343c80ca>return</span> start <span class="token operator" data-v-343c80ca>!==</span> <span class="token keyword" data-v-343c80ca>this</span><span class="token punctuation" data-v-343c80ca>.</span>state<span class="token punctuation" data-v-343c80ca>.</span>start <span class="token operator" data-v-343c80ca>||</span> end <span class="token operator" data-v-343c80ca>!==</span><span class="token keyword" data-v-343c80ca>this</span><span class="token punctuation" data-v-343c80ca>.</span>state<span class="token punctuation" data-v-343c80ca>.</span>end 
    <span class="token punctuation" data-v-343c80ca>}</span>
    <span class="token comment" data-v-343c80ca>/* 处理滚动效果 */</span>
    <span class="token function" data-v-343c80ca>render</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span> <span class="token punctuation" data-v-343c80ca>{</span>
        console<span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>log</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token number" data-v-343c80ca>1111</span><span class="token punctuation" data-v-343c80ca>)</span>
        <span class="token keyword" data-v-343c80ca>const</span> <span class="token punctuation" data-v-343c80ca>{</span> list<span class="token punctuation" data-v-343c80ca>,</span> scorllBoxHeight<span class="token punctuation" data-v-343c80ca>,</span> itemHeight <span class="token punctuation" data-v-343c80ca>,</span>start <span class="token punctuation" data-v-343c80ca>,</span>end <span class="token punctuation" data-v-343c80ca>}</span> <span class="token operator" data-v-343c80ca>=</span> <span class="token keyword" data-v-343c80ca>this</span><span class="token punctuation" data-v-343c80ca>.</span>state
        <span class="token keyword" data-v-343c80ca>const</span> renderList <span class="token operator" data-v-343c80ca>=</span> list<span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>slice</span><span class="token punctuation" data-v-343c80ca>(</span>start<span class="token punctuation" data-v-343c80ca>,</span>end<span class="token punctuation" data-v-343c80ca>)</span>
        <span class="token keyword" data-v-343c80ca>return</span> <span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>div</span> <span class="token attr-name" data-v-343c80ca>className</span><span class="token attr-value" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>&quot;</span>list_box<span class="token punctuation" data-v-343c80ca>&quot;</span></span>
            <span class="token attr-name" data-v-343c80ca>ref</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token parameter" data-v-343c80ca>node</span><span class="token punctuation" data-v-343c80ca>)</span> <span class="token operator" data-v-343c80ca>=&gt;</span> <span class="token keyword" data-v-343c80ca>this</span><span class="token punctuation" data-v-343c80ca>.</span>listBox <span class="token operator" data-v-343c80ca>=</span> node<span class="token punctuation" data-v-343c80ca>}</span></span>
        <span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>   
            </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>div</span>  
               <span class="token attr-name" data-v-343c80ca>style</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span><span class="token punctuation" data-v-343c80ca>{</span> height<span class="token operator" data-v-343c80ca>:</span> scorllBoxHeight<span class="token punctuation" data-v-343c80ca>,</span> overflow<span class="token operator" data-v-343c80ca>:</span> <span class="token string" data-v-343c80ca>'scroll'</span><span class="token punctuation" data-v-343c80ca>,</span> position<span class="token operator" data-v-343c80ca>:</span> <span class="token string" data-v-343c80ca>'relative'</span> <span class="token punctuation" data-v-343c80ca>}</span><span class="token punctuation" data-v-343c80ca>}</span></span>  
               <span class="token attr-name" data-v-343c80ca>ref</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span> <span class="token punctuation" data-v-343c80ca>(</span><span class="token parameter" data-v-343c80ca>node</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token operator" data-v-343c80ca>=&gt;</span> <span class="token keyword" data-v-343c80ca>this</span><span class="token punctuation" data-v-343c80ca>.</span>scrollBox <span class="token operator" data-v-343c80ca>=</span> node <span class="token punctuation" data-v-343c80ca>}</span></span>
               <span class="token attr-name" data-v-343c80ca>onScroll</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span> <span class="token keyword" data-v-343c80ca>this</span><span class="token punctuation" data-v-343c80ca>.</span>handerScroll <span class="token punctuation" data-v-343c80ca>}</span></span>   
            <span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
                </span><span class="token punctuation" data-v-343c80ca>{</span> <span class="token comment" data-v-343c80ca>/* 占位作用 */</span><span class="token punctuation" data-v-343c80ca>}</span><span class="token plain-text" data-v-343c80ca>
                </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>div</span> <span class="token attr-name" data-v-343c80ca>style</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span><span class="token punctuation" data-v-343c80ca>{</span> height<span class="token operator" data-v-343c80ca>:</span> <span class="token template-string" data-v-343c80ca><span class="token template-punctuation string" data-v-343c80ca>`</span><span class="token interpolation" data-v-343c80ca><span class="token interpolation-punctuation punctuation" data-v-343c80ca>${</span>list<span class="token punctuation" data-v-343c80ca>.</span>length <span class="token operator" data-v-343c80ca>*</span> itemHeight<span class="token interpolation-punctuation punctuation" data-v-343c80ca>}</span></span><span class="token string" data-v-343c80ca>px</span><span class="token template-punctuation string" data-v-343c80ca>`</span></span><span class="token punctuation" data-v-343c80ca>,</span> position<span class="token operator" data-v-343c80ca>:</span> <span class="token string" data-v-343c80ca>'absolute'</span><span class="token punctuation" data-v-343c80ca>,</span> left<span class="token operator" data-v-343c80ca>:</span> <span class="token number" data-v-343c80ca>0</span><span class="token punctuation" data-v-343c80ca>,</span> top<span class="token operator" data-v-343c80ca>:</span> <span class="token number" data-v-343c80ca>0</span><span class="token punctuation" data-v-343c80ca>,</span> right<span class="token operator" data-v-343c80ca>:</span> <span class="token number" data-v-343c80ca>0</span> <span class="token punctuation" data-v-343c80ca>}</span><span class="token punctuation" data-v-343c80ca>}</span></span> <span class="token punctuation" data-v-343c80ca>/&gt;</span></span><span class="token plain-text" data-v-343c80ca>
                </span><span class="token punctuation" data-v-343c80ca>{</span> <span class="token comment" data-v-343c80ca>/* 显然区 */</span> <span class="token punctuation" data-v-343c80ca>}</span><span class="token plain-text" data-v-343c80ca>
                </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>div</span> <span class="token attr-name" data-v-343c80ca>ref</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token parameter" data-v-343c80ca>node</span><span class="token punctuation" data-v-343c80ca>)</span> <span class="token operator" data-v-343c80ca>=&gt;</span> <span class="token keyword" data-v-343c80ca>this</span><span class="token punctuation" data-v-343c80ca>.</span>scrollContent <span class="token operator" data-v-343c80ca>=</span> node<span class="token punctuation" data-v-343c80ca>}</span></span> <span class="token attr-name" data-v-343c80ca>style</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span><span class="token punctuation" data-v-343c80ca>{</span> position<span class="token operator" data-v-343c80ca>:</span> <span class="token string" data-v-343c80ca>'relative'</span><span class="token punctuation" data-v-343c80ca>,</span> left<span class="token operator" data-v-343c80ca>:</span> <span class="token number" data-v-343c80ca>0</span><span class="token punctuation" data-v-343c80ca>,</span> top<span class="token operator" data-v-343c80ca>:</span> <span class="token number" data-v-343c80ca>0</span><span class="token punctuation" data-v-343c80ca>,</span> right<span class="token operator" data-v-343c80ca>:</span> <span class="token number" data-v-343c80ca>0</span> <span class="token punctuation" data-v-343c80ca>}</span><span class="token punctuation" data-v-343c80ca>}</span></span> <span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
                    </span><span class="token punctuation" data-v-343c80ca>{</span>
                        renderList<span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>map</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token parameter" data-v-343c80ca>item<span class="token punctuation" data-v-343c80ca>,</span> index</span><span class="token punctuation" data-v-343c80ca>)</span> <span class="token operator" data-v-343c80ca>=&gt;</span> <span class="token punctuation" data-v-343c80ca>(</span>
                            <span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>div</span> <span class="token attr-name" data-v-343c80ca>className</span><span class="token attr-value" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>&quot;</span>list<span class="token punctuation" data-v-343c80ca>&quot;</span></span> <span class="token attr-name" data-v-343c80ca>key</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span>index<span class="token punctuation" data-v-343c80ca>}</span></span> <span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
                                </span><span class="token punctuation" data-v-343c80ca>{</span>item <span class="token operator" data-v-343c80ca>+</span> <span class="token string" data-v-343c80ca>''</span> <span class="token punctuation" data-v-343c80ca>}</span><span class="token plain-text" data-v-343c80ca> Item
                            </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span>
                        <span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>)</span>
                    <span class="token punctuation" data-v-343c80ca>}</span><span class="token plain-text" data-v-343c80ca>
                </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
            </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>

        </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span>
    <span class="token punctuation" data-v-343c80ca>}</span>
<span class="token punctuation" data-v-343c80ca>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-343c80ca><span class="line-number" data-v-343c80ca>1</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>2</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>3</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>4</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>5</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>6</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>7</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>8</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>9</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>10</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>11</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>12</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>13</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>14</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>15</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>16</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>17</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>18</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>19</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>20</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>21</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>22</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>23</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>24</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>25</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>26</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>27</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>28</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>29</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>30</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>31</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>32</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>33</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>34</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>35</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>36</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>37</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>38</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>39</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>40</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>41</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>42</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>43</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>44</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>45</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>46</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>47</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>48</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>49</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>50</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>51</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>52</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>53</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>54</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>55</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>56</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>57</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>58</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>59</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>60</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>61</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>62</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>63</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>64</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>65</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>66</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>67</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>68</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>69</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>70</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>71</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>72</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>73</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>74</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>75</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>76</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>77</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>78</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>79</span><br data-v-343c80ca></div></div><p data-v-343c80ca>效果:</p> <p data-v-343c80ca><img src="/vuebloger/img/post/shfgsdfhfgdhdtg.gif" alt="" data-v-343c80ca></p> <p data-v-343c80ca>具体思路:</p> <ol data-v-343c80ca><li data-v-343c80ca>初始化计算容器的高度。截取初始化列表长度。这里我们需要div占位,撑起滚动条。</li> <li data-v-343c80ca>通过监听滚动容器的 onScroll事件,根据 scrollTop 来计算渲染区域向上偏移量, 我们要注意的是，当我们向下滑动的时候，为了渲染区域，能在可视区域内，可视区域要向上的滚动; 我们向上滑动的时候，可视区域要向下的滚动。</li> <li data-v-343c80ca>通过重新计算的 end 和 start 来重新渲染列表。</li></ol> <p data-v-343c80ca>性能优化点:</p> <ol data-v-343c80ca><li data-v-343c80ca>对于移动视图区域，我们可以用 transform 来代替改变 top值。</li> <li data-v-343c80ca>虚拟列表实际情况，是有 start 或者 end 改变的时候，在重新渲染列表，所以我们可以用之前 shouldComponentUpdate 来调优，避免重复渲染。</li></ol> <h2 id="usememo-usecallback" data-v-343c80ca><a href="#usememo-usecallback" class="header-anchor" data-v-343c80ca>#</a> useMemo/useCallback</h2> <p data-v-343c80ca>react中的性能优化。在hooks诞生之前，如果组件包含内部state，我们都是基于class的形式来创建组件。当时我们也知道，react中，性能的优化点在于：</p> <ul data-v-343c80ca><li data-v-343c80ca>调用setState，就会触发组件的重新渲染，无论前后的state是否不同</li> <li data-v-343c80ca>父组件更新，子组件也会自动的更新</li></ul> <p data-v-343c80ca>基于上面的两点，我们通常的解决方案是：使用immutable进行比较，在不相等的时候调用setState；在shouldComponentUpdate中判断前后的props和state，如果没有变化，则返回false来阻止更新。</p> <p data-v-343c80ca>在hooks出来之后，我们能够使用function的形式来创建包含内部state的组件。但是，使用function的形式，失去了上面的shouldComponentUpdate，我们无法通过判断前后状态来决定是否更新。而且，在函数组件中，react不再区分mount和update两个状态，这意味着函数组件的每一次调用都会执行其内部的所有逻辑，那么会带来较大的性能损耗。因此useMemo 和useCallback就是解决性能问题的杀手锏。</p> <p data-v-343c80ca>useCallback和useMemo的参数跟useEffect一致，他们之间最大的区别有是useEffect会用于处理副作用，而前两个hooks不能。
useMemo和useCallback都会在组件第一次渲染的时候执行，之后会在其依赖的变量发生改变时再次执行；并且这两个hooks都返回缓存的值，useMemo返回缓存的变量，useCallback返回缓存的函数。</p> <h3 id="usememo" data-v-343c80ca><a href="#usememo" class="header-anchor" data-v-343c80ca>#</a> useMemo</h3> <div class="language-jsx line-numbers-mode" data-v-343c80ca><pre class="language-jsx" data-v-343c80ca><code data-v-343c80ca><span class="token keyword" data-v-343c80ca>import</span> React <span class="token keyword" data-v-343c80ca>from</span> <span class="token string" data-v-343c80ca>'react'</span><span class="token punctuation" data-v-343c80ca>;</span>
 
<span class="token keyword" data-v-343c80ca>export</span> <span class="token keyword" data-v-343c80ca>default</span> <span class="token keyword" data-v-343c80ca>function</span> <span class="token function" data-v-343c80ca>WithoutMemo</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span> <span class="token punctuation" data-v-343c80ca>{</span>
    <span class="token keyword" data-v-343c80ca>const</span> <span class="token punctuation" data-v-343c80ca>[</span>count<span class="token punctuation" data-v-343c80ca>,</span> setCount<span class="token punctuation" data-v-343c80ca>]</span> <span class="token operator" data-v-343c80ca>=</span> <span class="token function" data-v-343c80ca>useState</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token number" data-v-343c80ca>1</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>;</span>
    <span class="token keyword" data-v-343c80ca>const</span> <span class="token punctuation" data-v-343c80ca>[</span>val<span class="token punctuation" data-v-343c80ca>,</span> setValue<span class="token punctuation" data-v-343c80ca>]</span> <span class="token operator" data-v-343c80ca>=</span> <span class="token function" data-v-343c80ca>useState</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token string" data-v-343c80ca>''</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>;</span>
 
    <span class="token keyword" data-v-343c80ca>function</span> <span class="token function" data-v-343c80ca>expensive</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span> <span class="token punctuation" data-v-343c80ca>{</span>
        console<span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>log</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token string" data-v-343c80ca>'compute'</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>;</span>
        <span class="token keyword" data-v-343c80ca>let</span> sum <span class="token operator" data-v-343c80ca>=</span> <span class="token number" data-v-343c80ca>0</span><span class="token punctuation" data-v-343c80ca>;</span>
        <span class="token keyword" data-v-343c80ca>for</span> <span class="token punctuation" data-v-343c80ca>(</span><span class="token keyword" data-v-343c80ca>let</span> i <span class="token operator" data-v-343c80ca>=</span> <span class="token number" data-v-343c80ca>0</span><span class="token punctuation" data-v-343c80ca>;</span> i <span class="token operator" data-v-343c80ca>&lt;</span> count <span class="token operator" data-v-343c80ca>*</span> <span class="token number" data-v-343c80ca>100</span><span class="token punctuation" data-v-343c80ca>;</span> i<span class="token operator" data-v-343c80ca>++</span><span class="token punctuation" data-v-343c80ca>)</span> <span class="token punctuation" data-v-343c80ca>{</span>
            sum <span class="token operator" data-v-343c80ca>+=</span> i<span class="token punctuation" data-v-343c80ca>;</span>
        <span class="token punctuation" data-v-343c80ca>}</span>
        <span class="token keyword" data-v-343c80ca>return</span> sum<span class="token punctuation" data-v-343c80ca>;</span>
    <span class="token punctuation" data-v-343c80ca>}</span>
 
    <span class="token keyword" data-v-343c80ca>return</span> <span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
        </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>h4</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token punctuation" data-v-343c80ca>{</span>count<span class="token punctuation" data-v-343c80ca>}</span><span class="token plain-text" data-v-343c80ca>-</span><span class="token punctuation" data-v-343c80ca>{</span>val<span class="token punctuation" data-v-343c80ca>}</span><span class="token plain-text" data-v-343c80ca>-</span><span class="token punctuation" data-v-343c80ca>{</span><span class="token function" data-v-343c80ca>expensive</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>}</span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>h4</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
        </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
            </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>button</span> <span class="token attr-name" data-v-343c80ca>onClick</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span> <span class="token operator" data-v-343c80ca>=&gt;</span> <span class="token function" data-v-343c80ca>setCount</span><span class="token punctuation" data-v-343c80ca>(</span>count <span class="token operator" data-v-343c80ca>+</span> <span class="token number" data-v-343c80ca>1</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>}</span></span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>+c1</span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>button</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
            </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>input</span> <span class="token attr-name" data-v-343c80ca>value</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span>val<span class="token punctuation" data-v-343c80ca>}</span></span> <span class="token attr-name" data-v-343c80ca>onChange</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span><span class="token parameter" data-v-343c80ca>event</span> <span class="token operator" data-v-343c80ca>=&gt;</span> <span class="token function" data-v-343c80ca>setValue</span><span class="token punctuation" data-v-343c80ca>(</span>event<span class="token punctuation" data-v-343c80ca>.</span>target<span class="token punctuation" data-v-343c80ca>.</span>value<span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>}</span></span><span class="token punctuation" data-v-343c80ca>/&gt;</span></span><span class="token plain-text" data-v-343c80ca>
        </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
    </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token punctuation" data-v-343c80ca>;</span>
<span class="token punctuation" data-v-343c80ca>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-343c80ca><span class="line-number" data-v-343c80ca>1</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>2</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>3</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>4</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>5</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>6</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>7</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>8</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>9</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>10</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>11</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>12</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>13</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>14</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>15</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>16</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>17</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>18</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>19</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>20</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>21</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>22</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>23</span><br data-v-343c80ca></div></div><p data-v-343c80ca>这里创建了两个state，然后通过expensive函数，执行一次昂贵的计算，拿到count对应的某个值。我们可以看到：无论是修改count还是val，由于组件的重新渲染，都会触发expensive的执行(能够在控制台看到，即使修改val，也会打印)；但是这里的昂贵计算只依赖于count的值，在val修改的时候，是没有必要再次计算的。在这种情况下，我们就可以使用useMemo，只在count的值修改时，执行expensive计算：</p> <div class="language-jsx line-numbers-mode" data-v-343c80ca><pre class="language-jsx" data-v-343c80ca><code data-v-343c80ca><span class="token keyword" data-v-343c80ca>export</span> <span class="token keyword" data-v-343c80ca>default</span> <span class="token keyword" data-v-343c80ca>function</span> <span class="token function" data-v-343c80ca>WithMemo</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span> <span class="token punctuation" data-v-343c80ca>{</span>
    <span class="token keyword" data-v-343c80ca>const</span> <span class="token punctuation" data-v-343c80ca>[</span>count<span class="token punctuation" data-v-343c80ca>,</span> setCount<span class="token punctuation" data-v-343c80ca>]</span> <span class="token operator" data-v-343c80ca>=</span> <span class="token function" data-v-343c80ca>useState</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token number" data-v-343c80ca>1</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>;</span>
    <span class="token keyword" data-v-343c80ca>const</span> <span class="token punctuation" data-v-343c80ca>[</span>val<span class="token punctuation" data-v-343c80ca>,</span> setValue<span class="token punctuation" data-v-343c80ca>]</span> <span class="token operator" data-v-343c80ca>=</span> <span class="token function" data-v-343c80ca>useState</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token string" data-v-343c80ca>''</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>;</span>
    <span class="token keyword" data-v-343c80ca>const</span> expensive <span class="token operator" data-v-343c80ca>=</span> <span class="token function" data-v-343c80ca>useMemo</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span> <span class="token operator" data-v-343c80ca>=&gt;</span> <span class="token punctuation" data-v-343c80ca>{</span>
        console<span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>log</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token string" data-v-343c80ca>'compute'</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>;</span>
        <span class="token keyword" data-v-343c80ca>let</span> sum <span class="token operator" data-v-343c80ca>=</span> <span class="token number" data-v-343c80ca>0</span><span class="token punctuation" data-v-343c80ca>;</span>
        <span class="token keyword" data-v-343c80ca>for</span> <span class="token punctuation" data-v-343c80ca>(</span><span class="token keyword" data-v-343c80ca>let</span> i <span class="token operator" data-v-343c80ca>=</span> <span class="token number" data-v-343c80ca>0</span><span class="token punctuation" data-v-343c80ca>;</span> i <span class="token operator" data-v-343c80ca>&lt;</span> count <span class="token operator" data-v-343c80ca>*</span> <span class="token number" data-v-343c80ca>100</span><span class="token punctuation" data-v-343c80ca>;</span> i<span class="token operator" data-v-343c80ca>++</span><span class="token punctuation" data-v-343c80ca>)</span> <span class="token punctuation" data-v-343c80ca>{</span>
            sum <span class="token operator" data-v-343c80ca>+=</span> i<span class="token punctuation" data-v-343c80ca>;</span>
        <span class="token punctuation" data-v-343c80ca>}</span>
        <span class="token keyword" data-v-343c80ca>return</span> sum<span class="token punctuation" data-v-343c80ca>;</span>
    <span class="token punctuation" data-v-343c80ca>}</span><span class="token punctuation" data-v-343c80ca>,</span> <span class="token punctuation" data-v-343c80ca>[</span>count<span class="token punctuation" data-v-343c80ca>]</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>;</span>
 
    <span class="token keyword" data-v-343c80ca>return</span> <span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
        </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>h4</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token punctuation" data-v-343c80ca>{</span>count<span class="token punctuation" data-v-343c80ca>}</span><span class="token plain-text" data-v-343c80ca>-</span><span class="token punctuation" data-v-343c80ca>{</span>expensive<span class="token punctuation" data-v-343c80ca>}</span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>h4</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
        </span><span class="token punctuation" data-v-343c80ca>{</span>val<span class="token punctuation" data-v-343c80ca>}</span><span class="token plain-text" data-v-343c80ca>
        </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
            </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>button</span> <span class="token attr-name" data-v-343c80ca>onClick</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span> <span class="token operator" data-v-343c80ca>=&gt;</span> <span class="token function" data-v-343c80ca>setCount</span><span class="token punctuation" data-v-343c80ca>(</span>count <span class="token operator" data-v-343c80ca>+</span> <span class="token number" data-v-343c80ca>1</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>}</span></span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>+c1</span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>button</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
            </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>input</span> <span class="token attr-name" data-v-343c80ca>value</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span>val<span class="token punctuation" data-v-343c80ca>}</span></span> <span class="token attr-name" data-v-343c80ca>onChange</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span><span class="token parameter" data-v-343c80ca>event</span> <span class="token operator" data-v-343c80ca>=&gt;</span> <span class="token function" data-v-343c80ca>setValue</span><span class="token punctuation" data-v-343c80ca>(</span>event<span class="token punctuation" data-v-343c80ca>.</span>target<span class="token punctuation" data-v-343c80ca>.</span>value<span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>}</span></span><span class="token punctuation" data-v-343c80ca>/&gt;</span></span><span class="token plain-text" data-v-343c80ca>
        </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
    </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token punctuation" data-v-343c80ca>;</span>
<span class="token punctuation" data-v-343c80ca>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-343c80ca><span class="line-number" data-v-343c80ca>1</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>2</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>3</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>4</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>5</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>6</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>7</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>8</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>9</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>10</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>11</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>12</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>13</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>14</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>15</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>16</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>17</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>18</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>19</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>20</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>21</span><br data-v-343c80ca></div></div><p data-v-343c80ca>上面我们可以看到，使用useMemo来执行昂贵的计算，然后将计算值返回，并且将count作为依赖值传递进去。这样，就只会在count改变的时候触发expensive执行，在修改val的时候，返回上一次缓存的值。</p> <h3 id="usecallback" data-v-343c80ca><a href="#usecallback" class="header-anchor" data-v-343c80ca>#</a> useCallback</h3> <p data-v-343c80ca>讲完了useMemo，接下来是useCallback。useCallback跟useMemo比较类似，但它返回的是缓存的函数。useCallback会将我们传递给它的函数fnB返回，并且将这个结果缓存；当依赖a变更时，会返回新的函数。既然返回的是函数，我们无法很好的判断返回的函数是否变更，所以我们可以借助ES6新增的数据类型Set来判断，具体如下：</p> <div class="language-jsx line-numbers-mode" data-v-343c80ca><pre class="language-jsx" data-v-343c80ca><code data-v-343c80ca><span class="token keyword" data-v-343c80ca>import</span> React<span class="token punctuation" data-v-343c80ca>,</span> <span class="token punctuation" data-v-343c80ca>{</span> useState<span class="token punctuation" data-v-343c80ca>,</span> useCallback <span class="token punctuation" data-v-343c80ca>}</span> <span class="token keyword" data-v-343c80ca>from</span> <span class="token string" data-v-343c80ca>'react'</span><span class="token punctuation" data-v-343c80ca>;</span>
<span class="token keyword" data-v-343c80ca>const</span> <span class="token keyword" data-v-343c80ca>set</span> <span class="token operator" data-v-343c80ca>=</span> <span class="token keyword" data-v-343c80ca>new</span> <span class="token class-name" data-v-343c80ca>Set</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>;</span>
<span class="token keyword" data-v-343c80ca>export</span> <span class="token keyword" data-v-343c80ca>default</span> <span class="token keyword" data-v-343c80ca>function</span> <span class="token function" data-v-343c80ca>Callback</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span> <span class="token punctuation" data-v-343c80ca>{</span>
    <span class="token keyword" data-v-343c80ca>const</span> <span class="token punctuation" data-v-343c80ca>[</span>count<span class="token punctuation" data-v-343c80ca>,</span> setCount<span class="token punctuation" data-v-343c80ca>]</span> <span class="token operator" data-v-343c80ca>=</span> <span class="token function" data-v-343c80ca>useState</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token number" data-v-343c80ca>1</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>;</span>
    <span class="token keyword" data-v-343c80ca>const</span> <span class="token punctuation" data-v-343c80ca>[</span>val<span class="token punctuation" data-v-343c80ca>,</span> setVal<span class="token punctuation" data-v-343c80ca>]</span> <span class="token operator" data-v-343c80ca>=</span> <span class="token function" data-v-343c80ca>useState</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token string" data-v-343c80ca>''</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>;</span>
 
    <span class="token keyword" data-v-343c80ca>const</span> callback <span class="token operator" data-v-343c80ca>=</span> <span class="token function" data-v-343c80ca>useCallback</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span> <span class="token operator" data-v-343c80ca>=&gt;</span> <span class="token punctuation" data-v-343c80ca>{</span>
        console<span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>log</span><span class="token punctuation" data-v-343c80ca>(</span>count<span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>;</span>
    <span class="token punctuation" data-v-343c80ca>}</span><span class="token punctuation" data-v-343c80ca>,</span> <span class="token punctuation" data-v-343c80ca>[</span>count<span class="token punctuation" data-v-343c80ca>]</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>;</span>
    <span class="token keyword" data-v-343c80ca>set</span><span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>add</span><span class="token punctuation" data-v-343c80ca>(</span>callback<span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>;</span>
 
 
    <span class="token keyword" data-v-343c80ca>return</span> <span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
        </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>h4</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token punctuation" data-v-343c80ca>{</span>count<span class="token punctuation" data-v-343c80ca>}</span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>h4</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
        </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>h4</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token punctuation" data-v-343c80ca>{</span><span class="token keyword" data-v-343c80ca>set</span><span class="token punctuation" data-v-343c80ca>.</span>size<span class="token punctuation" data-v-343c80ca>}</span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>h4</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
        </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
            </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>button</span> <span class="token attr-name" data-v-343c80ca>onClick</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span> <span class="token operator" data-v-343c80ca>=&gt;</span> <span class="token function" data-v-343c80ca>setCount</span><span class="token punctuation" data-v-343c80ca>(</span>count <span class="token operator" data-v-343c80ca>+</span> <span class="token number" data-v-343c80ca>1</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>}</span></span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>+</span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>button</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
            </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>input</span> <span class="token attr-name" data-v-343c80ca>value</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span>val<span class="token punctuation" data-v-343c80ca>}</span></span> <span class="token attr-name" data-v-343c80ca>onChange</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span><span class="token parameter" data-v-343c80ca>event</span> <span class="token operator" data-v-343c80ca>=&gt;</span> <span class="token function" data-v-343c80ca>setVal</span><span class="token punctuation" data-v-343c80ca>(</span>event<span class="token punctuation" data-v-343c80ca>.</span>target<span class="token punctuation" data-v-343c80ca>.</span>value<span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>}</span></span><span class="token punctuation" data-v-343c80ca>/&gt;</span></span><span class="token plain-text" data-v-343c80ca>
        </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
    </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token punctuation" data-v-343c80ca>;</span>
<span class="token punctuation" data-v-343c80ca>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-343c80ca><span class="line-number" data-v-343c80ca>1</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>2</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>3</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>4</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>5</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>6</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>7</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>8</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>9</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>10</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>11</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>12</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>13</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>14</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>15</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>16</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>17</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>18</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>19</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>20</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>21</span><br data-v-343c80ca></div></div><p data-v-343c80ca>我们可以看到，每次修改count，set.size就会+1，这说明useCallback依赖变量count，count变更时会返回新的函数；而val变更时，set.size不会变，说明返回的是缓存的旧版本函数。</p> <p data-v-343c80ca>知道useCallback有什么样的特点，那有什么作用呢？使用场景是：有一个父组件，其中包含子组件，子组件接收一个函数作为props；通常而言，如果父组件更新了，子组件也会执行更新；但是大多数场景下，更新是没有必要的，我们可以借助useCallback来返回函数，然后把这个函数作为props传递给子组件；这样，子组件就能避免不必要的更新。</p> <div class="language-jsx line-numbers-mode" data-v-343c80ca><pre class="language-jsx" data-v-343c80ca><code data-v-343c80ca><span class="token keyword" data-v-343c80ca>import</span> React<span class="token punctuation" data-v-343c80ca>,</span> <span class="token punctuation" data-v-343c80ca>{</span> useState<span class="token punctuation" data-v-343c80ca>,</span> useCallback<span class="token punctuation" data-v-343c80ca>,</span> useEffect <span class="token punctuation" data-v-343c80ca>}</span> <span class="token keyword" data-v-343c80ca>from</span> <span class="token string" data-v-343c80ca>'react'</span><span class="token punctuation" data-v-343c80ca>;</span>
<span class="token keyword" data-v-343c80ca>function</span> <span class="token function" data-v-343c80ca>Parent</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span> <span class="token punctuation" data-v-343c80ca>{</span>
    <span class="token keyword" data-v-343c80ca>const</span> <span class="token punctuation" data-v-343c80ca>[</span>count<span class="token punctuation" data-v-343c80ca>,</span> setCount<span class="token punctuation" data-v-343c80ca>]</span> <span class="token operator" data-v-343c80ca>=</span> <span class="token function" data-v-343c80ca>useState</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token number" data-v-343c80ca>1</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>;</span>
    <span class="token keyword" data-v-343c80ca>const</span> <span class="token punctuation" data-v-343c80ca>[</span>val<span class="token punctuation" data-v-343c80ca>,</span> setVal<span class="token punctuation" data-v-343c80ca>]</span> <span class="token operator" data-v-343c80ca>=</span> <span class="token function" data-v-343c80ca>useState</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token string" data-v-343c80ca>''</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>;</span>
 
    <span class="token keyword" data-v-343c80ca>const</span> callback <span class="token operator" data-v-343c80ca>=</span> <span class="token function" data-v-343c80ca>useCallback</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span> <span class="token operator" data-v-343c80ca>=&gt;</span> <span class="token punctuation" data-v-343c80ca>{</span>
        <span class="token keyword" data-v-343c80ca>return</span> count<span class="token punctuation" data-v-343c80ca>;</span>
    <span class="token punctuation" data-v-343c80ca>}</span><span class="token punctuation" data-v-343c80ca>,</span> <span class="token punctuation" data-v-343c80ca>[</span>count<span class="token punctuation" data-v-343c80ca>]</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>;</span>
    <span class="token keyword" data-v-343c80ca>return</span> <span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
        </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>h4</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token punctuation" data-v-343c80ca>{</span>count<span class="token punctuation" data-v-343c80ca>}</span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>h4</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
        </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span><span class="token class-name" data-v-343c80ca>Child</span></span> <span class="token attr-name" data-v-343c80ca>callback</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span>callback<span class="token punctuation" data-v-343c80ca>}</span></span><span class="token punctuation" data-v-343c80ca>/&gt;</span></span><span class="token plain-text" data-v-343c80ca>
        </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
            </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>button</span> <span class="token attr-name" data-v-343c80ca>onClick</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span> <span class="token operator" data-v-343c80ca>=&gt;</span> <span class="token function" data-v-343c80ca>setCount</span><span class="token punctuation" data-v-343c80ca>(</span>count <span class="token operator" data-v-343c80ca>+</span> <span class="token number" data-v-343c80ca>1</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>}</span></span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>+</span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>button</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
            </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>input</span> <span class="token attr-name" data-v-343c80ca>value</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span>val<span class="token punctuation" data-v-343c80ca>}</span></span> <span class="token attr-name" data-v-343c80ca>onChange</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span><span class="token parameter" data-v-343c80ca>event</span> <span class="token operator" data-v-343c80ca>=&gt;</span> <span class="token function" data-v-343c80ca>setVal</span><span class="token punctuation" data-v-343c80ca>(</span>event<span class="token punctuation" data-v-343c80ca>.</span>target<span class="token punctuation" data-v-343c80ca>.</span>value<span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>}</span></span><span class="token punctuation" data-v-343c80ca>/&gt;</span></span><span class="token plain-text" data-v-343c80ca>
        </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
    </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token punctuation" data-v-343c80ca>;</span>
<span class="token punctuation" data-v-343c80ca>}</span>
 
<span class="token keyword" data-v-343c80ca>function</span> <span class="token function" data-v-343c80ca>Child</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token parameter" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>{</span> callback <span class="token punctuation" data-v-343c80ca>}</span></span><span class="token punctuation" data-v-343c80ca>)</span> <span class="token punctuation" data-v-343c80ca>{</span>
    <span class="token keyword" data-v-343c80ca>const</span> <span class="token punctuation" data-v-343c80ca>[</span>count<span class="token punctuation" data-v-343c80ca>,</span> setCount<span class="token punctuation" data-v-343c80ca>]</span> <span class="token operator" data-v-343c80ca>=</span> <span class="token function" data-v-343c80ca>useState</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span> <span class="token operator" data-v-343c80ca>=&gt;</span> <span class="token function" data-v-343c80ca>callback</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>;</span>
    <span class="token function" data-v-343c80ca>useEffect</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span> <span class="token operator" data-v-343c80ca>=&gt;</span> <span class="token punctuation" data-v-343c80ca>{</span>
        <span class="token function" data-v-343c80ca>setCount</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token function" data-v-343c80ca>callback</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>;</span>
    <span class="token punctuation" data-v-343c80ca>}</span><span class="token punctuation" data-v-343c80ca>,</span> <span class="token punctuation" data-v-343c80ca>[</span>callback<span class="token punctuation" data-v-343c80ca>]</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>;</span>
    <span class="token keyword" data-v-343c80ca>return</span> <span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
        </span><span class="token punctuation" data-v-343c80ca>{</span>count<span class="token punctuation" data-v-343c80ca>}</span><span class="token plain-text" data-v-343c80ca>
    </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span>
<span class="token punctuation" data-v-343c80ca>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-343c80ca><span class="line-number" data-v-343c80ca>1</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>2</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>3</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>4</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>5</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>6</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>7</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>8</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>9</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>10</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>11</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>12</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>13</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>14</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>15</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>16</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>17</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>18</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>19</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>20</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>21</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>22</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>23</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>24</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>25</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>26</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>27</span><br data-v-343c80ca></div></div><p data-v-343c80ca>不仅是上面的例子，所有依赖本地状态或props来创建函数，需要使用到缓存函数的地方，都是useCallback的应用场景。useEffect、useMemo、useCallback都是自带闭包的。也就是说，每一次组件的渲染，其都会捕获当前组件函数上下文中的状态(state, props)，所以每一次这三种hooks的执行，反映的也都是当前的状态，你无法使用它们来捕获上一次的状态。对于这种情况，我们应该使用ref来访问。useCallback去进行性能优化可以归结为一下三点：</p> <ol data-v-343c80ca><li data-v-343c80ca>函数 functionA 在 useEffect 内部被调用，为了避免 useEffect 的频繁触发，所以我用useCallback将函数 functionA 包起来;</li> <li data-v-343c80ca>函数 functionB 在另一个使用useCallback包裹的函数 functionC 中被调用,为了避免这个函数functionC频繁变更,所以我用useCallback将函数 functionB 包起来;</li> <li data-v-343c80ca>当函数 functionD 被传递给子组件,为了避免子组件进行不必要的频繁渲染,所以我用useCallback将函数functionD 包起来</li></ol> <blockquote data-v-343c80ca><p data-v-343c80ca>在某些场景里需要在useEffect里调用一个函数,出于某些原因.你无法把这个函数移动到effect内部;</p></blockquote> <div class="language-jsx line-numbers-mode" data-v-343c80ca><pre class="language-jsx" data-v-343c80ca><code data-v-343c80ca><span class="token keyword" data-v-343c80ca>const</span> <span class="token function-variable function" data-v-343c80ca>Example</span> <span class="token operator" data-v-343c80ca>=</span> <span class="token punctuation" data-v-343c80ca>(</span><span class="token parameter" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>{</span> someProp <span class="token punctuation" data-v-343c80ca>}</span></span><span class="token punctuation" data-v-343c80ca>)</span> <span class="token operator" data-v-343c80ca>=&gt;</span> <span class="token punctuation" data-v-343c80ca>{</span>

 <span class="token keyword" data-v-343c80ca>const</span> <span class="token function-variable function" data-v-343c80ca>doSomething</span> <span class="token operator" data-v-343c80ca>=</span> <span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span> <span class="token operator" data-v-343c80ca>=&gt;</span> <span class="token punctuation" data-v-343c80ca>{</span>
   console<span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>log</span><span class="token punctuation" data-v-343c80ca>(</span>someProp<span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>;</span>
 <span class="token punctuation" data-v-343c80ca>}</span>

 <span class="token function" data-v-343c80ca>useEffect</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span> <span class="token operator" data-v-343c80ca>=&gt;</span> <span class="token punctuation" data-v-343c80ca>{</span>
   <span class="token function" data-v-343c80ca>doSomething</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>;</span>
 <span class="token punctuation" data-v-343c80ca>}</span><span class="token punctuation" data-v-343c80ca>,</span> <span class="token punctuation" data-v-343c80ca>[</span>doSomething<span class="token punctuation" data-v-343c80ca>]</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>;</span> <span class="token comment" data-v-343c80ca>// 🔴 这样不安全（它调用的 `doSomething` 函数使用了 `someProp`）</span>
<span class="token punctuation" data-v-343c80ca>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-343c80ca><span class="line-number" data-v-343c80ca>1</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>2</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>3</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>4</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>5</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>6</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>7</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>8</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>9</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>10</span><br data-v-343c80ca></div></div><p data-v-343c80ca>因为useEffect中调用的 doSomething 函数使用了 someProp这个props,所以需要将doSomething放在useEffect的依赖列表里;而为了确保这个函数不会随着组件渲染而重新创建,我们需要用useCallback把doSomething包裹起来,如下:</p> <div class="language-jsx line-numbers-mode" data-v-343c80ca><pre class="language-jsx" data-v-343c80ca><code data-v-343c80ca><span class="token keyword" data-v-343c80ca>const</span> <span class="token function-variable function" data-v-343c80ca>Example</span> <span class="token operator" data-v-343c80ca>=</span> <span class="token punctuation" data-v-343c80ca>(</span><span class="token parameter" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>{</span> someProp <span class="token punctuation" data-v-343c80ca>}</span></span><span class="token punctuation" data-v-343c80ca>)</span> <span class="token operator" data-v-343c80ca>=&gt;</span> <span class="token punctuation" data-v-343c80ca>{</span>
  <span class="token comment" data-v-343c80ca>// ✅ 用 useCallback 包裹以避免随渲染发生改变</span>
  <span class="token keyword" data-v-343c80ca>const</span> doSomething <span class="token operator" data-v-343c80ca>=</span> <span class="token function" data-v-343c80ca>useCallback</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span> <span class="token operator" data-v-343c80ca>=&gt;</span> <span class="token punctuation" data-v-343c80ca>{</span>
    <span class="token comment" data-v-343c80ca>// ... Does something with someProp ...</span>
  <span class="token punctuation" data-v-343c80ca>}</span><span class="token punctuation" data-v-343c80ca>,</span> <span class="token punctuation" data-v-343c80ca>[</span>someProp<span class="token punctuation" data-v-343c80ca>]</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>;</span> <span class="token comment" data-v-343c80ca>// ✅ useCallback 的所有依赖都被指定了</span>

 <span class="token function" data-v-343c80ca>useEffect</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span> <span class="token operator" data-v-343c80ca>=&gt;</span> <span class="token punctuation" data-v-343c80ca>{</span>
    <span class="token function" data-v-343c80ca>doSomething</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>;</span>
  <span class="token punctuation" data-v-343c80ca>}</span><span class="token punctuation" data-v-343c80ca>,</span> <span class="token punctuation" data-v-343c80ca>[</span>doSomething<span class="token punctuation" data-v-343c80ca>]</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>;</span> <span class="token comment" data-v-343c80ca>// ✅ useEffect 的所有依赖都被指定了</span>
<span class="token punctuation" data-v-343c80ca>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-343c80ca><span class="line-number" data-v-343c80ca>1</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>2</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>3</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>4</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>5</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>6</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>7</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>8</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>9</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>10</span><br data-v-343c80ca></div></div><blockquote data-v-343c80ca><p data-v-343c80ca>在某些情况下,你需要在useCallback包裹的函数中调用另一个函数,记得要给另一个函数也包上useCallback</p></blockquote> <div class="language-jsx line-numbers-mode" data-v-343c80ca><pre class="language-jsx" data-v-343c80ca><code data-v-343c80ca><span class="token keyword" data-v-343c80ca>const</span> <span class="token function-variable function" data-v-343c80ca>Example</span> <span class="token operator" data-v-343c80ca>=</span> <span class="token punctuation" data-v-343c80ca>(</span><span class="token parameter" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>{</span> prop1<span class="token punctuation" data-v-343c80ca>,</span> prop2 <span class="token punctuation" data-v-343c80ca>}</span></span><span class="token punctuation" data-v-343c80ca>)</span> <span class="token operator" data-v-343c80ca>=&gt;</span> <span class="token punctuation" data-v-343c80ca>{</span>
 <span class="token comment" data-v-343c80ca>// ✅ 用 useCallback 包裹以避免随渲染发生改变</span>
 <span class="token keyword" data-v-343c80ca>const</span> something <span class="token operator" data-v-343c80ca>=</span> <span class="token function" data-v-343c80ca>useCallback</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span> <span class="token operator" data-v-343c80ca>=&gt;</span> <span class="token punctuation" data-v-343c80ca>{</span>
 <span class="token comment" data-v-343c80ca>// ... Does something with prop2 ...</span>
 <span class="token punctuation" data-v-343c80ca>}</span><span class="token punctuation" data-v-343c80ca>,</span> <span class="token punctuation" data-v-343c80ca>[</span>prop2<span class="token punctuation" data-v-343c80ca>]</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>;</span> <span class="token comment" data-v-343c80ca>// ✅ useCallback 的所有依赖都被指定了</span>
 
 <span class="token comment" data-v-343c80ca>// ✅ 用 useCallback 包裹以避免随渲染发生改变</span>
 <span class="token keyword" data-v-343c80ca>const</span> doSomething <span class="token operator" data-v-343c80ca>=</span> <span class="token function" data-v-343c80ca>useCallback</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span> <span class="token operator" data-v-343c80ca>=&gt;</span> <span class="token punctuation" data-v-343c80ca>{</span>
 	<span class="token function" data-v-343c80ca>somethingOne</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>;</span>
   <span class="token comment" data-v-343c80ca>// ... Does something with prop1 ...</span>
 <span class="token punctuation" data-v-343c80ca>}</span><span class="token punctuation" data-v-343c80ca>,</span> <span class="token punctuation" data-v-343c80ca>[</span>prop1<span class="token punctuation" data-v-343c80ca>,</span> somethingOne<span class="token punctuation" data-v-343c80ca>]</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>;</span> <span class="token comment" data-v-343c80ca>// ✅ useCallback 的所有依赖都被指定了</span>

<span class="token function" data-v-343c80ca>useEffect</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span> <span class="token operator" data-v-343c80ca>=&gt;</span> <span class="token punctuation" data-v-343c80ca>{</span>
   <span class="token function" data-v-343c80ca>doSomething</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>;</span>
 <span class="token punctuation" data-v-343c80ca>}</span><span class="token punctuation" data-v-343c80ca>,</span> <span class="token punctuation" data-v-343c80ca>[</span>doSomething<span class="token punctuation" data-v-343c80ca>]</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>;</span> <span class="token comment" data-v-343c80ca>// ✅ useEffect 的所有依赖都被指定了</span>
<span class="token punctuation" data-v-343c80ca>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-343c80ca><span class="line-number" data-v-343c80ca>1</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>2</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>3</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>4</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>5</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>6</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>7</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>8</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>9</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>10</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>11</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>12</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>13</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>14</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>15</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>16</span><br data-v-343c80ca></div></div><blockquote data-v-343c80ca><p data-v-343c80ca>当函数 functionD 被传递给子组件:</p></blockquote> <div class="language-jsx line-numbers-mode" data-v-343c80ca><pre class="language-jsx" data-v-343c80ca><code data-v-343c80ca><span class="token keyword" data-v-343c80ca>const</span> <span class="token function-variable function" data-v-343c80ca>ParentComp</span> <span class="token operator" data-v-343c80ca>=</span> <span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span> <span class="token operator" data-v-343c80ca>=&gt;</span> <span class="token punctuation" data-v-343c80ca>{</span>
  <span class="token keyword" data-v-343c80ca>const</span> <span class="token punctuation" data-v-343c80ca>[</span> count<span class="token punctuation" data-v-343c80ca>,</span> setCount <span class="token punctuation" data-v-343c80ca>]</span> <span class="token operator" data-v-343c80ca>=</span> <span class="token function" data-v-343c80ca>useState</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token number" data-v-343c80ca>0</span><span class="token punctuation" data-v-343c80ca>)</span>
  <span class="token keyword" data-v-343c80ca>const</span> <span class="token function-variable function" data-v-343c80ca>increment</span> <span class="token operator" data-v-343c80ca>=</span> <span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span> <span class="token operator" data-v-343c80ca>=&gt;</span> <span class="token function" data-v-343c80ca>setCount</span><span class="token punctuation" data-v-343c80ca>(</span>count <span class="token operator" data-v-343c80ca>+</span> <span class="token number" data-v-343c80ca>1</span><span class="token punctuation" data-v-343c80ca>)</span>
  <span class="token keyword" data-v-343c80ca>const</span> <span class="token punctuation" data-v-343c80ca>[</span> name<span class="token punctuation" data-v-343c80ca>,</span> setName <span class="token punctuation" data-v-343c80ca>]</span> <span class="token operator" data-v-343c80ca>=</span> <span class="token function" data-v-343c80ca>useState</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token string" data-v-343c80ca>'hi~'</span><span class="token punctuation" data-v-343c80ca>)</span>
  <span class="token keyword" data-v-343c80ca>const</span> <span class="token function-variable function" data-v-343c80ca>changeName</span> <span class="token operator" data-v-343c80ca>=</span> <span class="token punctuation" data-v-343c80ca>(</span><span class="token parameter" data-v-343c80ca>newName</span><span class="token punctuation" data-v-343c80ca>)</span> <span class="token operator" data-v-343c80ca>=&gt;</span> <span class="token function" data-v-343c80ca>setName</span><span class="token punctuation" data-v-343c80ca>(</span>newName<span class="token punctuation" data-v-343c80ca>)</span>

  <span class="token keyword" data-v-343c80ca>return</span> <span class="token punctuation" data-v-343c80ca>(</span>
    <span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
      </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>button</span> <span class="token attr-name" data-v-343c80ca>onClick</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span>increment<span class="token punctuation" data-v-343c80ca>}</span></span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>点击次数：</span><span class="token punctuation" data-v-343c80ca>{</span>count<span class="token punctuation" data-v-343c80ca>}</span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>button</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
      </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span><span class="token class-name" data-v-343c80ca>ChildComp</span></span> <span class="token attr-name" data-v-343c80ca>name</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span>name<span class="token punctuation" data-v-343c80ca>}</span></span> <span class="token attr-name" data-v-343c80ca>onClick</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span>changeName<span class="token punctuation" data-v-343c80ca>}</span></span><span class="token punctuation" data-v-343c80ca>/&gt;</span></span><span class="token plain-text" data-v-343c80ca>
    </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span>
  <span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>;</span>
<span class="token punctuation" data-v-343c80ca>}</span>

<span class="token keyword" data-v-343c80ca>const</span> <span class="token function-variable function" data-v-343c80ca>ChildComp</span> <span class="token operator" data-v-343c80ca>=</span> <span class="token punctuation" data-v-343c80ca>(</span><span class="token parameter" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>{</span> name<span class="token punctuation" data-v-343c80ca>,</span> onClick <span class="token punctuation" data-v-343c80ca>}</span></span><span class="token punctuation" data-v-343c80ca>)</span> <span class="token operator" data-v-343c80ca>=&gt;</span> <span class="token punctuation" data-v-343c80ca>{</span>
  console<span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>log</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token string" data-v-343c80ca>'render child-comp ...'</span><span class="token punctuation" data-v-343c80ca>)</span>
  <span class="token keyword" data-v-343c80ca>return</span> <span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span></span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
    </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>Child Comp ... </span><span class="token punctuation" data-v-343c80ca>{</span>name<span class="token punctuation" data-v-343c80ca>}</span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
    </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>button</span> <span class="token attr-name" data-v-343c80ca>onClick</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span> <span class="token operator" data-v-343c80ca>=&gt;</span> <span class="token function" data-v-343c80ca>onClick</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token string" data-v-343c80ca>'hello'</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>}</span></span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>改变 name 值</span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>button</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
  </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span></span><span class="token punctuation" data-v-343c80ca>&gt;</span></span>
<span class="token punctuation" data-v-343c80ca>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-343c80ca><span class="line-number" data-v-343c80ca>1</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>2</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>3</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>4</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>5</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>6</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>7</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>8</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>9</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>10</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>11</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>12</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>13</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>14</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>15</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>16</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>17</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>18</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>19</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>20</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>21</span><br data-v-343c80ca></div></div><p data-v-343c80ca>我们先来看一下组件触发rerender的时机:</p> <ul data-v-343c80ca><li data-v-343c80ca>组件的state的属性改变时;</li> <li data-v-343c80ca>组件的props的任意属性值改变时;</li> <li data-v-343c80ca>父组件重新rerender时;</li></ul> <p data-v-343c80ca>根据组件的从新渲染机制,当我点击父组件的button来增加次数时,纵使子组件的state和props没有任何变化,子组件依然会rerender,这显然不是我们所期待的,原因我们也清楚,因为父组件重新rerender (state变化,父组件rerender) 且 子组件的props的onClick属性发生了变化 (父组件rerender时,函数changeName重新生成);</p> <p data-v-343c80ca>我们可以通过React.memo结合useCallback来解决子组件不必要rerender的问题</p> <ul data-v-343c80ca><li data-v-343c80ca>通过React.memo包裹子组件来解决因 父组件重新rerender 导致子组件rerender的问题;</li> <li data-v-343c80ca>通过useCallback包裹函数changeName来解决因 子组件的props的onClick属性发生了变化 导致子组件rerender的问题;</li></ul> <div class="language-jsx line-numbers-mode" data-v-343c80ca><pre class="language-jsx" data-v-343c80ca><code data-v-343c80ca><span class="token keyword" data-v-343c80ca>const</span> <span class="token function-variable function" data-v-343c80ca>ParentComp</span> <span class="token operator" data-v-343c80ca>=</span> <span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span> <span class="token operator" data-v-343c80ca>=&gt;</span> <span class="token punctuation" data-v-343c80ca>{</span>
  <span class="token keyword" data-v-343c80ca>const</span> <span class="token punctuation" data-v-343c80ca>[</span> count<span class="token punctuation" data-v-343c80ca>,</span> setCount <span class="token punctuation" data-v-343c80ca>]</span> <span class="token operator" data-v-343c80ca>=</span> <span class="token function" data-v-343c80ca>useState</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token number" data-v-343c80ca>0</span><span class="token punctuation" data-v-343c80ca>)</span>
  <span class="token keyword" data-v-343c80ca>const</span> <span class="token function-variable function" data-v-343c80ca>increment</span> <span class="token operator" data-v-343c80ca>=</span> <span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span> <span class="token operator" data-v-343c80ca>=&gt;</span> <span class="token function" data-v-343c80ca>setCount</span><span class="token punctuation" data-v-343c80ca>(</span>count <span class="token operator" data-v-343c80ca>+</span> <span class="token number" data-v-343c80ca>1</span><span class="token punctuation" data-v-343c80ca>)</span>
  <span class="token keyword" data-v-343c80ca>const</span> <span class="token punctuation" data-v-343c80ca>[</span> name<span class="token punctuation" data-v-343c80ca>,</span> setName <span class="token punctuation" data-v-343c80ca>]</span> <span class="token operator" data-v-343c80ca>=</span> <span class="token function" data-v-343c80ca>useState</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token string" data-v-343c80ca>'hi~'</span><span class="token punctuation" data-v-343c80ca>)</span>
   <span class="token keyword" data-v-343c80ca>const</span> changeName <span class="token operator" data-v-343c80ca>=</span> <span class="token function" data-v-343c80ca>useCallback</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token parameter" data-v-343c80ca>newName</span><span class="token punctuation" data-v-343c80ca>)</span> <span class="token operator" data-v-343c80ca>=&gt;</span> <span class="token function" data-v-343c80ca>setName</span><span class="token punctuation" data-v-343c80ca>(</span>newName<span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>,</span> <span class="token punctuation" data-v-343c80ca>[</span><span class="token punctuation" data-v-343c80ca>]</span><span class="token punctuation" data-v-343c80ca>)</span> <span class="token comment" data-v-343c80ca>// ✅ 通过useCallback将函数changeName包裹</span>
  <span class="token keyword" data-v-343c80ca>return</span> <span class="token punctuation" data-v-343c80ca>(</span>
    <span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
      </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>button</span> <span class="token attr-name" data-v-343c80ca>onClick</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span>increment<span class="token punctuation" data-v-343c80ca>}</span></span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>点击次数：</span><span class="token punctuation" data-v-343c80ca>{</span>count<span class="token punctuation" data-v-343c80ca>}</span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>button</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
      </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span><span class="token class-name" data-v-343c80ca>ChildComp</span></span> <span class="token attr-name" data-v-343c80ca>name</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span>name<span class="token punctuation" data-v-343c80ca>}</span></span> <span class="token attr-name" data-v-343c80ca>onClick</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span>changeName<span class="token punctuation" data-v-343c80ca>}</span></span><span class="token punctuation" data-v-343c80ca>/&gt;</span></span><span class="token plain-text" data-v-343c80ca>
    </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span>
  <span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>;</span>
<span class="token punctuation" data-v-343c80ca>}</span>

<span class="token keyword" data-v-343c80ca>const</span> ChildComp <span class="token operator" data-v-343c80ca>=</span> React<span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>memo</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token parameter" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>{</span> name<span class="token punctuation" data-v-343c80ca>,</span> onClick <span class="token punctuation" data-v-343c80ca>}</span></span><span class="token punctuation" data-v-343c80ca>)</span> <span class="token operator" data-v-343c80ca>=&gt;</span> <span class="token punctuation" data-v-343c80ca>{</span>  <span class="token comment" data-v-343c80ca>// ✅ 通过React.memo 高阶组件将子组件包裹</span>
  console<span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>log</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token string" data-v-343c80ca>'render child-comp ...'</span><span class="token punctuation" data-v-343c80ca>)</span>
  <span class="token keyword" data-v-343c80ca>return</span> <span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span></span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
    </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>Child Comp ... </span><span class="token punctuation" data-v-343c80ca>{</span>name<span class="token punctuation" data-v-343c80ca>}</span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
    </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>button</span> <span class="token attr-name" data-v-343c80ca>onClick</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span> <span class="token operator" data-v-343c80ca>=&gt;</span> <span class="token function" data-v-343c80ca>onClick</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token string" data-v-343c80ca>'hello'</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>}</span></span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>改变 name 值</span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>button</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
  </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span></span><span class="token punctuation" data-v-343c80ca>&gt;</span></span>
<span class="token punctuation" data-v-343c80ca>}</span><span class="token punctuation" data-v-343c80ca>)</span>
</code></pre> <div class="line-numbers-wrapper" data-v-343c80ca><span class="line-number" data-v-343c80ca>1</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>2</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>3</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>4</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>5</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>6</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>7</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>8</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>9</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>10</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>11</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>12</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>13</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>14</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>15</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>16</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>17</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>18</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>19</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>20</span><br data-v-343c80ca></div></div><div class="custom-block tip" data-v-343c80ca><p class="custom-block-title" data-v-343c80ca>温馨提示</p> <p data-v-343c80ca>React.memo和useCallback缺一不可;此外，useCallback性能优化也是有成本的.我们在得知useCallback能够优化性能后,恨不得每个函数都要拿useCallback包裹一下;不过我们需要明白: useCallback这种memoized函数也是需要成本的,比如增加了额外的deps变化判断,再比如可能会获得更多的内存分配…; 因此性能优化带来的好处可能抵消不了它的成本; 打个比方就像你开车去10公里以外的小镇 和 你开车去隔壁的邻居家);</p></div> <h3 id="usememo当usecallback" data-v-343c80ca><a href="#usememo当usecallback" class="header-anchor" data-v-343c80ca>#</a> useMemo当useCallback</h3> <p data-v-343c80ca>父组件:</p> <div class="language-jsx line-numbers-mode" data-v-343c80ca><pre class="language-jsx" data-v-343c80ca><code data-v-343c80ca><span class="token keyword" data-v-343c80ca>function</span> <span class="token function" data-v-343c80ca>App</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span> <span class="token punctuation" data-v-343c80ca>{</span>
  <span class="token keyword" data-v-343c80ca>const</span> <span class="token punctuation" data-v-343c80ca>[</span>name<span class="token punctuation" data-v-343c80ca>,</span> setName<span class="token punctuation" data-v-343c80ca>]</span> <span class="token operator" data-v-343c80ca>=</span> <span class="token function" data-v-343c80ca>useState</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token string" data-v-343c80ca>'名称'</span><span class="token punctuation" data-v-343c80ca>)</span>
  <span class="token keyword" data-v-343c80ca>const</span> <span class="token punctuation" data-v-343c80ca>[</span>content<span class="token punctuation" data-v-343c80ca>,</span>setContent<span class="token punctuation" data-v-343c80ca>]</span> <span class="token operator" data-v-343c80ca>=</span> <span class="token function" data-v-343c80ca>useState</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token string" data-v-343c80ca>'内容'</span><span class="token punctuation" data-v-343c80ca>)</span>
  <span class="token keyword" data-v-343c80ca>return</span> <span class="token punctuation" data-v-343c80ca>(</span>
      <span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span></span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
        </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>button</span> <span class="token attr-name" data-v-343c80ca>onClick</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span> <span class="token operator" data-v-343c80ca>=&gt;</span> <span class="token function" data-v-343c80ca>setName</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token keyword" data-v-343c80ca>new</span> <span class="token class-name" data-v-343c80ca>Date</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>getTime</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>}</span></span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>name</span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>button</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
        </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>button</span> <span class="token attr-name" data-v-343c80ca>onClick</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span> <span class="token operator" data-v-343c80ca>=&gt;</span> <span class="token function" data-v-343c80ca>setContent</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token keyword" data-v-343c80ca>new</span> <span class="token class-name" data-v-343c80ca>Date</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>getTime</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>}</span></span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>content</span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>button</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
        </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span><span class="token class-name" data-v-343c80ca>Button</span></span> <span class="token attr-name" data-v-343c80ca>name</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span>name<span class="token punctuation" data-v-343c80ca>}</span></span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token punctuation" data-v-343c80ca>{</span>content<span class="token punctuation" data-v-343c80ca>}</span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span><span class="token class-name" data-v-343c80ca>Button</span></span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
      </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span></span><span class="token punctuation" data-v-343c80ca>&gt;</span></span>
  <span class="token punctuation" data-v-343c80ca>)</span>
<span class="token punctuation" data-v-343c80ca>}</span>

</code></pre> <div class="line-numbers-wrapper" data-v-343c80ca><span class="line-number" data-v-343c80ca>1</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>2</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>3</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>4</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>5</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>6</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>7</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>8</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>9</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>10</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>11</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>12</span><br data-v-343c80ca></div></div><p data-v-343c80ca>子组件：</p> <div class="language-jsx line-numbers-mode" data-v-343c80ca><pre class="language-jsx" data-v-343c80ca><code data-v-343c80ca><span class="token keyword" data-v-343c80ca>function</span> <span class="token function" data-v-343c80ca>Button</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token parameter" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>{</span> name<span class="token punctuation" data-v-343c80ca>,</span> children <span class="token punctuation" data-v-343c80ca>}</span></span><span class="token punctuation" data-v-343c80ca>)</span> <span class="token punctuation" data-v-343c80ca>{</span>
  <span class="token keyword" data-v-343c80ca>function</span> <span class="token function" data-v-343c80ca>changeName</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token parameter" data-v-343c80ca>name</span><span class="token punctuation" data-v-343c80ca>)</span> <span class="token punctuation" data-v-343c80ca>{</span>
    console<span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>log</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token string" data-v-343c80ca>'11'</span><span class="token punctuation" data-v-343c80ca>)</span>
    <span class="token keyword" data-v-343c80ca>return</span> name <span class="token operator" data-v-343c80ca>+</span> <span class="token string" data-v-343c80ca>'改变name的方法'</span>
  <span class="token punctuation" data-v-343c80ca>}</span>

  <span class="token keyword" data-v-343c80ca>const</span> otherName <span class="token operator" data-v-343c80ca>=</span>  <span class="token function" data-v-343c80ca>changeName</span><span class="token punctuation" data-v-343c80ca>(</span>name<span class="token punctuation" data-v-343c80ca>)</span>
  <span class="token keyword" data-v-343c80ca>return</span> <span class="token punctuation" data-v-343c80ca>(</span>
      <span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span></span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
        </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token punctuation" data-v-343c80ca>{</span>otherName<span class="token punctuation" data-v-343c80ca>}</span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
        </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token punctuation" data-v-343c80ca>{</span>children<span class="token punctuation" data-v-343c80ca>}</span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
      </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span></span><span class="token punctuation" data-v-343c80ca>&gt;</span></span>

  <span class="token punctuation" data-v-343c80ca>)</span>
<span class="token punctuation" data-v-343c80ca>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-343c80ca><span class="line-number" data-v-343c80ca>1</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>2</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>3</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>4</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>5</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>6</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>7</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>8</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>9</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>10</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>11</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>12</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>13</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>14</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>15</span><br data-v-343c80ca></div></div><p data-v-343c80ca>注意我们打印console.log的方法，很显然的看出，当我们点击父组件的按钮的时候，子组件的name和children都会发生变化。不管我们是改变name或者content的值，我们发现 changeName的方法都会被调用。是不是意味着 我们本来只想修改content的值，但是由于name并没有发生变化，所以无需执行对应的changeName方法。但是发现他却执行了。 这是不是就意味着性能的损耗，做了无用功。</p> <p data-v-343c80ca>优化之后的子组件：</p> <div class="language-jsx line-numbers-mode" data-v-343c80ca><pre class="language-jsx" data-v-343c80ca><code data-v-343c80ca><span class="token keyword" data-v-343c80ca>function</span> <span class="token function" data-v-343c80ca>Button</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token parameter" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>{</span> name<span class="token punctuation" data-v-343c80ca>,</span> children <span class="token punctuation" data-v-343c80ca>}</span></span><span class="token punctuation" data-v-343c80ca>)</span> <span class="token punctuation" data-v-343c80ca>{</span>
  <span class="token keyword" data-v-343c80ca>function</span> <span class="token function" data-v-343c80ca>changeName</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token parameter" data-v-343c80ca>name</span><span class="token punctuation" data-v-343c80ca>)</span> <span class="token punctuation" data-v-343c80ca>{</span>
    console<span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>log</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token string" data-v-343c80ca>'11'</span><span class="token punctuation" data-v-343c80ca>)</span>
    <span class="token keyword" data-v-343c80ca>return</span> name <span class="token operator" data-v-343c80ca>+</span> <span class="token string" data-v-343c80ca>'改变name的方法'</span>
  <span class="token punctuation" data-v-343c80ca>}</span>

<span class="token keyword" data-v-343c80ca>const</span> otherName <span class="token operator" data-v-343c80ca>=</span>  <span class="token function" data-v-343c80ca>useMemo</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token operator" data-v-343c80ca>=&gt;</span><span class="token function" data-v-343c80ca>changeName</span><span class="token punctuation" data-v-343c80ca>(</span>name<span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>,</span><span class="token punctuation" data-v-343c80ca>[</span>name<span class="token punctuation" data-v-343c80ca>]</span><span class="token punctuation" data-v-343c80ca>)</span>
  <span class="token keyword" data-v-343c80ca>return</span> <span class="token punctuation" data-v-343c80ca>(</span>
      <span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span></span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
        </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token punctuation" data-v-343c80ca>{</span>otherName<span class="token punctuation" data-v-343c80ca>}</span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
        </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token punctuation" data-v-343c80ca>{</span>children<span class="token punctuation" data-v-343c80ca>}</span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
      </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span></span><span class="token punctuation" data-v-343c80ca>&gt;</span></span>

  <span class="token punctuation" data-v-343c80ca>)</span>
<span class="token punctuation" data-v-343c80ca>}</span>
<span class="token keyword" data-v-343c80ca>export</span> <span class="token keyword" data-v-343c80ca>default</span> Button
</code></pre> <div class="line-numbers-wrapper" data-v-343c80ca><span class="line-number" data-v-343c80ca>1</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>2</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>3</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>4</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>5</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>6</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>7</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>8</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>9</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>10</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>11</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>12</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>13</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>14</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>15</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>16</span><br data-v-343c80ca></div></div><p data-v-343c80ca>这个时候我们点击 改变content值的按钮，发现changeName 并没有被调用。但是点击改变name值按钮的时候，changeName被调用了。所以我们可以使用useMemo方法 避免无用方法的调用，当然一般我们changName里面可能会使用useState来改变state的值，那是不是就避免了组件的二次渲染。达到了优化性能的目的。</p> <div class="custom-block tip" data-v-343c80ca><p class="custom-block-title" data-v-343c80ca>温馨提示</p> <p data-v-343c80ca>使用 function 的形式来声明组件，失去了shouldCompnentUpdate（在组件更新之前）这个生命周期，也就是说我们没有办法通过组件更新前条件来决定组件是否更新。
而且在函数组件中，也不再区分mount和update两个状态，这意味着函数组件的每一次调用都会执行内部的所有逻辑，就带来了非常大的性能损耗。
useMemo和useCallback都是解决上述性能问题的。</p></div> <h2 id="usecallback使用场景" data-v-343c80ca><a href="#usecallback使用场景" class="header-anchor" data-v-343c80ca>#</a> useCallback使用场景</h2> <p data-v-343c80ca>我们再从另外的说法看下useCallback的使用场景：</p> <ul data-v-343c80ca><li data-v-343c80ca>函数被 useEffect 内部所使用，但为了避免频繁 useEffect 的频繁调用，所以我包一下；</li> <li data-v-343c80ca>我只是为了解决 hooks lint 的提示报警，所以我包一下；</li> <li data-v-343c80ca>因为有一个使用了 useCallback 的函数引用了我这个函数，所以我不得不包一下；</li> <li data-v-343c80ca>当这个函数会被传递给子组件，为了避免子组件频繁渲染，使用 useCallback 包裹，保持引用不变；</li> <li data-v-343c80ca>需要保存一个函数闭包结果，如配合 debounce、throttle 使用；</li> <li data-v-343c80ca>我希望这个useCallback包裹但函数，但某个依赖项变化时，引用了我这个函数的所有 useEffect 都得重新执行一下；</li></ul> <h2 id="路由懒加载，路由监听器" data-v-343c80ca><a href="#路由懒加载，路由监听器" class="header-anchor" data-v-343c80ca>#</a> 路由懒加载，路由监听器</h2> <p data-v-343c80ca>react路由懒加载，针对大型项目有很多页面，在配置路由的时候，如果没有对路由进行处理，一次性会加载大量路由，这对页面初始化很不友好，会延长页面初始化时间，所以我们想这用asyncRouter来按需加载页面路由。</p> <h3 id="传统路由" data-v-343c80ca><a href="#传统路由" class="header-anchor" data-v-343c80ca>#</a> 传统路由</h3> <p data-v-343c80ca>如果我们没有用umi等框架，需要手动配置路由的时候，也许路由会这样配置。</p> <div class="language-jsx line-numbers-mode" data-v-343c80ca><pre class="language-jsx" data-v-343c80ca><code data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span><span class="token class-name" data-v-343c80ca>Switch</span></span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
    </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span><span class="token class-name" data-v-343c80ca>Route</span></span> <span class="token attr-name" data-v-343c80ca>path</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span><span class="token string" data-v-343c80ca>'/index'</span><span class="token punctuation" data-v-343c80ca>}</span></span> <span class="token attr-name" data-v-343c80ca>component</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span>Index<span class="token punctuation" data-v-343c80ca>}</span></span> <span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span><span class="token class-name" data-v-343c80ca>Route</span></span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
    </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span><span class="token class-name" data-v-343c80ca>Route</span></span> <span class="token attr-name" data-v-343c80ca>path</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span><span class="token string" data-v-343c80ca>'/list'</span><span class="token punctuation" data-v-343c80ca>}</span></span> <span class="token attr-name" data-v-343c80ca>component</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span>List<span class="token punctuation" data-v-343c80ca>}</span></span> <span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span><span class="token class-name" data-v-343c80ca>Route</span></span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
    </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span><span class="token class-name" data-v-343c80ca>Route</span></span> <span class="token attr-name" data-v-343c80ca>path</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span><span class="token string" data-v-343c80ca>'/detail'</span><span class="token punctuation" data-v-343c80ca>}</span></span> <span class="token attr-name" data-v-343c80ca>component</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span> Detail <span class="token punctuation" data-v-343c80ca>}</span></span> <span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span><span class="token class-name" data-v-343c80ca>Route</span></span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
    </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span><span class="token class-name" data-v-343c80ca>Redirect</span></span> <span class="token attr-name" data-v-343c80ca>from</span><span class="token attr-value" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>'</span>/*<span class="token punctuation" data-v-343c80ca>'</span></span> <span class="token attr-name" data-v-343c80ca>to</span><span class="token attr-value" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>'</span>/index<span class="token punctuation" data-v-343c80ca>'</span></span> <span class="token punctuation" data-v-343c80ca>/&gt;</span></span><span class="token plain-text" data-v-343c80ca>
</span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span><span class="token class-name" data-v-343c80ca>Switch</span></span><span class="token punctuation" data-v-343c80ca>&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper" data-v-343c80ca><span class="line-number" data-v-343c80ca>1</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>2</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>3</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>4</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>5</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>6</span><br data-v-343c80ca></div></div><p data-v-343c80ca>或者用list保存路由信息，方便在进行路由拦截，或者配置路由菜单等。</p> <div class="language-jsx line-numbers-mode" data-v-343c80ca><pre class="language-jsx" data-v-343c80ca><code data-v-343c80ca><span class="token keyword" data-v-343c80ca>const</span> router <span class="token operator" data-v-343c80ca>=</span> <span class="token punctuation" data-v-343c80ca>[</span>
    <span class="token punctuation" data-v-343c80ca>{</span>
        <span class="token string" data-v-343c80ca>'path'</span><span class="token operator" data-v-343c80ca>:</span> <span class="token string" data-v-343c80ca>'/index'</span><span class="token punctuation" data-v-343c80ca>,</span>
        <span class="token string" data-v-343c80ca>'component'</span><span class="token operator" data-v-343c80ca>:</span> Index
    <span class="token punctuation" data-v-343c80ca>}</span><span class="token punctuation" data-v-343c80ca>,</span>
    <span class="token punctuation" data-v-343c80ca>{</span>
        <span class="token string" data-v-343c80ca>'path'</span><span class="token operator" data-v-343c80ca>:</span> <span class="token string" data-v-343c80ca>'/list'</span>'<span class="token punctuation" data-v-343c80ca>,</span>
        <span class="token string" data-v-343c80ca>'component'</span><span class="token operator" data-v-343c80ca>:</span> List
    <span class="token punctuation" data-v-343c80ca>}</span><span class="token punctuation" data-v-343c80ca>,</span>
    <span class="token punctuation" data-v-343c80ca>{</span>
        <span class="token string" data-v-343c80ca>'path'</span><span class="token operator" data-v-343c80ca>:</span> <span class="token string" data-v-343c80ca>'/detail'</span><span class="token punctuation" data-v-343c80ca>,</span>
        <span class="token string" data-v-343c80ca>'component'</span><span class="token operator" data-v-343c80ca>:</span> Detail
    <span class="token punctuation" data-v-343c80ca>}</span><span class="token punctuation" data-v-343c80ca>,</span>
<span class="token punctuation" data-v-343c80ca>]</span>
</code></pre> <div class="line-numbers-wrapper" data-v-343c80ca><span class="line-number" data-v-343c80ca>1</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>2</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>3</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>4</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>5</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>6</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>7</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>8</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>9</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>10</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>11</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>12</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>13</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>14</span><br data-v-343c80ca></div></div><h3 id="asyncrouter懒加载-并实现路由监听" data-v-343c80ca><a href="#asyncrouter懒加载-并实现路由监听" class="header-anchor" data-v-343c80ca>#</a> asyncRouter懒加载,并实现路由监听</h3> <p data-v-343c80ca>我们今天讲的这种react路由懒加载是基于import 函数路由懒加载， 众所周知 ，import 执行会返回一个Promise作为异步加载的手段。我们可以利用这点来实现react异步加载路由</p> <div class="language-jsx line-numbers-mode" data-v-343c80ca><pre class="language-jsx" data-v-343c80ca><code data-v-343c80ca><span class="token keyword" data-v-343c80ca>const</span> routerObserveQueue <span class="token operator" data-v-343c80ca>=</span> <span class="token punctuation" data-v-343c80ca>[</span><span class="token punctuation" data-v-343c80ca>]</span> <span class="token comment" data-v-343c80ca>/* 存放路由卫视钩子 */</span>
<span class="token comment" data-v-343c80ca>/* 懒加载路由卫士钩子 */</span>
<span class="token keyword" data-v-343c80ca>export</span> <span class="token keyword" data-v-343c80ca>const</span> RouterHooks <span class="token operator" data-v-343c80ca>=</span> <span class="token punctuation" data-v-343c80ca>{</span>
  <span class="token comment" data-v-343c80ca>/* 路由组件加载之前 */</span>
  <span class="token function-variable function" data-v-343c80ca>beforeRouterComponentLoad</span><span class="token operator" data-v-343c80ca>:</span> <span class="token keyword" data-v-343c80ca>function</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token parameter" data-v-343c80ca>callback</span><span class="token punctuation" data-v-343c80ca>)</span> <span class="token punctuation" data-v-343c80ca>{</span>
    routerObserveQueue<span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>push</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>{</span>
      type<span class="token operator" data-v-343c80ca>:</span> <span class="token string" data-v-343c80ca>'before'</span><span class="token punctuation" data-v-343c80ca>,</span>
      callback
    <span class="token punctuation" data-v-343c80ca>}</span><span class="token punctuation" data-v-343c80ca>)</span>
  <span class="token punctuation" data-v-343c80ca>}</span><span class="token punctuation" data-v-343c80ca>,</span>
  <span class="token comment" data-v-343c80ca>/* 路由组件加载之后 */</span>
  <span class="token function" data-v-343c80ca>afterRouterComponentDidLoaded</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token parameter" data-v-343c80ca>callback</span><span class="token punctuation" data-v-343c80ca>)</span> <span class="token punctuation" data-v-343c80ca>{</span>
    routerObserveQueue<span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>push</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>{</span>
      type<span class="token operator" data-v-343c80ca>:</span> <span class="token string" data-v-343c80ca>'after'</span><span class="token punctuation" data-v-343c80ca>,</span>
      callback
    <span class="token punctuation" data-v-343c80ca>}</span><span class="token punctuation" data-v-343c80ca>)</span>
  <span class="token punctuation" data-v-343c80ca>}</span>
<span class="token punctuation" data-v-343c80ca>}</span>
<span class="token comment" data-v-343c80ca>/* 路由懒加载HOC */</span>
<span class="token keyword" data-v-343c80ca>export</span> <span class="token keyword" data-v-343c80ca>default</span> <span class="token keyword" data-v-343c80ca>function</span> <span class="token function" data-v-343c80ca>AsyncRouter</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token parameter" data-v-343c80ca>loadRouter</span><span class="token punctuation" data-v-343c80ca>)</span> <span class="token punctuation" data-v-343c80ca>{</span>
  <span class="token keyword" data-v-343c80ca>return</span> <span class="token keyword" data-v-343c80ca>class</span> <span class="token class-name" data-v-343c80ca>Content</span> <span class="token keyword" data-v-343c80ca>extends</span> <span class="token class-name" data-v-343c80ca>React<span class="token punctuation" data-v-343c80ca>.</span>Component</span> <span class="token punctuation" data-v-343c80ca>{</span>
    <span class="token function" data-v-343c80ca>constructor</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token parameter" data-v-343c80ca>props</span><span class="token punctuation" data-v-343c80ca>)</span> <span class="token punctuation" data-v-343c80ca>{</span>
      <span class="token keyword" data-v-343c80ca>super</span><span class="token punctuation" data-v-343c80ca>(</span>props<span class="token punctuation" data-v-343c80ca>)</span>
      <span class="token comment" data-v-343c80ca>/* 触发每个路由加载之前钩子函数 */</span>
      <span class="token keyword" data-v-343c80ca>this</span><span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>dispatchRouterQueue</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token string" data-v-343c80ca>'before'</span><span class="token punctuation" data-v-343c80ca>)</span>
    <span class="token punctuation" data-v-343c80ca>}</span>
    state <span class="token operator" data-v-343c80ca>=</span> <span class="token punctuation" data-v-343c80ca>{</span>Component<span class="token operator" data-v-343c80ca>:</span> <span class="token keyword" data-v-343c80ca>null</span><span class="token punctuation" data-v-343c80ca>}</span>
    <span class="token function" data-v-343c80ca>dispatchRouterQueue</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token parameter" data-v-343c80ca>type</span><span class="token punctuation" data-v-343c80ca>)</span> <span class="token punctuation" data-v-343c80ca>{</span>
      <span class="token keyword" data-v-343c80ca>const</span> <span class="token punctuation" data-v-343c80ca>{</span>history<span class="token punctuation" data-v-343c80ca>}</span> <span class="token operator" data-v-343c80ca>=</span> <span class="token keyword" data-v-343c80ca>this</span><span class="token punctuation" data-v-343c80ca>.</span>props
      routerObserveQueue<span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>forEach</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token parameter" data-v-343c80ca>item</span> <span class="token operator" data-v-343c80ca>=&gt;</span> <span class="token punctuation" data-v-343c80ca>{</span>
        <span class="token keyword" data-v-343c80ca>if</span> <span class="token punctuation" data-v-343c80ca>(</span>item<span class="token punctuation" data-v-343c80ca>.</span>type <span class="token operator" data-v-343c80ca>===</span> type<span class="token punctuation" data-v-343c80ca>)</span> item<span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>callback</span><span class="token punctuation" data-v-343c80ca>(</span>history<span class="token punctuation" data-v-343c80ca>)</span>
      <span class="token punctuation" data-v-343c80ca>}</span><span class="token punctuation" data-v-343c80ca>)</span>
    <span class="token punctuation" data-v-343c80ca>}</span>
    <span class="token function" data-v-343c80ca>componentDidMount</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span> <span class="token punctuation" data-v-343c80ca>{</span>
      <span class="token keyword" data-v-343c80ca>if</span> <span class="token punctuation" data-v-343c80ca>(</span><span class="token keyword" data-v-343c80ca>this</span><span class="token punctuation" data-v-343c80ca>.</span>state<span class="token punctuation" data-v-343c80ca>.</span>Component<span class="token punctuation" data-v-343c80ca>)</span> <span class="token keyword" data-v-343c80ca>return</span>
      <span class="token function" data-v-343c80ca>loadRouter</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span>
        <span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>then</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token parameter" data-v-343c80ca>module</span> <span class="token operator" data-v-343c80ca>=&gt;</span> module<span class="token punctuation" data-v-343c80ca>.</span>default<span class="token punctuation" data-v-343c80ca>)</span>
        <span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>then</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token parameter" data-v-343c80ca>Component</span> <span class="token operator" data-v-343c80ca>=&gt;</span> <span class="token keyword" data-v-343c80ca>this</span><span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>setState</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>{</span>Component<span class="token punctuation" data-v-343c80ca>}</span><span class="token punctuation" data-v-343c80ca>,</span>
          <span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span> <span class="token operator" data-v-343c80ca>=&gt;</span> <span class="token punctuation" data-v-343c80ca>{</span>
            <span class="token comment" data-v-343c80ca>/* 触发每个路由加载之后钩子函数 */</span>
            <span class="token keyword" data-v-343c80ca>this</span><span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>dispatchRouterQueue</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token string" data-v-343c80ca>'after'</span><span class="token punctuation" data-v-343c80ca>)</span>
          <span class="token punctuation" data-v-343c80ca>}</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>)</span>
    <span class="token punctuation" data-v-343c80ca>}</span>
    <span class="token function" data-v-343c80ca>render</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span> <span class="token punctuation" data-v-343c80ca>{</span>
      <span class="token keyword" data-v-343c80ca>const</span> <span class="token punctuation" data-v-343c80ca>{</span>Component<span class="token punctuation" data-v-343c80ca>}</span> <span class="token operator" data-v-343c80ca>=</span> <span class="token keyword" data-v-343c80ca>this</span><span class="token punctuation" data-v-343c80ca>.</span>state
      <span class="token keyword" data-v-343c80ca>return</span> Component <span class="token operator" data-v-343c80ca>?</span> <span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span><span class="token class-name" data-v-343c80ca>Component</span></span> <span class="token spread" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>{</span>
      <span class="token punctuation" data-v-343c80ca>...</span><span class="token attr-value" data-v-343c80ca>this</span><span class="token punctuation" data-v-343c80ca>.</span><span class="token attr-value" data-v-343c80ca>props</span>
      <span class="token punctuation" data-v-343c80ca>}</span></span>
      <span class="token punctuation" data-v-343c80ca>/&gt;</span></span> <span class="token operator" data-v-343c80ca>:</span> <span class="token keyword" data-v-343c80ca>null</span>
    <span class="token punctuation" data-v-343c80ca>}</span>
  <span class="token punctuation" data-v-343c80ca>}</span>
<span class="token punctuation" data-v-343c80ca>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-343c80ca><span class="line-number" data-v-343c80ca>1</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>2</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>3</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>4</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>5</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>6</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>7</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>8</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>9</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>10</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>11</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>12</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>13</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>14</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>15</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>16</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>17</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>18</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>19</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>20</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>21</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>22</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>23</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>24</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>25</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>26</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>27</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>28</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>29</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>30</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>31</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>32</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>33</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>34</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>35</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>36</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>37</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>38</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>39</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>40</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>41</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>42</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>43</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>44</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>45</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>46</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>47</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>48</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>49</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>50</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>51</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>52</span><br data-v-343c80ca></div></div><p data-v-343c80ca>asyncRouter实际就是一个高级组件,将()=&gt;import()作为加载函数传进来，然后当外部Route加载当前组件的时候，在componentDidMount生命周期函数，加载真实的组件，并渲染组件，我们还可以写针对路由懒加载状态定制属于自己的路由监听器beforeRouterComponentLoad和afterRouterComponentDidLoaded，类似vue中 watch $route 功能。接下来我们看看如何使用。</p> <div class="language-jsx line-numbers-mode" data-v-343c80ca><pre class="language-jsx" data-v-343c80ca><code data-v-343c80ca><span class="token keyword" data-v-343c80ca>import</span> AsyncRouter <span class="token punctuation" data-v-343c80ca>,</span><span class="token punctuation" data-v-343c80ca>{</span> RouterHooks <span class="token punctuation" data-v-343c80ca>}</span>  <span class="token keyword" data-v-343c80ca>from</span> <span class="token string" data-v-343c80ca>'./asyncRouter.jsx'</span>
<span class="token keyword" data-v-343c80ca>const</span> <span class="token punctuation" data-v-343c80ca>{</span> beforeRouterComponentLoad<span class="token punctuation" data-v-343c80ca>}</span> <span class="token operator" data-v-343c80ca>=</span> RouterHooks
<span class="token keyword" data-v-343c80ca>const</span> Index <span class="token operator" data-v-343c80ca>=</span> <span class="token function" data-v-343c80ca>AsyncRouter</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token operator" data-v-343c80ca>=&gt;</span><span class="token keyword" data-v-343c80ca>import</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token string" data-v-343c80ca>'../src/page/home/index'</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>)</span>
<span class="token keyword" data-v-343c80ca>const</span> List <span class="token operator" data-v-343c80ca>=</span> <span class="token function" data-v-343c80ca>AsyncRouter</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token operator" data-v-343c80ca>=&gt;</span><span class="token keyword" data-v-343c80ca>import</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token string" data-v-343c80ca>'../src/page/list'</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>)</span>
<span class="token keyword" data-v-343c80ca>const</span> Detail <span class="token operator" data-v-343c80ca>=</span> <span class="token function" data-v-343c80ca>AsyncRouter</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token operator" data-v-343c80ca>=&gt;</span><span class="token keyword" data-v-343c80ca>import</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token string" data-v-343c80ca>'../src/page/detail'</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token punctuation" data-v-343c80ca>)</span>
<span class="token keyword" data-v-343c80ca>const</span> <span class="token function-variable function" data-v-343c80ca>index</span> <span class="token operator" data-v-343c80ca>=</span> <span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span> <span class="token operator" data-v-343c80ca>=&gt;</span> <span class="token punctuation" data-v-343c80ca>{</span>
  <span class="token function" data-v-343c80ca>useEffect</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token operator" data-v-343c80ca>=&gt;</span><span class="token punctuation" data-v-343c80ca>{</span>
    <span class="token comment" data-v-343c80ca>/* 增加监听函数 */</span>  
    <span class="token function" data-v-343c80ca>beforeRouterComponentLoad</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token parameter" data-v-343c80ca>history</span><span class="token punctuation" data-v-343c80ca>)</span><span class="token operator" data-v-343c80ca>=&gt;</span><span class="token punctuation" data-v-343c80ca>{</span>
      console<span class="token punctuation" data-v-343c80ca>.</span><span class="token function" data-v-343c80ca>log</span><span class="token punctuation" data-v-343c80ca>(</span><span class="token string" data-v-343c80ca>'当前激活的路由是'</span><span class="token punctuation" data-v-343c80ca>,</span>history<span class="token punctuation" data-v-343c80ca>.</span>location<span class="token punctuation" data-v-343c80ca>.</span>pathname<span class="token punctuation" data-v-343c80ca>)</span>
    <span class="token punctuation" data-v-343c80ca>}</span><span class="token punctuation" data-v-343c80ca>)</span>
  <span class="token punctuation" data-v-343c80ca>}</span><span class="token punctuation" data-v-343c80ca>,</span><span class="token punctuation" data-v-343c80ca>[</span><span class="token punctuation" data-v-343c80ca>]</span><span class="token punctuation" data-v-343c80ca>)</span>
  <span class="token keyword" data-v-343c80ca>return</span> <span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>div</span> <span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
    </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span>div</span> <span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
      </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span><span class="token class-name" data-v-343c80ca>Router</span></span>  <span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
      </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span><span class="token class-name" data-v-343c80ca>Meuns</span></span><span class="token punctuation" data-v-343c80ca>/&gt;</span></span><span class="token plain-text" data-v-343c80ca>
      </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span><span class="token class-name" data-v-343c80ca>Switch</span></span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
          </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span><span class="token class-name" data-v-343c80ca>Route</span></span> <span class="token attr-name" data-v-343c80ca>path</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span><span class="token string" data-v-343c80ca>'/index'</span><span class="token punctuation" data-v-343c80ca>}</span></span> <span class="token attr-name" data-v-343c80ca>component</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span>Index<span class="token punctuation" data-v-343c80ca>}</span></span> <span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span><span class="token class-name" data-v-343c80ca>Route</span></span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
          </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span><span class="token class-name" data-v-343c80ca>Route</span></span> <span class="token attr-name" data-v-343c80ca>path</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span><span class="token string" data-v-343c80ca>'/list'</span><span class="token punctuation" data-v-343c80ca>}</span></span> <span class="token attr-name" data-v-343c80ca>component</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span>List<span class="token punctuation" data-v-343c80ca>}</span></span> <span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span><span class="token class-name" data-v-343c80ca>Route</span></span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
          </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span><span class="token class-name" data-v-343c80ca>Route</span></span> <span class="token attr-name" data-v-343c80ca>path</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span><span class="token string" data-v-343c80ca>'/detail'</span><span class="token punctuation" data-v-343c80ca>}</span></span> <span class="token attr-name" data-v-343c80ca>component</span><span class="token script language-javascript" data-v-343c80ca><span class="token script-punctuation punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>{</span> Detail <span class="token punctuation" data-v-343c80ca>}</span></span> <span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span><span class="token class-name" data-v-343c80ca>Route</span></span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
          </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;</span><span class="token class-name" data-v-343c80ca>Redirect</span></span> <span class="token attr-name" data-v-343c80ca>from</span><span class="token attr-value" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>'</span>/*<span class="token punctuation" data-v-343c80ca>'</span></span> <span class="token attr-name" data-v-343c80ca>to</span><span class="token attr-value" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>=</span><span class="token punctuation" data-v-343c80ca>'</span>/index<span class="token punctuation" data-v-343c80ca>'</span></span> <span class="token punctuation" data-v-343c80ca>/&gt;</span></span><span class="token plain-text" data-v-343c80ca>
       </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span><span class="token class-name" data-v-343c80ca>Switch</span></span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
      </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span><span class="token class-name" data-v-343c80ca>Router</span></span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
    </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span><span class="token plain-text" data-v-343c80ca>
  </span><span class="token tag" data-v-343c80ca><span class="token tag" data-v-343c80ca><span class="token punctuation" data-v-343c80ca>&lt;/</span>div</span><span class="token punctuation" data-v-343c80ca>&gt;</span></span>
<span class="token punctuation" data-v-343c80ca>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-343c80ca><span class="line-number" data-v-343c80ca>1</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>2</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>3</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>4</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>5</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>6</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>7</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>8</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>9</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>10</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>11</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>12</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>13</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>14</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>15</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>16</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>17</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>18</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>19</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>20</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>21</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>22</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>23</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>24</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>25</span><br data-v-343c80ca><span class="line-number" data-v-343c80ca>26</span><br data-v-343c80ca></div></div><p data-v-343c80ca>效果:</p> <p data-v-343c80ca><img src="/vuebloger/img/post/qwert.gif" alt="" data-v-343c80ca></p></div> <div class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">10/6/2021, 10:23:05 AM</span></div></div> <!----> </div> <!----></div><div class="global-ui"></div></div>
    <script src="/vuebloger/assets/js/app.a65085b2.js" defer></script><script src="/vuebloger/assets/js/7.02fe805f.js" defer></script><script src="/vuebloger/assets/js/1.252ffbfc.js" defer></script><script src="/vuebloger/assets/js/73.686450b9.js" defer></script><script src="/vuebloger/assets/js/49.3a1b9aa9.js" defer></script>
  </body>
</html>
