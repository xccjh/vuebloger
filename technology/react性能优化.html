<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>react性能优化 | 邹先生博客记录</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/vuebloger/img/logo.jpeg">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.2/jquery.fancybox.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.2/jquery.fancybox.min.css">
    <meta name="description" content="">
    
    <link rel="preload" href="/vuebloger/assets/css/0.styles.6a86f138.css" as="style"><link rel="preload" href="/vuebloger/assets/js/app.d19f2dda.js" as="script"><link rel="preload" href="/vuebloger/assets/js/5.82db9be2.js" as="script"><link rel="preload" href="/vuebloger/assets/js/1.b1b3586e.js" as="script"><link rel="preload" href="/vuebloger/assets/js/61.503d35d8.js" as="script"><link rel="preload" href="/vuebloger/assets/js/44.845ecfff.js" as="script"><link rel="prefetch" href="/vuebloger/assets/js/10.9366c20a.js"><link rel="prefetch" href="/vuebloger/assets/js/100.d7988301.js"><link rel="prefetch" href="/vuebloger/assets/js/101.416c39ad.js"><link rel="prefetch" href="/vuebloger/assets/js/102.0b067186.js"><link rel="prefetch" href="/vuebloger/assets/js/103.a2b038dd.js"><link rel="prefetch" href="/vuebloger/assets/js/104.ac2d3de2.js"><link rel="prefetch" href="/vuebloger/assets/js/105.1aba030a.js"><link rel="prefetch" href="/vuebloger/assets/js/106.d41c7c42.js"><link rel="prefetch" href="/vuebloger/assets/js/107.a4117db3.js"><link rel="prefetch" href="/vuebloger/assets/js/108.b03455c7.js"><link rel="prefetch" href="/vuebloger/assets/js/109.ad846513.js"><link rel="prefetch" href="/vuebloger/assets/js/11.628619fa.js"><link rel="prefetch" href="/vuebloger/assets/js/110.93771f7c.js"><link rel="prefetch" href="/vuebloger/assets/js/111.43d40c35.js"><link rel="prefetch" href="/vuebloger/assets/js/112.66d96f01.js"><link rel="prefetch" href="/vuebloger/assets/js/113.5b7594b1.js"><link rel="prefetch" href="/vuebloger/assets/js/114.a012155e.js"><link rel="prefetch" href="/vuebloger/assets/js/115.25ae05b8.js"><link rel="prefetch" href="/vuebloger/assets/js/116.11d418d6.js"><link rel="prefetch" href="/vuebloger/assets/js/117.45f9d86b.js"><link rel="prefetch" href="/vuebloger/assets/js/118.6cadd747.js"><link rel="prefetch" href="/vuebloger/assets/js/119.d1f644ed.js"><link rel="prefetch" href="/vuebloger/assets/js/12.3ca2d200.js"><link rel="prefetch" href="/vuebloger/assets/js/120.b1012fa1.js"><link rel="prefetch" href="/vuebloger/assets/js/121.dd3c10d3.js"><link rel="prefetch" href="/vuebloger/assets/js/122.86ff6683.js"><link rel="prefetch" href="/vuebloger/assets/js/123.65c21caf.js"><link rel="prefetch" href="/vuebloger/assets/js/124.310ae242.js"><link rel="prefetch" href="/vuebloger/assets/js/125.f03f0904.js"><link rel="prefetch" href="/vuebloger/assets/js/126.9c1b0d85.js"><link rel="prefetch" href="/vuebloger/assets/js/127.0987eb5c.js"><link rel="prefetch" href="/vuebloger/assets/js/128.2bca4c00.js"><link rel="prefetch" href="/vuebloger/assets/js/129.a1eac8a7.js"><link rel="prefetch" href="/vuebloger/assets/js/13.9cf5f312.js"><link rel="prefetch" href="/vuebloger/assets/js/130.684ad33a.js"><link rel="prefetch" href="/vuebloger/assets/js/131.76d54e49.js"><link rel="prefetch" href="/vuebloger/assets/js/132.60cf793d.js"><link rel="prefetch" href="/vuebloger/assets/js/133.4da36ef4.js"><link rel="prefetch" href="/vuebloger/assets/js/134.204bbac3.js"><link rel="prefetch" href="/vuebloger/assets/js/135.434a4d2a.js"><link rel="prefetch" href="/vuebloger/assets/js/136.cc49070c.js"><link rel="prefetch" href="/vuebloger/assets/js/137.463e933e.js"><link rel="prefetch" href="/vuebloger/assets/js/138.f471c93a.js"><link rel="prefetch" href="/vuebloger/assets/js/139.fd99e15d.js"><link rel="prefetch" href="/vuebloger/assets/js/14.c45907da.js"><link rel="prefetch" href="/vuebloger/assets/js/140.6bc4ea26.js"><link rel="prefetch" href="/vuebloger/assets/js/15.19528e37.js"><link rel="prefetch" href="/vuebloger/assets/js/16.0a4c588b.js"><link rel="prefetch" href="/vuebloger/assets/js/17.0e51e193.js"><link rel="prefetch" href="/vuebloger/assets/js/18.989dc208.js"><link rel="prefetch" href="/vuebloger/assets/js/19.da16ff18.js"><link rel="prefetch" href="/vuebloger/assets/js/20.5cf90bce.js"><link rel="prefetch" href="/vuebloger/assets/js/21.6b044372.js"><link rel="prefetch" href="/vuebloger/assets/js/22.594fb529.js"><link rel="prefetch" href="/vuebloger/assets/js/23.bea9c4b4.js"><link rel="prefetch" href="/vuebloger/assets/js/24.140dfb31.js"><link rel="prefetch" href="/vuebloger/assets/js/25.fe820da6.js"><link rel="prefetch" href="/vuebloger/assets/js/26.100db31e.js"><link rel="prefetch" href="/vuebloger/assets/js/27.8a3a4354.js"><link rel="prefetch" href="/vuebloger/assets/js/28.2cf44b3b.js"><link rel="prefetch" href="/vuebloger/assets/js/29.8d949896.js"><link rel="prefetch" href="/vuebloger/assets/js/30.8f3b5b90.js"><link rel="prefetch" href="/vuebloger/assets/js/31.5379b29a.js"><link rel="prefetch" href="/vuebloger/assets/js/32.b40d4fca.js"><link rel="prefetch" href="/vuebloger/assets/js/33.4400641d.js"><link rel="prefetch" href="/vuebloger/assets/js/34.f4135ec0.js"><link rel="prefetch" href="/vuebloger/assets/js/35.d9298324.js"><link rel="prefetch" href="/vuebloger/assets/js/36.4d786088.js"><link rel="prefetch" href="/vuebloger/assets/js/37.33075dd6.js"><link rel="prefetch" href="/vuebloger/assets/js/38.75270867.js"><link rel="prefetch" href="/vuebloger/assets/js/39.c0ca805d.js"><link rel="prefetch" href="/vuebloger/assets/js/4.4e73fd8a.js"><link rel="prefetch" href="/vuebloger/assets/js/40.5b35f86a.js"><link rel="prefetch" href="/vuebloger/assets/js/41.026e68a8.js"><link rel="prefetch" href="/vuebloger/assets/js/42.93cedc95.js"><link rel="prefetch" href="/vuebloger/assets/js/43.b707e613.js"><link rel="prefetch" href="/vuebloger/assets/js/45.842b115c.js"><link rel="prefetch" href="/vuebloger/assets/js/46.4b8a2809.js"><link rel="prefetch" href="/vuebloger/assets/js/47.85362a4d.js"><link rel="prefetch" href="/vuebloger/assets/js/48.72d67229.js"><link rel="prefetch" href="/vuebloger/assets/js/49.37c0ba36.js"><link rel="prefetch" href="/vuebloger/assets/js/50.bbd015f4.js"><link rel="prefetch" href="/vuebloger/assets/js/51.9347567e.js"><link rel="prefetch" href="/vuebloger/assets/js/52.81fa3ecd.js"><link rel="prefetch" href="/vuebloger/assets/js/53.ab28cf80.js"><link rel="prefetch" href="/vuebloger/assets/js/54.944a041f.js"><link rel="prefetch" href="/vuebloger/assets/js/55.89d64acb.js"><link rel="prefetch" href="/vuebloger/assets/js/56.84f64e8a.js"><link rel="prefetch" href="/vuebloger/assets/js/57.3130e86d.js"><link rel="prefetch" href="/vuebloger/assets/js/58.2ae53f0a.js"><link rel="prefetch" href="/vuebloger/assets/js/59.20043f9b.js"><link rel="prefetch" href="/vuebloger/assets/js/6.05f243c5.js"><link rel="prefetch" href="/vuebloger/assets/js/60.0550603d.js"><link rel="prefetch" href="/vuebloger/assets/js/62.23dd5005.js"><link rel="prefetch" href="/vuebloger/assets/js/63.689f3eb7.js"><link rel="prefetch" href="/vuebloger/assets/js/64.66e2f1ab.js"><link rel="prefetch" href="/vuebloger/assets/js/65.3652e1ee.js"><link rel="prefetch" href="/vuebloger/assets/js/66.f040bde9.js"><link rel="prefetch" href="/vuebloger/assets/js/67.94560718.js"><link rel="prefetch" href="/vuebloger/assets/js/68.4eb5f8cb.js"><link rel="prefetch" href="/vuebloger/assets/js/69.08964783.js"><link rel="prefetch" href="/vuebloger/assets/js/7.1c4cfcbe.js"><link rel="prefetch" href="/vuebloger/assets/js/70.ee6baa68.js"><link rel="prefetch" href="/vuebloger/assets/js/71.436f53d9.js"><link rel="prefetch" href="/vuebloger/assets/js/72.1478afc0.js"><link rel="prefetch" href="/vuebloger/assets/js/73.e2c4cff9.js"><link rel="prefetch" href="/vuebloger/assets/js/74.b1af2470.js"><link rel="prefetch" href="/vuebloger/assets/js/75.1d006096.js"><link rel="prefetch" href="/vuebloger/assets/js/76.eb628173.js"><link rel="prefetch" href="/vuebloger/assets/js/77.9643293c.js"><link rel="prefetch" href="/vuebloger/assets/js/78.13240810.js"><link rel="prefetch" href="/vuebloger/assets/js/79.5120c70d.js"><link rel="prefetch" href="/vuebloger/assets/js/8.f3194aa0.js"><link rel="prefetch" href="/vuebloger/assets/js/80.afa0f345.js"><link rel="prefetch" href="/vuebloger/assets/js/81.8705f793.js"><link rel="prefetch" href="/vuebloger/assets/js/82.9f77e27f.js"><link rel="prefetch" href="/vuebloger/assets/js/83.ff29e315.js"><link rel="prefetch" href="/vuebloger/assets/js/84.a2913c31.js"><link rel="prefetch" href="/vuebloger/assets/js/85.31812d9a.js"><link rel="prefetch" href="/vuebloger/assets/js/86.a9a2b1d6.js"><link rel="prefetch" href="/vuebloger/assets/js/87.6071d604.js"><link rel="prefetch" href="/vuebloger/assets/js/88.3364c577.js"><link rel="prefetch" href="/vuebloger/assets/js/89.8d6828ef.js"><link rel="prefetch" href="/vuebloger/assets/js/9.f25900b9.js"><link rel="prefetch" href="/vuebloger/assets/js/90.5c31474e.js"><link rel="prefetch" href="/vuebloger/assets/js/91.93a410f5.js"><link rel="prefetch" href="/vuebloger/assets/js/92.3e427936.js"><link rel="prefetch" href="/vuebloger/assets/js/93.513cb5b6.js"><link rel="prefetch" href="/vuebloger/assets/js/94.02db6698.js"><link rel="prefetch" href="/vuebloger/assets/js/95.aae01fa0.js"><link rel="prefetch" href="/vuebloger/assets/js/96.499bafc7.js"><link rel="prefetch" href="/vuebloger/assets/js/97.7b851abb.js"><link rel="prefetch" href="/vuebloger/assets/js/98.f537df2c.js"><link rel="prefetch" href="/vuebloger/assets/js/99.ca257e8c.js"><link rel="prefetch" href="/vuebloger/assets/js/vendors~docsearch.439e457f.js">
    <link rel="stylesheet" href="/vuebloger/assets/css/0.styles.6a86f138.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/vuebloger/" class="home-link router-link-active"><img src="/vuebloger/img/logo.jpeg" alt="邹先生博客记录" class="logo"> <span class="site-name can-hide">邹先生博客记录</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/vuebloger/timeLine/" class="nav-link">首页</a></div><div class="nav-item"><a href="/vuebloger/technology/" class="nav-link router-link-active">技术</a></div><div class="nav-item"><a href="/vuebloger/life/" class="nav-link">生活</a></div><div class="nav-item"><a href="/vuebloger/workplace/" class="nav-link">职场</a></div><div class="nav-item"><a href="/vuebloger/bake/" class="nav-link">备忘</a></div><div class="nav-item"><a href="/vuebloger/tags/" class="nav-link">标签库</a></div><div class="nav-item"><a href="/vuebloger/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/vuebloger/massage/" class="nav-link">留言板</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">链接</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://gitee.com/xccjh/projects" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://nextjs.frontendx.cn/docs/#%E5%AE%89%E8%A3%85" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Nextjs
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://zh.nuxtjs.org/guide/installation" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Nuxtjs
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://angularjs.org/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  AngularJS
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://reactnative.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ReactNative
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://element-cn.eleme.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ElementUI
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://youzan.github.io/vant/#/zh-CN/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Vant
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://developer.mozilla.org/zh-CN/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  MDN
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://www.fontawesome.com.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Fontawesome
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://developers.weixin.qq.com/miniprogram/dev/index.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  MiniProgram
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://reacttraining.com/react-router/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  react-router-dom
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://webpack.js.org/concepts/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  webpack
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.babeljs.cn/docs/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  babel
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://eslint.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  eslint
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.swiper.com.cn/api/index.html/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  swiper
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://momentjs.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  momentjs
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.runoob.com/linux/linux-shell.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  shell
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://lodash.com/docs/4.17.15#template" target="_blank" rel="noopener noreferrer" class="nav-link external">
  lodash
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://koa.bootcss.com/#links" target="_blank" rel="noopener noreferrer" class="nav-link external">
  koa
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://jestjs.io/docs/en/getting-started" target="_blank" rel="noopener noreferrer" class="nav-link external">
  jest
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://aui.github.io/art-template/zh-cn/docs/index.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  art-template
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://ejs.bootcss.com/#docs" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ejs
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.layui.com/doc/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  layui
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://antv-g2.gitee.io/zh/examples/gallery" target="_blank" rel="noopener noreferrer" class="nav-link external">
  G2
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.echartsjs.com/zh/option.html#title" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ECharts
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.vagrantup.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  vagrant
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://docs.docker.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  docker
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="/vuebloger/technology/ https:/www.runoob.com/redis/redis-tutorial.html" class="nav-link">redis</a></li><li class="dropdown-item"><!----> <a href="https://www.runoob.com/mysql/mysql-tutorial.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  mysql
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://leafletjs.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  leaflet
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.tslang.cn/docs/home.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  TypeScript
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://docschina.org/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  印记中文
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav> <div style="margin-left:20px;margin-right:20px;">
    音乐
    <div role="switch" class="el-switch"><input type="checkbox" name="" true-value="true" class="el-switch__input"><!----><span class="el-switch__core" style="width:40px;"></span><!----></div> <audio><source src="/vuebloger/mp3/065b_520b_0409_111c898908eab454414c3c326fe77c36.mp3" type="audio/mpeg"></audio></div></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/vuebloger/timeLine/" class="nav-link">首页</a></div><div class="nav-item"><a href="/vuebloger/technology/" class="nav-link router-link-active">技术</a></div><div class="nav-item"><a href="/vuebloger/life/" class="nav-link">生活</a></div><div class="nav-item"><a href="/vuebloger/workplace/" class="nav-link">职场</a></div><div class="nav-item"><a href="/vuebloger/bake/" class="nav-link">备忘</a></div><div class="nav-item"><a href="/vuebloger/tags/" class="nav-link">标签库</a></div><div class="nav-item"><a href="/vuebloger/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/vuebloger/massage/" class="nav-link">留言板</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">链接</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://gitee.com/xccjh/projects" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://nextjs.frontendx.cn/docs/#%E5%AE%89%E8%A3%85" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Nextjs
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://zh.nuxtjs.org/guide/installation" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Nuxtjs
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://angularjs.org/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  AngularJS
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://reactnative.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ReactNative
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://element-cn.eleme.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ElementUI
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://youzan.github.io/vant/#/zh-CN/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Vant
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://developer.mozilla.org/zh-CN/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  MDN
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://www.fontawesome.com.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Fontawesome
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://developers.weixin.qq.com/miniprogram/dev/index.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  MiniProgram
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://reacttraining.com/react-router/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  react-router-dom
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://webpack.js.org/concepts/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  webpack
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.babeljs.cn/docs/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  babel
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://eslint.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  eslint
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.swiper.com.cn/api/index.html/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  swiper
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://momentjs.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  momentjs
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.runoob.com/linux/linux-shell.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  shell
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://lodash.com/docs/4.17.15#template" target="_blank" rel="noopener noreferrer" class="nav-link external">
  lodash
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://koa.bootcss.com/#links" target="_blank" rel="noopener noreferrer" class="nav-link external">
  koa
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://jestjs.io/docs/en/getting-started" target="_blank" rel="noopener noreferrer" class="nav-link external">
  jest
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://aui.github.io/art-template/zh-cn/docs/index.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  art-template
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://ejs.bootcss.com/#docs" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ejs
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.layui.com/doc/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  layui
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://antv-g2.gitee.io/zh/examples/gallery" target="_blank" rel="noopener noreferrer" class="nav-link external">
  G2
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.echartsjs.com/zh/option.html#title" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ECharts
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.vagrantup.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  vagrant
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://docs.docker.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  docker
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="/vuebloger/technology/ https:/www.runoob.com/redis/redis-tutorial.html" class="nav-link">redis</a></li><li class="dropdown-item"><!----> <a href="https://www.runoob.com/mysql/mysql-tutorial.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  mysql
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://leafletjs.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  leaflet
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.tslang.cn/docs/home.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  TypeScript
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://docschina.org/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  印记中文
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>react性能优化</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/vuebloger/technology/react%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96.html#受控性组件颗粒化" class="sidebar-link">受控性组件颗粒化</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vuebloger/technology/react%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96.html#建立独立的请求渲染单元" class="sidebar-link">建立独立的请求渲染单元</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vuebloger/technology/react%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96.html#memo-shouldcomponentupdate" class="sidebar-link">memo/shouldComponentUpdate</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuebloger/technology/react%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96.html#purecomponent-react-memo" class="sidebar-link">PureComponent/React.memo</a></li><li class="sidebar-sub-header"><a href="/vuebloger/technology/react%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96.html#shouldcomponentupdate" class="sidebar-link">shouldComponentUpdate</a></li><li class="sidebar-sub-header"><a href="/vuebloger/technology/react%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96.html#immetable-jsx" class="sidebar-link">immetable.jsx</a></li></ul></li><li><a href="/vuebloger/technology/react%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96.html#规范写法-合理处理细节问题" class="sidebar-link">规范写法，合理处理细节问题</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuebloger/technology/react%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96.html#绑定事件尽量不要使用箭头函数" class="sidebar-link">绑定事件尽量不要使用箭头函数</a></li><li class="sidebar-sub-header"><a href="/vuebloger/technology/react%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96.html#循环正确使用key" class="sidebar-link">循环正确使用key</a></li><li class="sidebar-sub-header"><a href="/vuebloger/technology/react%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96.html#usememo-避免重复声明" class="sidebar-link">useMemo 避免重复声明</a></li><li class="sidebar-sub-header"><a href="/vuebloger/technology/react%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96.html#懒加载-suspense-和-lazy" class="sidebar-link">懒加载 Suspense 和 lazy</a></li></ul></li><li><a href="/vuebloger/technology/react%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96.html#多种方式避免重复渲染" class="sidebar-link">多种方式避免重复渲染</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuebloger/technology/react%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96.html#学会使用的批量更新" class="sidebar-link">学会使用的批量更新</a></li><li class="sidebar-sub-header"><a href="/vuebloger/technology/react%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96.html#合并state" class="sidebar-link">合并state</a></li><li class="sidebar-sub-header"><a href="/vuebloger/technology/react%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96.html#usememo-react-memo隔离单元" class="sidebar-link">useMemo React.memo隔离单元</a></li><li class="sidebar-sub-header"><a href="/vuebloger/technology/react%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96.html#取缔state-学会使用缓存。" class="sidebar-link">取缔state，学会使用缓存。</a></li><li class="sidebar-sub-header"><a href="/vuebloger/technology/react%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96.html#usecallback回调" class="sidebar-link">useCallback回调</a></li></ul></li><li><a href="/vuebloger/technology/react%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96.html#海量数据优化-时间分片-虚拟列表" class="sidebar-link">海量数据优化-时间分片，虚拟列表</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuebloger/technology/react%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96.html#时间分片" class="sidebar-link">时间分片</a></li><li class="sidebar-sub-header"><a href="/vuebloger/technology/react%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96.html#虚拟列表" class="sidebar-link">虚拟列表</a></li></ul></li><li><a href="/vuebloger/technology/react%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96.html#usememo-usecallback" class="sidebar-link">useMemo/useCallback</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuebloger/technology/react%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96.html#usememo" class="sidebar-link">useMemo</a></li><li class="sidebar-sub-header"><a href="/vuebloger/technology/react%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96.html#usecallback" class="sidebar-link">useCallback</a></li><li class="sidebar-sub-header"><a href="/vuebloger/technology/react%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96.html#usememo当usecallback" class="sidebar-link">useMemo当useCallback</a></li></ul></li><li><a href="/vuebloger/technology/react%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96.html#usecallback使用场景" class="sidebar-link">useCallback使用场景</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vuebloger/technology/react%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96.html#路由懒加载-路由监听器" class="sidebar-link">路由懒加载，路由监听器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuebloger/technology/react%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96.html#传统路由" class="sidebar-link">传统路由</a></li><li class="sidebar-sub-header"><a href="/vuebloger/technology/react%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96.html#asyncrouter懒加载-并实现路由监听" class="sidebar-link">asyncRouter懒加载,并实现路由监听</a></li></ul></li></ul></div></li></ul> </div> <div class="page"> <div class="content__default" data-v-24208a48 data-v-24208a48><h2 id="受控性组件颗粒化" data-v-24208a48><a href="#受控性组件颗粒化" class="header-anchor" data-v-24208a48>#</a> 受控性组件颗粒化</h2> <p data-v-24208a48>可控性组件和非可控性的区别就是dom元素值是否与受到react数据状态state控制。一旦由react的state控制数据状态，比如input输入框的值，就会造成这样一个场景，为了使input值实时变化，会不断setState，就会不断触发render函数，如果父组件内容简单还好，如果父组件比较复杂，会造成牵一发动全身，如果其他的子组件中componentWillReceiveProps这种带有副作用的钩子，那么引发的蝴蝶效应不敢想象。比如如下demo。</p> <div class="language-jsx line-numbers-mode" data-v-24208a48><pre class="language-jsx" data-v-24208a48><code data-v-24208a48><span class="token keyword" data-v-24208a48>class</span> <span class="token class-name" data-v-24208a48>index</span> <span class="token keyword" data-v-24208a48>extends</span> <span class="token class-name" data-v-24208a48>React<span class="token punctuation" data-v-24208a48>.</span>Component</span><span class="token operator" data-v-24208a48>&lt;</span>any<span class="token punctuation" data-v-24208a48>,</span>any<span class="token operator" data-v-24208a48>&gt;</span><span class="token punctuation" data-v-24208a48>{</span>
    <span class="token function" data-v-24208a48>constructor</span><span class="token punctuation" data-v-24208a48>(</span><span class="token parameter" data-v-24208a48>props</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>{</span>
        <span class="token keyword" data-v-24208a48>super</span><span class="token punctuation" data-v-24208a48>(</span>props<span class="token punctuation" data-v-24208a48>)</span>
        <span class="token keyword" data-v-24208a48>this</span><span class="token punctuation" data-v-24208a48>.</span>state<span class="token operator" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span>
            inputValue<span class="token operator" data-v-24208a48>:</span><span class="token string" data-v-24208a48>''</span>
        <span class="token punctuation" data-v-24208a48>}</span>
    <span class="token punctuation" data-v-24208a48>}</span>
    <span class="token function-variable function" data-v-24208a48>handerChange</span><span class="token operator" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>(</span><span class="token parameter" data-v-24208a48>e</span><span class="token punctuation" data-v-24208a48>)</span><span class="token operator" data-v-24208a48>=&gt;</span> <span class="token keyword" data-v-24208a48>this</span><span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>setState</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>{</span> inputValue<span class="token operator" data-v-24208a48>:</span>e<span class="token punctuation" data-v-24208a48>.</span>target<span class="token punctuation" data-v-24208a48>.</span>value  <span class="token punctuation" data-v-24208a48>}</span><span class="token punctuation" data-v-24208a48>)</span>
    <span class="token function" data-v-24208a48>render</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>{</span>
        <span class="token keyword" data-v-24208a48>const</span> <span class="token punctuation" data-v-24208a48>{</span> inputValue <span class="token punctuation" data-v-24208a48>}</span> <span class="token operator" data-v-24208a48>=</span> <span class="token keyword" data-v-24208a48>this</span><span class="token punctuation" data-v-24208a48>.</span>state
        <span class="token keyword" data-v-24208a48>return</span> <span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
            </span><span class="token punctuation" data-v-24208a48>{</span> <span class="token comment" data-v-24208a48>/*  我们增加三个子组件 */</span> <span class="token punctuation" data-v-24208a48>}</span><span class="token plain-text" data-v-24208a48>
            </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span><span class="token class-name" data-v-24208a48>ComA</span></span> <span class="token punctuation" data-v-24208a48>/&gt;</span></span><span class="token plain-text" data-v-24208a48>
            </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span><span class="token class-name" data-v-24208a48>ComB</span></span> <span class="token punctuation" data-v-24208a48>/&gt;</span></span><span class="token plain-text" data-v-24208a48>
            </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span><span class="token class-name" data-v-24208a48>ComC</span></span> <span class="token punctuation" data-v-24208a48>/&gt;</span></span><span class="token plain-text" data-v-24208a48>
            </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>div</span> <span class="token attr-name" data-v-24208a48>className</span><span class="token attr-value" data-v-24208a48><span class="token punctuation attr-equals" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>&quot;</span>box<span class="token punctuation" data-v-24208a48>&quot;</span></span> <span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
                </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span><span class="token class-name" data-v-24208a48>Input</span></span>  <span class="token attr-name" data-v-24208a48>value</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span>inputValue<span class="token punctuation" data-v-24208a48>}</span></span>  <span class="token attr-name" data-v-24208a48>onChange</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span> <span class="token punctuation" data-v-24208a48>(</span><span class="token parameter" data-v-24208a48>e</span><span class="token punctuation" data-v-24208a48>)</span><span class="token operator" data-v-24208a48>=&gt;</span> <span class="token keyword" data-v-24208a48>this</span><span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>handerChange</span><span class="token punctuation" data-v-24208a48>(</span>e<span class="token punctuation" data-v-24208a48>)</span> <span class="token punctuation" data-v-24208a48>}</span></span> <span class="token punctuation" data-v-24208a48>/&gt;</span></span><span class="token plain-text" data-v-24208a48>
            </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
            </span><span class="token punctuation" data-v-24208a48>{</span><span class="token comment" data-v-24208a48>/* 我们首先来一个列表循环 */</span><span class="token punctuation" data-v-24208a48>}</span><span class="token plain-text" data-v-24208a48>
            </span><span class="token punctuation" data-v-24208a48>{</span>
                <span class="token keyword" data-v-24208a48>new</span> <span class="token class-name" data-v-24208a48>Array</span><span class="token punctuation" data-v-24208a48>(</span><span class="token number" data-v-24208a48>10</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>fill</span><span class="token punctuation" data-v-24208a48>(</span><span class="token number" data-v-24208a48>0</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>map</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>(</span><span class="token parameter" data-v-24208a48>item<span class="token punctuation" data-v-24208a48>,</span>index</span><span class="token punctuation" data-v-24208a48>)</span><span class="token operator" data-v-24208a48>=&gt;</span><span class="token punctuation" data-v-24208a48>{</span>
                    console<span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>log</span><span class="token punctuation" data-v-24208a48>(</span><span class="token string" data-v-24208a48>'列表循环了'</span> <span class="token punctuation" data-v-24208a48>)</span>
                    <span class="token keyword" data-v-24208a48>return</span> <span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>div</span> <span class="token attr-name" data-v-24208a48>key</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span>index<span class="token punctuation" data-v-24208a48>}</span></span> <span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token punctuation" data-v-24208a48>{</span>item<span class="token punctuation" data-v-24208a48>}</span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span>
                <span class="token punctuation" data-v-24208a48>}</span><span class="token punctuation" data-v-24208a48>)</span>
            <span class="token punctuation" data-v-24208a48>}</span><span class="token plain-text" data-v-24208a48>
            </span><span class="token punctuation" data-v-24208a48>{</span>
              <span class="token comment" data-v-24208a48>/* 这里可能是更复杂的结构 */</span>
              <span class="token comment" data-v-24208a48>/* ------------------ */</span>
            <span class="token punctuation" data-v-24208a48>}</span><span class="token plain-text" data-v-24208a48>
        </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span>
    <span class="token punctuation" data-v-24208a48>}</span>
<span class="token punctuation" data-v-24208a48>}</span>

</code></pre> <div class="line-numbers-wrapper" data-v-24208a48><span class="line-number" data-v-24208a48>1</span><br data-v-24208a48><span class="line-number" data-v-24208a48>2</span><br data-v-24208a48><span class="line-number" data-v-24208a48>3</span><br data-v-24208a48><span class="line-number" data-v-24208a48>4</span><br data-v-24208a48><span class="line-number" data-v-24208a48>5</span><br data-v-24208a48><span class="line-number" data-v-24208a48>6</span><br data-v-24208a48><span class="line-number" data-v-24208a48>7</span><br data-v-24208a48><span class="line-number" data-v-24208a48>8</span><br data-v-24208a48><span class="line-number" data-v-24208a48>9</span><br data-v-24208a48><span class="line-number" data-v-24208a48>10</span><br data-v-24208a48><span class="line-number" data-v-24208a48>11</span><br data-v-24208a48><span class="line-number" data-v-24208a48>12</span><br data-v-24208a48><span class="line-number" data-v-24208a48>13</span><br data-v-24208a48><span class="line-number" data-v-24208a48>14</span><br data-v-24208a48><span class="line-number" data-v-24208a48>15</span><br data-v-24208a48><span class="line-number" data-v-24208a48>16</span><br data-v-24208a48><span class="line-number" data-v-24208a48>17</span><br data-v-24208a48><span class="line-number" data-v-24208a48>18</span><br data-v-24208a48><span class="line-number" data-v-24208a48>19</span><br data-v-24208a48><span class="line-number" data-v-24208a48>20</span><br data-v-24208a48><span class="line-number" data-v-24208a48>21</span><br data-v-24208a48><span class="line-number" data-v-24208a48>22</span><br data-v-24208a48><span class="line-number" data-v-24208a48>23</span><br data-v-24208a48><span class="line-number" data-v-24208a48>24</span><br data-v-24208a48><span class="line-number" data-v-24208a48>25</span><br data-v-24208a48><span class="line-number" data-v-24208a48>26</span><br data-v-24208a48><span class="line-number" data-v-24208a48>27</span><br data-v-24208a48><span class="line-number" data-v-24208a48>28</span><br data-v-24208a48><span class="line-number" data-v-24208a48>29</span><br data-v-24208a48><span class="line-number" data-v-24208a48>30</span><br data-v-24208a48><span class="line-number" data-v-24208a48>31</span><br data-v-24208a48><span class="line-number" data-v-24208a48>32</span><br data-v-24208a48><span class="line-number" data-v-24208a48>33</span><br data-v-24208a48></div></div><blockquote data-v-24208a48><p data-v-24208a48>组件A</p></blockquote> <div class="language-jsx line-numbers-mode" data-v-24208a48><pre class="language-jsx" data-v-24208a48><code data-v-24208a48><span class="token keyword" data-v-24208a48>function</span> <span class="token function" data-v-24208a48>index</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>{</span>
    console<span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>log</span><span class="token punctuation" data-v-24208a48>(</span><span class="token string" data-v-24208a48>'组件A渲染'</span><span class="token punctuation" data-v-24208a48>)</span>
   <span class="token keyword" data-v-24208a48>return</span> <span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>我是组件A</span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span>
<span class="token punctuation" data-v-24208a48>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-24208a48><span class="line-number" data-v-24208a48>1</span><br data-v-24208a48><span class="line-number" data-v-24208a48>2</span><br data-v-24208a48><span class="line-number" data-v-24208a48>3</span><br data-v-24208a48><span class="line-number" data-v-24208a48>4</span><br data-v-24208a48></div></div><blockquote data-v-24208a48><p data-v-24208a48>组件B，有一个componentWillReceiveProps钩子</p></blockquote> <div class="language-jsx line-numbers-mode" data-v-24208a48><pre class="language-jsx" data-v-24208a48><code data-v-24208a48><span class="token keyword" data-v-24208a48>class</span> <span class="token class-name" data-v-24208a48>Index</span> <span class="token keyword" data-v-24208a48>extends</span> <span class="token class-name" data-v-24208a48>React<span class="token punctuation" data-v-24208a48>.</span>Component</span><span class="token punctuation" data-v-24208a48>{</span>
    <span class="token function" data-v-24208a48>constructor</span><span class="token punctuation" data-v-24208a48>(</span><span class="token parameter" data-v-24208a48>props</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>{</span>
        <span class="token keyword" data-v-24208a48>super</span><span class="token punctuation" data-v-24208a48>(</span>props<span class="token punctuation" data-v-24208a48>)</span>
    <span class="token punctuation" data-v-24208a48>}</span>
    <span class="token function" data-v-24208a48>componentWillReceiveProps</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>{</span>
        console<span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>log</span><span class="token punctuation" data-v-24208a48>(</span><span class="token string" data-v-24208a48>'componentWillReceiveProps执行'</span><span class="token punctuation" data-v-24208a48>)</span>
        <span class="token comment" data-v-24208a48>/* 可能做一些骚操作 wu lian */</span>
    <span class="token punctuation" data-v-24208a48>}</span>
    <span class="token function" data-v-24208a48>render</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>{</span>
        console<span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>log</span><span class="token punctuation" data-v-24208a48>(</span><span class="token string" data-v-24208a48>'组件B渲染'</span><span class="token punctuation" data-v-24208a48>)</span>
        <span class="token keyword" data-v-24208a48>return</span> <span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
            我是组件B
        </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span>
    <span class="token punctuation" data-v-24208a48>}</span>
<span class="token punctuation" data-v-24208a48>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-24208a48><span class="line-number" data-v-24208a48>1</span><br data-v-24208a48><span class="line-number" data-v-24208a48>2</span><br data-v-24208a48><span class="line-number" data-v-24208a48>3</span><br data-v-24208a48><span class="line-number" data-v-24208a48>4</span><br data-v-24208a48><span class="line-number" data-v-24208a48>5</span><br data-v-24208a48><span class="line-number" data-v-24208a48>6</span><br data-v-24208a48><span class="line-number" data-v-24208a48>7</span><br data-v-24208a48><span class="line-number" data-v-24208a48>8</span><br data-v-24208a48><span class="line-number" data-v-24208a48>9</span><br data-v-24208a48><span class="line-number" data-v-24208a48>10</span><br data-v-24208a48><span class="line-number" data-v-24208a48>11</span><br data-v-24208a48><span class="line-number" data-v-24208a48>12</span><br data-v-24208a48><span class="line-number" data-v-24208a48>13</span><br data-v-24208a48><span class="line-number" data-v-24208a48>14</span><br data-v-24208a48><span class="line-number" data-v-24208a48>15</span><br data-v-24208a48></div></div><blockquote data-v-24208a48><p data-v-24208a48>组件C有一个列表循环</p></blockquote> <div class="language-jsx line-numbers-mode" data-v-24208a48><pre class="language-jsx" data-v-24208a48><code data-v-24208a48><span class="token keyword" data-v-24208a48>class</span> <span class="token class-name" data-v-24208a48>Index</span> <span class="token keyword" data-v-24208a48>extends</span> <span class="token class-name" data-v-24208a48>React<span class="token punctuation" data-v-24208a48>.</span>Component</span><span class="token punctuation" data-v-24208a48>{</span>
    <span class="token function" data-v-24208a48>constructor</span><span class="token punctuation" data-v-24208a48>(</span><span class="token parameter" data-v-24208a48>props</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>{</span>
        <span class="token keyword" data-v-24208a48>super</span><span class="token punctuation" data-v-24208a48>(</span>props<span class="token punctuation" data-v-24208a48>)</span>
    <span class="token punctuation" data-v-24208a48>}</span>

    <span class="token function" data-v-24208a48>render</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>{</span>
        console<span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>log</span><span class="token punctuation" data-v-24208a48>(</span><span class="token string" data-v-24208a48>'组件c渲染'</span><span class="token punctuation" data-v-24208a48>)</span>
        <span class="token keyword" data-v-24208a48>return</span> <span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
              我是组件c
             </span><span class="token punctuation" data-v-24208a48>{</span>
                <span class="token keyword" data-v-24208a48>new</span> <span class="token class-name" data-v-24208a48>Array</span><span class="token punctuation" data-v-24208a48>(</span><span class="token number" data-v-24208a48>10</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>fill</span><span class="token punctuation" data-v-24208a48>(</span><span class="token number" data-v-24208a48>0</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>map</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>(</span><span class="token parameter" data-v-24208a48>item<span class="token punctuation" data-v-24208a48>,</span>index</span><span class="token punctuation" data-v-24208a48>)</span><span class="token operator" data-v-24208a48>=&gt;</span><span class="token punctuation" data-v-24208a48>{</span>
                    console<span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>log</span><span class="token punctuation" data-v-24208a48>(</span><span class="token string" data-v-24208a48>'组件C列表循环了'</span> <span class="token punctuation" data-v-24208a48>)</span>
                    <span class="token keyword" data-v-24208a48>return</span> <span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>div</span> <span class="token attr-name" data-v-24208a48>key</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span>index<span class="token punctuation" data-v-24208a48>}</span></span> <span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token punctuation" data-v-24208a48>{</span>item<span class="token punctuation" data-v-24208a48>}</span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span>
                <span class="token punctuation" data-v-24208a48>}</span><span class="token punctuation" data-v-24208a48>)</span>
            <span class="token punctuation" data-v-24208a48>}</span><span class="token plain-text" data-v-24208a48>
        </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span>
    <span class="token punctuation" data-v-24208a48>}</span>
<span class="token punctuation" data-v-24208a48>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-24208a48><span class="line-number" data-v-24208a48>1</span><br data-v-24208a48><span class="line-number" data-v-24208a48>2</span><br data-v-24208a48><span class="line-number" data-v-24208a48>3</span><br data-v-24208a48><span class="line-number" data-v-24208a48>4</span><br data-v-24208a48><span class="line-number" data-v-24208a48>5</span><br data-v-24208a48><span class="line-number" data-v-24208a48>6</span><br data-v-24208a48><span class="line-number" data-v-24208a48>7</span><br data-v-24208a48><span class="line-number" data-v-24208a48>8</span><br data-v-24208a48><span class="line-number" data-v-24208a48>9</span><br data-v-24208a48><span class="line-number" data-v-24208a48>10</span><br data-v-24208a48><span class="line-number" data-v-24208a48>11</span><br data-v-24208a48><span class="line-number" data-v-24208a48>12</span><br data-v-24208a48><span class="line-number" data-v-24208a48>13</span><br data-v-24208a48><span class="line-number" data-v-24208a48>14</span><br data-v-24208a48><span class="line-number" data-v-24208a48>15</span><br data-v-24208a48><span class="line-number" data-v-24208a48>16</span><br data-v-24208a48><span class="line-number" data-v-24208a48>17</span><br data-v-24208a48><span class="line-number" data-v-24208a48>18</span><br data-v-24208a48></div></div><p data-v-24208a48>效果:</p> <p data-v-24208a48><img src="/vuebloger/img/post/asdasdad.gif" alt="" data-v-24208a48></p> <p data-v-24208a48>当我们在input输入内容的时候。就会造成如上的现象，所有的不该重新更新的地方，全部重新执行了一遍，这无疑是巨大的性能损耗。这个一个setState触发带来的一股巨大的由此组件到子组件可能更深的更新流，带来的副作用是不可估量的。所以我们可以思考一下，是否将这种受控性组件颗粒化，让自己更新 -&gt; 渲染过程由自身调度。我们对上面的input表单单独颗粒化处理。</p> <div class="language-jsx line-numbers-mode" data-v-24208a48><pre class="language-jsx" data-v-24208a48><code data-v-24208a48><span class="token keyword" data-v-24208a48>const</span> ComponentInput <span class="token operator" data-v-24208a48>=</span> <span class="token function" data-v-24208a48>memo</span><span class="token punctuation" data-v-24208a48>(</span><span class="token keyword" data-v-24208a48>function</span><span class="token punctuation" data-v-24208a48>(</span><span class="token parameter" data-v-24208a48><span class="token punctuation" data-v-24208a48>{</span> notifyFatherChange <span class="token punctuation" data-v-24208a48>}</span><span class="token operator" data-v-24208a48>:</span>any</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>{</span>
    <span class="token keyword" data-v-24208a48>const</span> <span class="token punctuation" data-v-24208a48>[</span> inputValue <span class="token punctuation" data-v-24208a48>,</span> setInputValue <span class="token punctuation" data-v-24208a48>]</span> <span class="token operator" data-v-24208a48>=</span> <span class="token function" data-v-24208a48>useState</span><span class="token punctuation" data-v-24208a48>(</span><span class="token string" data-v-24208a48>''</span><span class="token punctuation" data-v-24208a48>)</span>
    <span class="token keyword" data-v-24208a48>const</span> handerChange <span class="token operator" data-v-24208a48>=</span> <span class="token function" data-v-24208a48>useMemo</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span> <span class="token operator" data-v-24208a48>=&gt;</span> <span class="token punctuation" data-v-24208a48>(</span><span class="token parameter" data-v-24208a48>e</span><span class="token punctuation" data-v-24208a48>)</span> <span class="token operator" data-v-24208a48>=&gt;</span> <span class="token punctuation" data-v-24208a48>{</span>
        <span class="token function" data-v-24208a48>setInputValue</span><span class="token punctuation" data-v-24208a48>(</span>e<span class="token punctuation" data-v-24208a48>.</span>target<span class="token punctuation" data-v-24208a48>.</span>value<span class="token punctuation" data-v-24208a48>)</span>
        notifyFatherChange <span class="token operator" data-v-24208a48>&amp;&amp;</span> <span class="token function" data-v-24208a48>notifyFatherChange</span><span class="token punctuation" data-v-24208a48>(</span>e<span class="token punctuation" data-v-24208a48>.</span>target<span class="token punctuation" data-v-24208a48>.</span>value<span class="token punctuation" data-v-24208a48>)</span>
    <span class="token punctuation" data-v-24208a48>}</span><span class="token punctuation" data-v-24208a48>,</span><span class="token punctuation" data-v-24208a48>[</span><span class="token punctuation" data-v-24208a48>]</span><span class="token punctuation" data-v-24208a48>)</span>
    <span class="token keyword" data-v-24208a48>return</span> <span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span><span class="token class-name" data-v-24208a48>Input</span></span>   <span class="token attr-name" data-v-24208a48>value</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span>inputValue<span class="token punctuation" data-v-24208a48>}</span></span> <span class="token attr-name" data-v-24208a48>onChange</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span> handerChange  <span class="token punctuation" data-v-24208a48>}</span></span>  <span class="token punctuation" data-v-24208a48>/&gt;</span></span>
<span class="token punctuation" data-v-24208a48>}</span><span class="token punctuation" data-v-24208a48>)</span>
</code></pre> <div class="line-numbers-wrapper" data-v-24208a48><span class="line-number" data-v-24208a48>1</span><br data-v-24208a48><span class="line-number" data-v-24208a48>2</span><br data-v-24208a48><span class="line-number" data-v-24208a48>3</span><br data-v-24208a48><span class="line-number" data-v-24208a48>4</span><br data-v-24208a48><span class="line-number" data-v-24208a48>5</span><br data-v-24208a48><span class="line-number" data-v-24208a48>6</span><br data-v-24208a48><span class="line-number" data-v-24208a48>7</span><br data-v-24208a48><span class="line-number" data-v-24208a48>8</span><br data-v-24208a48></div></div><p data-v-24208a48>此时的组件更新由组件单元自行控制，不需要父组件的更新，所以不需要父组件设置独立state保留状态。只需要绑定到this上即可。不是所有状态都应该放在组件的 state 中. 例如缓存数据。如果需要组件响应它的变动, 或者需要渲染到视图中的数据才应该放到 state 中。这样可以避免不必要的数据变动导致组件重新渲染.</p> <div class="language-jsx line-numbers-mode" data-v-24208a48><pre class="language-jsx" data-v-24208a48><code data-v-24208a48><span class="token keyword" data-v-24208a48>class</span> <span class="token class-name" data-v-24208a48>index</span> <span class="token keyword" data-v-24208a48>extends</span> <span class="token class-name" data-v-24208a48>React<span class="token punctuation" data-v-24208a48>.</span>Component</span><span class="token operator" data-v-24208a48>&lt;</span>any<span class="token punctuation" data-v-24208a48>,</span>any<span class="token operator" data-v-24208a48>&gt;</span><span class="token punctuation" data-v-24208a48>{</span>   
    formData <span class="token operator" data-v-24208a48>:</span>any <span class="token operator" data-v-24208a48>=</span> <span class="token punctuation" data-v-24208a48>{</span><span class="token punctuation" data-v-24208a48>}</span>
    <span class="token function" data-v-24208a48>render</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>{</span>
        <span class="token keyword" data-v-24208a48>return</span> <span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
            </span><span class="token punctuation" data-v-24208a48>{</span> <span class="token comment" data-v-24208a48>/*  我们增加三个子组件 */</span> <span class="token punctuation" data-v-24208a48>}</span><span class="token plain-text" data-v-24208a48>
            </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span><span class="token class-name" data-v-24208a48>ComA</span></span> <span class="token punctuation" data-v-24208a48>/&gt;</span></span><span class="token plain-text" data-v-24208a48>
            </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span><span class="token class-name" data-v-24208a48>ComB</span></span> <span class="token punctuation" data-v-24208a48>/&gt;</span></span><span class="token plain-text" data-v-24208a48>
            </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span><span class="token class-name" data-v-24208a48>ComC</span></span> <span class="token punctuation" data-v-24208a48>/&gt;</span></span><span class="token plain-text" data-v-24208a48>
            </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>div</span> <span class="token attr-name" data-v-24208a48>className</span><span class="token attr-value" data-v-24208a48><span class="token punctuation attr-equals" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>&quot;</span>box<span class="token punctuation" data-v-24208a48>&quot;</span></span> <span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
               </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span><span class="token class-name" data-v-24208a48>ComponentInput</span></span> <span class="token attr-name" data-v-24208a48>notifyFatherChange</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span> <span class="token punctuation" data-v-24208a48>(</span><span class="token parameter" data-v-24208a48>value</span><span class="token punctuation" data-v-24208a48>)</span><span class="token operator" data-v-24208a48>=&gt;</span><span class="token punctuation" data-v-24208a48>{</span> <span class="token keyword" data-v-24208a48>this</span><span class="token punctuation" data-v-24208a48>.</span>formData<span class="token punctuation" data-v-24208a48>.</span>inputValue <span class="token operator" data-v-24208a48>=</span> value <span class="token punctuation" data-v-24208a48>}</span> <span class="token punctuation" data-v-24208a48>}</span></span>  <span class="token punctuation" data-v-24208a48>/&gt;</span></span><span class="token plain-text" data-v-24208a48>
               </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span><span class="token class-name" data-v-24208a48>Button</span></span> <span class="token attr-name" data-v-24208a48>onClick</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token operator" data-v-24208a48>=&gt;</span> console<span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>log</span><span class="token punctuation" data-v-24208a48>(</span><span class="token keyword" data-v-24208a48>this</span><span class="token punctuation" data-v-24208a48>.</span>formData<span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>}</span></span> <span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>打印数据</span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span><span class="token class-name" data-v-24208a48>Button</span></span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
            </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
            </span><span class="token punctuation" data-v-24208a48>{</span><span class="token comment" data-v-24208a48>/* 我们首先来一个列表循环 */</span><span class="token punctuation" data-v-24208a48>}</span><span class="token plain-text" data-v-24208a48>
            </span><span class="token punctuation" data-v-24208a48>{</span>
                <span class="token keyword" data-v-24208a48>new</span> <span class="token class-name" data-v-24208a48>Array</span><span class="token punctuation" data-v-24208a48>(</span><span class="token number" data-v-24208a48>10</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>fill</span><span class="token punctuation" data-v-24208a48>(</span><span class="token number" data-v-24208a48>0</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>map</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>(</span><span class="token parameter" data-v-24208a48>item<span class="token punctuation" data-v-24208a48>,</span>index</span><span class="token punctuation" data-v-24208a48>)</span><span class="token operator" data-v-24208a48>=&gt;</span><span class="token punctuation" data-v-24208a48>{</span>
                    console<span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>log</span><span class="token punctuation" data-v-24208a48>(</span><span class="token string" data-v-24208a48>'列表循环了'</span> <span class="token punctuation" data-v-24208a48>)</span>
                    <span class="token keyword" data-v-24208a48>return</span> <span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>div</span> <span class="token attr-name" data-v-24208a48>key</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span>index<span class="token punctuation" data-v-24208a48>}</span></span> <span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token punctuation" data-v-24208a48>{</span>item<span class="token punctuation" data-v-24208a48>}</span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span>
                <span class="token punctuation" data-v-24208a48>}</span><span class="token punctuation" data-v-24208a48>)</span>
            <span class="token punctuation" data-v-24208a48>}</span><span class="token plain-text" data-v-24208a48>
            </span><span class="token punctuation" data-v-24208a48>{</span>
              <span class="token comment" data-v-24208a48>/* 这里可能是更复杂的结构 */</span>
              <span class="token comment" data-v-24208a48>/* ------------------ */</span>
            <span class="token punctuation" data-v-24208a48>}</span><span class="token plain-text" data-v-24208a48>
        </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span>
    <span class="token punctuation" data-v-24208a48>}</span>
<span class="token punctuation" data-v-24208a48>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-24208a48><span class="line-number" data-v-24208a48>1</span><br data-v-24208a48><span class="line-number" data-v-24208a48>2</span><br data-v-24208a48><span class="line-number" data-v-24208a48>3</span><br data-v-24208a48><span class="line-number" data-v-24208a48>4</span><br data-v-24208a48><span class="line-number" data-v-24208a48>5</span><br data-v-24208a48><span class="line-number" data-v-24208a48>6</span><br data-v-24208a48><span class="line-number" data-v-24208a48>7</span><br data-v-24208a48><span class="line-number" data-v-24208a48>8</span><br data-v-24208a48><span class="line-number" data-v-24208a48>9</span><br data-v-24208a48><span class="line-number" data-v-24208a48>10</span><br data-v-24208a48><span class="line-number" data-v-24208a48>11</span><br data-v-24208a48><span class="line-number" data-v-24208a48>12</span><br data-v-24208a48><span class="line-number" data-v-24208a48>13</span><br data-v-24208a48><span class="line-number" data-v-24208a48>14</span><br data-v-24208a48><span class="line-number" data-v-24208a48>15</span><br data-v-24208a48><span class="line-number" data-v-24208a48>16</span><br data-v-24208a48><span class="line-number" data-v-24208a48>17</span><br data-v-24208a48><span class="line-number" data-v-24208a48>18</span><br data-v-24208a48><span class="line-number" data-v-24208a48>19</span><br data-v-24208a48><span class="line-number" data-v-24208a48>20</span><br data-v-24208a48><span class="line-number" data-v-24208a48>21</span><br data-v-24208a48><span class="line-number" data-v-24208a48>22</span><br data-v-24208a48><span class="line-number" data-v-24208a48>23</span><br data-v-24208a48><span class="line-number" data-v-24208a48>24</span><br data-v-24208a48><span class="line-number" data-v-24208a48>25</span><br data-v-24208a48><span class="line-number" data-v-24208a48>26</span><br data-v-24208a48></div></div><p data-v-24208a48>效果:
</p><div style="width:1200px;margin:auto;" data-v-24208a48><img src="/vuebloger/img/post/asdasdaasd.gif" alt="" data-v-24208a48></div><p data-v-24208a48></p> <p data-v-24208a48>这样除了当前组件外，其他地方没有收到任何渲染波动，达到了我们想要的目的。</p> <h2 id="建立独立的请求渲染单元" data-v-24208a48><a href="#建立独立的请求渲染单元" class="header-anchor" data-v-24208a48>#</a> 建立独立的请求渲染单元</h2> <p data-v-24208a48>建立独立的请求渲染单元，直接理解就是，如果我们把页面，分为请求数据展示部分(通过调用后端接口，获取数据)，和基础部分(不需要请求数据，已经直接写好的)，对于一些逻辑交互不是很复杂的数据展示部分，我推荐用一种独立组件，独立请求数据，独立控制渲染的模式。至于为什么我们可以慢慢分析。</p> <p data-v-24208a48>首先我们看一下传统的页面模式。
</p><div style="width:800px;margin:auto;" data-v-24208a48><img src="/vuebloger/img/post/Snipaste_2021-10-05_14-28-16.jpg" alt="" data-v-24208a48></div>
页面有三个展示区域分别，做了三次请求，触发了三次setState,渲染三次页面，即使用Promise.all等方法，但是也不保证接下来交互中，会有部分展示区重新拉取数据的可能。一旦有一个区域重新拉取数据，另外两个区域也会说、受到牵连，这种效应是不可避免的，即便react有很好的ddiff算法去调协相同的节点，但是比如长列表等情况，循环在所难免。<p data-v-24208a48></p> <div class="language-jsx line-numbers-mode" data-v-24208a48><pre class="language-jsx" data-v-24208a48><code data-v-24208a48><span class="token keyword" data-v-24208a48>class</span> <span class="token class-name" data-v-24208a48>Index</span> <span class="token keyword" data-v-24208a48>extends</span> <span class="token class-name" data-v-24208a48>React<span class="token punctuation" data-v-24208a48>.</span>Component</span><span class="token punctuation" data-v-24208a48>{</span>
    state <span class="token operator" data-v-24208a48>:</span>any<span class="token operator" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span>
        dataA<span class="token operator" data-v-24208a48>:</span><span class="token keyword" data-v-24208a48>null</span><span class="token punctuation" data-v-24208a48>,</span>
        dataB<span class="token operator" data-v-24208a48>:</span><span class="token keyword" data-v-24208a48>null</span><span class="token punctuation" data-v-24208a48>,</span>
        dataC<span class="token operator" data-v-24208a48>:</span><span class="token keyword" data-v-24208a48>null</span>
    <span class="token punctuation" data-v-24208a48>}</span>
    <span class="token keyword" data-v-24208a48>async</span> <span class="token function" data-v-24208a48>componentDidMount</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>{</span>
        <span class="token comment" data-v-24208a48>/* 获取A区域数据 */</span>
        <span class="token keyword" data-v-24208a48>const</span> dataA <span class="token operator" data-v-24208a48>=</span> <span class="token keyword" data-v-24208a48>await</span> <span class="token function" data-v-24208a48>getDataA</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span>
        <span class="token keyword" data-v-24208a48>this</span><span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>setState</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>{</span> dataA <span class="token punctuation" data-v-24208a48>}</span><span class="token punctuation" data-v-24208a48>)</span>
        <span class="token comment" data-v-24208a48>/* 获取B区域数据 */</span>
        <span class="token keyword" data-v-24208a48>const</span> dataB <span class="token operator" data-v-24208a48>=</span> <span class="token keyword" data-v-24208a48>await</span> <span class="token function" data-v-24208a48>getDataB</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span>
        <span class="token keyword" data-v-24208a48>this</span><span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>setState</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>{</span> dataB <span class="token punctuation" data-v-24208a48>}</span><span class="token punctuation" data-v-24208a48>)</span>
        <span class="token comment" data-v-24208a48>/* 获取C区域数据 */</span>
        <span class="token keyword" data-v-24208a48>const</span> dataC <span class="token operator" data-v-24208a48>=</span> <span class="token keyword" data-v-24208a48>await</span> <span class="token function" data-v-24208a48>getDataC</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span>
        <span class="token keyword" data-v-24208a48>this</span><span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>setState</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>{</span> dataC <span class="token punctuation" data-v-24208a48>}</span><span class="token punctuation" data-v-24208a48>)</span>
    <span class="token punctuation" data-v-24208a48>}</span>
    <span class="token function" data-v-24208a48>render</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>{</span>
        <span class="token keyword" data-v-24208a48>const</span> <span class="token punctuation" data-v-24208a48>{</span> dataA <span class="token punctuation" data-v-24208a48>,</span> dataB <span class="token punctuation" data-v-24208a48>,</span> dataC <span class="token punctuation" data-v-24208a48>}</span> <span class="token operator" data-v-24208a48>=</span> <span class="token keyword" data-v-24208a48>this</span><span class="token punctuation" data-v-24208a48>.</span>state
        console<span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>log</span><span class="token punctuation" data-v-24208a48>(</span>dataA<span class="token punctuation" data-v-24208a48>,</span>dataB<span class="token punctuation" data-v-24208a48>,</span>dataC<span class="token punctuation" data-v-24208a48>)</span>
        <span class="token keyword" data-v-24208a48>return</span> <span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
            </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48> </span><span class="token punctuation" data-v-24208a48>{</span> <span class="token comment" data-v-24208a48>/* 用 dataA 数据做展示渲染 */</span> <span class="token punctuation" data-v-24208a48>}</span><span class="token plain-text" data-v-24208a48> </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
            </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48> </span><span class="token punctuation" data-v-24208a48>{</span> <span class="token comment" data-v-24208a48>/* 用 dataB 数据做展示渲染 */</span> <span class="token punctuation" data-v-24208a48>}</span><span class="token plain-text" data-v-24208a48> </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
            </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48> </span><span class="token punctuation" data-v-24208a48>{</span> <span class="token comment" data-v-24208a48>/* 用 dataC 数据做展示渲染 */</span> <span class="token punctuation" data-v-24208a48>}</span><span class="token plain-text" data-v-24208a48> </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
        </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span>
    <span class="token punctuation" data-v-24208a48>}</span>
<span class="token punctuation" data-v-24208a48>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-24208a48><span class="line-number" data-v-24208a48>1</span><br data-v-24208a48><span class="line-number" data-v-24208a48>2</span><br data-v-24208a48><span class="line-number" data-v-24208a48>3</span><br data-v-24208a48><span class="line-number" data-v-24208a48>4</span><br data-v-24208a48><span class="line-number" data-v-24208a48>5</span><br data-v-24208a48><span class="line-number" data-v-24208a48>6</span><br data-v-24208a48><span class="line-number" data-v-24208a48>7</span><br data-v-24208a48><span class="line-number" data-v-24208a48>8</span><br data-v-24208a48><span class="line-number" data-v-24208a48>9</span><br data-v-24208a48><span class="line-number" data-v-24208a48>10</span><br data-v-24208a48><span class="line-number" data-v-24208a48>11</span><br data-v-24208a48><span class="line-number" data-v-24208a48>12</span><br data-v-24208a48><span class="line-number" data-v-24208a48>13</span><br data-v-24208a48><span class="line-number" data-v-24208a48>14</span><br data-v-24208a48><span class="line-number" data-v-24208a48>15</span><br data-v-24208a48><span class="line-number" data-v-24208a48>16</span><br data-v-24208a48><span class="line-number" data-v-24208a48>17</span><br data-v-24208a48><span class="line-number" data-v-24208a48>18</span><br data-v-24208a48><span class="line-number" data-v-24208a48>19</span><br data-v-24208a48><span class="line-number" data-v-24208a48>20</span><br data-v-24208a48><span class="line-number" data-v-24208a48>21</span><br data-v-24208a48><span class="line-number" data-v-24208a48>22</span><br data-v-24208a48><span class="line-number" data-v-24208a48>23</span><br data-v-24208a48><span class="line-number" data-v-24208a48>24</span><br data-v-24208a48><span class="line-number" data-v-24208a48>25</span><br data-v-24208a48><span class="line-number" data-v-24208a48>26</span><br data-v-24208a48><span class="line-number" data-v-24208a48>27</span><br data-v-24208a48></div></div><p data-v-24208a48>接下来我们，把每一部分抽取出来，形成独立的渲染单元，每个组件都独立数据请求到独立渲染。</p> <div class="language-jsx line-numbers-mode" data-v-24208a48><pre class="language-jsx" data-v-24208a48><code data-v-24208a48><span class="token keyword" data-v-24208a48>function</span> <span class="token function" data-v-24208a48>ComponentA</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>{</span>
    <span class="token keyword" data-v-24208a48>const</span> <span class="token punctuation" data-v-24208a48>[</span> dataA<span class="token punctuation" data-v-24208a48>,</span> setDataA <span class="token punctuation" data-v-24208a48>]</span> <span class="token operator" data-v-24208a48>=</span> <span class="token function" data-v-24208a48>useState</span><span class="token punctuation" data-v-24208a48>(</span><span class="token keyword" data-v-24208a48>null</span><span class="token punctuation" data-v-24208a48>)</span>
    <span class="token function" data-v-24208a48>useEffect</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token operator" data-v-24208a48>=&gt;</span><span class="token punctuation" data-v-24208a48>{</span>
       <span class="token function" data-v-24208a48>getDataA</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>then</span><span class="token punctuation" data-v-24208a48>(</span><span class="token parameter" data-v-24208a48>res</span><span class="token operator" data-v-24208a48>=&gt;</span> <span class="token function" data-v-24208a48>setDataA</span><span class="token punctuation" data-v-24208a48>(</span>res<span class="token punctuation" data-v-24208a48>.</span>data<span class="token punctuation" data-v-24208a48>)</span>  <span class="token punctuation" data-v-24208a48>)</span>
    <span class="token punctuation" data-v-24208a48>}</span><span class="token punctuation" data-v-24208a48>,</span><span class="token punctuation" data-v-24208a48>[</span><span class="token punctuation" data-v-24208a48>]</span><span class="token punctuation" data-v-24208a48>)</span>
    <span class="token keyword" data-v-24208a48>return</span>  <span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48> </span><span class="token punctuation" data-v-24208a48>{</span> <span class="token comment" data-v-24208a48>/* 用 dataA 数据做展示渲染 */</span> <span class="token punctuation" data-v-24208a48>}</span><span class="token plain-text" data-v-24208a48> </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span>
<span class="token punctuation" data-v-24208a48>}</span> 

<span class="token keyword" data-v-24208a48>function</span> <span class="token function" data-v-24208a48>ComponentB</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>{</span>
    <span class="token keyword" data-v-24208a48>const</span> <span class="token punctuation" data-v-24208a48>[</span> dataB<span class="token punctuation" data-v-24208a48>,</span> setDataB <span class="token punctuation" data-v-24208a48>]</span> <span class="token operator" data-v-24208a48>=</span> <span class="token function" data-v-24208a48>useState</span><span class="token punctuation" data-v-24208a48>(</span><span class="token keyword" data-v-24208a48>null</span><span class="token punctuation" data-v-24208a48>)</span>
    <span class="token function" data-v-24208a48>useEffect</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token operator" data-v-24208a48>=&gt;</span><span class="token punctuation" data-v-24208a48>{</span>
       <span class="token function" data-v-24208a48>getDataB</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>then</span><span class="token punctuation" data-v-24208a48>(</span><span class="token parameter" data-v-24208a48>res</span><span class="token operator" data-v-24208a48>=&gt;</span> <span class="token function" data-v-24208a48>setDataB</span><span class="token punctuation" data-v-24208a48>(</span>res<span class="token punctuation" data-v-24208a48>.</span>data<span class="token punctuation" data-v-24208a48>)</span>  <span class="token punctuation" data-v-24208a48>)</span>
    <span class="token punctuation" data-v-24208a48>}</span><span class="token punctuation" data-v-24208a48>,</span><span class="token punctuation" data-v-24208a48>[</span><span class="token punctuation" data-v-24208a48>]</span><span class="token punctuation" data-v-24208a48>)</span>
    <span class="token keyword" data-v-24208a48>return</span>  <span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48> </span><span class="token punctuation" data-v-24208a48>{</span> <span class="token comment" data-v-24208a48>/* 用 dataB 数据做展示渲染 */</span> <span class="token punctuation" data-v-24208a48>}</span><span class="token plain-text" data-v-24208a48> </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span>
<span class="token punctuation" data-v-24208a48>}</span> 

<span class="token keyword" data-v-24208a48>function</span> <span class="token function" data-v-24208a48>ComponentC</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>{</span>
    <span class="token keyword" data-v-24208a48>const</span> <span class="token punctuation" data-v-24208a48>[</span> dataC<span class="token punctuation" data-v-24208a48>,</span> setDataC <span class="token punctuation" data-v-24208a48>]</span> <span class="token operator" data-v-24208a48>=</span> <span class="token function" data-v-24208a48>useState</span><span class="token punctuation" data-v-24208a48>(</span><span class="token keyword" data-v-24208a48>null</span><span class="token punctuation" data-v-24208a48>)</span>
    <span class="token function" data-v-24208a48>useEffect</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token operator" data-v-24208a48>=&gt;</span><span class="token punctuation" data-v-24208a48>{</span>
       <span class="token function" data-v-24208a48>getDataC</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>then</span><span class="token punctuation" data-v-24208a48>(</span><span class="token parameter" data-v-24208a48>res</span><span class="token operator" data-v-24208a48>=&gt;</span> <span class="token function" data-v-24208a48>setDataC</span><span class="token punctuation" data-v-24208a48>(</span>res<span class="token punctuation" data-v-24208a48>.</span>data<span class="token punctuation" data-v-24208a48>)</span>  <span class="token punctuation" data-v-24208a48>)</span>
    <span class="token punctuation" data-v-24208a48>}</span><span class="token punctuation" data-v-24208a48>,</span><span class="token punctuation" data-v-24208a48>[</span><span class="token punctuation" data-v-24208a48>]</span><span class="token punctuation" data-v-24208a48>)</span>
    <span class="token keyword" data-v-24208a48>return</span>  <span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48> </span><span class="token punctuation" data-v-24208a48>{</span> <span class="token comment" data-v-24208a48>/* 用 dataC 数据做展示渲染 */</span> <span class="token punctuation" data-v-24208a48>}</span><span class="token plain-text" data-v-24208a48> </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span>
<span class="token punctuation" data-v-24208a48>}</span>  

<span class="token keyword" data-v-24208a48>function</span> <span class="token function" data-v-24208a48>Index</span> <span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>{</span>
    <span class="token keyword" data-v-24208a48>return</span> <span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
        </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span><span class="token class-name" data-v-24208a48>ComponentA</span></span> <span class="token punctuation" data-v-24208a48>/&gt;</span></span><span class="token plain-text" data-v-24208a48>
        </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span><span class="token class-name" data-v-24208a48>ComponentB</span></span> <span class="token punctuation" data-v-24208a48>/&gt;</span></span><span class="token plain-text" data-v-24208a48>
        </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span><span class="token class-name" data-v-24208a48>ComponentC</span></span> <span class="token punctuation" data-v-24208a48>/&gt;</span></span><span class="token plain-text" data-v-24208a48>
    </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span>
<span class="token punctuation" data-v-24208a48>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-24208a48><span class="line-number" data-v-24208a48>1</span><br data-v-24208a48><span class="line-number" data-v-24208a48>2</span><br data-v-24208a48><span class="line-number" data-v-24208a48>3</span><br data-v-24208a48><span class="line-number" data-v-24208a48>4</span><br data-v-24208a48><span class="line-number" data-v-24208a48>5</span><br data-v-24208a48><span class="line-number" data-v-24208a48>6</span><br data-v-24208a48><span class="line-number" data-v-24208a48>7</span><br data-v-24208a48><span class="line-number" data-v-24208a48>8</span><br data-v-24208a48><span class="line-number" data-v-24208a48>9</span><br data-v-24208a48><span class="line-number" data-v-24208a48>10</span><br data-v-24208a48><span class="line-number" data-v-24208a48>11</span><br data-v-24208a48><span class="line-number" data-v-24208a48>12</span><br data-v-24208a48><span class="line-number" data-v-24208a48>13</span><br data-v-24208a48><span class="line-number" data-v-24208a48>14</span><br data-v-24208a48><span class="line-number" data-v-24208a48>15</span><br data-v-24208a48><span class="line-number" data-v-24208a48>16</span><br data-v-24208a48><span class="line-number" data-v-24208a48>17</span><br data-v-24208a48><span class="line-number" data-v-24208a48>18</span><br data-v-24208a48><span class="line-number" data-v-24208a48>19</span><br data-v-24208a48><span class="line-number" data-v-24208a48>20</span><br data-v-24208a48><span class="line-number" data-v-24208a48>21</span><br data-v-24208a48><span class="line-number" data-v-24208a48>22</span><br data-v-24208a48><span class="line-number" data-v-24208a48>23</span><br data-v-24208a48><span class="line-number" data-v-24208a48>24</span><br data-v-24208a48><span class="line-number" data-v-24208a48>25</span><br data-v-24208a48><span class="line-number" data-v-24208a48>26</span><br data-v-24208a48><span class="line-number" data-v-24208a48>27</span><br data-v-24208a48><span class="line-number" data-v-24208a48>28</span><br data-v-24208a48><span class="line-number" data-v-24208a48>29</span><br data-v-24208a48><span class="line-number" data-v-24208a48>30</span><br data-v-24208a48><span class="line-number" data-v-24208a48>31</span><br data-v-24208a48></div></div><p data-v-24208a48>这样一来，彼此的数据更新都不会相互影响。
</p><div style="width:800px;margin:auto;" data-v-24208a48><img src="/vuebloger/img/post/Snipaste_2021-10-05_14-33-08.jpg" alt="" data-v-24208a48></div><p data-v-24208a48></p> <h2 id="memo-shouldcomponentupdate" data-v-24208a48><a href="#memo-shouldcomponentupdate" class="header-anchor" data-v-24208a48>#</a> memo/shouldComponentUpdate</h2> <h3 id="purecomponent-react-memo" data-v-24208a48><a href="#purecomponent-react-memo" class="header-anchor" data-v-24208a48>#</a> PureComponent/React.memo</h3> <p data-v-24208a48>React.PureComponent  与 React.Component 用法差不多 ,但 React.PureComponent 通过props和state的浅对比来实现 shouldComponentUpate()。如果对象包含复杂的数据结构(比如对象和数组)，他会浅比较，如果深层次的改变，是无法作出判断的，React.PureComponent 认为没有变化，而没有渲染试图。
如这个例子</p> <div class="language-jsx line-numbers-mode" data-v-24208a48><pre class="language-jsx" data-v-24208a48><code data-v-24208a48><span class="token keyword" data-v-24208a48>class</span> <span class="token class-name" data-v-24208a48>Text</span> <span class="token keyword" data-v-24208a48>extends</span> <span class="token class-name" data-v-24208a48>React<span class="token punctuation" data-v-24208a48>.</span>PureComponent</span><span class="token operator" data-v-24208a48>&lt;</span>any<span class="token punctuation" data-v-24208a48>,</span>any<span class="token operator" data-v-24208a48>&gt;</span><span class="token punctuation" data-v-24208a48>{</span>
    <span class="token function" data-v-24208a48>render</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>{</span>
        console<span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>log</span><span class="token punctuation" data-v-24208a48>(</span><span class="token keyword" data-v-24208a48>this</span><span class="token punctuation" data-v-24208a48>.</span>props<span class="token punctuation" data-v-24208a48>)</span>
        <span class="token keyword" data-v-24208a48>return</span> <span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>hello,wrold</span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span>
    <span class="token punctuation" data-v-24208a48>}</span>
<span class="token punctuation" data-v-24208a48>}</span>
<span class="token keyword" data-v-24208a48>class</span> <span class="token class-name" data-v-24208a48>Index</span> <span class="token keyword" data-v-24208a48>extends</span> <span class="token class-name" data-v-24208a48>React<span class="token punctuation" data-v-24208a48>.</span>Component</span><span class="token operator" data-v-24208a48>&lt;</span>any<span class="token punctuation" data-v-24208a48>,</span>any<span class="token operator" data-v-24208a48>&gt;</span><span class="token punctuation" data-v-24208a48>{</span>
    state<span class="token operator" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span>
        data<span class="token operator" data-v-24208a48>:</span><span class="token punctuation" data-v-24208a48>{</span> a <span class="token operator" data-v-24208a48>:</span> <span class="token number" data-v-24208a48>1</span> <span class="token punctuation" data-v-24208a48>,</span> b <span class="token operator" data-v-24208a48>:</span> <span class="token number" data-v-24208a48>2</span> <span class="token punctuation" data-v-24208a48>}</span>
    <span class="token punctuation" data-v-24208a48>}</span>
    <span class="token function-variable function" data-v-24208a48>handerClick</span><span class="token operator" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token operator" data-v-24208a48>=&gt;</span><span class="token punctuation" data-v-24208a48>{</span>
        <span class="token keyword" data-v-24208a48>const</span> <span class="token punctuation" data-v-24208a48>{</span> data <span class="token punctuation" data-v-24208a48>}</span> <span class="token operator" data-v-24208a48>=</span> <span class="token keyword" data-v-24208a48>this</span><span class="token punctuation" data-v-24208a48>.</span>state
        data<span class="token punctuation" data-v-24208a48>.</span>a<span class="token operator" data-v-24208a48>++</span>
        <span class="token keyword" data-v-24208a48>this</span><span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>setState</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>{</span> data <span class="token punctuation" data-v-24208a48>}</span><span class="token punctuation" data-v-24208a48>)</span>
    <span class="token punctuation" data-v-24208a48>}</span>
    <span class="token function" data-v-24208a48>render</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>{</span>
        <span class="token keyword" data-v-24208a48>const</span> <span class="token punctuation" data-v-24208a48>{</span> data <span class="token punctuation" data-v-24208a48>}</span> <span class="token operator" data-v-24208a48>=</span> <span class="token keyword" data-v-24208a48>this</span><span class="token punctuation" data-v-24208a48>.</span>state
        <span class="token keyword" data-v-24208a48>return</span> <span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
            </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>button</span> <span class="token attr-name" data-v-24208a48>onClick</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span> <span class="token keyword" data-v-24208a48>this</span><span class="token punctuation" data-v-24208a48>.</span>handerClick <span class="token punctuation" data-v-24208a48>}</span></span> <span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>点击</span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>button</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
            </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span><span class="token class-name" data-v-24208a48>Text</span></span> <span class="token attr-name" data-v-24208a48>data</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span>data<span class="token punctuation" data-v-24208a48>}</span></span> <span class="token punctuation" data-v-24208a48>/&gt;</span></span><span class="token plain-text" data-v-24208a48>
        </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span>
    <span class="token punctuation" data-v-24208a48>}</span>
<span class="token punctuation" data-v-24208a48>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-24208a48><span class="line-number" data-v-24208a48>1</span><br data-v-24208a48><span class="line-number" data-v-24208a48>2</span><br data-v-24208a48><span class="line-number" data-v-24208a48>3</span><br data-v-24208a48><span class="line-number" data-v-24208a48>4</span><br data-v-24208a48><span class="line-number" data-v-24208a48>5</span><br data-v-24208a48><span class="line-number" data-v-24208a48>6</span><br data-v-24208a48><span class="line-number" data-v-24208a48>7</span><br data-v-24208a48><span class="line-number" data-v-24208a48>8</span><br data-v-24208a48><span class="line-number" data-v-24208a48>9</span><br data-v-24208a48><span class="line-number" data-v-24208a48>10</span><br data-v-24208a48><span class="line-number" data-v-24208a48>11</span><br data-v-24208a48><span class="line-number" data-v-24208a48>12</span><br data-v-24208a48><span class="line-number" data-v-24208a48>13</span><br data-v-24208a48><span class="line-number" data-v-24208a48>14</span><br data-v-24208a48><span class="line-number" data-v-24208a48>15</span><br data-v-24208a48><span class="line-number" data-v-24208a48>16</span><br data-v-24208a48><span class="line-number" data-v-24208a48>17</span><br data-v-24208a48><span class="line-number" data-v-24208a48>18</span><br data-v-24208a48><span class="line-number" data-v-24208a48>19</span><br data-v-24208a48><span class="line-number" data-v-24208a48>20</span><br data-v-24208a48><span class="line-number" data-v-24208a48>21</span><br data-v-24208a48><span class="line-number" data-v-24208a48>22</span><br data-v-24208a48><span class="line-number" data-v-24208a48>23</span><br data-v-24208a48></div></div><p data-v-24208a48>效果:
</p><div style="width:1200px;margin:auto;" data-v-24208a48><img src="/vuebloger/img/post/34234234234.gif" alt="" data-v-24208a48></div>
我们点击按钮，发现 <Text data-v-24208a48></Text> 根本没有重新更新。这里虽然改了data但是只是改变了data下的属性，所以 PureComponent 进行浅比较不会update。<p data-v-24208a48></p> <p data-v-24208a48>想要解决这个问题实际也很容易。</p> <div class="language-jsx line-numbers-mode" data-v-24208a48><pre class="language-jsx" data-v-24208a48><code data-v-24208a48> <span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span><span class="token class-name" data-v-24208a48>Text</span></span> <span class="token attr-name" data-v-24208a48>data</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span><span class="token punctuation" data-v-24208a48>{</span> <span class="token operator" data-v-24208a48>...</span>data <span class="token punctuation" data-v-24208a48>}</span><span class="token punctuation" data-v-24208a48>}</span></span> <span class="token punctuation" data-v-24208a48>/&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper" data-v-24208a48><span class="line-number" data-v-24208a48>1</span><br data-v-24208a48></div></div><p data-v-24208a48>无论组件是否是 PureComponent，如果定义了 shouldComponentUpdate()，那么会调用它并以它的执行结果来判断是否 update。在组件未定义 shouldComponentUpdate() 的情况下，会判断该组件是否是 PureComponent，如果是的话，会对新旧 props、state 进行 shallowEqual 比较，一旦新旧不一致，会触发渲染更新。
react.memo 和 PureComponent 功能类似 ，react.memo 作为第一个高阶组件，第二个参数 可以对props 进行比较 ，和shouldComponentUpdate不同的, 当第二个参数返回 true 的时候，证明props没有改变，不渲染组件，反之渲染组件。</p> <h3 id="shouldcomponentupdate" data-v-24208a48><a href="#shouldcomponentupdate" class="header-anchor" data-v-24208a48>#</a> shouldComponentUpdate</h3> <p data-v-24208a48>使用 shouldComponentUpdate()  以让React知道当state或props的改变是否影响组件的重新render，默认返回ture，返回false时不会重新渲染更新，而且该方法并不会在初始化渲染或当使用 forceUpdate() 时被调用，通常一个shouldComponentUpdate 应用是这么写的。</p> <p data-v-24208a48>控制状态</p> <div class="language-jsx line-numbers-mode" data-v-24208a48><pre class="language-jsx" data-v-24208a48><code data-v-24208a48><span class="token function" data-v-24208a48>shouldComponentUpdate</span><span class="token punctuation" data-v-24208a48>(</span><span class="token parameter" data-v-24208a48>nextProps<span class="token punctuation" data-v-24208a48>,</span> nextState</span><span class="token punctuation" data-v-24208a48>)</span> <span class="token punctuation" data-v-24208a48>{</span>
  <span class="token comment" data-v-24208a48>/* 当 state 中 data1 发生改变的时候，重新更新组件 */</span>  
  <span class="token keyword" data-v-24208a48>return</span> nextState<span class="token punctuation" data-v-24208a48>.</span>data1 <span class="token operator" data-v-24208a48>!==</span> <span class="token keyword" data-v-24208a48>this</span><span class="token punctuation" data-v-24208a48>.</span>state<span class="token punctuation" data-v-24208a48>.</span>data1
<span class="token punctuation" data-v-24208a48>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-24208a48><span class="line-number" data-v-24208a48>1</span><br data-v-24208a48><span class="line-number" data-v-24208a48>2</span><br data-v-24208a48><span class="line-number" data-v-24208a48>3</span><br data-v-24208a48><span class="line-number" data-v-24208a48>4</span><br data-v-24208a48></div></div><p data-v-24208a48>这个的意思就是 仅当state 中 data1 发生改变的时候，重新更新组件。 控制prop属性</p> <div class="language-jsx line-numbers-mode" data-v-24208a48><pre class="language-jsx" data-v-24208a48><code data-v-24208a48><span class="token function" data-v-24208a48>shouldComponentUpdate</span><span class="token punctuation" data-v-24208a48>(</span><span class="token parameter" data-v-24208a48>nextProps<span class="token punctuation" data-v-24208a48>,</span> nextState</span><span class="token punctuation" data-v-24208a48>)</span> <span class="token punctuation" data-v-24208a48>{</span>
  <span class="token comment" data-v-24208a48>/* 当 props 中 data2发生改变的时候，重新更新组件 */</span>  
  <span class="token keyword" data-v-24208a48>return</span> nextProps<span class="token punctuation" data-v-24208a48>.</span>data2 <span class="token operator" data-v-24208a48>!==</span> <span class="token keyword" data-v-24208a48>this</span><span class="token punctuation" data-v-24208a48>.</span>props<span class="token punctuation" data-v-24208a48>.</span>data2
<span class="token punctuation" data-v-24208a48>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-24208a48><span class="line-number" data-v-24208a48>1</span><br data-v-24208a48><span class="line-number" data-v-24208a48>2</span><br data-v-24208a48><span class="line-number" data-v-24208a48>3</span><br data-v-24208a48><span class="line-number" data-v-24208a48>4</span><br data-v-24208a48></div></div><h3 id="immetable-jsx" data-v-24208a48><a href="#immetable-jsx" class="header-anchor" data-v-24208a48>#</a> immetable.jsx</h3> <p data-v-24208a48>immetable.jsx 是Facebook 开发的一个js库，可以提高对象的比较性能，像之前所说的pureComponent 只能对对象进行浅比较，,对于对象的数据类型,却束手无策,所以我们可以用 immetable.jsx 配合 shouldComponentUpdate 或者  react.memo来使用。immutable 中</p> <p data-v-24208a48>我们用react-redux来简单举一个例子，如下所示 数据都已经被 immetable.js处理。</p> <div class="language-jsx line-numbers-mode" data-v-24208a48><pre class="language-jsx" data-v-24208a48><code data-v-24208a48><span class="token keyword" data-v-24208a48>import</span> <span class="token punctuation" data-v-24208a48>{</span> is  <span class="token punctuation" data-v-24208a48>}</span> <span class="token keyword" data-v-24208a48>from</span> <span class="token string" data-v-24208a48>'immutable'</span>
<span class="token keyword" data-v-24208a48>const</span> GoodItems <span class="token operator" data-v-24208a48>=</span> <span class="token function" data-v-24208a48>connect</span><span class="token punctuation" data-v-24208a48>(</span><span class="token parameter" data-v-24208a48>state</span> <span class="token operator" data-v-24208a48>=&gt;</span>
    <span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>{</span> GoodItems<span class="token operator" data-v-24208a48>:</span> <span class="token function" data-v-24208a48>filter</span><span class="token punctuation" data-v-24208a48>(</span>state<span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>getIn</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>[</span><span class="token string" data-v-24208a48>'Items'</span><span class="token punctuation" data-v-24208a48>,</span> <span class="token string" data-v-24208a48>'payload'</span><span class="token punctuation" data-v-24208a48>,</span> <span class="token string" data-v-24208a48>'list'</span><span class="token punctuation" data-v-24208a48>]</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>,</span> state<span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>getIn</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>[</span><span class="token string" data-v-24208a48>'customItems'</span><span class="token punctuation" data-v-24208a48>,</span> <span class="token string" data-v-24208a48>'payload'</span><span class="token punctuation" data-v-24208a48>,</span> <span class="token string" data-v-24208a48>'list'</span><span class="token punctuation" data-v-24208a48>]</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>)</span> <span class="token operator" data-v-24208a48>||</span> Immutable<span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>List</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>,</span> <span class="token punctuation" data-v-24208a48>}</span><span class="token punctuation" data-v-24208a48>)</span>
    <span class="token comment" data-v-24208a48>/* 此处省略很多代码～～～～～～ */</span>
<span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>(</span><span class="token function" data-v-24208a48>memo</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>(</span><span class="token parameter" data-v-24208a48><span class="token punctuation" data-v-24208a48>{</span> Items<span class="token punctuation" data-v-24208a48>,</span> dispatch<span class="token punctuation" data-v-24208a48>,</span> setSeivceId <span class="token punctuation" data-v-24208a48>}</span></span><span class="token punctuation" data-v-24208a48>)</span> <span class="token operator" data-v-24208a48>=&gt;</span> <span class="token punctuation" data-v-24208a48>{</span>
   <span class="token comment" data-v-24208a48>/*  */</span>
<span class="token punctuation" data-v-24208a48>}</span><span class="token punctuation" data-v-24208a48>,</span> <span class="token punctuation" data-v-24208a48>(</span><span class="token parameter" data-v-24208a48>pre<span class="token punctuation" data-v-24208a48>,</span> next</span><span class="token punctuation" data-v-24208a48>)</span> <span class="token operator" data-v-24208a48>=&gt;</span> <span class="token function" data-v-24208a48>is</span><span class="token punctuation" data-v-24208a48>(</span>pre<span class="token punctuation" data-v-24208a48>.</span>Items<span class="token punctuation" data-v-24208a48>,</span> next<span class="token punctuation" data-v-24208a48>.</span>Items<span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>)</span>
</code></pre> <div class="line-numbers-wrapper" data-v-24208a48><span class="line-number" data-v-24208a48>1</span><br data-v-24208a48><span class="line-number" data-v-24208a48>2</span><br data-v-24208a48><span class="line-number" data-v-24208a48>3</span><br data-v-24208a48><span class="line-number" data-v-24208a48>4</span><br data-v-24208a48><span class="line-number" data-v-24208a48>5</span><br data-v-24208a48><span class="line-number" data-v-24208a48>6</span><br data-v-24208a48><span class="line-number" data-v-24208a48>7</span><br data-v-24208a48></div></div><p data-v-24208a48>通过 is 方法来判断，前后Items(对象数据类型)是否发生变化。</p> <h2 id="规范写法-合理处理细节问题" data-v-24208a48><a href="#规范写法-合理处理细节问题" class="header-anchor" data-v-24208a48>#</a> 规范写法，合理处理细节问题</h2> <h3 id="绑定事件尽量不要使用箭头函数" data-v-24208a48><a href="#绑定事件尽量不要使用箭头函数" class="header-anchor" data-v-24208a48>#</a> 绑定事件尽量不要使用箭头函数</h3> <ol data-v-24208a48><li data-v-24208a48>面临问题</li></ol> <p data-v-24208a48>众所周知，react更新来大部分情况自于props的改变(被动渲染)，和state改变(主动渲染)。当我们给未加任何更新限定条件子组件绑定事件的时候，或者是PureComponent 纯组件， 如果我们箭头函数使用的话。</p> <div class="language-jsx line-numbers-mode" data-v-24208a48><pre class="language-jsx" data-v-24208a48><code data-v-24208a48><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span><span class="token class-name" data-v-24208a48>ChildComponent</span></span> <span class="token attr-name" data-v-24208a48>handerClick</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token operator" data-v-24208a48>=&gt;</span><span class="token punctuation" data-v-24208a48>{</span> console<span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>log</span><span class="token punctuation" data-v-24208a48>(</span><span class="token number" data-v-24208a48>666</span><span class="token punctuation" data-v-24208a48>)</span> <span class="token punctuation" data-v-24208a48>}</span><span class="token punctuation" data-v-24208a48>}</span></span>  <span class="token punctuation" data-v-24208a48>/&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper" data-v-24208a48><span class="line-number" data-v-24208a48>1</span><br data-v-24208a48></div></div><p data-v-24208a48>每次渲染时都会创建一个新的事件处理器，这会导致 ChildComponent 每次都会被渲染。</p> <p data-v-24208a48>即便我们用箭头函数绑定给dom元素。</p> <div class="language-jsx line-numbers-mode" data-v-24208a48><pre class="language-jsx" data-v-24208a48><code data-v-24208a48><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>div</span> <span class="token attr-name" data-v-24208a48>onClick</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span> <span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token operator" data-v-24208a48>=&gt;</span><span class="token punctuation" data-v-24208a48>{</span> console<span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>log</span><span class="token punctuation" data-v-24208a48>(</span><span class="token number" data-v-24208a48>777</span><span class="token punctuation" data-v-24208a48>)</span> <span class="token punctuation" data-v-24208a48>}</span> <span class="token punctuation" data-v-24208a48>}</span></span> <span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>hello,world</span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span>

</code></pre> <div class="line-numbers-wrapper" data-v-24208a48><span class="line-number" data-v-24208a48>1</span><br data-v-24208a48><span class="line-number" data-v-24208a48>2</span><br data-v-24208a48></div></div><p data-v-24208a48>每次react合成事件事件的时候，也都会重新声明一个新事件。</p> <ol start="2" data-v-24208a48><li data-v-24208a48>解决问题</li></ol> <p data-v-24208a48>解决这个问题事件很简单，分为无状态组件和有状态组件。</p> <blockquote data-v-24208a48><p data-v-24208a48>有状态组件</p></blockquote> <div class="language-jsx line-numbers-mode" data-v-24208a48><pre class="language-jsx" data-v-24208a48><code data-v-24208a48><span class="token keyword" data-v-24208a48>class</span> <span class="token class-name" data-v-24208a48>index</span> <span class="token keyword" data-v-24208a48>extends</span> <span class="token class-name" data-v-24208a48>React<span class="token punctuation" data-v-24208a48>.</span>Component</span><span class="token punctuation" data-v-24208a48>{</span>
    <span class="token function-variable function" data-v-24208a48>handerClick</span><span class="token operator" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token operator" data-v-24208a48>=&gt;</span><span class="token punctuation" data-v-24208a48>{</span>
        console<span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>log</span><span class="token punctuation" data-v-24208a48>(</span><span class="token number" data-v-24208a48>666</span><span class="token punctuation" data-v-24208a48>)</span>
    <span class="token punctuation" data-v-24208a48>}</span>
    <span class="token function-variable function" data-v-24208a48>handerClick1</span><span class="token operator" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token operator" data-v-24208a48>=&gt;</span><span class="token punctuation" data-v-24208a48>{</span>
        console<span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>log</span><span class="token punctuation" data-v-24208a48>(</span><span class="token number" data-v-24208a48>777</span><span class="token punctuation" data-v-24208a48>)</span>
    <span class="token punctuation" data-v-24208a48>}</span>
    <span class="token function" data-v-24208a48>render</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>{</span>
        <span class="token keyword" data-v-24208a48>return</span> <span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
            </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span><span class="token class-name" data-v-24208a48>ChildComponent</span></span> <span class="token attr-name" data-v-24208a48>handerClick</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span> <span class="token keyword" data-v-24208a48>this</span><span class="token punctuation" data-v-24208a48>.</span>handerClick <span class="token punctuation" data-v-24208a48>}</span></span>  <span class="token punctuation" data-v-24208a48>/&gt;</span></span><span class="token plain-text" data-v-24208a48>
            </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>div</span> <span class="token attr-name" data-v-24208a48>onClick</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span> <span class="token keyword" data-v-24208a48>this</span><span class="token punctuation" data-v-24208a48>.</span>handerClick1 <span class="token punctuation" data-v-24208a48>}</span></span>  <span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>hello,world</span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
        </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span>
    <span class="token punctuation" data-v-24208a48>}</span>
<span class="token punctuation" data-v-24208a48>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-24208a48><span class="line-number" data-v-24208a48>1</span><br data-v-24208a48><span class="line-number" data-v-24208a48>2</span><br data-v-24208a48><span class="line-number" data-v-24208a48>3</span><br data-v-24208a48><span class="line-number" data-v-24208a48>4</span><br data-v-24208a48><span class="line-number" data-v-24208a48>5</span><br data-v-24208a48><span class="line-number" data-v-24208a48>6</span><br data-v-24208a48><span class="line-number" data-v-24208a48>7</span><br data-v-24208a48><span class="line-number" data-v-24208a48>8</span><br data-v-24208a48><span class="line-number" data-v-24208a48>9</span><br data-v-24208a48><span class="line-number" data-v-24208a48>10</span><br data-v-24208a48><span class="line-number" data-v-24208a48>11</span><br data-v-24208a48><span class="line-number" data-v-24208a48>12</span><br data-v-24208a48><span class="line-number" data-v-24208a48>13</span><br data-v-24208a48><span class="line-number" data-v-24208a48>14</span><br data-v-24208a48></div></div><blockquote data-v-24208a48><p data-v-24208a48>无状态组件</p></blockquote> <div class="language-jsx line-numbers-mode" data-v-24208a48><pre class="language-jsx" data-v-24208a48><code data-v-24208a48><span class="token keyword" data-v-24208a48>function</span> <span class="token function" data-v-24208a48>index</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>{</span>
   
    <span class="token keyword" data-v-24208a48>const</span> handerClick1 <span class="token operator" data-v-24208a48>=</span> <span class="token function" data-v-24208a48>useMemo</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token operator" data-v-24208a48>=&gt;</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token operator" data-v-24208a48>=&gt;</span><span class="token punctuation" data-v-24208a48>{</span>
       console<span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>log</span><span class="token punctuation" data-v-24208a48>(</span><span class="token number" data-v-24208a48>777</span><span class="token punctuation" data-v-24208a48>)</span>
    <span class="token punctuation" data-v-24208a48>}</span><span class="token punctuation" data-v-24208a48>,</span><span class="token punctuation" data-v-24208a48>[</span><span class="token punctuation" data-v-24208a48>]</span><span class="token punctuation" data-v-24208a48>)</span>  <span class="token comment" data-v-24208a48>/* [] 存在当前 handerClick1 的依赖项*/</span>
    <span class="token keyword" data-v-24208a48>const</span> handerClick <span class="token operator" data-v-24208a48>=</span> <span class="token function" data-v-24208a48>useCallback</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token operator" data-v-24208a48>=&gt;</span><span class="token punctuation" data-v-24208a48>{</span> console<span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>log</span><span class="token punctuation" data-v-24208a48>(</span><span class="token number" data-v-24208a48>666</span><span class="token punctuation" data-v-24208a48>)</span> <span class="token punctuation" data-v-24208a48>}</span><span class="token punctuation" data-v-24208a48>,</span><span class="token punctuation" data-v-24208a48>[</span><span class="token punctuation" data-v-24208a48>]</span><span class="token punctuation" data-v-24208a48>)</span>  <span class="token comment" data-v-24208a48>/* [] 存在当前 handerClick 的依赖项*/</span>
    <span class="token keyword" data-v-24208a48>return</span> <span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
        </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span><span class="token class-name" data-v-24208a48>ChildComponent</span></span> <span class="token attr-name" data-v-24208a48>handerClick</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span> handerClick <span class="token punctuation" data-v-24208a48>}</span></span>  <span class="token punctuation" data-v-24208a48>/&gt;</span></span><span class="token plain-text" data-v-24208a48>
        </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>div</span> <span class="token attr-name" data-v-24208a48>onClick</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span> handerClick1 <span class="token punctuation" data-v-24208a48>}</span></span>  <span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>hello,world</span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
    </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span>
<span class="token punctuation" data-v-24208a48>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-24208a48><span class="line-number" data-v-24208a48>1</span><br data-v-24208a48><span class="line-number" data-v-24208a48>2</span><br data-v-24208a48><span class="line-number" data-v-24208a48>3</span><br data-v-24208a48><span class="line-number" data-v-24208a48>4</span><br data-v-24208a48><span class="line-number" data-v-24208a48>5</span><br data-v-24208a48><span class="line-number" data-v-24208a48>6</span><br data-v-24208a48><span class="line-number" data-v-24208a48>7</span><br data-v-24208a48><span class="line-number" data-v-24208a48>8</span><br data-v-24208a48><span class="line-number" data-v-24208a48>9</span><br data-v-24208a48><span class="line-number" data-v-24208a48>10</span><br data-v-24208a48><span class="line-number" data-v-24208a48>11</span><br data-v-24208a48></div></div><p data-v-24208a48>对于dom，如果我们需要传递参数。我们可以这么写。</p> <div class="language-jsx line-numbers-mode" data-v-24208a48><pre class="language-jsx" data-v-24208a48><code data-v-24208a48><span class="token keyword" data-v-24208a48>function</span> <span class="token function" data-v-24208a48>index</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>{</span>
    <span class="token keyword" data-v-24208a48>const</span> handerClick1 <span class="token operator" data-v-24208a48>=</span> <span class="token function" data-v-24208a48>useMemo</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token operator" data-v-24208a48>=&gt;</span><span class="token punctuation" data-v-24208a48>(</span><span class="token parameter" data-v-24208a48>event</span><span class="token punctuation" data-v-24208a48>)</span><span class="token operator" data-v-24208a48>=&gt;</span><span class="token punctuation" data-v-24208a48>{</span>
        <span class="token keyword" data-v-24208a48>const</span> mes <span class="token operator" data-v-24208a48>=</span> event<span class="token punctuation" data-v-24208a48>.</span>currentTarget<span class="token punctuation" data-v-24208a48>.</span>dataset<span class="token punctuation" data-v-24208a48>.</span>mes
        console<span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>log</span><span class="token punctuation" data-v-24208a48>(</span>mes<span class="token punctuation" data-v-24208a48>)</span> <span class="token comment" data-v-24208a48>/* hello,world */</span>
    <span class="token punctuation" data-v-24208a48>}</span><span class="token punctuation" data-v-24208a48>,</span><span class="token punctuation" data-v-24208a48>[</span><span class="token punctuation" data-v-24208a48>]</span><span class="token punctuation" data-v-24208a48>)</span>
    <span class="token keyword" data-v-24208a48>return</span> <span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
        </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>div</span>  <span class="token attr-name" data-v-24208a48>data-mes</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span> <span class="token string" data-v-24208a48>'hello,world'</span> <span class="token punctuation" data-v-24208a48>}</span></span> <span class="token attr-name" data-v-24208a48>onClick</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span> handerClick1 <span class="token punctuation" data-v-24208a48>}</span></span>  <span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>hello,world</span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
    </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span>
<span class="token punctuation" data-v-24208a48>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-24208a48><span class="line-number" data-v-24208a48>1</span><br data-v-24208a48><span class="line-number" data-v-24208a48>2</span><br data-v-24208a48><span class="line-number" data-v-24208a48>3</span><br data-v-24208a48><span class="line-number" data-v-24208a48>4</span><br data-v-24208a48><span class="line-number" data-v-24208a48>5</span><br data-v-24208a48><span class="line-number" data-v-24208a48>6</span><br data-v-24208a48><span class="line-number" data-v-24208a48>7</span><br data-v-24208a48><span class="line-number" data-v-24208a48>8</span><br data-v-24208a48><span class="line-number" data-v-24208a48>9</span><br data-v-24208a48></div></div><h3 id="循环正确使用key" data-v-24208a48><a href="#循环正确使用key" class="header-anchor" data-v-24208a48>#</a> 循环正确使用key</h3> <p data-v-24208a48>无论是react 和 vue,正确使用key,目的就是在一次循环中，找到与新节点对应的老节点，复用节点，节省开销。想深入理解的同学可以看一下笔者的另外一篇文章 全面解析 vue3.0 diff算法 里面有对key详细说明。我们今天来看以下key正确用法,和错误用法。</p> <ol data-v-24208a48><li data-v-24208a48>错误用法</li></ol> <blockquote data-v-24208a48><p data-v-24208a48>错误用法一：用index做key</p></blockquote> <div class="language-jsx line-numbers-mode" data-v-24208a48><pre class="language-jsx" data-v-24208a48><code data-v-24208a48><span class="token keyword" data-v-24208a48>function</span> <span class="token function" data-v-24208a48>index</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>{</span>
    <span class="token keyword" data-v-24208a48>const</span> list <span class="token operator" data-v-24208a48>=</span> <span class="token punctuation" data-v-24208a48>[</span> <span class="token punctuation" data-v-24208a48>{</span> id<span class="token operator" data-v-24208a48>:</span><span class="token number" data-v-24208a48>1</span> <span class="token punctuation" data-v-24208a48>,</span> name<span class="token operator" data-v-24208a48>:</span><span class="token string" data-v-24208a48>'哈哈'</span> <span class="token punctuation" data-v-24208a48>}</span> <span class="token punctuation" data-v-24208a48>,</span> <span class="token punctuation" data-v-24208a48>{</span> id<span class="token operator" data-v-24208a48>:</span><span class="token number" data-v-24208a48>2</span><span class="token punctuation" data-v-24208a48>,</span> name<span class="token operator" data-v-24208a48>:</span><span class="token string" data-v-24208a48>'嘿嘿'</span> <span class="token punctuation" data-v-24208a48>}</span> <span class="token punctuation" data-v-24208a48>,</span><span class="token punctuation" data-v-24208a48>{</span> id<span class="token operator" data-v-24208a48>:</span><span class="token number" data-v-24208a48>3</span> <span class="token punctuation" data-v-24208a48>,</span> name<span class="token operator" data-v-24208a48>:</span><span class="token string" data-v-24208a48>'嘻嘻'</span> <span class="token punctuation" data-v-24208a48>}</span> <span class="token punctuation" data-v-24208a48>]</span>
    <span class="token keyword" data-v-24208a48>return</span> <span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
       </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>ul</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
         </span><span class="token punctuation" data-v-24208a48>{</span>  list<span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>map</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>(</span><span class="token parameter" data-v-24208a48>item<span class="token punctuation" data-v-24208a48>,</span>index</span><span class="token punctuation" data-v-24208a48>)</span><span class="token operator" data-v-24208a48>=&gt;</span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>li</span> <span class="token attr-name" data-v-24208a48>key</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span>index<span class="token punctuation" data-v-24208a48>}</span></span> <span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token punctuation" data-v-24208a48>{</span> item<span class="token punctuation" data-v-24208a48>.</span>name <span class="token punctuation" data-v-24208a48>}</span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>li</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token punctuation" data-v-24208a48>)</span>  <span class="token punctuation" data-v-24208a48>}</span><span class="token plain-text" data-v-24208a48>
       </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>ul</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
    </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span>
<span class="token punctuation" data-v-24208a48>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-24208a48><span class="line-number" data-v-24208a48>1</span><br data-v-24208a48><span class="line-number" data-v-24208a48>2</span><br data-v-24208a48><span class="line-number" data-v-24208a48>3</span><br data-v-24208a48><span class="line-number" data-v-24208a48>4</span><br data-v-24208a48><span class="line-number" data-v-24208a48>5</span><br data-v-24208a48><span class="line-number" data-v-24208a48>6</span><br data-v-24208a48><span class="line-number" data-v-24208a48>7</span><br data-v-24208a48><span class="line-number" data-v-24208a48>8</span><br data-v-24208a48></div></div><p data-v-24208a48>这种加key的性能,实际和不加key效果差不多，每次还是从头到尾diff。</p> <blockquote data-v-24208a48><p data-v-24208a48>错误用法二:用index拼接其他的字段</p></blockquote> <div class="language-jsx line-numbers-mode" data-v-24208a48><pre class="language-jsx" data-v-24208a48><code data-v-24208a48><span class="token keyword" data-v-24208a48>function</span> <span class="token function" data-v-24208a48>index</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>{</span>
    <span class="token keyword" data-v-24208a48>const</span> list <span class="token operator" data-v-24208a48>=</span> <span class="token punctuation" data-v-24208a48>[</span> <span class="token punctuation" data-v-24208a48>{</span> id<span class="token operator" data-v-24208a48>:</span><span class="token number" data-v-24208a48>1</span> <span class="token punctuation" data-v-24208a48>,</span> name<span class="token operator" data-v-24208a48>:</span><span class="token string" data-v-24208a48>'哈哈'</span> <span class="token punctuation" data-v-24208a48>}</span> <span class="token punctuation" data-v-24208a48>,</span> <span class="token punctuation" data-v-24208a48>{</span> id<span class="token operator" data-v-24208a48>:</span><span class="token number" data-v-24208a48>2</span><span class="token punctuation" data-v-24208a48>,</span> name<span class="token operator" data-v-24208a48>:</span><span class="token string" data-v-24208a48>'嘿嘿'</span> <span class="token punctuation" data-v-24208a48>}</span> <span class="token punctuation" data-v-24208a48>,</span><span class="token punctuation" data-v-24208a48>{</span> id<span class="token operator" data-v-24208a48>:</span><span class="token number" data-v-24208a48>3</span> <span class="token punctuation" data-v-24208a48>,</span> name<span class="token operator" data-v-24208a48>:</span><span class="token string" data-v-24208a48>'嘻嘻'</span> <span class="token punctuation" data-v-24208a48>}</span> <span class="token punctuation" data-v-24208a48>]</span>
    <span class="token keyword" data-v-24208a48>return</span> <span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
       </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>ul</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
         </span><span class="token punctuation" data-v-24208a48>{</span>  list<span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>map</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>(</span><span class="token parameter" data-v-24208a48>item<span class="token punctuation" data-v-24208a48>,</span>index</span><span class="token punctuation" data-v-24208a48>)</span><span class="token operator" data-v-24208a48>=&gt;</span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>li</span> <span class="token attr-name" data-v-24208a48>key</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span>index <span class="token operator" data-v-24208a48>+</span> item<span class="token punctuation" data-v-24208a48>.</span>name <span class="token punctuation" data-v-24208a48>}</span></span> <span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token punctuation" data-v-24208a48>{</span> item<span class="token punctuation" data-v-24208a48>.</span>name <span class="token punctuation" data-v-24208a48>}</span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>li</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token punctuation" data-v-24208a48>)</span>  <span class="token punctuation" data-v-24208a48>}</span><span class="token plain-text" data-v-24208a48>
       </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>ul</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
    </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span>
<span class="token punctuation" data-v-24208a48>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-24208a48><span class="line-number" data-v-24208a48>1</span><br data-v-24208a48><span class="line-number" data-v-24208a48>2</span><br data-v-24208a48><span class="line-number" data-v-24208a48>3</span><br data-v-24208a48><span class="line-number" data-v-24208a48>4</span><br data-v-24208a48><span class="line-number" data-v-24208a48>5</span><br data-v-24208a48><span class="line-number" data-v-24208a48>6</span><br data-v-24208a48><span class="line-number" data-v-24208a48>7</span><br data-v-24208a48><span class="line-number" data-v-24208a48>8</span><br data-v-24208a48></div></div><p data-v-24208a48>如果有元素移动或者删除，那么就失去了一一对应关系，剩下的节点都不能有效复用。</p> <p data-v-24208a48>2 正确用法
用唯一的健id作为key,能够做到有效复用元素节点。</p> <div class="language-jsx line-numbers-mode" data-v-24208a48><pre class="language-jsx" data-v-24208a48><code data-v-24208a48><span class="token keyword" data-v-24208a48>function</span> <span class="token function" data-v-24208a48>index</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>{</span>
    <span class="token keyword" data-v-24208a48>const</span> list <span class="token operator" data-v-24208a48>=</span> <span class="token punctuation" data-v-24208a48>[</span> <span class="token punctuation" data-v-24208a48>{</span> id<span class="token operator" data-v-24208a48>:</span><span class="token number" data-v-24208a48>1</span> <span class="token punctuation" data-v-24208a48>,</span> name<span class="token operator" data-v-24208a48>:</span><span class="token string" data-v-24208a48>'哈哈'</span> <span class="token punctuation" data-v-24208a48>}</span> <span class="token punctuation" data-v-24208a48>,</span> <span class="token punctuation" data-v-24208a48>{</span> id<span class="token operator" data-v-24208a48>:</span><span class="token number" data-v-24208a48>2</span><span class="token punctuation" data-v-24208a48>,</span> name<span class="token operator" data-v-24208a48>:</span><span class="token string" data-v-24208a48>'嘿嘿'</span> <span class="token punctuation" data-v-24208a48>}</span> <span class="token punctuation" data-v-24208a48>,</span><span class="token punctuation" data-v-24208a48>{</span> id<span class="token operator" data-v-24208a48>:</span><span class="token number" data-v-24208a48>3</span> <span class="token punctuation" data-v-24208a48>,</span> name<span class="token operator" data-v-24208a48>:</span><span class="token string" data-v-24208a48>'嘻嘻'</span> <span class="token punctuation" data-v-24208a48>}</span> <span class="token punctuation" data-v-24208a48>]</span>
    <span class="token keyword" data-v-24208a48>return</span> <span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
       </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>ul</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
         </span><span class="token punctuation" data-v-24208a48>{</span>  list<span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>map</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>(</span><span class="token parameter" data-v-24208a48>item<span class="token punctuation" data-v-24208a48>,</span>index</span><span class="token punctuation" data-v-24208a48>)</span><span class="token operator" data-v-24208a48>=&gt;</span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>li</span> <span class="token attr-name" data-v-24208a48>key</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span> item<span class="token punctuation" data-v-24208a48>.</span>id <span class="token punctuation" data-v-24208a48>}</span></span> <span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token punctuation" data-v-24208a48>{</span> item<span class="token punctuation" data-v-24208a48>.</span>name <span class="token punctuation" data-v-24208a48>}</span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>li</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token punctuation" data-v-24208a48>)</span>  <span class="token punctuation" data-v-24208a48>}</span><span class="token plain-text" data-v-24208a48>
       </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>ul</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
    </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span>
<span class="token punctuation" data-v-24208a48>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-24208a48><span class="line-number" data-v-24208a48>1</span><br data-v-24208a48><span class="line-number" data-v-24208a48>2</span><br data-v-24208a48><span class="line-number" data-v-24208a48>3</span><br data-v-24208a48><span class="line-number" data-v-24208a48>4</span><br data-v-24208a48><span class="line-number" data-v-24208a48>5</span><br data-v-24208a48><span class="line-number" data-v-24208a48>6</span><br data-v-24208a48><span class="line-number" data-v-24208a48>7</span><br data-v-24208a48><span class="line-number" data-v-24208a48>8</span><br data-v-24208a48></div></div><h3 id="usememo-避免重复声明" data-v-24208a48><a href="#usememo-避免重复声明" class="header-anchor" data-v-24208a48>#</a> useMemo 避免重复声明</h3> <p data-v-24208a48>对于无状态组件，数据更新就等于函数上下文的重复执行。那么函数里面的变量，方法就会重新声明。比如如下情况。</p> <div class="language-jsx line-numbers-mode" data-v-24208a48><pre class="language-jsx" data-v-24208a48><code data-v-24208a48><span class="token keyword" data-v-24208a48>function</span> <span class="token function" data-v-24208a48>Index</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>{</span>
    <span class="token keyword" data-v-24208a48>const</span> <span class="token punctuation" data-v-24208a48>[</span> number <span class="token punctuation" data-v-24208a48>,</span> setNumber  <span class="token punctuation" data-v-24208a48>]</span> <span class="token operator" data-v-24208a48>=</span> <span class="token function" data-v-24208a48>useState</span><span class="token punctuation" data-v-24208a48>(</span><span class="token number" data-v-24208a48>0</span><span class="token punctuation" data-v-24208a48>)</span>
    <span class="token keyword" data-v-24208a48>const</span> <span class="token function-variable function" data-v-24208a48>handerClick1</span> <span class="token operator" data-v-24208a48>=</span> <span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token operator" data-v-24208a48>=&gt;</span><span class="token punctuation" data-v-24208a48>{</span>
        <span class="token comment" data-v-24208a48>/* 一些操作 */</span>
    <span class="token punctuation" data-v-24208a48>}</span>
    <span class="token keyword" data-v-24208a48>const</span> <span class="token function-variable function" data-v-24208a48>handerClick2</span> <span class="token operator" data-v-24208a48>=</span> <span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token operator" data-v-24208a48>=&gt;</span><span class="token punctuation" data-v-24208a48>{</span>
        <span class="token comment" data-v-24208a48>/* 一些操作 */</span>
    <span class="token punctuation" data-v-24208a48>}</span>
    <span class="token keyword" data-v-24208a48>const</span> <span class="token function-variable function" data-v-24208a48>handerClick3</span> <span class="token operator" data-v-24208a48>=</span> <span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token operator" data-v-24208a48>=&gt;</span><span class="token punctuation" data-v-24208a48>{</span>
        <span class="token comment" data-v-24208a48>/* 一些操作 */</span>
    <span class="token punctuation" data-v-24208a48>}</span>
    <span class="token keyword" data-v-24208a48>return</span> <span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
        </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>a</span> <span class="token attr-name" data-v-24208a48>onClick</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span> handerClick1 <span class="token punctuation" data-v-24208a48>}</span></span> <span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>点我有惊喜1</span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>a</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
        </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>a</span> <span class="token attr-name" data-v-24208a48>onClick</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span> handerClick2 <span class="token punctuation" data-v-24208a48>}</span></span> <span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>点我有惊喜2</span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>a</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
        </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>a</span> <span class="token attr-name" data-v-24208a48>onClick</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span> handerClick3 <span class="token punctuation" data-v-24208a48>}</span></span> <span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>点我有惊喜3</span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>a</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
        </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>button</span> <span class="token attr-name" data-v-24208a48>onClick</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span> <span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token operator" data-v-24208a48>=&gt;</span> <span class="token function" data-v-24208a48>setNumber</span><span class="token punctuation" data-v-24208a48>(</span>number<span class="token operator" data-v-24208a48>+</span><span class="token number" data-v-24208a48>1</span><span class="token punctuation" data-v-24208a48>)</span> <span class="token punctuation" data-v-24208a48>}</span></span> <span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48> 点击 </span><span class="token punctuation" data-v-24208a48>{</span> number <span class="token punctuation" data-v-24208a48>}</span><span class="token plain-text" data-v-24208a48> </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>button</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
    </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span>
<span class="token punctuation" data-v-24208a48>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-24208a48><span class="line-number" data-v-24208a48>1</span><br data-v-24208a48><span class="line-number" data-v-24208a48>2</span><br data-v-24208a48><span class="line-number" data-v-24208a48>3</span><br data-v-24208a48><span class="line-number" data-v-24208a48>4</span><br data-v-24208a48><span class="line-number" data-v-24208a48>5</span><br data-v-24208a48><span class="line-number" data-v-24208a48>6</span><br data-v-24208a48><span class="line-number" data-v-24208a48>7</span><br data-v-24208a48><span class="line-number" data-v-24208a48>8</span><br data-v-24208a48><span class="line-number" data-v-24208a48>9</span><br data-v-24208a48><span class="line-number" data-v-24208a48>10</span><br data-v-24208a48><span class="line-number" data-v-24208a48>11</span><br data-v-24208a48><span class="line-number" data-v-24208a48>12</span><br data-v-24208a48><span class="line-number" data-v-24208a48>13</span><br data-v-24208a48><span class="line-number" data-v-24208a48>14</span><br data-v-24208a48><span class="line-number" data-v-24208a48>15</span><br data-v-24208a48><span class="line-number" data-v-24208a48>16</span><br data-v-24208a48><span class="line-number" data-v-24208a48>17</span><br data-v-24208a48><span class="line-number" data-v-24208a48>18</span><br data-v-24208a48></div></div><p data-v-24208a48>每次点击button的时候,都会执行Index函数。handerClick1 , handerClick2,handerClick3都会重新声明。为了避免这个情况的发生，我们可以用 useMemo 做缓存，我们可以改成如下。</p> <div class="language-jsx line-numbers-mode" data-v-24208a48><pre class="language-jsx" data-v-24208a48><code data-v-24208a48><span class="token keyword" data-v-24208a48>function</span> <span class="token function" data-v-24208a48>Index</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>{</span>
    <span class="token keyword" data-v-24208a48>const</span> <span class="token punctuation" data-v-24208a48>[</span> number <span class="token punctuation" data-v-24208a48>,</span> setNumber  <span class="token punctuation" data-v-24208a48>]</span> <span class="token operator" data-v-24208a48>=</span> <span class="token function" data-v-24208a48>useState</span><span class="token punctuation" data-v-24208a48>(</span><span class="token number" data-v-24208a48>0</span><span class="token punctuation" data-v-24208a48>)</span>
    <span class="token keyword" data-v-24208a48>const</span> <span class="token punctuation" data-v-24208a48>[</span> handerClick1 <span class="token punctuation" data-v-24208a48>,</span> handerClick2  <span class="token punctuation" data-v-24208a48>,</span>handerClick3<span class="token punctuation" data-v-24208a48>]</span> <span class="token operator" data-v-24208a48>=</span> <span class="token function" data-v-24208a48>useMemo</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token operator" data-v-24208a48>=&gt;</span><span class="token punctuation" data-v-24208a48>{</span>
        <span class="token keyword" data-v-24208a48>const</span> <span class="token function-variable function" data-v-24208a48>fn1</span> <span class="token operator" data-v-24208a48>=</span> <span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token operator" data-v-24208a48>=&gt;</span><span class="token punctuation" data-v-24208a48>{</span>
            <span class="token comment" data-v-24208a48>/* 一些操作 */</span>
        <span class="token punctuation" data-v-24208a48>}</span>
        <span class="token keyword" data-v-24208a48>const</span> <span class="token function-variable function" data-v-24208a48>fn2</span> <span class="token operator" data-v-24208a48>=</span> <span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token operator" data-v-24208a48>=&gt;</span><span class="token punctuation" data-v-24208a48>{</span>
            <span class="token comment" data-v-24208a48>/* 一些操作 */</span>
        <span class="token punctuation" data-v-24208a48>}</span>
        <span class="token keyword" data-v-24208a48>const</span>  <span class="token function-variable function" data-v-24208a48>fn3</span><span class="token operator" data-v-24208a48>=</span> <span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token operator" data-v-24208a48>=&gt;</span><span class="token punctuation" data-v-24208a48>{</span>
            <span class="token comment" data-v-24208a48>/* 一些操作 */</span>
        <span class="token punctuation" data-v-24208a48>}</span>
        <span class="token keyword" data-v-24208a48>return</span> <span class="token punctuation" data-v-24208a48>[</span>fn1 <span class="token punctuation" data-v-24208a48>,</span> fn2 <span class="token punctuation" data-v-24208a48>,</span>fn3<span class="token punctuation" data-v-24208a48>]</span>
    <span class="token punctuation" data-v-24208a48>}</span><span class="token punctuation" data-v-24208a48>,</span><span class="token punctuation" data-v-24208a48>[</span><span class="token punctuation" data-v-24208a48>]</span><span class="token punctuation" data-v-24208a48>)</span> <span class="token comment" data-v-24208a48>/* 只有当数据里面的依赖项，发生改变的时候，才会重新声明函数。 */</span>
    <span class="token keyword" data-v-24208a48>return</span> <span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
        </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>a</span> <span class="token attr-name" data-v-24208a48>onClick</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span> handerClick1 <span class="token punctuation" data-v-24208a48>}</span></span> <span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>点我有惊喜1</span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>a</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
        </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>a</span> <span class="token attr-name" data-v-24208a48>onClick</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span> handerClick2 <span class="token punctuation" data-v-24208a48>}</span></span> <span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>点我有惊喜2</span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>a</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
        </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>a</span> <span class="token attr-name" data-v-24208a48>onClick</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span> handerClick3 <span class="token punctuation" data-v-24208a48>}</span></span> <span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>点我有惊喜3</span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>a</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
        </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>button</span> <span class="token attr-name" data-v-24208a48>onClick</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span> <span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token operator" data-v-24208a48>=&gt;</span> <span class="token function" data-v-24208a48>setNumber</span><span class="token punctuation" data-v-24208a48>(</span>number<span class="token operator" data-v-24208a48>+</span><span class="token number" data-v-24208a48>1</span><span class="token punctuation" data-v-24208a48>)</span> <span class="token punctuation" data-v-24208a48>}</span></span> <span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48> 点击 </span><span class="token punctuation" data-v-24208a48>{</span> number <span class="token punctuation" data-v-24208a48>}</span><span class="token plain-text" data-v-24208a48> </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>button</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
    </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span>
<span class="token punctuation" data-v-24208a48>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-24208a48><span class="line-number" data-v-24208a48>1</span><br data-v-24208a48><span class="line-number" data-v-24208a48>2</span><br data-v-24208a48><span class="line-number" data-v-24208a48>3</span><br data-v-24208a48><span class="line-number" data-v-24208a48>4</span><br data-v-24208a48><span class="line-number" data-v-24208a48>5</span><br data-v-24208a48><span class="line-number" data-v-24208a48>6</span><br data-v-24208a48><span class="line-number" data-v-24208a48>7</span><br data-v-24208a48><span class="line-number" data-v-24208a48>8</span><br data-v-24208a48><span class="line-number" data-v-24208a48>9</span><br data-v-24208a48><span class="line-number" data-v-24208a48>10</span><br data-v-24208a48><span class="line-number" data-v-24208a48>11</span><br data-v-24208a48><span class="line-number" data-v-24208a48>12</span><br data-v-24208a48><span class="line-number" data-v-24208a48>13</span><br data-v-24208a48><span class="line-number" data-v-24208a48>14</span><br data-v-24208a48><span class="line-number" data-v-24208a48>15</span><br data-v-24208a48><span class="line-number" data-v-24208a48>16</span><br data-v-24208a48><span class="line-number" data-v-24208a48>17</span><br data-v-24208a48><span class="line-number" data-v-24208a48>18</span><br data-v-24208a48><span class="line-number" data-v-24208a48>19</span><br data-v-24208a48><span class="line-number" data-v-24208a48>20</span><br data-v-24208a48><span class="line-number" data-v-24208a48>21</span><br data-v-24208a48></div></div><p data-v-24208a48>如下改变之后，handerClick1 , handerClick2,handerClick3 会被缓存下来。</p> <h3 id="懒加载-suspense-和-lazy" data-v-24208a48><a href="#懒加载-suspense-和-lazy" class="header-anchor" data-v-24208a48>#</a> 懒加载 Suspense 和 lazy</h3> <p data-v-24208a48>Suspense 和 lazy 可以实现 dynamic import 懒加载效果，原理和上述的路由懒加载差不多。在 React 中的使用方法是在 Suspense 组件中使用 <code data-v-24208a48>&lt;LazyComponent&gt;</code> 组件。</p> <div class="language-jsx line-numbers-mode" data-v-24208a48><pre class="language-jsx" data-v-24208a48><code data-v-24208a48><span class="token keyword" data-v-24208a48>const</span> LazyComponent <span class="token operator" data-v-24208a48>=</span> React<span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>lazy</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span> <span class="token operator" data-v-24208a48>=&gt;</span> <span class="token keyword" data-v-24208a48>import</span><span class="token punctuation" data-v-24208a48>(</span><span class="token string" data-v-24208a48>'./LazyComponent'</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>;</span>

<span class="token keyword" data-v-24208a48>function</span> <span class="token function" data-v-24208a48>demo</span> <span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span> <span class="token punctuation" data-v-24208a48>{</span>
  <span class="token keyword" data-v-24208a48>return</span> <span class="token punctuation" data-v-24208a48>(</span>
    <span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
      </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span><span class="token class-name" data-v-24208a48>Suspense</span></span> <span class="token attr-name" data-v-24208a48>fallback</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>Loading...</span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token punctuation" data-v-24208a48>}</span></span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
        </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span><span class="token class-name" data-v-24208a48>LazyComponent</span></span> <span class="token punctuation" data-v-24208a48>/&gt;</span></span><span class="token plain-text" data-v-24208a48>
      </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span><span class="token class-name" data-v-24208a48>Suspense</span></span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
    </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span>
  <span class="token punctuation" data-v-24208a48>)</span>
<span class="token punctuation" data-v-24208a48>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-24208a48><span class="line-number" data-v-24208a48>1</span><br data-v-24208a48><span class="line-number" data-v-24208a48>2</span><br data-v-24208a48><span class="line-number" data-v-24208a48>3</span><br data-v-24208a48><span class="line-number" data-v-24208a48>4</span><br data-v-24208a48><span class="line-number" data-v-24208a48>5</span><br data-v-24208a48><span class="line-number" data-v-24208a48>6</span><br data-v-24208a48><span class="line-number" data-v-24208a48>7</span><br data-v-24208a48><span class="line-number" data-v-24208a48>8</span><br data-v-24208a48><span class="line-number" data-v-24208a48>9</span><br data-v-24208a48><span class="line-number" data-v-24208a48>10</span><br data-v-24208a48><span class="line-number" data-v-24208a48>11</span><br data-v-24208a48></div></div><p data-v-24208a48>LazyComponent 是通过懒加载加载进来的，所以渲染页面的时候可能会有延迟，但使用了 Suspense 之后，在加载状态下，可以用<code data-v-24208a48>&lt;div&gt;Loading...&lt;/div&gt;</code>作为loading效果。</p> <p data-v-24208a48>Suspense 可以包裹多个懒加载组件。</p> <div class="language-jsx line-numbers-mode" data-v-24208a48><pre class="language-jsx" data-v-24208a48><code data-v-24208a48><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span><span class="token class-name" data-v-24208a48>Suspense</span></span> <span class="token attr-name" data-v-24208a48>fallback</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>Loading...</span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token punctuation" data-v-24208a48>}</span></span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
    </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span><span class="token class-name" data-v-24208a48>LazyComponent</span></span> <span class="token punctuation" data-v-24208a48>/&gt;</span></span><span class="token plain-text" data-v-24208a48>
    </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span><span class="token class-name" data-v-24208a48>LazyComponent1</span></span> <span class="token punctuation" data-v-24208a48>/&gt;</span></span><span class="token plain-text" data-v-24208a48>
</span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span><span class="token class-name" data-v-24208a48>Suspense</span></span><span class="token punctuation" data-v-24208a48>&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper" data-v-24208a48><span class="line-number" data-v-24208a48>1</span><br data-v-24208a48><span class="line-number" data-v-24208a48>2</span><br data-v-24208a48><span class="line-number" data-v-24208a48>3</span><br data-v-24208a48><span class="line-number" data-v-24208a48>4</span><br data-v-24208a48></div></div><h2 id="多种方式避免重复渲染" data-v-24208a48><a href="#多种方式避免重复渲染" class="header-anchor" data-v-24208a48>#</a> 多种方式避免重复渲染</h2> <p data-v-24208a48>避免重复渲染,是react性能优化的重要方向。如果想尽心尽力处理好react项目每一个细节，那么就要从每一行代码开始，从每一组件开始。正所谓不积硅步无以至千里。</p> <h3 id="学会使用的批量更新" data-v-24208a48><a href="#学会使用的批量更新" class="header-anchor" data-v-24208a48>#</a> 学会使用的批量更新</h3> <ol data-v-24208a48><li data-v-24208a48>批量更新
这次讲的批量更新的概念，实际主要是针对无状态组件和hooks中useState,和 class有状态组件中的this.setState，两种方法已经做了批量更新的处理。比如如下例子</li></ol> <blockquote data-v-24208a48><p data-v-24208a48>一次更新中</p></blockquote> <div class="language-jsx line-numbers-mode" data-v-24208a48><pre class="language-jsx" data-v-24208a48><code data-v-24208a48><span class="token keyword" data-v-24208a48>class</span> <span class="token class-name" data-v-24208a48>index</span> <span class="token keyword" data-v-24208a48>extends</span> <span class="token class-name" data-v-24208a48>React<span class="token punctuation" data-v-24208a48>.</span>Component</span><span class="token punctuation" data-v-24208a48>{</span>
    <span class="token function" data-v-24208a48>constructor</span><span class="token punctuation" data-v-24208a48>(</span><span class="token parameter" data-v-24208a48>prop</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>{</span>
        <span class="token keyword" data-v-24208a48>super</span><span class="token punctuation" data-v-24208a48>(</span>prop<span class="token punctuation" data-v-24208a48>)</span>
        <span class="token keyword" data-v-24208a48>this</span><span class="token punctuation" data-v-24208a48>.</span>state <span class="token operator" data-v-24208a48>=</span> <span class="token punctuation" data-v-24208a48>{</span>
            a<span class="token operator" data-v-24208a48>:</span><span class="token number" data-v-24208a48>1</span><span class="token punctuation" data-v-24208a48>,</span>
            b<span class="token operator" data-v-24208a48>:</span><span class="token number" data-v-24208a48>2</span><span class="token punctuation" data-v-24208a48>,</span>
            c<span class="token operator" data-v-24208a48>:</span><span class="token number" data-v-24208a48>3</span><span class="token punctuation" data-v-24208a48>,</span>
        <span class="token punctuation" data-v-24208a48>}</span>
    <span class="token punctuation" data-v-24208a48>}</span>
    <span class="token function-variable function" data-v-24208a48>handerClick</span><span class="token operator" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token operator" data-v-24208a48>=&gt;</span><span class="token punctuation" data-v-24208a48>{</span>
        <span class="token keyword" data-v-24208a48>const</span> <span class="token punctuation" data-v-24208a48>{</span> a<span class="token punctuation" data-v-24208a48>,</span>b<span class="token punctuation" data-v-24208a48>,</span>c <span class="token punctuation" data-v-24208a48>}</span> <span class="token operator" data-v-24208a48>:</span>any <span class="token operator" data-v-24208a48>=</span> <span class="token keyword" data-v-24208a48>this</span><span class="token punctuation" data-v-24208a48>.</span>state
        <span class="token keyword" data-v-24208a48>this</span><span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>setState</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>{</span> a<span class="token operator" data-v-24208a48>:</span>a<span class="token operator" data-v-24208a48>+</span><span class="token number" data-v-24208a48>1</span> <span class="token punctuation" data-v-24208a48>}</span><span class="token punctuation" data-v-24208a48>)</span>
        <span class="token keyword" data-v-24208a48>this</span><span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>setState</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>{</span> b<span class="token operator" data-v-24208a48>:</span>b<span class="token operator" data-v-24208a48>+</span><span class="token number" data-v-24208a48>1</span> <span class="token punctuation" data-v-24208a48>}</span><span class="token punctuation" data-v-24208a48>)</span>
        <span class="token keyword" data-v-24208a48>this</span><span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>setState</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>{</span> c<span class="token operator" data-v-24208a48>:</span>c<span class="token operator" data-v-24208a48>+</span><span class="token number" data-v-24208a48>1</span> <span class="token punctuation" data-v-24208a48>}</span><span class="token punctuation" data-v-24208a48>)</span>
    <span class="token punctuation" data-v-24208a48>}</span>
    <span class="token function-variable function" data-v-24208a48>render</span><span class="token operator" data-v-24208a48>=</span> <span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span> <span class="token operator" data-v-24208a48>=&gt;</span> <span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>div</span> <span class="token attr-name" data-v-24208a48>onClick</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span><span class="token keyword" data-v-24208a48>this</span><span class="token punctuation" data-v-24208a48>.</span>handerClick<span class="token punctuation" data-v-24208a48>}</span></span> <span class="token punctuation" data-v-24208a48>/&gt;</span></span>
<span class="token punctuation" data-v-24208a48>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-24208a48><span class="line-number" data-v-24208a48>1</span><br data-v-24208a48><span class="line-number" data-v-24208a48>2</span><br data-v-24208a48><span class="line-number" data-v-24208a48>3</span><br data-v-24208a48><span class="line-number" data-v-24208a48>4</span><br data-v-24208a48><span class="line-number" data-v-24208a48>5</span><br data-v-24208a48><span class="line-number" data-v-24208a48>6</span><br data-v-24208a48><span class="line-number" data-v-24208a48>7</span><br data-v-24208a48><span class="line-number" data-v-24208a48>8</span><br data-v-24208a48><span class="line-number" data-v-24208a48>9</span><br data-v-24208a48><span class="line-number" data-v-24208a48>10</span><br data-v-24208a48><span class="line-number" data-v-24208a48>11</span><br data-v-24208a48><span class="line-number" data-v-24208a48>12</span><br data-v-24208a48><span class="line-number" data-v-24208a48>13</span><br data-v-24208a48><span class="line-number" data-v-24208a48>14</span><br data-v-24208a48><span class="line-number" data-v-24208a48>15</span><br data-v-24208a48><span class="line-number" data-v-24208a48>16</span><br data-v-24208a48><span class="line-number" data-v-24208a48>17</span><br data-v-24208a48></div></div><p data-v-24208a48>点击事件发生之后，会触发三次 setState,但是不会渲染三次，因为有一个批量更新batchUpdate批量更新的概念。三次setState最后被合成类似如下样子</p> <div class="language-jsx line-numbers-mode" data-v-24208a48><pre class="language-jsx" data-v-24208a48><code data-v-24208a48><span class="token keyword" data-v-24208a48>this</span><span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>setState</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>{</span>
    a<span class="token operator" data-v-24208a48>:</span>a<span class="token operator" data-v-24208a48>+</span><span class="token number" data-v-24208a48>1</span> <span class="token punctuation" data-v-24208a48>,</span>
    b<span class="token operator" data-v-24208a48>:</span>b<span class="token operator" data-v-24208a48>+</span><span class="token number" data-v-24208a48>1</span> <span class="token punctuation" data-v-24208a48>,</span>
    c<span class="token operator" data-v-24208a48>:</span>c<span class="token operator" data-v-24208a48>+</span><span class="token number" data-v-24208a48>1</span> 
<span class="token punctuation" data-v-24208a48>}</span><span class="token punctuation" data-v-24208a48>)</span>
</code></pre> <div class="line-numbers-wrapper" data-v-24208a48><span class="line-number" data-v-24208a48>1</span><br data-v-24208a48><span class="line-number" data-v-24208a48>2</span><br data-v-24208a48><span class="line-number" data-v-24208a48>3</span><br data-v-24208a48><span class="line-number" data-v-24208a48>4</span><br data-v-24208a48><span class="line-number" data-v-24208a48>5</span><br data-v-24208a48></div></div><p data-v-24208a48>无状态组件中也是</p> <div class="language-jsx line-numbers-mode" data-v-24208a48><pre class="language-jsx" data-v-24208a48><code data-v-24208a48>    <span class="token keyword" data-v-24208a48>const</span>  <span class="token punctuation" data-v-24208a48>[</span> a <span class="token punctuation" data-v-24208a48>,</span> setA <span class="token punctuation" data-v-24208a48>]</span> <span class="token operator" data-v-24208a48>=</span> <span class="token function" data-v-24208a48>useState</span><span class="token punctuation" data-v-24208a48>(</span><span class="token number" data-v-24208a48>1</span><span class="token punctuation" data-v-24208a48>)</span>
    <span class="token keyword" data-v-24208a48>const</span>  <span class="token punctuation" data-v-24208a48>[</span> b <span class="token punctuation" data-v-24208a48>,</span> setB <span class="token punctuation" data-v-24208a48>]</span> <span class="token operator" data-v-24208a48>=</span> <span class="token function" data-v-24208a48>useState</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>{</span><span class="token punctuation" data-v-24208a48>}</span><span class="token punctuation" data-v-24208a48>)</span>
    <span class="token keyword" data-v-24208a48>const</span>  <span class="token punctuation" data-v-24208a48>[</span> c <span class="token punctuation" data-v-24208a48>,</span> setC <span class="token punctuation" data-v-24208a48>]</span> <span class="token operator" data-v-24208a48>=</span> <span class="token function" data-v-24208a48>useState</span><span class="token punctuation" data-v-24208a48>(</span><span class="token number" data-v-24208a48>1</span><span class="token punctuation" data-v-24208a48>)</span>
    <span class="token keyword" data-v-24208a48>const</span> <span class="token function-variable function" data-v-24208a48>handerClick</span> <span class="token operator" data-v-24208a48>=</span> <span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span> <span class="token operator" data-v-24208a48>=&gt;</span> <span class="token punctuation" data-v-24208a48>{</span>
        <span class="token function" data-v-24208a48>setB</span><span class="token punctuation" data-v-24208a48>(</span> <span class="token punctuation" data-v-24208a48>{</span> <span class="token operator" data-v-24208a48>...</span>b <span class="token punctuation" data-v-24208a48>}</span> <span class="token punctuation" data-v-24208a48>)</span> 
        <span class="token function" data-v-24208a48>setC</span><span class="token punctuation" data-v-24208a48>(</span> c<span class="token operator" data-v-24208a48>+</span><span class="token number" data-v-24208a48>1</span> <span class="token punctuation" data-v-24208a48>)</span> 
        <span class="token function" data-v-24208a48>setA</span><span class="token punctuation" data-v-24208a48>(</span> a<span class="token operator" data-v-24208a48>+</span><span class="token number" data-v-24208a48>1</span> <span class="token punctuation" data-v-24208a48>)</span>
    <span class="token punctuation" data-v-24208a48>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-24208a48><span class="line-number" data-v-24208a48>1</span><br data-v-24208a48><span class="line-number" data-v-24208a48>2</span><br data-v-24208a48><span class="line-number" data-v-24208a48>3</span><br data-v-24208a48><span class="line-number" data-v-24208a48>4</span><br data-v-24208a48><span class="line-number" data-v-24208a48>5</span><br data-v-24208a48><span class="line-number" data-v-24208a48>6</span><br data-v-24208a48><span class="line-number" data-v-24208a48>7</span><br data-v-24208a48><span class="line-number" data-v-24208a48>8</span><br data-v-24208a48></div></div><p data-v-24208a48>批量更新失效常常发生在异步，比如：</p> <div class="language-jsx line-numbers-mode" data-v-24208a48><pre class="language-jsx" data-v-24208a48><code data-v-24208a48><span class="token function-variable function" data-v-24208a48>handerClick</span><span class="token operator" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token operator" data-v-24208a48>=&gt;</span><span class="token punctuation" data-v-24208a48>{</span>
    <span class="token function" data-v-24208a48>setTimeout</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span> <span class="token operator" data-v-24208a48>=&gt;</span> <span class="token punctuation" data-v-24208a48>{</span>
        <span class="token keyword" data-v-24208a48>this</span><span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>setState</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>{</span> a<span class="token operator" data-v-24208a48>:</span>a<span class="token operator" data-v-24208a48>+</span><span class="token number" data-v-24208a48>1</span> <span class="token punctuation" data-v-24208a48>}</span><span class="token punctuation" data-v-24208a48>)</span>
        <span class="token keyword" data-v-24208a48>this</span><span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>setState</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>{</span> b<span class="token operator" data-v-24208a48>:</span>b<span class="token operator" data-v-24208a48>+</span><span class="token number" data-v-24208a48>1</span> <span class="token punctuation" data-v-24208a48>}</span><span class="token punctuation" data-v-24208a48>)</span>
        <span class="token keyword" data-v-24208a48>this</span><span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>setState</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>{</span> c<span class="token operator" data-v-24208a48>:</span>c<span class="token operator" data-v-24208a48>+</span><span class="token number" data-v-24208a48>1</span> <span class="token punctuation" data-v-24208a48>}</span><span class="token punctuation" data-v-24208a48>)</span>
    <span class="token punctuation" data-v-24208a48>}</span><span class="token punctuation" data-v-24208a48>,</span> <span class="token number" data-v-24208a48>0</span><span class="token punctuation" data-v-24208a48>)</span>
<span class="token punctuation" data-v-24208a48>}</span>

<span class="token comment" data-v-24208a48>// 或</span>

 <span class="token keyword" data-v-24208a48>const</span> <span class="token function-variable function" data-v-24208a48>handerClick</span> <span class="token operator" data-v-24208a48>=</span> <span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span> <span class="token operator" data-v-24208a48>=&gt;</span> <span class="token punctuation" data-v-24208a48>{</span>
    Promise<span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>resolve</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>then</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token operator" data-v-24208a48>=&gt;</span><span class="token punctuation" data-v-24208a48>{</span>
    <span class="token function" data-v-24208a48>setB</span><span class="token punctuation" data-v-24208a48>(</span> <span class="token punctuation" data-v-24208a48>{</span> <span class="token operator" data-v-24208a48>...</span>b <span class="token punctuation" data-v-24208a48>}</span> <span class="token punctuation" data-v-24208a48>)</span> 
    <span class="token function" data-v-24208a48>setC</span><span class="token punctuation" data-v-24208a48>(</span> c<span class="token operator" data-v-24208a48>+</span><span class="token number" data-v-24208a48>1</span> <span class="token punctuation" data-v-24208a48>)</span> 
    <span class="token function" data-v-24208a48>setA</span><span class="token punctuation" data-v-24208a48>(</span> a<span class="token operator" data-v-24208a48>+</span><span class="token number" data-v-24208a48>1</span> <span class="token punctuation" data-v-24208a48>)</span>
    <span class="token punctuation" data-v-24208a48>}</span><span class="token punctuation" data-v-24208a48>)</span>
<span class="token punctuation" data-v-24208a48>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-24208a48><span class="line-number" data-v-24208a48>1</span><br data-v-24208a48><span class="line-number" data-v-24208a48>2</span><br data-v-24208a48><span class="line-number" data-v-24208a48>3</span><br data-v-24208a48><span class="line-number" data-v-24208a48>4</span><br data-v-24208a48><span class="line-number" data-v-24208a48>5</span><br data-v-24208a48><span class="line-number" data-v-24208a48>6</span><br data-v-24208a48><span class="line-number" data-v-24208a48>7</span><br data-v-24208a48><span class="line-number" data-v-24208a48>8</span><br data-v-24208a48><span class="line-number" data-v-24208a48>9</span><br data-v-24208a48><span class="line-number" data-v-24208a48>10</span><br data-v-24208a48><span class="line-number" data-v-24208a48>11</span><br data-v-24208a48><span class="line-number" data-v-24208a48>12</span><br data-v-24208a48><span class="line-number" data-v-24208a48>13</span><br data-v-24208a48><span class="line-number" data-v-24208a48>14</span><br data-v-24208a48><span class="line-number" data-v-24208a48>15</span><br data-v-24208a48><span class="line-number" data-v-24208a48>16</span><br data-v-24208a48><span class="line-number" data-v-24208a48>17</span><br data-v-24208a48></div></div><p data-v-24208a48>我们会发现，上述两种情况 ，组件都更新渲染了三次 ，此时的批量更新失效了。这种情况在react-hooks中也普遍存在，这种情况甚至在hooks中更加明显，因为我们都知道hooks中每个useState保存了一个状态，并不是让class声明组件中，可以通过this.state统一协调状态，再一次异步函数中，比如说一次ajax请求后，想通过多个useState改变状态，会造成多次渲染页面，为了解决这个问题，我们可以手动批量更新。</p> <p data-v-24208a48>react-dom 中提供了unstable_batchedUpdates方法进行手动批量更新。这个api更契合react-hooks，我们可以这样做。</p> <div class="language-jsx line-numbers-mode" data-v-24208a48><pre class="language-jsx" data-v-24208a48><code data-v-24208a48> <span class="token keyword" data-v-24208a48>const</span> <span class="token function-variable function" data-v-24208a48>handerClick</span> <span class="token operator" data-v-24208a48>=</span> <span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span> <span class="token operator" data-v-24208a48>=&gt;</span> <span class="token punctuation" data-v-24208a48>{</span>
    Promise<span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>resolve</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>then</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token operator" data-v-24208a48>=&gt;</span><span class="token punctuation" data-v-24208a48>{</span>
        <span class="token function" data-v-24208a48>unstable_batchedUpdates</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token operator" data-v-24208a48>=&gt;</span><span class="token punctuation" data-v-24208a48>{</span>
            <span class="token function" data-v-24208a48>setB</span><span class="token punctuation" data-v-24208a48>(</span> <span class="token punctuation" data-v-24208a48>{</span> <span class="token operator" data-v-24208a48>...</span>b <span class="token punctuation" data-v-24208a48>}</span> <span class="token punctuation" data-v-24208a48>)</span> 
            <span class="token function" data-v-24208a48>setC</span><span class="token punctuation" data-v-24208a48>(</span> c<span class="token operator" data-v-24208a48>+</span><span class="token number" data-v-24208a48>1</span> <span class="token punctuation" data-v-24208a48>)</span> 
            <span class="token function" data-v-24208a48>setA</span><span class="token punctuation" data-v-24208a48>(</span> a<span class="token operator" data-v-24208a48>+</span><span class="token number" data-v-24208a48>1</span> <span class="token punctuation" data-v-24208a48>)</span>
        <span class="token punctuation" data-v-24208a48>}</span><span class="token punctuation" data-v-24208a48>)</span>
    <span class="token punctuation" data-v-24208a48>}</span><span class="token punctuation" data-v-24208a48>)</span>
<span class="token punctuation" data-v-24208a48>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-24208a48><span class="line-number" data-v-24208a48>1</span><br data-v-24208a48><span class="line-number" data-v-24208a48>2</span><br data-v-24208a48><span class="line-number" data-v-24208a48>3</span><br data-v-24208a48><span class="line-number" data-v-24208a48>4</span><br data-v-24208a48><span class="line-number" data-v-24208a48>5</span><br data-v-24208a48><span class="line-number" data-v-24208a48>6</span><br data-v-24208a48><span class="line-number" data-v-24208a48>7</span><br data-v-24208a48><span class="line-number" data-v-24208a48>8</span><br data-v-24208a48><span class="line-number" data-v-24208a48>9</span><br data-v-24208a48></div></div><p data-v-24208a48>这样三次更新，就会合并成一次。同样达到了批量更新的效果。</p> <h3 id="合并state" data-v-24208a48><a href="#合并state" class="header-anchor" data-v-24208a48>#</a> 合并state</h3> <ol data-v-24208a48><li data-v-24208a48>class类组件(有状态组件)
合并state这种，是一种我们在react项目开发中要养成的习惯。我看过有些同学的代码中可能会这么写(如下demo是模拟的情况，实际要比这复杂的多)。</li></ol> <div class="language-jsx line-numbers-mode" data-v-24208a48><pre class="language-jsx" data-v-24208a48><code data-v-24208a48><span class="token keyword" data-v-24208a48>class</span> <span class="token class-name" data-v-24208a48>Index</span> <span class="token keyword" data-v-24208a48>extends</span> <span class="token class-name" data-v-24208a48>React<span class="token punctuation" data-v-24208a48>.</span>Component</span><span class="token operator" data-v-24208a48>&lt;</span>any <span class="token punctuation" data-v-24208a48>,</span> any<span class="token operator" data-v-24208a48>&gt;</span><span class="token punctuation" data-v-24208a48>{</span>
    state <span class="token operator" data-v-24208a48>=</span> <span class="token punctuation" data-v-24208a48>{</span>
          loading<span class="token operator" data-v-24208a48>:</span><span class="token boolean" data-v-24208a48>false</span> <span class="token comment" data-v-24208a48>/* 用来模拟loading效果 */</span><span class="token punctuation" data-v-24208a48>,</span>
          list<span class="token operator" data-v-24208a48>:</span><span class="token punctuation" data-v-24208a48>[</span><span class="token punctuation" data-v-24208a48>]</span><span class="token punctuation" data-v-24208a48>,</span>
    <span class="token punctuation" data-v-24208a48>}</span>
    <span class="token function" data-v-24208a48>componentDidMount</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>{</span>
        <span class="token comment" data-v-24208a48>/* 模拟一个异步请求数据场景 */</span>
        <span class="token keyword" data-v-24208a48>this</span><span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>setState</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>{</span> loading <span class="token operator" data-v-24208a48>:</span> <span class="token boolean" data-v-24208a48>true</span> <span class="token punctuation" data-v-24208a48>}</span><span class="token punctuation" data-v-24208a48>)</span> <span class="token comment" data-v-24208a48>/* 开启loading效果 */</span>
        Promise<span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>resolve</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>then</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token operator" data-v-24208a48>=&gt;</span><span class="token punctuation" data-v-24208a48>{</span>
            <span class="token keyword" data-v-24208a48>const</span> list <span class="token operator" data-v-24208a48>=</span> <span class="token punctuation" data-v-24208a48>[</span> <span class="token punctuation" data-v-24208a48>{</span> id<span class="token operator" data-v-24208a48>:</span><span class="token number" data-v-24208a48>1</span> <span class="token punctuation" data-v-24208a48>,</span> name<span class="token operator" data-v-24208a48>:</span> <span class="token string" data-v-24208a48>'xixi'</span> <span class="token punctuation" data-v-24208a48>}</span> <span class="token punctuation" data-v-24208a48>,</span><span class="token punctuation" data-v-24208a48>{</span> id<span class="token operator" data-v-24208a48>:</span><span class="token number" data-v-24208a48>2</span> <span class="token punctuation" data-v-24208a48>,</span> name<span class="token operator" data-v-24208a48>:</span> <span class="token string" data-v-24208a48>'haha'</span> <span class="token punctuation" data-v-24208a48>}</span><span class="token punctuation" data-v-24208a48>,</span><span class="token punctuation" data-v-24208a48>{</span> id<span class="token operator" data-v-24208a48>:</span><span class="token number" data-v-24208a48>3</span> <span class="token punctuation" data-v-24208a48>,</span> name<span class="token operator" data-v-24208a48>:</span> <span class="token string" data-v-24208a48>'heihei'</span> <span class="token punctuation" data-v-24208a48>}</span> <span class="token punctuation" data-v-24208a48>]</span>
            <span class="token keyword" data-v-24208a48>this</span><span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>setState</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>{</span> loading <span class="token operator" data-v-24208a48>:</span> <span class="token boolean" data-v-24208a48>false</span> <span class="token punctuation" data-v-24208a48>}</span><span class="token punctuation" data-v-24208a48>,</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token operator" data-v-24208a48>=&gt;</span><span class="token punctuation" data-v-24208a48>{</span>
                <span class="token keyword" data-v-24208a48>this</span><span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>setState</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>{</span>
                    list<span class="token operator" data-v-24208a48>:</span>list<span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>map</span><span class="token punctuation" data-v-24208a48>(</span><span class="token parameter" data-v-24208a48>item</span><span class="token operator" data-v-24208a48>=&gt;</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>{</span>
                        <span class="token operator" data-v-24208a48>...</span>item<span class="token punctuation" data-v-24208a48>,</span>
                        name<span class="token operator" data-v-24208a48>:</span>item<span class="token punctuation" data-v-24208a48>.</span>name<span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>toLocaleUpperCase</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span>
                    <span class="token punctuation" data-v-24208a48>}</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>)</span>
                <span class="token punctuation" data-v-24208a48>}</span><span class="token punctuation" data-v-24208a48>)</span>
            <span class="token punctuation" data-v-24208a48>}</span><span class="token punctuation" data-v-24208a48>)</span>
        <span class="token punctuation" data-v-24208a48>}</span><span class="token punctuation" data-v-24208a48>)</span>
    <span class="token punctuation" data-v-24208a48>}</span>
    <span class="token function" data-v-24208a48>render</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>{</span>
    <span class="token keyword" data-v-24208a48>const</span> <span class="token punctuation" data-v-24208a48>{</span> list <span class="token punctuation" data-v-24208a48>}</span> <span class="token operator" data-v-24208a48>=</span> <span class="token keyword" data-v-24208a48>this</span><span class="token punctuation" data-v-24208a48>.</span>state
    <span class="token keyword" data-v-24208a48>return</span> <span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token punctuation" data-v-24208a48>{</span>
            list<span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>map</span><span class="token punctuation" data-v-24208a48>(</span><span class="token parameter" data-v-24208a48>item</span><span class="token operator" data-v-24208a48>=&gt;</span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>div</span> <span class="token attr-name" data-v-24208a48>key</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span>item<span class="token punctuation" data-v-24208a48>.</span>id<span class="token punctuation" data-v-24208a48>}</span></span>  <span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token punctuation" data-v-24208a48>{</span> item<span class="token punctuation" data-v-24208a48>.</span>name <span class="token punctuation" data-v-24208a48>}</span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token punctuation" data-v-24208a48>)</span>
        <span class="token punctuation" data-v-24208a48>}</span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span>
    <span class="token punctuation" data-v-24208a48>}</span>
<span class="token punctuation" data-v-24208a48>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-24208a48><span class="line-number" data-v-24208a48>1</span><br data-v-24208a48><span class="line-number" data-v-24208a48>2</span><br data-v-24208a48><span class="line-number" data-v-24208a48>3</span><br data-v-24208a48><span class="line-number" data-v-24208a48>4</span><br data-v-24208a48><span class="line-number" data-v-24208a48>5</span><br data-v-24208a48><span class="line-number" data-v-24208a48>6</span><br data-v-24208a48><span class="line-number" data-v-24208a48>7</span><br data-v-24208a48><span class="line-number" data-v-24208a48>8</span><br data-v-24208a48><span class="line-number" data-v-24208a48>9</span><br data-v-24208a48><span class="line-number" data-v-24208a48>10</span><br data-v-24208a48><span class="line-number" data-v-24208a48>11</span><br data-v-24208a48><span class="line-number" data-v-24208a48>12</span><br data-v-24208a48><span class="line-number" data-v-24208a48>13</span><br data-v-24208a48><span class="line-number" data-v-24208a48>14</span><br data-v-24208a48><span class="line-number" data-v-24208a48>15</span><br data-v-24208a48><span class="line-number" data-v-24208a48>16</span><br data-v-24208a48><span class="line-number" data-v-24208a48>17</span><br data-v-24208a48><span class="line-number" data-v-24208a48>18</span><br data-v-24208a48><span class="line-number" data-v-24208a48>19</span><br data-v-24208a48><span class="line-number" data-v-24208a48>20</span><br data-v-24208a48><span class="line-number" data-v-24208a48>21</span><br data-v-24208a48><span class="line-number" data-v-24208a48>22</span><br data-v-24208a48><span class="line-number" data-v-24208a48>23</span><br data-v-24208a48><span class="line-number" data-v-24208a48>24</span><br data-v-24208a48><span class="line-number" data-v-24208a48>25</span><br data-v-24208a48><span class="line-number" data-v-24208a48>26</span><br data-v-24208a48><span class="line-number" data-v-24208a48>27</span><br data-v-24208a48></div></div><p data-v-24208a48>分别用两次this.state第一次解除loading状态，第二次格式化数据列表。这另两次更新完全没有必要，可以用一次setState更新完美解决。不这样做的原因是，对于像demo这样的简单结构还好，对于复杂的结构，一次更新可能都是宝贵的，所以我们应该学会去合并state。将上述demo这样修改。</p> <div class="language-jsx line-numbers-mode" data-v-24208a48><pre class="language-jsx" data-v-24208a48><code data-v-24208a48><span class="token keyword" data-v-24208a48>this</span><span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>setState</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>{</span>
    loading <span class="token operator" data-v-24208a48>:</span> <span class="token boolean" data-v-24208a48>false</span><span class="token punctuation" data-v-24208a48>,</span>
    list<span class="token operator" data-v-24208a48>:</span>list<span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>map</span><span class="token punctuation" data-v-24208a48>(</span><span class="token parameter" data-v-24208a48>item</span><span class="token operator" data-v-24208a48>=&gt;</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>{</span>
        <span class="token operator" data-v-24208a48>...</span>item<span class="token punctuation" data-v-24208a48>,</span>
        name<span class="token operator" data-v-24208a48>:</span>item<span class="token punctuation" data-v-24208a48>.</span>name<span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>toLocaleUpperCase</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span>
    <span class="token punctuation" data-v-24208a48>}</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>)</span>
<span class="token punctuation" data-v-24208a48>}</span><span class="token punctuation" data-v-24208a48>)</span>
</code></pre> <div class="line-numbers-wrapper" data-v-24208a48><span class="line-number" data-v-24208a48>1</span><br data-v-24208a48><span class="line-number" data-v-24208a48>2</span><br data-v-24208a48><span class="line-number" data-v-24208a48>3</span><br data-v-24208a48><span class="line-number" data-v-24208a48>4</span><br data-v-24208a48><span class="line-number" data-v-24208a48>5</span><br data-v-24208a48><span class="line-number" data-v-24208a48>6</span><br data-v-24208a48><span class="line-number" data-v-24208a48>7</span><br data-v-24208a48></div></div><ol start="2" data-v-24208a48><li data-v-24208a48>函数组件(无状态组件)
对于无状态组件，我们可以通过一个useState保存多个状态，没有必要每一个状态都用一个useState。</li></ol> <p data-v-24208a48>对于这样的情况。</p> <div class="language-jsx line-numbers-mode" data-v-24208a48><pre class="language-jsx" data-v-24208a48><code data-v-24208a48><span class="token keyword" data-v-24208a48>const</span> <span class="token punctuation" data-v-24208a48>[</span> a <span class="token punctuation" data-v-24208a48>,</span>setA <span class="token punctuation" data-v-24208a48>]</span> <span class="token operator" data-v-24208a48>=</span> <span class="token function" data-v-24208a48>useState</span><span class="token punctuation" data-v-24208a48>(</span><span class="token number" data-v-24208a48>1</span><span class="token punctuation" data-v-24208a48>)</span>
<span class="token keyword" data-v-24208a48>const</span> <span class="token punctuation" data-v-24208a48>[</span> b <span class="token punctuation" data-v-24208a48>,</span>setB <span class="token punctuation" data-v-24208a48>]</span> <span class="token operator" data-v-24208a48>=</span> <span class="token function" data-v-24208a48>useState</span><span class="token punctuation" data-v-24208a48>(</span><span class="token number" data-v-24208a48>2</span><span class="token punctuation" data-v-24208a48>)</span>
</code></pre> <div class="line-numbers-wrapper" data-v-24208a48><span class="line-number" data-v-24208a48>1</span><br data-v-24208a48><span class="line-number" data-v-24208a48>2</span><br data-v-24208a48></div></div><p data-v-24208a48>我们完全可以一个state搞定。</p> <div class="language-jsx line-numbers-mode" data-v-24208a48><pre class="language-jsx" data-v-24208a48><code data-v-24208a48><span class="token keyword" data-v-24208a48>const</span> <span class="token punctuation" data-v-24208a48>[</span> numberState <span class="token punctuation" data-v-24208a48>,</span> setNumberState <span class="token punctuation" data-v-24208a48>]</span> <span class="token operator" data-v-24208a48>=</span> <span class="token function" data-v-24208a48>useState</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>{</span> a<span class="token operator" data-v-24208a48>:</span><span class="token number" data-v-24208a48>1</span> <span class="token punctuation" data-v-24208a48>,</span> b <span class="token operator" data-v-24208a48>:</span><span class="token number" data-v-24208a48>2</span><span class="token punctuation" data-v-24208a48>}</span><span class="token punctuation" data-v-24208a48>)</span>
</code></pre> <div class="line-numbers-wrapper" data-v-24208a48><span class="line-number" data-v-24208a48>1</span><br data-v-24208a48></div></div><p data-v-24208a48>但是要注意，如果我们的state已经成为 useEffect , useCallback , useMemo依赖项，请慎用如上方法。</p> <h3 id="usememo-react-memo隔离单元" data-v-24208a48><a href="#usememo-react-memo隔离单元" class="header-anchor" data-v-24208a48>#</a> useMemo React.memo隔离单元</h3> <p data-v-24208a48>react正常的更新流，就像利剑一下，从父组件项子组件穿透，为了避免这些重复的更新渲染，shouldComponentUpdate , React.memo等api也应运而生。但是有的情况下，多余的更新在所难免，比如如下这种情况。这种更新会由父组件 -&gt; 子组件 传递下去。
</p><div style="width:400px;" data-v-24208a48><img src="/vuebloger/img/post/Snipaste_2021-10-05_14-34-56.jpg" alt="" data-v-24208a48></div><p data-v-24208a48></p> <div class="language-jsx line-numbers-mode" data-v-24208a48><pre class="language-jsx" data-v-24208a48><code data-v-24208a48><span class="token keyword" data-v-24208a48>function</span> <span class="token function" data-v-24208a48>ChildrenComponent</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>{</span>
    console<span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>log</span><span class="token punctuation" data-v-24208a48>(</span><span class="token number" data-v-24208a48>2222</span><span class="token punctuation" data-v-24208a48>)</span>
    <span class="token keyword" data-v-24208a48>return</span> <span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>hello,world</span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span>
<span class="token punctuation" data-v-24208a48>}</span>
<span class="token keyword" data-v-24208a48>function</span> <span class="token function" data-v-24208a48>Index</span> <span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>{</span>
    <span class="token keyword" data-v-24208a48>const</span> <span class="token punctuation" data-v-24208a48>[</span> list  <span class="token punctuation" data-v-24208a48>]</span> <span class="token operator" data-v-24208a48>=</span> <span class="token function" data-v-24208a48>useState</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>[</span> <span class="token punctuation" data-v-24208a48>{</span> id<span class="token operator" data-v-24208a48>:</span><span class="token number" data-v-24208a48>1</span> <span class="token punctuation" data-v-24208a48>,</span> name<span class="token operator" data-v-24208a48>:</span> <span class="token string" data-v-24208a48>'xixi'</span> <span class="token punctuation" data-v-24208a48>}</span> <span class="token punctuation" data-v-24208a48>,</span><span class="token punctuation" data-v-24208a48>{</span> id<span class="token operator" data-v-24208a48>:</span><span class="token number" data-v-24208a48>2</span> <span class="token punctuation" data-v-24208a48>,</span> name<span class="token operator" data-v-24208a48>:</span> <span class="token string" data-v-24208a48>'haha'</span> <span class="token punctuation" data-v-24208a48>}</span><span class="token punctuation" data-v-24208a48>,</span><span class="token punctuation" data-v-24208a48>{</span> id<span class="token operator" data-v-24208a48>:</span><span class="token number" data-v-24208a48>3</span> <span class="token punctuation" data-v-24208a48>,</span> name<span class="token operator" data-v-24208a48>:</span> <span class="token string" data-v-24208a48>'heihei'</span> <span class="token punctuation" data-v-24208a48>}</span> <span class="token punctuation" data-v-24208a48>]</span><span class="token punctuation" data-v-24208a48>)</span>
    <span class="token keyword" data-v-24208a48>const</span> <span class="token punctuation" data-v-24208a48>[</span> number <span class="token punctuation" data-v-24208a48>,</span> setNumber <span class="token punctuation" data-v-24208a48>]</span> <span class="token operator" data-v-24208a48>=</span> <span class="token function" data-v-24208a48>useState</span><span class="token punctuation" data-v-24208a48>(</span><span class="token number" data-v-24208a48>0</span><span class="token punctuation" data-v-24208a48>)</span>
    <span class="token keyword" data-v-24208a48>return</span> <span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
       </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>span</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token punctuation" data-v-24208a48>{</span> number <span class="token punctuation" data-v-24208a48>}</span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>span</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
       </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>button</span> <span class="token attr-name" data-v-24208a48>onClick</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span> <span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token operator" data-v-24208a48>=&gt;</span> <span class="token function" data-v-24208a48>setNumber</span><span class="token punctuation" data-v-24208a48>(</span>number <span class="token operator" data-v-24208a48>+</span> <span class="token number" data-v-24208a48>1</span><span class="token punctuation" data-v-24208a48>)</span> <span class="token punctuation" data-v-24208a48>}</span></span> <span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>点击</span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>button</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
           </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>ul</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
               </span><span class="token punctuation" data-v-24208a48>{</span>
                list<span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>map</span><span class="token punctuation" data-v-24208a48>(</span><span class="token parameter" data-v-24208a48>item</span><span class="token operator" data-v-24208a48>=&gt;</span><span class="token punctuation" data-v-24208a48>{</span>
                    console<span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>log</span><span class="token punctuation" data-v-24208a48>(</span><span class="token number" data-v-24208a48>1111</span><span class="token punctuation" data-v-24208a48>)</span>
                    <span class="token keyword" data-v-24208a48>return</span> <span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>li</span> <span class="token attr-name" data-v-24208a48>key</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span> item<span class="token punctuation" data-v-24208a48>.</span>id <span class="token punctuation" data-v-24208a48>}</span></span>  <span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token punctuation" data-v-24208a48>{</span> item<span class="token punctuation" data-v-24208a48>.</span>name <span class="token punctuation" data-v-24208a48>}</span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>li</span><span class="token punctuation" data-v-24208a48>&gt;</span></span>
                <span class="token punctuation" data-v-24208a48>}</span><span class="token punctuation" data-v-24208a48>)</span>
               <span class="token punctuation" data-v-24208a48>}</span><span class="token plain-text" data-v-24208a48>
           </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>ul</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
           </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span><span class="token class-name" data-v-24208a48>ChildrenComponent</span></span> <span class="token punctuation" data-v-24208a48>/&gt;</span></span><span class="token plain-text" data-v-24208a48>
    </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span>
<span class="token punctuation" data-v-24208a48>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-24208a48><span class="line-number" data-v-24208a48>1</span><br data-v-24208a48><span class="line-number" data-v-24208a48>2</span><br data-v-24208a48><span class="line-number" data-v-24208a48>3</span><br data-v-24208a48><span class="line-number" data-v-24208a48>4</span><br data-v-24208a48><span class="line-number" data-v-24208a48>5</span><br data-v-24208a48><span class="line-number" data-v-24208a48>6</span><br data-v-24208a48><span class="line-number" data-v-24208a48>7</span><br data-v-24208a48><span class="line-number" data-v-24208a48>8</span><br data-v-24208a48><span class="line-number" data-v-24208a48>9</span><br data-v-24208a48><span class="line-number" data-v-24208a48>10</span><br data-v-24208a48><span class="line-number" data-v-24208a48>11</span><br data-v-24208a48><span class="line-number" data-v-24208a48>12</span><br data-v-24208a48><span class="line-number" data-v-24208a48>13</span><br data-v-24208a48><span class="line-number" data-v-24208a48>14</span><br data-v-24208a48><span class="line-number" data-v-24208a48>15</span><br data-v-24208a48><span class="line-number" data-v-24208a48>16</span><br data-v-24208a48><span class="line-number" data-v-24208a48>17</span><br data-v-24208a48><span class="line-number" data-v-24208a48>18</span><br data-v-24208a48><span class="line-number" data-v-24208a48>19</span><br data-v-24208a48><span class="line-number" data-v-24208a48>20</span><br data-v-24208a48><span class="line-number" data-v-24208a48>21</span><br data-v-24208a48></div></div><p data-v-24208a48>效果：</p> <p data-v-24208a48><img src="/vuebloger/img/post/34wdsdfs.gif" alt="" data-v-24208a48></p> <p data-v-24208a48>针对这一现象，我们可以通过使用useMemo进行隔离，形成独立的渲染单元，每次更新上一个状态会被缓存，循环不会再执行，子组件也不会再次被渲染,我们可以这么做。</p> <ol data-v-24208a48><li data-v-24208a48>无状态组件</li></ol> <div class="language-jsx line-numbers-mode" data-v-24208a48><pre class="language-jsx" data-v-24208a48><code data-v-24208a48><span class="token keyword" data-v-24208a48>function</span> <span class="token function" data-v-24208a48>Index</span> <span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>{</span>
    <span class="token keyword" data-v-24208a48>const</span> <span class="token punctuation" data-v-24208a48>[</span> list  <span class="token punctuation" data-v-24208a48>]</span> <span class="token operator" data-v-24208a48>=</span> <span class="token function" data-v-24208a48>useState</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>[</span> <span class="token punctuation" data-v-24208a48>{</span> id<span class="token operator" data-v-24208a48>:</span><span class="token number" data-v-24208a48>1</span> <span class="token punctuation" data-v-24208a48>,</span> name<span class="token operator" data-v-24208a48>:</span> <span class="token string" data-v-24208a48>'xixi'</span> <span class="token punctuation" data-v-24208a48>}</span> <span class="token punctuation" data-v-24208a48>,</span><span class="token punctuation" data-v-24208a48>{</span> id<span class="token operator" data-v-24208a48>:</span><span class="token number" data-v-24208a48>2</span> <span class="token punctuation" data-v-24208a48>,</span> name<span class="token operator" data-v-24208a48>:</span> <span class="token string" data-v-24208a48>'haha'</span> <span class="token punctuation" data-v-24208a48>}</span><span class="token punctuation" data-v-24208a48>,</span><span class="token punctuation" data-v-24208a48>{</span> id<span class="token operator" data-v-24208a48>:</span><span class="token number" data-v-24208a48>3</span> <span class="token punctuation" data-v-24208a48>,</span> name<span class="token operator" data-v-24208a48>:</span> <span class="token string" data-v-24208a48>'heihei'</span> <span class="token punctuation" data-v-24208a48>}</span> <span class="token punctuation" data-v-24208a48>]</span><span class="token punctuation" data-v-24208a48>)</span>
    <span class="token keyword" data-v-24208a48>const</span> <span class="token punctuation" data-v-24208a48>[</span> number <span class="token punctuation" data-v-24208a48>,</span> setNumber <span class="token punctuation" data-v-24208a48>]</span> <span class="token operator" data-v-24208a48>=</span> <span class="token function" data-v-24208a48>useState</span><span class="token punctuation" data-v-24208a48>(</span><span class="token number" data-v-24208a48>0</span><span class="token punctuation" data-v-24208a48>)</span>
    <span class="token keyword" data-v-24208a48>return</span> <span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
       </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>span</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token punctuation" data-v-24208a48>{</span> number <span class="token punctuation" data-v-24208a48>}</span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>span</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
       </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>button</span> <span class="token attr-name" data-v-24208a48>onClick</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span> <span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token operator" data-v-24208a48>=&gt;</span> <span class="token function" data-v-24208a48>setNumber</span><span class="token punctuation" data-v-24208a48>(</span>number <span class="token operator" data-v-24208a48>+</span> <span class="token number" data-v-24208a48>1</span><span class="token punctuation" data-v-24208a48>)</span> <span class="token punctuation" data-v-24208a48>}</span></span> <span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>点击</span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>button</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
           </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>ul</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
               </span><span class="token punctuation" data-v-24208a48>{</span>
                <span class="token function" data-v-24208a48>useMemo</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token operator" data-v-24208a48>=&gt;</span><span class="token punctuation" data-v-24208a48>(</span>list<span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>map</span><span class="token punctuation" data-v-24208a48>(</span><span class="token parameter" data-v-24208a48>item</span><span class="token operator" data-v-24208a48>=&gt;</span><span class="token punctuation" data-v-24208a48>{</span>
                    console<span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>log</span><span class="token punctuation" data-v-24208a48>(</span><span class="token number" data-v-24208a48>1111</span><span class="token punctuation" data-v-24208a48>)</span>
                    <span class="token keyword" data-v-24208a48>return</span> <span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>li</span> <span class="token attr-name" data-v-24208a48>key</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span> item<span class="token punctuation" data-v-24208a48>.</span>id <span class="token punctuation" data-v-24208a48>}</span></span>  <span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token punctuation" data-v-24208a48>{</span> item<span class="token punctuation" data-v-24208a48>.</span>name <span class="token punctuation" data-v-24208a48>}</span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>li</span><span class="token punctuation" data-v-24208a48>&gt;</span></span>
                <span class="token punctuation" data-v-24208a48>}</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>,</span><span class="token punctuation" data-v-24208a48>[</span> list <span class="token punctuation" data-v-24208a48>]</span><span class="token punctuation" data-v-24208a48>)</span>
               <span class="token punctuation" data-v-24208a48>}</span><span class="token plain-text" data-v-24208a48>
           </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>ul</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
        </span><span class="token punctuation" data-v-24208a48>{</span> <span class="token function" data-v-24208a48>useMemo</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token operator" data-v-24208a48>=&gt;</span> <span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span><span class="token class-name" data-v-24208a48>ChildrenComponent</span></span> <span class="token punctuation" data-v-24208a48>/&gt;</span></span><span class="token punctuation" data-v-24208a48>,</span><span class="token punctuation" data-v-24208a48>[</span><span class="token punctuation" data-v-24208a48>]</span><span class="token punctuation" data-v-24208a48>)</span> <span class="token punctuation" data-v-24208a48>}</span><span class="token plain-text" data-v-24208a48>
    </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span>
<span class="token punctuation" data-v-24208a48>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-24208a48><span class="line-number" data-v-24208a48>1</span><br data-v-24208a48><span class="line-number" data-v-24208a48>2</span><br data-v-24208a48><span class="line-number" data-v-24208a48>3</span><br data-v-24208a48><span class="line-number" data-v-24208a48>4</span><br data-v-24208a48><span class="line-number" data-v-24208a48>5</span><br data-v-24208a48><span class="line-number" data-v-24208a48>6</span><br data-v-24208a48><span class="line-number" data-v-24208a48>7</span><br data-v-24208a48><span class="line-number" data-v-24208a48>8</span><br data-v-24208a48><span class="line-number" data-v-24208a48>9</span><br data-v-24208a48><span class="line-number" data-v-24208a48>10</span><br data-v-24208a48><span class="line-number" data-v-24208a48>11</span><br data-v-24208a48><span class="line-number" data-v-24208a48>12</span><br data-v-24208a48><span class="line-number" data-v-24208a48>13</span><br data-v-24208a48><span class="line-number" data-v-24208a48>14</span><br data-v-24208a48><span class="line-number" data-v-24208a48>15</span><br data-v-24208a48><span class="line-number" data-v-24208a48>16</span><br data-v-24208a48><span class="line-number" data-v-24208a48>17</span><br data-v-24208a48></div></div><ol start="2" data-v-24208a48><li data-v-24208a48>有状态组件：
在class声明的组件中，没有像 useMemo 的API ，但是也并不等于束手无策，我们可以通过 react.memo 来阻拦来自组件本身的更新。我们可以写一个组件，来控制react 组件更新的方向。我们通过一个 <code data-v-24208a48>&lt;NotUpdate&gt;</code> 组件来阻断更新流。</li></ol> <div class="language-jsx line-numbers-mode" data-v-24208a48><pre class="language-jsx" data-v-24208a48><code data-v-24208a48><span class="token comment" data-v-24208a48>/* 控制更新 ,第二个参数可以作为组件更新的依赖 ， 这里设置为 ()=&gt; true 只渲染一次 */</span>
<span class="token keyword" data-v-24208a48>const</span> NotUpdate <span class="token operator" data-v-24208a48>=</span> React<span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>memo</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>(</span><span class="token parameter" data-v-24208a48><span class="token punctuation" data-v-24208a48>{</span> children <span class="token punctuation" data-v-24208a48>}</span><span class="token operator" data-v-24208a48>:</span>any</span><span class="token punctuation" data-v-24208a48>)</span><span class="token operator" data-v-24208a48>=&gt;</span> <span class="token keyword" data-v-24208a48>typeof</span> children <span class="token operator" data-v-24208a48>===</span> <span class="token string" data-v-24208a48>'function'</span> <span class="token operator" data-v-24208a48>?</span> <span class="token function" data-v-24208a48>children</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span> <span class="token operator" data-v-24208a48>:</span> children <span class="token punctuation" data-v-24208a48>,</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token operator" data-v-24208a48>=&gt;</span><span class="token boolean" data-v-24208a48>true</span><span class="token punctuation" data-v-24208a48>)</span>

<span class="token keyword" data-v-24208a48>class</span> <span class="token class-name" data-v-24208a48>Index</span> <span class="token keyword" data-v-24208a48>extends</span> <span class="token class-name" data-v-24208a48>React<span class="token punctuation" data-v-24208a48>.</span>Component</span><span class="token operator" data-v-24208a48>&lt;</span>any<span class="token punctuation" data-v-24208a48>,</span>any<span class="token operator" data-v-24208a48>&gt;</span><span class="token punctuation" data-v-24208a48>{</span>
    <span class="token function" data-v-24208a48>constructor</span><span class="token punctuation" data-v-24208a48>(</span><span class="token parameter" data-v-24208a48>prop</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>{</span>
        <span class="token keyword" data-v-24208a48>super</span><span class="token punctuation" data-v-24208a48>(</span>prop<span class="token punctuation" data-v-24208a48>)</span>
        <span class="token keyword" data-v-24208a48>this</span><span class="token punctuation" data-v-24208a48>.</span>state <span class="token operator" data-v-24208a48>=</span> <span class="token punctuation" data-v-24208a48>{</span> 
            list<span class="token operator" data-v-24208a48>:</span> <span class="token punctuation" data-v-24208a48>[</span> <span class="token punctuation" data-v-24208a48>{</span> id<span class="token operator" data-v-24208a48>:</span><span class="token number" data-v-24208a48>1</span> <span class="token punctuation" data-v-24208a48>,</span> name<span class="token operator" data-v-24208a48>:</span> <span class="token string" data-v-24208a48>'xixi'</span> <span class="token punctuation" data-v-24208a48>}</span> <span class="token punctuation" data-v-24208a48>,</span><span class="token punctuation" data-v-24208a48>{</span> id<span class="token operator" data-v-24208a48>:</span><span class="token number" data-v-24208a48>2</span> <span class="token punctuation" data-v-24208a48>,</span> name<span class="token operator" data-v-24208a48>:</span> <span class="token string" data-v-24208a48>'haha'</span> <span class="token punctuation" data-v-24208a48>}</span><span class="token punctuation" data-v-24208a48>,</span><span class="token punctuation" data-v-24208a48>{</span> id<span class="token operator" data-v-24208a48>:</span><span class="token number" data-v-24208a48>3</span> <span class="token punctuation" data-v-24208a48>,</span> name<span class="token operator" data-v-24208a48>:</span> <span class="token string" data-v-24208a48>'heihei'</span> <span class="token punctuation" data-v-24208a48>}</span> <span class="token punctuation" data-v-24208a48>]</span><span class="token punctuation" data-v-24208a48>,</span>
            number<span class="token operator" data-v-24208a48>:</span><span class="token number" data-v-24208a48>0</span><span class="token punctuation" data-v-24208a48>,</span>
         <span class="token punctuation" data-v-24208a48>}</span>
    <span class="token punctuation" data-v-24208a48>}</span>
    <span class="token function-variable function" data-v-24208a48>handerClick</span> <span class="token operator" data-v-24208a48>=</span> <span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token operator" data-v-24208a48>=&gt;</span><span class="token punctuation" data-v-24208a48>{</span>
        <span class="token keyword" data-v-24208a48>this</span><span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>setState</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>{</span> number<span class="token operator" data-v-24208a48>:</span><span class="token keyword" data-v-24208a48>this</span><span class="token punctuation" data-v-24208a48>.</span>state<span class="token punctuation" data-v-24208a48>.</span>number <span class="token operator" data-v-24208a48>+</span> <span class="token number" data-v-24208a48>1</span> <span class="token punctuation" data-v-24208a48>}</span><span class="token punctuation" data-v-24208a48>)</span>
    <span class="token punctuation" data-v-24208a48>}</span>
    <span class="token function" data-v-24208a48>render</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>{</span>
       <span class="token keyword" data-v-24208a48>const</span> <span class="token punctuation" data-v-24208a48>{</span> list <span class="token punctuation" data-v-24208a48>}</span><span class="token operator" data-v-24208a48>:</span>any <span class="token operator" data-v-24208a48>=</span> <span class="token keyword" data-v-24208a48>this</span><span class="token punctuation" data-v-24208a48>.</span>state
       <span class="token keyword" data-v-24208a48>return</span> <span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
           </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>button</span> <span class="token attr-name" data-v-24208a48>onClick</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span> <span class="token keyword" data-v-24208a48>this</span><span class="token punctuation" data-v-24208a48>.</span>handerClick <span class="token punctuation" data-v-24208a48>}</span></span> <span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>点击</span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>button</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
           </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span><span class="token class-name" data-v-24208a48>NotUpdate</span></span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
              </span><span class="token punctuation" data-v-24208a48>{</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token operator" data-v-24208a48>=&gt;</span><span class="token punctuation" data-v-24208a48>(</span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>ul</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
                    </span><span class="token punctuation" data-v-24208a48>{</span>
                    list<span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>map</span><span class="token punctuation" data-v-24208a48>(</span><span class="token parameter" data-v-24208a48>item</span><span class="token operator" data-v-24208a48>=&gt;</span><span class="token punctuation" data-v-24208a48>{</span>
                        console<span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>log</span><span class="token punctuation" data-v-24208a48>(</span><span class="token number" data-v-24208a48>1111</span><span class="token punctuation" data-v-24208a48>)</span>
                        <span class="token keyword" data-v-24208a48>return</span> <span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>li</span> <span class="token attr-name" data-v-24208a48>key</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span> item<span class="token punctuation" data-v-24208a48>.</span>id <span class="token punctuation" data-v-24208a48>}</span></span>  <span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token punctuation" data-v-24208a48>{</span> item<span class="token punctuation" data-v-24208a48>.</span>name <span class="token punctuation" data-v-24208a48>}</span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>li</span><span class="token punctuation" data-v-24208a48>&gt;</span></span>
                    <span class="token punctuation" data-v-24208a48>}</span><span class="token punctuation" data-v-24208a48>)</span>
                    <span class="token punctuation" data-v-24208a48>}</span><span class="token plain-text" data-v-24208a48>
                </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>ul</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>}</span><span class="token plain-text" data-v-24208a48>
           </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span><span class="token class-name" data-v-24208a48>NotUpdate</span></span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
           </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span><span class="token class-name" data-v-24208a48>NotUpdate</span></span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
                </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span><span class="token class-name" data-v-24208a48>ChildrenComponent</span></span> <span class="token punctuation" data-v-24208a48>/&gt;</span></span><span class="token plain-text" data-v-24208a48>
           </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span><span class="token class-name" data-v-24208a48>NotUpdate</span></span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
          
       </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span>
    <span class="token punctuation" data-v-24208a48>}</span>
<span class="token punctuation" data-v-24208a48>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-24208a48><span class="line-number" data-v-24208a48>1</span><br data-v-24208a48><span class="line-number" data-v-24208a48>2</span><br data-v-24208a48><span class="line-number" data-v-24208a48>3</span><br data-v-24208a48><span class="line-number" data-v-24208a48>4</span><br data-v-24208a48><span class="line-number" data-v-24208a48>5</span><br data-v-24208a48><span class="line-number" data-v-24208a48>6</span><br data-v-24208a48><span class="line-number" data-v-24208a48>7</span><br data-v-24208a48><span class="line-number" data-v-24208a48>8</span><br data-v-24208a48><span class="line-number" data-v-24208a48>9</span><br data-v-24208a48><span class="line-number" data-v-24208a48>10</span><br data-v-24208a48><span class="line-number" data-v-24208a48>11</span><br data-v-24208a48><span class="line-number" data-v-24208a48>12</span><br data-v-24208a48><span class="line-number" data-v-24208a48>13</span><br data-v-24208a48><span class="line-number" data-v-24208a48>14</span><br data-v-24208a48><span class="line-number" data-v-24208a48>15</span><br data-v-24208a48><span class="line-number" data-v-24208a48>16</span><br data-v-24208a48><span class="line-number" data-v-24208a48>17</span><br data-v-24208a48><span class="line-number" data-v-24208a48>18</span><br data-v-24208a48><span class="line-number" data-v-24208a48>19</span><br data-v-24208a48><span class="line-number" data-v-24208a48>20</span><br data-v-24208a48><span class="line-number" data-v-24208a48>21</span><br data-v-24208a48><span class="line-number" data-v-24208a48>22</span><br data-v-24208a48><span class="line-number" data-v-24208a48>23</span><br data-v-24208a48><span class="line-number" data-v-24208a48>24</span><br data-v-24208a48><span class="line-number" data-v-24208a48>25</span><br data-v-24208a48><span class="line-number" data-v-24208a48>26</span><br data-v-24208a48><span class="line-number" data-v-24208a48>27</span><br data-v-24208a48><span class="line-number" data-v-24208a48>28</span><br data-v-24208a48><span class="line-number" data-v-24208a48>29</span><br data-v-24208a48><span class="line-number" data-v-24208a48>30</span><br data-v-24208a48><span class="line-number" data-v-24208a48>31</span><br data-v-24208a48><span class="line-number" data-v-24208a48>32</span><br data-v-24208a48><span class="line-number" data-v-24208a48>33</span><br data-v-24208a48><span class="line-number" data-v-24208a48>34</span><br data-v-24208a48><span class="line-number" data-v-24208a48>35</span><br data-v-24208a48></div></div><p data-v-24208a48>NotUpdate组件:</p> <div class="language-jsx line-numbers-mode" data-v-24208a48><pre class="language-jsx" data-v-24208a48><code data-v-24208a48><span class="token keyword" data-v-24208a48>const</span> NotUpdate <span class="token operator" data-v-24208a48>=</span> React<span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>memo</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>(</span><span class="token parameter" data-v-24208a48><span class="token punctuation" data-v-24208a48>{</span> children <span class="token punctuation" data-v-24208a48>}</span><span class="token operator" data-v-24208a48>:</span>any</span><span class="token punctuation" data-v-24208a48>)</span><span class="token operator" data-v-24208a48>=&gt;</span> <span class="token keyword" data-v-24208a48>typeof</span> children <span class="token operator" data-v-24208a48>===</span> <span class="token string" data-v-24208a48>'function'</span> <span class="token operator" data-v-24208a48>?</span> <span class="token function" data-v-24208a48>children</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span> <span class="token operator" data-v-24208a48>:</span> children <span class="token punctuation" data-v-24208a48>,</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token operator" data-v-24208a48>=&gt;</span><span class="token boolean" data-v-24208a48>true</span><span class="token punctuation" data-v-24208a48>)</span>
</code></pre> <div class="line-numbers-wrapper" data-v-24208a48><span class="line-number" data-v-24208a48>1</span><br data-v-24208a48></div></div><p data-v-24208a48>原理：
</p><div style="width:400px;" data-v-24208a48><img src="/vuebloger/img/post/Snipaste_2021-10-05_14-37-37.jpg" alt="" data-v-24208a48></div><p data-v-24208a48></p> <p data-v-24208a48>没错，用的就是 React.memo，生成了阻断更新的隔离单元，如果我们想要控制更新，可以对 React.memo 第二个参数入手， demo项目中完全阻断的更新。</p> <h3 id="取缔state-学会使用缓存。" data-v-24208a48><a href="#取缔state-学会使用缓存。" class="header-anchor" data-v-24208a48>#</a> 取缔state，学会使用缓存。</h3> <p data-v-24208a48>这里的取缔state，并完全不使用state来管理数据，而是善于使用state,知道什么时候使用,怎么使用。react 并不像 vue 那样响应式数据流。 在 vue中 有专门的dep做依赖收集，可以自动收集字符串模版的依赖项，只要没有引用的data数据， 通过 this.aaa = bbb ,在vue中是不会更新渲染的。因为 aaa 的dep没有收集渲染watcher依赖项。在react中，我们触发this.setState 或者 useState，只会关心两次state值是否相同，来触发渲染，根本不会在乎jsx语法中是否真正的引入了正确的值。</p> <ol data-v-24208a48><li data-v-24208a48>没有更新作用的state
有状态组件中:</li></ol> <div class="language-jsx line-numbers-mode" data-v-24208a48><pre class="language-jsx" data-v-24208a48><code data-v-24208a48><span class="token keyword" data-v-24208a48>class</span> <span class="token class-name" data-v-24208a48>Demo</span> <span class="token keyword" data-v-24208a48>extends</span> <span class="token class-name" data-v-24208a48>React<span class="token punctuation" data-v-24208a48>.</span>Component</span><span class="token punctuation" data-v-24208a48>{</span>
    state<span class="token operator" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span> text<span class="token operator" data-v-24208a48>:</span><span class="token number" data-v-24208a48>111</span> <span class="token punctuation" data-v-24208a48>}</span>
    <span class="token function" data-v-24208a48>componentDidMount</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>{</span>
        <span class="token keyword" data-v-24208a48>const</span> <span class="token punctuation" data-v-24208a48>{</span> a <span class="token punctuation" data-v-24208a48>}</span> <span class="token operator" data-v-24208a48>=</span> <span class="token keyword" data-v-24208a48>this</span><span class="token punctuation" data-v-24208a48>.</span>props
         <span class="token comment" data-v-24208a48>/* 我们只是希望在初始化,用text记录 props中 a 的值 */</span>
        <span class="token keyword" data-v-24208a48>this</span><span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>setState</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>{</span>
            text<span class="token operator" data-v-24208a48>:</span>a
        <span class="token punctuation" data-v-24208a48>}</span><span class="token punctuation" data-v-24208a48>)</span>    
    <span class="token punctuation" data-v-24208a48>}</span>
    <span class="token function" data-v-24208a48>render</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>{</span>
        <span class="token comment" data-v-24208a48>/* 没有引入text */</span>
       <span class="token keyword" data-v-24208a48>return</span> <span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token punctuation" data-v-24208a48>{</span><span class="token string" data-v-24208a48>'hello,world'</span><span class="token punctuation" data-v-24208a48>}</span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span>
    <span class="token punctuation" data-v-24208a48>}</span>
<span class="token punctuation" data-v-24208a48>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-24208a48><span class="line-number" data-v-24208a48>1</span><br data-v-24208a48><span class="line-number" data-v-24208a48>2</span><br data-v-24208a48><span class="line-number" data-v-24208a48>3</span><br data-v-24208a48><span class="line-number" data-v-24208a48>4</span><br data-v-24208a48><span class="line-number" data-v-24208a48>5</span><br data-v-24208a48><span class="line-number" data-v-24208a48>6</span><br data-v-24208a48><span class="line-number" data-v-24208a48>7</span><br data-v-24208a48><span class="line-number" data-v-24208a48>8</span><br data-v-24208a48><span class="line-number" data-v-24208a48>9</span><br data-v-24208a48><span class="line-number" data-v-24208a48>10</span><br data-v-24208a48><span class="line-number" data-v-24208a48>11</span><br data-v-24208a48><span class="line-number" data-v-24208a48>12</span><br data-v-24208a48><span class="line-number" data-v-24208a48>13</span><br data-v-24208a48><span class="line-number" data-v-24208a48>14</span><br data-v-24208a48></div></div><p data-v-24208a48>如上例子中,render函数中并没有引入text ,我们只是希望在初始化的时候，用 text 记录 props 中 a 的值。我们却用 setState 触发了一次无用的更新。无状态组件中情况也一样存在，具体如下。</p> <p data-v-24208a48>无状态组件中:</p> <div class="language-jsx line-numbers-mode" data-v-24208a48><pre class="language-jsx" data-v-24208a48><code data-v-24208a48><span class="token keyword" data-v-24208a48>function</span> <span class="token function" data-v-24208a48>Demo</span> <span class="token punctuation" data-v-24208a48>(</span><span class="token parameter" data-v-24208a48><span class="token punctuation" data-v-24208a48>{</span> a <span class="token punctuation" data-v-24208a48>}</span></span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>{</span>
    <span class="token keyword" data-v-24208a48>const</span> <span class="token punctuation" data-v-24208a48>[</span>text <span class="token punctuation" data-v-24208a48>,</span> setText<span class="token punctuation" data-v-24208a48>]</span> <span class="token operator" data-v-24208a48>=</span> <span class="token function" data-v-24208a48>useState</span><span class="token punctuation" data-v-24208a48>(</span><span class="token number" data-v-24208a48>111</span><span class="token punctuation" data-v-24208a48>)</span>
    <span class="token function" data-v-24208a48>useEffect</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token operator" data-v-24208a48>=&gt;</span><span class="token punctuation" data-v-24208a48>{</span>
        <span class="token function" data-v-24208a48>setText</span><span class="token punctuation" data-v-24208a48>(</span>a<span class="token punctuation" data-v-24208a48>)</span>
    <span class="token punctuation" data-v-24208a48>}</span><span class="token punctuation" data-v-24208a48>,</span><span class="token punctuation" data-v-24208a48>[</span><span class="token punctuation" data-v-24208a48>]</span><span class="token punctuation" data-v-24208a48>)</span>
    <span class="token keyword" data-v-24208a48>return</span> <span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
         </span><span class="token punctuation" data-v-24208a48>{</span><span class="token string" data-v-24208a48>'hello,world'</span><span class="token punctuation" data-v-24208a48>}</span><span class="token plain-text" data-v-24208a48>
    </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span>
<span class="token punctuation" data-v-24208a48>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-24208a48><span class="line-number" data-v-24208a48>1</span><br data-v-24208a48><span class="line-number" data-v-24208a48>2</span><br data-v-24208a48><span class="line-number" data-v-24208a48>3</span><br data-v-24208a48><span class="line-number" data-v-24208a48>4</span><br data-v-24208a48><span class="line-number" data-v-24208a48>5</span><br data-v-24208a48><span class="line-number" data-v-24208a48>6</span><br data-v-24208a48><span class="line-number" data-v-24208a48>7</span><br data-v-24208a48><span class="line-number" data-v-24208a48>8</span><br data-v-24208a48><span class="line-number" data-v-24208a48>9</span><br data-v-24208a48></div></div><ol start="2" data-v-24208a48><li data-v-24208a48>改为缓存
有状态组件中: 在class声明组件中，我们可以直接把数据绑定给this上，来作为数据缓存。</li></ol> <div class="language-jsx line-numbers-mode" data-v-24208a48><pre class="language-jsx" data-v-24208a48><code data-v-24208a48><span class="token keyword" data-v-24208a48>class</span> <span class="token class-name" data-v-24208a48>Demo</span> <span class="token keyword" data-v-24208a48>extends</span> <span class="token class-name" data-v-24208a48>React<span class="token punctuation" data-v-24208a48>.</span>Component</span><span class="token punctuation" data-v-24208a48>{</span>
    text <span class="token operator" data-v-24208a48>=</span> <span class="token number" data-v-24208a48>111</span>
    <span class="token function" data-v-24208a48>componentDidMount</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>{</span>
        <span class="token keyword" data-v-24208a48>const</span> <span class="token punctuation" data-v-24208a48>{</span> a <span class="token punctuation" data-v-24208a48>}</span> <span class="token operator" data-v-24208a48>=</span> <span class="token keyword" data-v-24208a48>this</span><span class="token punctuation" data-v-24208a48>.</span>props
        <span class="token comment" data-v-24208a48>/* 数据直接保存在text上 */</span>
        <span class="token keyword" data-v-24208a48>this</span><span class="token punctuation" data-v-24208a48>.</span>text <span class="token operator" data-v-24208a48>=</span> a
    <span class="token punctuation" data-v-24208a48>}</span>
    <span class="token function" data-v-24208a48>render</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>{</span>
        <span class="token comment" data-v-24208a48>/* 没有引入text */</span>
       <span class="token keyword" data-v-24208a48>return</span> <span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token punctuation" data-v-24208a48>{</span><span class="token string" data-v-24208a48>'hello,world'</span><span class="token punctuation" data-v-24208a48>}</span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span>
    <span class="token punctuation" data-v-24208a48>}</span>
<span class="token punctuation" data-v-24208a48>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-24208a48><span class="line-number" data-v-24208a48>1</span><br data-v-24208a48><span class="line-number" data-v-24208a48>2</span><br data-v-24208a48><span class="line-number" data-v-24208a48>3</span><br data-v-24208a48><span class="line-number" data-v-24208a48>4</span><br data-v-24208a48><span class="line-number" data-v-24208a48>5</span><br data-v-24208a48><span class="line-number" data-v-24208a48>6</span><br data-v-24208a48><span class="line-number" data-v-24208a48>7</span><br data-v-24208a48><span class="line-number" data-v-24208a48>8</span><br data-v-24208a48><span class="line-number" data-v-24208a48>9</span><br data-v-24208a48><span class="line-number" data-v-24208a48>10</span><br data-v-24208a48><span class="line-number" data-v-24208a48>11</span><br data-v-24208a48><span class="line-number" data-v-24208a48>12</span><br data-v-24208a48></div></div><p data-v-24208a48>无状态组件中: 在无状态组件中, 我们不能往问this,但是我们可以用useRef来解决问题。</p> <div class="language-jsx line-numbers-mode" data-v-24208a48><pre class="language-jsx" data-v-24208a48><code data-v-24208a48><span class="token keyword" data-v-24208a48>function</span> <span class="token function" data-v-24208a48>Demo</span> <span class="token punctuation" data-v-24208a48>(</span><span class="token parameter" data-v-24208a48><span class="token punctuation" data-v-24208a48>{</span> a <span class="token punctuation" data-v-24208a48>}</span></span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>{</span>
    <span class="token keyword" data-v-24208a48>const</span> text <span class="token operator" data-v-24208a48>=</span> <span class="token function" data-v-24208a48>useRef</span><span class="token punctuation" data-v-24208a48>(</span><span class="token number" data-v-24208a48>111</span><span class="token punctuation" data-v-24208a48>)</span>
    <span class="token function" data-v-24208a48>useEffect</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token operator" data-v-24208a48>=&gt;</span><span class="token punctuation" data-v-24208a48>{</span>
        text<span class="token punctuation" data-v-24208a48>.</span>current <span class="token operator" data-v-24208a48>=</span> a
    <span class="token punctuation" data-v-24208a48>}</span><span class="token punctuation" data-v-24208a48>,</span><span class="token punctuation" data-v-24208a48>[</span><span class="token punctuation" data-v-24208a48>]</span><span class="token punctuation" data-v-24208a48>)</span>
    <span class="token keyword" data-v-24208a48>return</span> <span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
        </span><span class="token punctuation" data-v-24208a48>{</span><span class="token string" data-v-24208a48>'hello,world'</span><span class="token punctuation" data-v-24208a48>}</span><span class="token plain-text" data-v-24208a48>
    </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span>
<span class="token punctuation" data-v-24208a48>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-24208a48><span class="line-number" data-v-24208a48>1</span><br data-v-24208a48><span class="line-number" data-v-24208a48>2</span><br data-v-24208a48><span class="line-number" data-v-24208a48>3</span><br data-v-24208a48><span class="line-number" data-v-24208a48>4</span><br data-v-24208a48><span class="line-number" data-v-24208a48>5</span><br data-v-24208a48><span class="line-number" data-v-24208a48>6</span><br data-v-24208a48><span class="line-number" data-v-24208a48>7</span><br data-v-24208a48><span class="line-number" data-v-24208a48>8</span><br data-v-24208a48><span class="line-number" data-v-24208a48>9</span><br data-v-24208a48></div></div><h3 id="usecallback回调" data-v-24208a48><a href="#usecallback回调" class="header-anchor" data-v-24208a48>#</a> useCallback回调</h3> <p data-v-24208a48>useCallback 的真正目的还是在于缓存了每次渲染时 inline callback 的实例，这样方便配合上子组件的 shouldComponentUpdate 或者 React.memo 起到减少不必要的渲染的作用。对子组件的渲染限定来源与，对子组件props比较，但是如果对父组件的callback做比较，无状态组件每次渲染执行，都会形成新的callback ,是无法比较，所以需要对callback做一个 memoize 记忆功能，我们可以理解为useCallback就是 callback加了一个memoize。我们接着往下看👇👇👇。</p> <div class="language-jsx line-numbers-mode" data-v-24208a48><pre class="language-jsx" data-v-24208a48><code data-v-24208a48><span class="token keyword" data-v-24208a48>function</span> <span class="token function" data-v-24208a48>demo</span> <span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>{</span>
    <span class="token keyword" data-v-24208a48>const</span> <span class="token punctuation" data-v-24208a48>[</span> number <span class="token punctuation" data-v-24208a48>,</span> setNumber <span class="token punctuation" data-v-24208a48>]</span> <span class="token operator" data-v-24208a48>=</span> <span class="token function" data-v-24208a48>useState</span><span class="token punctuation" data-v-24208a48>(</span><span class="token number" data-v-24208a48>0</span><span class="token punctuation" data-v-24208a48>)</span>
    <span class="token keyword" data-v-24208a48>return</span> <span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>  
        </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span><span class="token class-name" data-v-24208a48>DemoComponent</span></span>  <span class="token attr-name" data-v-24208a48>handerChange</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span> <span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token operator" data-v-24208a48>=&gt;</span><span class="token punctuation" data-v-24208a48>{</span> <span class="token function" data-v-24208a48>setNumber</span><span class="token punctuation" data-v-24208a48>(</span>number<span class="token operator" data-v-24208a48>+</span><span class="token number" data-v-24208a48>1</span><span class="token punctuation" data-v-24208a48>)</span>  <span class="token punctuation" data-v-24208a48>}</span> <span class="token punctuation" data-v-24208a48>}</span></span> <span class="token punctuation" data-v-24208a48>/&gt;</span></span><span class="token plain-text" data-v-24208a48>
    </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span>
<span class="token punctuation" data-v-24208a48>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-24208a48><span class="line-number" data-v-24208a48>1</span><br data-v-24208a48><span class="line-number" data-v-24208a48>2</span><br data-v-24208a48><span class="line-number" data-v-24208a48>3</span><br data-v-24208a48><span class="line-number" data-v-24208a48>4</span><br data-v-24208a48><span class="line-number" data-v-24208a48>5</span><br data-v-24208a48><span class="line-number" data-v-24208a48>6</span><br data-v-24208a48></div></div><p data-v-24208a48>或着</p> <div class="language-jsx line-numbers-mode" data-v-24208a48><pre class="language-jsx" data-v-24208a48><code data-v-24208a48><span class="token keyword" data-v-24208a48>function</span> <span class="token function" data-v-24208a48>demo</span> <span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>{</span>
    <span class="token keyword" data-v-24208a48>const</span> <span class="token punctuation" data-v-24208a48>[</span> number <span class="token punctuation" data-v-24208a48>,</span> setNumber <span class="token punctuation" data-v-24208a48>]</span> <span class="token operator" data-v-24208a48>=</span> <span class="token function" data-v-24208a48>useState</span><span class="token punctuation" data-v-24208a48>(</span><span class="token number" data-v-24208a48>0</span><span class="token punctuation" data-v-24208a48>)</span>
    <span class="token keyword" data-v-24208a48>const</span> <span class="token function-variable function" data-v-24208a48>handerChange</span> <span class="token operator" data-v-24208a48>=</span> <span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token operator" data-v-24208a48>=&gt;</span><span class="token punctuation" data-v-24208a48>{</span>
        <span class="token function" data-v-24208a48>setNumber</span><span class="token punctuation" data-v-24208a48>(</span>number<span class="token operator" data-v-24208a48>+</span><span class="token number" data-v-24208a48>1</span><span class="token punctuation" data-v-24208a48>)</span> 
    <span class="token punctuation" data-v-24208a48>}</span>
    <span class="token keyword" data-v-24208a48>return</span> <span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>  
                </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span><span class="token class-name" data-v-24208a48>DemoComponent</span></span>  <span class="token attr-name" data-v-24208a48>handerChange</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span> handerChange <span class="token punctuation" data-v-24208a48>}</span></span> <span class="token punctuation" data-v-24208a48>/&gt;</span></span><span class="token plain-text" data-v-24208a48>
            </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span>
<span class="token punctuation" data-v-24208a48>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-24208a48><span class="line-number" data-v-24208a48>1</span><br data-v-24208a48><span class="line-number" data-v-24208a48>2</span><br data-v-24208a48><span class="line-number" data-v-24208a48>3</span><br data-v-24208a48><span class="line-number" data-v-24208a48>4</span><br data-v-24208a48><span class="line-number" data-v-24208a48>5</span><br data-v-24208a48><span class="line-number" data-v-24208a48>6</span><br data-v-24208a48><span class="line-number" data-v-24208a48>7</span><br data-v-24208a48><span class="line-number" data-v-24208a48>8</span><br data-v-24208a48><span class="line-number" data-v-24208a48>9</span><br data-v-24208a48></div></div><p data-v-24208a48>无论是上述那种方式，pureComponent 和 react.memo 通过浅比较方式，只能判断每次更新都是新的callback，然后触发渲染更新。useCallback给加了一个记忆功能，告诉我们子组件，两次是相同的 callback无需重新更新页面。至于什么时候callback更改，就要取决于 useCallback 第二个参数。好的，将上述demo我们用 useCallback 重写。</p> <div class="language-jsx line-numbers-mode" data-v-24208a48><pre class="language-jsx" data-v-24208a48><code data-v-24208a48><span class="token keyword" data-v-24208a48>function</span> <span class="token function" data-v-24208a48>demo</span> <span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>{</span>
    <span class="token keyword" data-v-24208a48>const</span> <span class="token punctuation" data-v-24208a48>[</span> number <span class="token punctuation" data-v-24208a48>,</span> setNumber <span class="token punctuation" data-v-24208a48>]</span> <span class="token operator" data-v-24208a48>=</span> <span class="token function" data-v-24208a48>useState</span><span class="token punctuation" data-v-24208a48>(</span><span class="token number" data-v-24208a48>0</span><span class="token punctuation" data-v-24208a48>)</span>
    <span class="token keyword" data-v-24208a48>const</span> handerChange <span class="token operator" data-v-24208a48>=</span> <span class="token function" data-v-24208a48>useCallback</span><span class="token punctuation" data-v-24208a48>(</span> <span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token operator" data-v-24208a48>=&gt;</span><span class="token punctuation" data-v-24208a48>{</span>
        <span class="token function" data-v-24208a48>setNumber</span><span class="token punctuation" data-v-24208a48>(</span>number<span class="token operator" data-v-24208a48>+</span><span class="token number" data-v-24208a48>1</span><span class="token punctuation" data-v-24208a48>)</span> 
    <span class="token punctuation" data-v-24208a48>}</span><span class="token punctuation" data-v-24208a48>,</span><span class="token punctuation" data-v-24208a48>[</span><span class="token punctuation" data-v-24208a48>]</span><span class="token punctuation" data-v-24208a48>)</span>
    <span class="token keyword" data-v-24208a48>return</span> <span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>  
        </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span><span class="token class-name" data-v-24208a48>DemoComponent</span></span>  <span class="token attr-name" data-v-24208a48>handerChange</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span> handerChange <span class="token punctuation" data-v-24208a48>}</span></span> <span class="token punctuation" data-v-24208a48>/&gt;</span></span><span class="token plain-text" data-v-24208a48>
    </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span>
<span class="token punctuation" data-v-24208a48>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-24208a48><span class="line-number" data-v-24208a48>1</span><br data-v-24208a48><span class="line-number" data-v-24208a48>2</span><br data-v-24208a48><span class="line-number" data-v-24208a48>3</span><br data-v-24208a48><span class="line-number" data-v-24208a48>4</span><br data-v-24208a48><span class="line-number" data-v-24208a48>5</span><br data-v-24208a48><span class="line-number" data-v-24208a48>6</span><br data-v-24208a48><span class="line-number" data-v-24208a48>7</span><br data-v-24208a48><span class="line-number" data-v-24208a48>8</span><br data-v-24208a48><span class="line-number" data-v-24208a48>9</span><br data-v-24208a48></div></div><p data-v-24208a48>这样 pureComponent 和 react.memo 可以直接判断是callback没有改变，防止了不必要渲染。</p> <h2 id="海量数据优化-时间分片-虚拟列表" data-v-24208a48><a href="#海量数据优化-时间分片-虚拟列表" class="header-anchor" data-v-24208a48>#</a> 海量数据优化-时间分片，虚拟列表</h2> <h3 id="时间分片" data-v-24208a48><a href="#时间分片" class="header-anchor" data-v-24208a48>#</a> 时间分片</h3> <p data-v-24208a48>时间分片的概念，就是一次性渲染大量数据，初始化的时候会出现卡顿等现象。我们必须要明白的一个道理，js执行永远要比dom渲染快的多。 ，所以对于大量的数据，一次性渲染，容易造成卡顿，卡死的情况。我们先来看一下例子</p> <div class="language-jsx line-numbers-mode" data-v-24208a48><pre class="language-jsx" data-v-24208a48><code data-v-24208a48><span class="token keyword" data-v-24208a48>class</span> <span class="token class-name" data-v-24208a48>Index</span> <span class="token keyword" data-v-24208a48>extends</span> <span class="token class-name" data-v-24208a48>React<span class="token punctuation" data-v-24208a48>.</span>Component</span><span class="token operator" data-v-24208a48>&lt;</span>any<span class="token punctuation" data-v-24208a48>,</span>any<span class="token operator" data-v-24208a48>&gt;</span><span class="token punctuation" data-v-24208a48>{</span>
    state<span class="token operator" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span>
       list<span class="token operator" data-v-24208a48>:</span> <span class="token punctuation" data-v-24208a48>[</span><span class="token punctuation" data-v-24208a48>]</span>
    <span class="token punctuation" data-v-24208a48>}</span>
    <span class="token function-variable function" data-v-24208a48>handerClick</span><span class="token operator" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token operator" data-v-24208a48>=&gt;</span><span class="token punctuation" data-v-24208a48>{</span>
       <span class="token keyword" data-v-24208a48>let</span> starTime <span class="token operator" data-v-24208a48>=</span> <span class="token keyword" data-v-24208a48>new</span> <span class="token class-name" data-v-24208a48>Date</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>getTime</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span>
       <span class="token keyword" data-v-24208a48>this</span><span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>setState</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>{</span>
           list<span class="token operator" data-v-24208a48>:</span> <span class="token keyword" data-v-24208a48>new</span> <span class="token class-name" data-v-24208a48>Array</span><span class="token punctuation" data-v-24208a48>(</span><span class="token number" data-v-24208a48>40000</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>fill</span><span class="token punctuation" data-v-24208a48>(</span><span class="token number" data-v-24208a48>0</span><span class="token punctuation" data-v-24208a48>)</span>
       <span class="token punctuation" data-v-24208a48>}</span><span class="token punctuation" data-v-24208a48>,</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token operator" data-v-24208a48>=&gt;</span><span class="token punctuation" data-v-24208a48>{</span>
          <span class="token keyword" data-v-24208a48>const</span> end <span class="token operator" data-v-24208a48>=</span>  <span class="token keyword" data-v-24208a48>new</span> <span class="token class-name" data-v-24208a48>Date</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>getTime</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span>
          console<span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>log</span><span class="token punctuation" data-v-24208a48>(</span> <span class="token punctuation" data-v-24208a48>(</span>end <span class="token operator" data-v-24208a48>-</span> starTime <span class="token punctuation" data-v-24208a48>)</span> <span class="token operator" data-v-24208a48>/</span> <span class="token number" data-v-24208a48>1000</span> <span class="token operator" data-v-24208a48>+</span> <span class="token string" data-v-24208a48>'秒'</span><span class="token punctuation" data-v-24208a48>)</span>
       <span class="token punctuation" data-v-24208a48>}</span><span class="token punctuation" data-v-24208a48>)</span>
    <span class="token punctuation" data-v-24208a48>}</span>
    <span class="token function" data-v-24208a48>render</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>{</span>
        <span class="token keyword" data-v-24208a48>const</span> <span class="token punctuation" data-v-24208a48>{</span> list <span class="token punctuation" data-v-24208a48>}</span> <span class="token operator" data-v-24208a48>=</span> <span class="token keyword" data-v-24208a48>this</span><span class="token punctuation" data-v-24208a48>.</span>state
        console<span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>log</span><span class="token punctuation" data-v-24208a48>(</span>list<span class="token punctuation" data-v-24208a48>)</span>
        <span class="token keyword" data-v-24208a48>return</span> <span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
            </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>button</span> <span class="token attr-name" data-v-24208a48>onClick</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span> <span class="token keyword" data-v-24208a48>this</span><span class="token punctuation" data-v-24208a48>.</span>handerClick <span class="token punctuation" data-v-24208a48>}</span></span> <span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>点击</span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>button</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
            </span><span class="token punctuation" data-v-24208a48>{</span>
                list<span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>map</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>(</span><span class="token parameter" data-v-24208a48>item<span class="token punctuation" data-v-24208a48>,</span>index</span><span class="token punctuation" data-v-24208a48>)</span><span class="token operator" data-v-24208a48>=&gt;</span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>li</span> <span class="token attr-name" data-v-24208a48>className</span><span class="token attr-value" data-v-24208a48><span class="token punctuation attr-equals" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>&quot;</span>list<span class="token punctuation" data-v-24208a48>&quot;</span></span>  <span class="token attr-name" data-v-24208a48>key</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span>index<span class="token punctuation" data-v-24208a48>}</span></span> <span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
                    </span><span class="token punctuation" data-v-24208a48>{</span> item  <span class="token operator" data-v-24208a48>+</span> <span class="token string" data-v-24208a48>''</span> <span class="token operator" data-v-24208a48>+</span> index <span class="token punctuation" data-v-24208a48>}</span><span class="token plain-text" data-v-24208a48> Item
                </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>li</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token punctuation" data-v-24208a48>)</span>
            <span class="token punctuation" data-v-24208a48>}</span><span class="token plain-text" data-v-24208a48>
        </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span>
    <span class="token punctuation" data-v-24208a48>}</span>
<span class="token punctuation" data-v-24208a48>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-24208a48><span class="line-number" data-v-24208a48>1</span><br data-v-24208a48><span class="line-number" data-v-24208a48>2</span><br data-v-24208a48><span class="line-number" data-v-24208a48>3</span><br data-v-24208a48><span class="line-number" data-v-24208a48>4</span><br data-v-24208a48><span class="line-number" data-v-24208a48>5</span><br data-v-24208a48><span class="line-number" data-v-24208a48>6</span><br data-v-24208a48><span class="line-number" data-v-24208a48>7</span><br data-v-24208a48><span class="line-number" data-v-24208a48>8</span><br data-v-24208a48><span class="line-number" data-v-24208a48>9</span><br data-v-24208a48><span class="line-number" data-v-24208a48>10</span><br data-v-24208a48><span class="line-number" data-v-24208a48>11</span><br data-v-24208a48><span class="line-number" data-v-24208a48>12</span><br data-v-24208a48><span class="line-number" data-v-24208a48>13</span><br data-v-24208a48><span class="line-number" data-v-24208a48>14</span><br data-v-24208a48><span class="line-number" data-v-24208a48>15</span><br data-v-24208a48><span class="line-number" data-v-24208a48>16</span><br data-v-24208a48><span class="line-number" data-v-24208a48>17</span><br data-v-24208a48><span class="line-number" data-v-24208a48>18</span><br data-v-24208a48><span class="line-number" data-v-24208a48>19</span><br data-v-24208a48><span class="line-number" data-v-24208a48>20</span><br data-v-24208a48><span class="line-number" data-v-24208a48>21</span><br data-v-24208a48><span class="line-number" data-v-24208a48>22</span><br data-v-24208a48><span class="line-number" data-v-24208a48>23</span><br data-v-24208a48><span class="line-number" data-v-24208a48>24</span><br data-v-24208a48><span class="line-number" data-v-24208a48>25</span><br data-v-24208a48><span class="line-number" data-v-24208a48>26</span><br data-v-24208a48></div></div><p data-v-24208a48>我们模拟一次性渲染 40000 个数据的列表，看一下需要多长时间。
效果：
</p><div style="width:800px;" data-v-24208a48><img src="/vuebloger/img/post/vasddgasdfasf.gif" alt="" data-v-24208a48></div><p data-v-24208a48></p> <p data-v-24208a48>我们看到 40000 个 简单列表渲染了，将近5秒的时间。为了解决一次性加载大量数据的问题。我们引出了时间分片的概念，就是用setTimeout把任务分割，分成若干次来渲染。一共40000个数据，我们可以每次渲染100个， 分次400渲染。</p> <div class="language-jsx line-numbers-mode" data-v-24208a48><pre class="language-jsx" data-v-24208a48><code data-v-24208a48><span class="token keyword" data-v-24208a48>class</span> <span class="token class-name" data-v-24208a48>Index</span> <span class="token keyword" data-v-24208a48>extends</span> <span class="token class-name" data-v-24208a48>React<span class="token punctuation" data-v-24208a48>.</span>Component</span><span class="token operator" data-v-24208a48>&lt;</span>any<span class="token punctuation" data-v-24208a48>,</span>any<span class="token operator" data-v-24208a48>&gt;</span><span class="token punctuation" data-v-24208a48>{</span>
    state<span class="token operator" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span>
       list<span class="token operator" data-v-24208a48>:</span> <span class="token punctuation" data-v-24208a48>[</span><span class="token punctuation" data-v-24208a48>]</span>
    <span class="token punctuation" data-v-24208a48>}</span>
    <span class="token function-variable function" data-v-24208a48>handerClick</span><span class="token operator" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token operator" data-v-24208a48>=&gt;</span><span class="token punctuation" data-v-24208a48>{</span>
       <span class="token keyword" data-v-24208a48>this</span><span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>sliceTime</span><span class="token punctuation" data-v-24208a48>(</span><span class="token keyword" data-v-24208a48>new</span> <span class="token class-name" data-v-24208a48>Array</span><span class="token punctuation" data-v-24208a48>(</span><span class="token number" data-v-24208a48>40000</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>fill</span><span class="token punctuation" data-v-24208a48>(</span><span class="token number" data-v-24208a48>0</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>,</span> <span class="token number" data-v-24208a48>0</span><span class="token punctuation" data-v-24208a48>)</span>
    <span class="token punctuation" data-v-24208a48>}</span>
    <span class="token function-variable function" data-v-24208a48>sliceTime</span><span class="token operator" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>(</span><span class="token parameter" data-v-24208a48>list<span class="token punctuation" data-v-24208a48>,</span>times</span><span class="token punctuation" data-v-24208a48>)</span><span class="token operator" data-v-24208a48>=&gt;</span><span class="token punctuation" data-v-24208a48>{</span>
        <span class="token keyword" data-v-24208a48>if</span><span class="token punctuation" data-v-24208a48>(</span>times <span class="token operator" data-v-24208a48>===</span> <span class="token number" data-v-24208a48>400</span><span class="token punctuation" data-v-24208a48>)</span> <span class="token keyword" data-v-24208a48>return</span> 
        <span class="token function" data-v-24208a48>setTimeout</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span> <span class="token operator" data-v-24208a48>=&gt;</span> <span class="token punctuation" data-v-24208a48>{</span>
            <span class="token keyword" data-v-24208a48>const</span> newList <span class="token operator" data-v-24208a48>=</span> list<span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>slice</span><span class="token punctuation" data-v-24208a48>(</span> times <span class="token punctuation" data-v-24208a48>,</span> <span class="token punctuation" data-v-24208a48>(</span>times <span class="token operator" data-v-24208a48>+</span> <span class="token number" data-v-24208a48>1</span><span class="token punctuation" data-v-24208a48>)</span> <span class="token operator" data-v-24208a48>*</span> <span class="token number" data-v-24208a48>100</span> <span class="token punctuation" data-v-24208a48>)</span> <span class="token comment" data-v-24208a48>/* 每次截取 100 个 */</span>
            <span class="token keyword" data-v-24208a48>this</span><span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>setState</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>{</span>
                list<span class="token operator" data-v-24208a48>:</span> <span class="token keyword" data-v-24208a48>this</span><span class="token punctuation" data-v-24208a48>.</span>state<span class="token punctuation" data-v-24208a48>.</span>list<span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>concat</span><span class="token punctuation" data-v-24208a48>(</span>newList<span class="token punctuation" data-v-24208a48>)</span>
            <span class="token punctuation" data-v-24208a48>}</span><span class="token punctuation" data-v-24208a48>)</span>
            <span class="token keyword" data-v-24208a48>this</span><span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>sliceTime</span><span class="token punctuation" data-v-24208a48>(</span> list <span class="token punctuation" data-v-24208a48>,</span>times <span class="token operator" data-v-24208a48>+</span> <span class="token number" data-v-24208a48>1</span> <span class="token punctuation" data-v-24208a48>)</span>
        <span class="token punctuation" data-v-24208a48>}</span><span class="token punctuation" data-v-24208a48>,</span> <span class="token number" data-v-24208a48>0</span><span class="token punctuation" data-v-24208a48>)</span>
    <span class="token punctuation" data-v-24208a48>}</span>
    <span class="token function" data-v-24208a48>render</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>{</span>
        <span class="token keyword" data-v-24208a48>const</span> <span class="token punctuation" data-v-24208a48>{</span> list <span class="token punctuation" data-v-24208a48>}</span> <span class="token operator" data-v-24208a48>=</span> <span class="token keyword" data-v-24208a48>this</span><span class="token punctuation" data-v-24208a48>.</span>state
        <span class="token keyword" data-v-24208a48>return</span> <span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
            </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>button</span> <span class="token attr-name" data-v-24208a48>onClick</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span> <span class="token keyword" data-v-24208a48>this</span><span class="token punctuation" data-v-24208a48>.</span>handerClick <span class="token punctuation" data-v-24208a48>}</span></span> <span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>点击</span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>button</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
            </span><span class="token punctuation" data-v-24208a48>{</span>
                list<span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>map</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>(</span><span class="token parameter" data-v-24208a48>item<span class="token punctuation" data-v-24208a48>,</span>index</span><span class="token punctuation" data-v-24208a48>)</span><span class="token operator" data-v-24208a48>=&gt;</span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>li</span> <span class="token attr-name" data-v-24208a48>className</span><span class="token attr-value" data-v-24208a48><span class="token punctuation attr-equals" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>&quot;</span>list<span class="token punctuation" data-v-24208a48>&quot;</span></span>  <span class="token attr-name" data-v-24208a48>key</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span>index<span class="token punctuation" data-v-24208a48>}</span></span> <span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
                    </span><span class="token punctuation" data-v-24208a48>{</span> item  <span class="token operator" data-v-24208a48>+</span> <span class="token string" data-v-24208a48>''</span> <span class="token operator" data-v-24208a48>+</span> index <span class="token punctuation" data-v-24208a48>}</span><span class="token plain-text" data-v-24208a48> Item
                </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>li</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token punctuation" data-v-24208a48>)</span>
            <span class="token punctuation" data-v-24208a48>}</span><span class="token plain-text" data-v-24208a48>
        </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span>
    <span class="token punctuation" data-v-24208a48>}</span>
<span class="token punctuation" data-v-24208a48>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-24208a48><span class="line-number" data-v-24208a48>1</span><br data-v-24208a48><span class="line-number" data-v-24208a48>2</span><br data-v-24208a48><span class="line-number" data-v-24208a48>3</span><br data-v-24208a48><span class="line-number" data-v-24208a48>4</span><br data-v-24208a48><span class="line-number" data-v-24208a48>5</span><br data-v-24208a48><span class="line-number" data-v-24208a48>6</span><br data-v-24208a48><span class="line-number" data-v-24208a48>7</span><br data-v-24208a48><span class="line-number" data-v-24208a48>8</span><br data-v-24208a48><span class="line-number" data-v-24208a48>9</span><br data-v-24208a48><span class="line-number" data-v-24208a48>10</span><br data-v-24208a48><span class="line-number" data-v-24208a48>11</span><br data-v-24208a48><span class="line-number" data-v-24208a48>12</span><br data-v-24208a48><span class="line-number" data-v-24208a48>13</span><br data-v-24208a48><span class="line-number" data-v-24208a48>14</span><br data-v-24208a48><span class="line-number" data-v-24208a48>15</span><br data-v-24208a48><span class="line-number" data-v-24208a48>16</span><br data-v-24208a48><span class="line-number" data-v-24208a48>17</span><br data-v-24208a48><span class="line-number" data-v-24208a48>18</span><br data-v-24208a48><span class="line-number" data-v-24208a48>19</span><br data-v-24208a48><span class="line-number" data-v-24208a48>20</span><br data-v-24208a48><span class="line-number" data-v-24208a48>21</span><br data-v-24208a48><span class="line-number" data-v-24208a48>22</span><br data-v-24208a48><span class="line-number" data-v-24208a48>23</span><br data-v-24208a48><span class="line-number" data-v-24208a48>24</span><br data-v-24208a48><span class="line-number" data-v-24208a48>25</span><br data-v-24208a48><span class="line-number" data-v-24208a48>26</span><br data-v-24208a48><span class="line-number" data-v-24208a48>27</span><br data-v-24208a48><span class="line-number" data-v-24208a48>28</span><br data-v-24208a48><span class="line-number" data-v-24208a48>29</span><br data-v-24208a48></div></div><p data-v-24208a48>效果：
</p><div style="width:800px;" data-v-24208a48><img src="/vuebloger/img/post/dsfhdfgsdfgsdfgf.gif" alt="" data-v-24208a48></div><p data-v-24208a48></p> <p data-v-24208a48>setTimeout 可以用 window.requestAnimationFrame() 代替，会有更好的渲染效果。 我们demo使用列表做的，实际对于列表来说，最佳方案是虚拟列表，而时间分片，更适合热力图，地图点位比较多的情况。</p> <h3 id="虚拟列表" data-v-24208a48><a href="#虚拟列表" class="header-anchor" data-v-24208a48>#</a> 虚拟列表</h3> <p data-v-24208a48>无论是小程序，或者是h5 ，随着 dom元素越来越多，页面会越来越卡顿,这种情况在小程序更加明显 。虚拟列表是按需显示的一种技术，可以根据用户的滚动，不必渲染所有列表项，而只是渲染可视区域内的一部分列表元素的技术。正常的虚拟列表分为 渲染区，缓冲区 ，虚拟列表区。如下图所示。
</p><div style="width:800px;" data-v-24208a48><img src="/vuebloger/img/post/b07315beeea84d7c82598327e7985ab1_tplv-k3u1fbpfcp-watermark.png" alt="" data-v-24208a48></div>
为了防止大量dom存在影响性能，我们只对，渲染区和缓冲区的数据做渲染，，虚拟列表区 没有真实的dom存在。 缓冲区的作用就是防止快速下滑或者上滑过程中，会有空白的现象。<p data-v-24208a48></p> <p data-v-24208a48>react-tiny-virtual-list 是一个较为轻量的实现虚拟列表的组件。</p> <div class="language-jsx line-numbers-mode" data-v-24208a48><pre class="language-jsx" data-v-24208a48><code data-v-24208a48><span class="token keyword" data-v-24208a48>import</span> React <span class="token keyword" data-v-24208a48>from</span> <span class="token string" data-v-24208a48>'react'</span><span class="token punctuation" data-v-24208a48>;</span>
<span class="token keyword" data-v-24208a48>import</span> <span class="token punctuation" data-v-24208a48>{</span>render<span class="token punctuation" data-v-24208a48>}</span> <span class="token keyword" data-v-24208a48>from</span> <span class="token string" data-v-24208a48>'react-dom'</span><span class="token punctuation" data-v-24208a48>;</span>
<span class="token keyword" data-v-24208a48>import</span> VirtualList <span class="token keyword" data-v-24208a48>from</span> <span class="token string" data-v-24208a48>'react-tiny-virtual-list'</span><span class="token punctuation" data-v-24208a48>;</span>
 
<span class="token keyword" data-v-24208a48>const</span> data <span class="token operator" data-v-24208a48>=</span> <span class="token punctuation" data-v-24208a48>[</span><span class="token string" data-v-24208a48>'A'</span><span class="token punctuation" data-v-24208a48>,</span> <span class="token string" data-v-24208a48>'B'</span><span class="token punctuation" data-v-24208a48>,</span> <span class="token string" data-v-24208a48>'C'</span><span class="token punctuation" data-v-24208a48>,</span> <span class="token string" data-v-24208a48>'D'</span><span class="token punctuation" data-v-24208a48>,</span> <span class="token string" data-v-24208a48>'E'</span><span class="token punctuation" data-v-24208a48>,</span> <span class="token string" data-v-24208a48>'F'</span><span class="token punctuation" data-v-24208a48>,</span> <span class="token operator" data-v-24208a48>...</span><span class="token punctuation" data-v-24208a48>]</span><span class="token punctuation" data-v-24208a48>;</span>
 
<span class="token function" data-v-24208a48>render</span><span class="token punctuation" data-v-24208a48>(</span>
  <span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span><span class="token class-name" data-v-24208a48>VirtualList</span></span>
    <span class="token attr-name" data-v-24208a48>width</span><span class="token attr-value" data-v-24208a48><span class="token punctuation attr-equals" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>'</span>100%<span class="token punctuation" data-v-24208a48>'</span></span>
    <span class="token attr-name" data-v-24208a48>height</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span><span class="token number" data-v-24208a48>600</span><span class="token punctuation" data-v-24208a48>}</span></span>
    <span class="token attr-name" data-v-24208a48>itemCount</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span>data<span class="token punctuation" data-v-24208a48>.</span>length<span class="token punctuation" data-v-24208a48>}</span></span>
    <span class="token attr-name" data-v-24208a48>itemSize</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span><span class="token number" data-v-24208a48>50</span><span class="token punctuation" data-v-24208a48>}</span></span> <span class="token comment" data-v-24208a48>// Also supports variable heights (array or function getter)</span>
    <span class="token attr-name" data-v-24208a48>renderItem</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span><span class="token punctuation" data-v-24208a48>(</span><span class="token parameter" data-v-24208a48><span class="token punctuation" data-v-24208a48>{</span>index<span class="token punctuation" data-v-24208a48>,</span> style<span class="token punctuation" data-v-24208a48>}</span></span><span class="token punctuation" data-v-24208a48>)</span> <span class="token operator" data-v-24208a48>=&gt;</span>
      <span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>div</span> <span class="token attr-name" data-v-24208a48>key</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span>index<span class="token punctuation" data-v-24208a48>}</span></span> <span class="token attr-name" data-v-24208a48>style</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span>style<span class="token punctuation" data-v-24208a48>}</span></span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48> // The style property contains the item's absolute position
        Letter: </span><span class="token punctuation" data-v-24208a48>{</span>data<span class="token punctuation" data-v-24208a48>[</span>index<span class="token punctuation" data-v-24208a48>]</span><span class="token punctuation" data-v-24208a48>}</span><span class="token plain-text" data-v-24208a48>, Row: #</span><span class="token punctuation" data-v-24208a48>{</span>index<span class="token punctuation" data-v-24208a48>}</span><span class="token plain-text" data-v-24208a48>
      </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span>
    <span class="token punctuation" data-v-24208a48>}</span></span>
  <span class="token punctuation" data-v-24208a48>/&gt;</span></span><span class="token punctuation" data-v-24208a48>,</span>
  document<span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>getElementById</span><span class="token punctuation" data-v-24208a48>(</span><span class="token string" data-v-24208a48>'root'</span><span class="token punctuation" data-v-24208a48>)</span>
<span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>;</span>
</code></pre> <div class="line-numbers-wrapper" data-v-24208a48><span class="line-number" data-v-24208a48>1</span><br data-v-24208a48><span class="line-number" data-v-24208a48>2</span><br data-v-24208a48><span class="line-number" data-v-24208a48>3</span><br data-v-24208a48><span class="line-number" data-v-24208a48>4</span><br data-v-24208a48><span class="line-number" data-v-24208a48>5</span><br data-v-24208a48><span class="line-number" data-v-24208a48>6</span><br data-v-24208a48><span class="line-number" data-v-24208a48>7</span><br data-v-24208a48><span class="line-number" data-v-24208a48>8</span><br data-v-24208a48><span class="line-number" data-v-24208a48>9</span><br data-v-24208a48><span class="line-number" data-v-24208a48>10</span><br data-v-24208a48><span class="line-number" data-v-24208a48>11</span><br data-v-24208a48><span class="line-number" data-v-24208a48>12</span><br data-v-24208a48><span class="line-number" data-v-24208a48>13</span><br data-v-24208a48><span class="line-number" data-v-24208a48>14</span><br data-v-24208a48><span class="line-number" data-v-24208a48>15</span><br data-v-24208a48><span class="line-number" data-v-24208a48>16</span><br data-v-24208a48><span class="line-number" data-v-24208a48>17</span><br data-v-24208a48><span class="line-number" data-v-24208a48>18</span><br data-v-24208a48><span class="line-number" data-v-24208a48>19</span><br data-v-24208a48><span class="line-number" data-v-24208a48>20</span><br data-v-24208a48></div></div><p data-v-24208a48>手写一个react虚拟列表</p> <div class="language-jsx line-numbers-mode" data-v-24208a48><pre class="language-jsx" data-v-24208a48><code data-v-24208a48><span class="token keyword" data-v-24208a48>let</span> num  <span class="token operator" data-v-24208a48>=</span> <span class="token number" data-v-24208a48>0</span>
<span class="token keyword" data-v-24208a48>class</span> <span class="token class-name" data-v-24208a48>Index</span> <span class="token keyword" data-v-24208a48>extends</span> <span class="token class-name" data-v-24208a48>React<span class="token punctuation" data-v-24208a48>.</span>Component</span><span class="token operator" data-v-24208a48>&lt;</span>any<span class="token punctuation" data-v-24208a48>,</span> any<span class="token operator" data-v-24208a48>&gt;</span><span class="token punctuation" data-v-24208a48>{</span>
    state <span class="token operator" data-v-24208a48>=</span> <span class="token punctuation" data-v-24208a48>{</span>
        list<span class="token operator" data-v-24208a48>:</span> <span class="token keyword" data-v-24208a48>new</span> <span class="token class-name" data-v-24208a48>Array</span><span class="token punctuation" data-v-24208a48>(</span><span class="token number" data-v-24208a48>9999</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>fill</span><span class="token punctuation" data-v-24208a48>(</span><span class="token number" data-v-24208a48>0</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>map</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span> <span class="token operator" data-v-24208a48>=&gt;</span><span class="token punctuation" data-v-24208a48>{</span> 
            num<span class="token operator" data-v-24208a48>++</span>
            <span class="token keyword" data-v-24208a48>return</span> num
        <span class="token punctuation" data-v-24208a48>}</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>,</span>
        scorllBoxHeight<span class="token operator" data-v-24208a48>:</span> <span class="token number" data-v-24208a48>500</span><span class="token punctuation" data-v-24208a48>,</span> <span class="token comment" data-v-24208a48>/* 容器高度(初始化高度) */</span>
        renderList<span class="token operator" data-v-24208a48>:</span> <span class="token punctuation" data-v-24208a48>[</span><span class="token punctuation" data-v-24208a48>]</span><span class="token punctuation" data-v-24208a48>,</span>       <span class="token comment" data-v-24208a48>/* 渲染列表 */</span>
        itemHeight<span class="token operator" data-v-24208a48>:</span> <span class="token number" data-v-24208a48>60</span><span class="token punctuation" data-v-24208a48>,</span>       <span class="token comment" data-v-24208a48>/* 每一个列表高度 */</span>
        bufferCount<span class="token operator" data-v-24208a48>:</span> <span class="token number" data-v-24208a48>8</span><span class="token punctuation" data-v-24208a48>,</span>       <span class="token comment" data-v-24208a48>/* 缓冲个数 上下四个 */</span>
        renderCount<span class="token operator" data-v-24208a48>:</span> <span class="token number" data-v-24208a48>0</span><span class="token punctuation" data-v-24208a48>,</span>       <span class="token comment" data-v-24208a48>/* 渲染数量 */</span>
        start<span class="token operator" data-v-24208a48>:</span> <span class="token number" data-v-24208a48>0</span><span class="token punctuation" data-v-24208a48>,</span>             <span class="token comment" data-v-24208a48>/* 起始索引 */</span>
        end<span class="token operator" data-v-24208a48>:</span> <span class="token number" data-v-24208a48>0</span>                <span class="token comment" data-v-24208a48>/* 终止索引 */</span>
    <span class="token punctuation" data-v-24208a48>}</span>
    listBox<span class="token operator" data-v-24208a48>:</span> any <span class="token operator" data-v-24208a48>=</span> <span class="token keyword" data-v-24208a48>null</span>
    scrollBox <span class="token operator" data-v-24208a48>:</span> any <span class="token operator" data-v-24208a48>=</span> <span class="token keyword" data-v-24208a48>null</span>
    scrollContent<span class="token operator" data-v-24208a48>:</span>any <span class="token operator" data-v-24208a48>=</span> <span class="token keyword" data-v-24208a48>null</span>
    <span class="token function" data-v-24208a48>componentDidMount</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span> <span class="token punctuation" data-v-24208a48>{</span>
        <span class="token keyword" data-v-24208a48>const</span> <span class="token punctuation" data-v-24208a48>{</span> itemHeight<span class="token punctuation" data-v-24208a48>,</span> bufferCount <span class="token punctuation" data-v-24208a48>}</span> <span class="token operator" data-v-24208a48>=</span> <span class="token keyword" data-v-24208a48>this</span><span class="token punctuation" data-v-24208a48>.</span>state
        <span class="token comment" data-v-24208a48>/* 计算容器高度 */</span>
        <span class="token keyword" data-v-24208a48>const</span> scorllBoxHeight <span class="token operator" data-v-24208a48>=</span> <span class="token keyword" data-v-24208a48>this</span><span class="token punctuation" data-v-24208a48>.</span>listBox<span class="token punctuation" data-v-24208a48>.</span>offsetHeight
        <span class="token keyword" data-v-24208a48>const</span> renderCount <span class="token operator" data-v-24208a48>=</span> Math<span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>ceil</span><span class="token punctuation" data-v-24208a48>(</span>scorllBoxHeight <span class="token operator" data-v-24208a48>/</span> itemHeight<span class="token punctuation" data-v-24208a48>)</span> <span class="token operator" data-v-24208a48>+</span> bufferCount
        <span class="token keyword" data-v-24208a48>const</span> end <span class="token operator" data-v-24208a48>=</span> renderCount <span class="token operator" data-v-24208a48>+</span> <span class="token number" data-v-24208a48>1</span>
        <span class="token keyword" data-v-24208a48>this</span><span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>setState</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>{</span>
            scorllBoxHeight<span class="token punctuation" data-v-24208a48>,</span>
            end<span class="token punctuation" data-v-24208a48>,</span>
            renderCount<span class="token punctuation" data-v-24208a48>,</span>
        <span class="token punctuation" data-v-24208a48>}</span><span class="token punctuation" data-v-24208a48>)</span>
    <span class="token punctuation" data-v-24208a48>}</span>
    <span class="token comment" data-v-24208a48>/* 处理滚动效果 */</span>
    <span class="token function-variable function" data-v-24208a48>handerScroll</span><span class="token operator" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token operator" data-v-24208a48>=&gt;</span><span class="token punctuation" data-v-24208a48>{</span>
        <span class="token keyword" data-v-24208a48>const</span> <span class="token punctuation" data-v-24208a48>{</span> scrollTop <span class="token punctuation" data-v-24208a48>}</span> <span class="token operator" data-v-24208a48>:</span>any <span class="token operator" data-v-24208a48>=</span>  <span class="token keyword" data-v-24208a48>this</span><span class="token punctuation" data-v-24208a48>.</span>scrollBox
        <span class="token keyword" data-v-24208a48>const</span> <span class="token punctuation" data-v-24208a48>{</span> itemHeight <span class="token punctuation" data-v-24208a48>,</span> renderCount <span class="token punctuation" data-v-24208a48>}</span> <span class="token operator" data-v-24208a48>=</span> <span class="token keyword" data-v-24208a48>this</span><span class="token punctuation" data-v-24208a48>.</span>state
        <span class="token keyword" data-v-24208a48>const</span> currentOffset <span class="token operator" data-v-24208a48>=</span> scrollTop <span class="token operator" data-v-24208a48>-</span> <span class="token punctuation" data-v-24208a48>(</span>scrollTop <span class="token operator" data-v-24208a48>%</span> itemHeight<span class="token punctuation" data-v-24208a48>)</span>
        <span class="token comment" data-v-24208a48>/* translate3d 开启css cpu 加速 */</span>
        <span class="token keyword" data-v-24208a48>this</span><span class="token punctuation" data-v-24208a48>.</span>scrollContent<span class="token punctuation" data-v-24208a48>.</span>style<span class="token punctuation" data-v-24208a48>.</span>transform <span class="token operator" data-v-24208a48>=</span> <span class="token template-string" data-v-24208a48><span class="token template-punctuation string" data-v-24208a48>`</span><span class="token string" data-v-24208a48>translate3d(0, </span><span class="token interpolation" data-v-24208a48><span class="token interpolation-punctuation punctuation" data-v-24208a48>${</span>currentOffset<span class="token interpolation-punctuation punctuation" data-v-24208a48>}</span></span><span class="token string" data-v-24208a48>px, 0)</span><span class="token template-punctuation string" data-v-24208a48>`</span></span>
        <span class="token keyword" data-v-24208a48>const</span> start <span class="token operator" data-v-24208a48>=</span> Math<span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>floor</span><span class="token punctuation" data-v-24208a48>(</span>scrollTop <span class="token operator" data-v-24208a48>/</span> itemHeight<span class="token punctuation" data-v-24208a48>)</span>
        <span class="token keyword" data-v-24208a48>const</span> end <span class="token operator" data-v-24208a48>=</span> Math<span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>floor</span><span class="token punctuation" data-v-24208a48>(</span>scrollTop <span class="token operator" data-v-24208a48>/</span> itemHeight <span class="token operator" data-v-24208a48>+</span> renderCount <span class="token operator" data-v-24208a48>+</span> <span class="token number" data-v-24208a48>1</span><span class="token punctuation" data-v-24208a48>)</span>
        <span class="token keyword" data-v-24208a48>this</span><span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>setState</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>{</span>
            start<span class="token punctuation" data-v-24208a48>,</span>
            end<span class="token punctuation" data-v-24208a48>,</span>
       <span class="token punctuation" data-v-24208a48>}</span><span class="token punctuation" data-v-24208a48>)</span>
    <span class="token punctuation" data-v-24208a48>}</span>
     <span class="token comment" data-v-24208a48>/* 性能优化：只有在列表start 和 end 改变的时候在渲染列表 */</span>
    <span class="token function" data-v-24208a48>shouldComponentUpdate</span><span class="token punctuation" data-v-24208a48>(</span><span class="token parameter" data-v-24208a48>_nextProps<span class="token punctuation" data-v-24208a48>,</span> _nextState</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>{</span>
        <span class="token keyword" data-v-24208a48>const</span> <span class="token punctuation" data-v-24208a48>{</span> start <span class="token punctuation" data-v-24208a48>,</span> end <span class="token punctuation" data-v-24208a48>}</span> <span class="token operator" data-v-24208a48>=</span> _nextState
        <span class="token keyword" data-v-24208a48>return</span> start <span class="token operator" data-v-24208a48>!==</span> <span class="token keyword" data-v-24208a48>this</span><span class="token punctuation" data-v-24208a48>.</span>state<span class="token punctuation" data-v-24208a48>.</span>start <span class="token operator" data-v-24208a48>||</span> end <span class="token operator" data-v-24208a48>!==</span><span class="token keyword" data-v-24208a48>this</span><span class="token punctuation" data-v-24208a48>.</span>state<span class="token punctuation" data-v-24208a48>.</span>end 
    <span class="token punctuation" data-v-24208a48>}</span>
    <span class="token comment" data-v-24208a48>/* 处理滚动效果 */</span>
    <span class="token function" data-v-24208a48>render</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span> <span class="token punctuation" data-v-24208a48>{</span>
        console<span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>log</span><span class="token punctuation" data-v-24208a48>(</span><span class="token number" data-v-24208a48>1111</span><span class="token punctuation" data-v-24208a48>)</span>
        <span class="token keyword" data-v-24208a48>const</span> <span class="token punctuation" data-v-24208a48>{</span> list<span class="token punctuation" data-v-24208a48>,</span> scorllBoxHeight<span class="token punctuation" data-v-24208a48>,</span> itemHeight <span class="token punctuation" data-v-24208a48>,</span>start <span class="token punctuation" data-v-24208a48>,</span>end <span class="token punctuation" data-v-24208a48>}</span> <span class="token operator" data-v-24208a48>=</span> <span class="token keyword" data-v-24208a48>this</span><span class="token punctuation" data-v-24208a48>.</span>state
        <span class="token keyword" data-v-24208a48>const</span> renderList <span class="token operator" data-v-24208a48>=</span> list<span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>slice</span><span class="token punctuation" data-v-24208a48>(</span>start<span class="token punctuation" data-v-24208a48>,</span>end<span class="token punctuation" data-v-24208a48>)</span>
        <span class="token keyword" data-v-24208a48>return</span> <span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>div</span> <span class="token attr-name" data-v-24208a48>className</span><span class="token attr-value" data-v-24208a48><span class="token punctuation attr-equals" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>&quot;</span>list_box<span class="token punctuation" data-v-24208a48>&quot;</span></span>
            <span class="token attr-name" data-v-24208a48>ref</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span><span class="token punctuation" data-v-24208a48>(</span><span class="token parameter" data-v-24208a48>node</span><span class="token punctuation" data-v-24208a48>)</span> <span class="token operator" data-v-24208a48>=&gt;</span> <span class="token keyword" data-v-24208a48>this</span><span class="token punctuation" data-v-24208a48>.</span>listBox <span class="token operator" data-v-24208a48>=</span> node<span class="token punctuation" data-v-24208a48>}</span></span>
        <span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>   
            </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>div</span>  
               <span class="token attr-name" data-v-24208a48>style</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span><span class="token punctuation" data-v-24208a48>{</span> height<span class="token operator" data-v-24208a48>:</span> scorllBoxHeight<span class="token punctuation" data-v-24208a48>,</span> overflow<span class="token operator" data-v-24208a48>:</span> <span class="token string" data-v-24208a48>'scroll'</span><span class="token punctuation" data-v-24208a48>,</span> position<span class="token operator" data-v-24208a48>:</span> <span class="token string" data-v-24208a48>'relative'</span> <span class="token punctuation" data-v-24208a48>}</span><span class="token punctuation" data-v-24208a48>}</span></span>  
               <span class="token attr-name" data-v-24208a48>ref</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span> <span class="token punctuation" data-v-24208a48>(</span><span class="token parameter" data-v-24208a48>node</span><span class="token punctuation" data-v-24208a48>)</span><span class="token operator" data-v-24208a48>=&gt;</span> <span class="token keyword" data-v-24208a48>this</span><span class="token punctuation" data-v-24208a48>.</span>scrollBox <span class="token operator" data-v-24208a48>=</span> node <span class="token punctuation" data-v-24208a48>}</span></span>
               <span class="token attr-name" data-v-24208a48>onScroll</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span> <span class="token keyword" data-v-24208a48>this</span><span class="token punctuation" data-v-24208a48>.</span>handerScroll <span class="token punctuation" data-v-24208a48>}</span></span>   
            <span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
                </span><span class="token punctuation" data-v-24208a48>{</span> <span class="token comment" data-v-24208a48>/* 占位作用 */</span><span class="token punctuation" data-v-24208a48>}</span><span class="token plain-text" data-v-24208a48>
                </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>div</span> <span class="token attr-name" data-v-24208a48>style</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span><span class="token punctuation" data-v-24208a48>{</span> height<span class="token operator" data-v-24208a48>:</span> <span class="token template-string" data-v-24208a48><span class="token template-punctuation string" data-v-24208a48>`</span><span class="token interpolation" data-v-24208a48><span class="token interpolation-punctuation punctuation" data-v-24208a48>${</span>list<span class="token punctuation" data-v-24208a48>.</span>length <span class="token operator" data-v-24208a48>*</span> itemHeight<span class="token interpolation-punctuation punctuation" data-v-24208a48>}</span></span><span class="token string" data-v-24208a48>px</span><span class="token template-punctuation string" data-v-24208a48>`</span></span><span class="token punctuation" data-v-24208a48>,</span> position<span class="token operator" data-v-24208a48>:</span> <span class="token string" data-v-24208a48>'absolute'</span><span class="token punctuation" data-v-24208a48>,</span> left<span class="token operator" data-v-24208a48>:</span> <span class="token number" data-v-24208a48>0</span><span class="token punctuation" data-v-24208a48>,</span> top<span class="token operator" data-v-24208a48>:</span> <span class="token number" data-v-24208a48>0</span><span class="token punctuation" data-v-24208a48>,</span> right<span class="token operator" data-v-24208a48>:</span> <span class="token number" data-v-24208a48>0</span> <span class="token punctuation" data-v-24208a48>}</span><span class="token punctuation" data-v-24208a48>}</span></span> <span class="token punctuation" data-v-24208a48>/&gt;</span></span><span class="token plain-text" data-v-24208a48>
                </span><span class="token punctuation" data-v-24208a48>{</span> <span class="token comment" data-v-24208a48>/* 显然区 */</span> <span class="token punctuation" data-v-24208a48>}</span><span class="token plain-text" data-v-24208a48>
                </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>div</span> <span class="token attr-name" data-v-24208a48>ref</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span><span class="token punctuation" data-v-24208a48>(</span><span class="token parameter" data-v-24208a48>node</span><span class="token punctuation" data-v-24208a48>)</span> <span class="token operator" data-v-24208a48>=&gt;</span> <span class="token keyword" data-v-24208a48>this</span><span class="token punctuation" data-v-24208a48>.</span>scrollContent <span class="token operator" data-v-24208a48>=</span> node<span class="token punctuation" data-v-24208a48>}</span></span> <span class="token attr-name" data-v-24208a48>style</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span><span class="token punctuation" data-v-24208a48>{</span> position<span class="token operator" data-v-24208a48>:</span> <span class="token string" data-v-24208a48>'relative'</span><span class="token punctuation" data-v-24208a48>,</span> left<span class="token operator" data-v-24208a48>:</span> <span class="token number" data-v-24208a48>0</span><span class="token punctuation" data-v-24208a48>,</span> top<span class="token operator" data-v-24208a48>:</span> <span class="token number" data-v-24208a48>0</span><span class="token punctuation" data-v-24208a48>,</span> right<span class="token operator" data-v-24208a48>:</span> <span class="token number" data-v-24208a48>0</span> <span class="token punctuation" data-v-24208a48>}</span><span class="token punctuation" data-v-24208a48>}</span></span> <span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
                    </span><span class="token punctuation" data-v-24208a48>{</span>
                        renderList<span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>map</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>(</span><span class="token parameter" data-v-24208a48>item<span class="token punctuation" data-v-24208a48>,</span> index</span><span class="token punctuation" data-v-24208a48>)</span> <span class="token operator" data-v-24208a48>=&gt;</span> <span class="token punctuation" data-v-24208a48>(</span>
                            <span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>div</span> <span class="token attr-name" data-v-24208a48>className</span><span class="token attr-value" data-v-24208a48><span class="token punctuation attr-equals" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>&quot;</span>list<span class="token punctuation" data-v-24208a48>&quot;</span></span> <span class="token attr-name" data-v-24208a48>key</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span>index<span class="token punctuation" data-v-24208a48>}</span></span> <span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
                                </span><span class="token punctuation" data-v-24208a48>{</span>item <span class="token operator" data-v-24208a48>+</span> <span class="token string" data-v-24208a48>''</span> <span class="token punctuation" data-v-24208a48>}</span><span class="token plain-text" data-v-24208a48> Item
                            </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span>
                        <span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>)</span>
                    <span class="token punctuation" data-v-24208a48>}</span><span class="token plain-text" data-v-24208a48>
                </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
            </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>

        </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span>
    <span class="token punctuation" data-v-24208a48>}</span>
<span class="token punctuation" data-v-24208a48>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-24208a48><span class="line-number" data-v-24208a48>1</span><br data-v-24208a48><span class="line-number" data-v-24208a48>2</span><br data-v-24208a48><span class="line-number" data-v-24208a48>3</span><br data-v-24208a48><span class="line-number" data-v-24208a48>4</span><br data-v-24208a48><span class="line-number" data-v-24208a48>5</span><br data-v-24208a48><span class="line-number" data-v-24208a48>6</span><br data-v-24208a48><span class="line-number" data-v-24208a48>7</span><br data-v-24208a48><span class="line-number" data-v-24208a48>8</span><br data-v-24208a48><span class="line-number" data-v-24208a48>9</span><br data-v-24208a48><span class="line-number" data-v-24208a48>10</span><br data-v-24208a48><span class="line-number" data-v-24208a48>11</span><br data-v-24208a48><span class="line-number" data-v-24208a48>12</span><br data-v-24208a48><span class="line-number" data-v-24208a48>13</span><br data-v-24208a48><span class="line-number" data-v-24208a48>14</span><br data-v-24208a48><span class="line-number" data-v-24208a48>15</span><br data-v-24208a48><span class="line-number" data-v-24208a48>16</span><br data-v-24208a48><span class="line-number" data-v-24208a48>17</span><br data-v-24208a48><span class="line-number" data-v-24208a48>18</span><br data-v-24208a48><span class="line-number" data-v-24208a48>19</span><br data-v-24208a48><span class="line-number" data-v-24208a48>20</span><br data-v-24208a48><span class="line-number" data-v-24208a48>21</span><br data-v-24208a48><span class="line-number" data-v-24208a48>22</span><br data-v-24208a48><span class="line-number" data-v-24208a48>23</span><br data-v-24208a48><span class="line-number" data-v-24208a48>24</span><br data-v-24208a48><span class="line-number" data-v-24208a48>25</span><br data-v-24208a48><span class="line-number" data-v-24208a48>26</span><br data-v-24208a48><span class="line-number" data-v-24208a48>27</span><br data-v-24208a48><span class="line-number" data-v-24208a48>28</span><br data-v-24208a48><span class="line-number" data-v-24208a48>29</span><br data-v-24208a48><span class="line-number" data-v-24208a48>30</span><br data-v-24208a48><span class="line-number" data-v-24208a48>31</span><br data-v-24208a48><span class="line-number" data-v-24208a48>32</span><br data-v-24208a48><span class="line-number" data-v-24208a48>33</span><br data-v-24208a48><span class="line-number" data-v-24208a48>34</span><br data-v-24208a48><span class="line-number" data-v-24208a48>35</span><br data-v-24208a48><span class="line-number" data-v-24208a48>36</span><br data-v-24208a48><span class="line-number" data-v-24208a48>37</span><br data-v-24208a48><span class="line-number" data-v-24208a48>38</span><br data-v-24208a48><span class="line-number" data-v-24208a48>39</span><br data-v-24208a48><span class="line-number" data-v-24208a48>40</span><br data-v-24208a48><span class="line-number" data-v-24208a48>41</span><br data-v-24208a48><span class="line-number" data-v-24208a48>42</span><br data-v-24208a48><span class="line-number" data-v-24208a48>43</span><br data-v-24208a48><span class="line-number" data-v-24208a48>44</span><br data-v-24208a48><span class="line-number" data-v-24208a48>45</span><br data-v-24208a48><span class="line-number" data-v-24208a48>46</span><br data-v-24208a48><span class="line-number" data-v-24208a48>47</span><br data-v-24208a48><span class="line-number" data-v-24208a48>48</span><br data-v-24208a48><span class="line-number" data-v-24208a48>49</span><br data-v-24208a48><span class="line-number" data-v-24208a48>50</span><br data-v-24208a48><span class="line-number" data-v-24208a48>51</span><br data-v-24208a48><span class="line-number" data-v-24208a48>52</span><br data-v-24208a48><span class="line-number" data-v-24208a48>53</span><br data-v-24208a48><span class="line-number" data-v-24208a48>54</span><br data-v-24208a48><span class="line-number" data-v-24208a48>55</span><br data-v-24208a48><span class="line-number" data-v-24208a48>56</span><br data-v-24208a48><span class="line-number" data-v-24208a48>57</span><br data-v-24208a48><span class="line-number" data-v-24208a48>58</span><br data-v-24208a48><span class="line-number" data-v-24208a48>59</span><br data-v-24208a48><span class="line-number" data-v-24208a48>60</span><br data-v-24208a48><span class="line-number" data-v-24208a48>61</span><br data-v-24208a48><span class="line-number" data-v-24208a48>62</span><br data-v-24208a48><span class="line-number" data-v-24208a48>63</span><br data-v-24208a48><span class="line-number" data-v-24208a48>64</span><br data-v-24208a48><span class="line-number" data-v-24208a48>65</span><br data-v-24208a48><span class="line-number" data-v-24208a48>66</span><br data-v-24208a48><span class="line-number" data-v-24208a48>67</span><br data-v-24208a48><span class="line-number" data-v-24208a48>68</span><br data-v-24208a48><span class="line-number" data-v-24208a48>69</span><br data-v-24208a48><span class="line-number" data-v-24208a48>70</span><br data-v-24208a48><span class="line-number" data-v-24208a48>71</span><br data-v-24208a48><span class="line-number" data-v-24208a48>72</span><br data-v-24208a48><span class="line-number" data-v-24208a48>73</span><br data-v-24208a48><span class="line-number" data-v-24208a48>74</span><br data-v-24208a48><span class="line-number" data-v-24208a48>75</span><br data-v-24208a48><span class="line-number" data-v-24208a48>76</span><br data-v-24208a48><span class="line-number" data-v-24208a48>77</span><br data-v-24208a48><span class="line-number" data-v-24208a48>78</span><br data-v-24208a48><span class="line-number" data-v-24208a48>79</span><br data-v-24208a48></div></div><p data-v-24208a48>效果:</p> <p data-v-24208a48><img src="/vuebloger/img/post/shfgsdfhfgdhdtg.gif" alt="" data-v-24208a48></p> <p data-v-24208a48>具体思路:</p> <ol data-v-24208a48><li data-v-24208a48>初始化计算容器的高度。截取初始化列表长度。这里我们需要div占位,撑起滚动条。</li> <li data-v-24208a48>通过监听滚动容器的 onScroll事件,根据 scrollTop 来计算渲染区域向上偏移量, 我们要注意的是，当我们向下滑动的时候，为了渲染区域，能在可视区域内，可视区域要向上的滚动; 我们向上滑动的时候，可视区域要向下的滚动。</li> <li data-v-24208a48>通过重新计算的 end 和 start 来重新渲染列表。</li></ol> <p data-v-24208a48>性能优化点:</p> <ol data-v-24208a48><li data-v-24208a48>对于移动视图区域，我们可以用 transform 来代替改变 top值。</li> <li data-v-24208a48>虚拟列表实际情况，是有 start 或者 end 改变的时候，在重新渲染列表，所以我们可以用之前 shouldComponentUpdate 来调优，避免重复渲染。</li></ol> <h2 id="usememo-usecallback" data-v-24208a48><a href="#usememo-usecallback" class="header-anchor" data-v-24208a48>#</a> useMemo/useCallback</h2> <p data-v-24208a48>react中的性能优化。在hooks诞生之前，如果组件包含内部state，我们都是基于class的形式来创建组件。当时我们也知道，react中，性能的优化点在于：</p> <ul data-v-24208a48><li data-v-24208a48>调用setState，就会触发组件的重新渲染，无论前后的state是否不同</li> <li data-v-24208a48>父组件更新，子组件也会自动的更新</li></ul> <p data-v-24208a48>基于上面的两点，我们通常的解决方案是：使用immutable进行比较，在不相等的时候调用setState；在shouldComponentUpdate中判断前后的props和state，如果没有变化，则返回false来阻止更新。</p> <p data-v-24208a48>在hooks出来之后，我们能够使用function的形式来创建包含内部state的组件。但是，使用function的形式，失去了上面的shouldComponentUpdate，我们无法通过判断前后状态来决定是否更新。而且，在函数组件中，react不再区分mount和update两个状态，这意味着函数组件的每一次调用都会执行其内部的所有逻辑，那么会带来较大的性能损耗。因此useMemo 和useCallback就是解决性能问题的杀手锏。</p> <p data-v-24208a48>useCallback和useMemo的参数跟useEffect一致，他们之间最大的区别有是useEffect会用于处理副作用，而前两个hooks不能。
useMemo和useCallback都会在组件第一次渲染的时候执行，之后会在其依赖的变量发生改变时再次执行；并且这两个hooks都返回缓存的值，useMemo返回缓存的变量，useCallback返回缓存的函数。</p> <h3 id="usememo" data-v-24208a48><a href="#usememo" class="header-anchor" data-v-24208a48>#</a> useMemo</h3> <div class="language-jsx line-numbers-mode" data-v-24208a48><pre class="language-jsx" data-v-24208a48><code data-v-24208a48><span class="token keyword" data-v-24208a48>import</span> React <span class="token keyword" data-v-24208a48>from</span> <span class="token string" data-v-24208a48>'react'</span><span class="token punctuation" data-v-24208a48>;</span>
 
<span class="token keyword" data-v-24208a48>export</span> <span class="token keyword" data-v-24208a48>default</span> <span class="token keyword" data-v-24208a48>function</span> <span class="token function" data-v-24208a48>WithoutMemo</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span> <span class="token punctuation" data-v-24208a48>{</span>
    <span class="token keyword" data-v-24208a48>const</span> <span class="token punctuation" data-v-24208a48>[</span>count<span class="token punctuation" data-v-24208a48>,</span> setCount<span class="token punctuation" data-v-24208a48>]</span> <span class="token operator" data-v-24208a48>=</span> <span class="token function" data-v-24208a48>useState</span><span class="token punctuation" data-v-24208a48>(</span><span class="token number" data-v-24208a48>1</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>;</span>
    <span class="token keyword" data-v-24208a48>const</span> <span class="token punctuation" data-v-24208a48>[</span>val<span class="token punctuation" data-v-24208a48>,</span> setValue<span class="token punctuation" data-v-24208a48>]</span> <span class="token operator" data-v-24208a48>=</span> <span class="token function" data-v-24208a48>useState</span><span class="token punctuation" data-v-24208a48>(</span><span class="token string" data-v-24208a48>''</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>;</span>
 
    <span class="token keyword" data-v-24208a48>function</span> <span class="token function" data-v-24208a48>expensive</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span> <span class="token punctuation" data-v-24208a48>{</span>
        console<span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>log</span><span class="token punctuation" data-v-24208a48>(</span><span class="token string" data-v-24208a48>'compute'</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>;</span>
        <span class="token keyword" data-v-24208a48>let</span> sum <span class="token operator" data-v-24208a48>=</span> <span class="token number" data-v-24208a48>0</span><span class="token punctuation" data-v-24208a48>;</span>
        <span class="token keyword" data-v-24208a48>for</span> <span class="token punctuation" data-v-24208a48>(</span><span class="token keyword" data-v-24208a48>let</span> i <span class="token operator" data-v-24208a48>=</span> <span class="token number" data-v-24208a48>0</span><span class="token punctuation" data-v-24208a48>;</span> i <span class="token operator" data-v-24208a48>&lt;</span> count <span class="token operator" data-v-24208a48>*</span> <span class="token number" data-v-24208a48>100</span><span class="token punctuation" data-v-24208a48>;</span> i<span class="token operator" data-v-24208a48>++</span><span class="token punctuation" data-v-24208a48>)</span> <span class="token punctuation" data-v-24208a48>{</span>
            sum <span class="token operator" data-v-24208a48>+=</span> i<span class="token punctuation" data-v-24208a48>;</span>
        <span class="token punctuation" data-v-24208a48>}</span>
        <span class="token keyword" data-v-24208a48>return</span> sum<span class="token punctuation" data-v-24208a48>;</span>
    <span class="token punctuation" data-v-24208a48>}</span>
 
    <span class="token keyword" data-v-24208a48>return</span> <span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
        </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>h4</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token punctuation" data-v-24208a48>{</span>count<span class="token punctuation" data-v-24208a48>}</span><span class="token plain-text" data-v-24208a48>-</span><span class="token punctuation" data-v-24208a48>{</span>val<span class="token punctuation" data-v-24208a48>}</span><span class="token plain-text" data-v-24208a48>-</span><span class="token punctuation" data-v-24208a48>{</span><span class="token function" data-v-24208a48>expensive</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>}</span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>h4</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
        </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
            </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>button</span> <span class="token attr-name" data-v-24208a48>onClick</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span> <span class="token operator" data-v-24208a48>=&gt;</span> <span class="token function" data-v-24208a48>setCount</span><span class="token punctuation" data-v-24208a48>(</span>count <span class="token operator" data-v-24208a48>+</span> <span class="token number" data-v-24208a48>1</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>}</span></span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>+c1</span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>button</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
            </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>input</span> <span class="token attr-name" data-v-24208a48>value</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span>val<span class="token punctuation" data-v-24208a48>}</span></span> <span class="token attr-name" data-v-24208a48>onChange</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span><span class="token parameter" data-v-24208a48>event</span> <span class="token operator" data-v-24208a48>=&gt;</span> <span class="token function" data-v-24208a48>setValue</span><span class="token punctuation" data-v-24208a48>(</span>event<span class="token punctuation" data-v-24208a48>.</span>target<span class="token punctuation" data-v-24208a48>.</span>value<span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>}</span></span><span class="token punctuation" data-v-24208a48>/&gt;</span></span><span class="token plain-text" data-v-24208a48>
        </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
    </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token punctuation" data-v-24208a48>;</span>
<span class="token punctuation" data-v-24208a48>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-24208a48><span class="line-number" data-v-24208a48>1</span><br data-v-24208a48><span class="line-number" data-v-24208a48>2</span><br data-v-24208a48><span class="line-number" data-v-24208a48>3</span><br data-v-24208a48><span class="line-number" data-v-24208a48>4</span><br data-v-24208a48><span class="line-number" data-v-24208a48>5</span><br data-v-24208a48><span class="line-number" data-v-24208a48>6</span><br data-v-24208a48><span class="line-number" data-v-24208a48>7</span><br data-v-24208a48><span class="line-number" data-v-24208a48>8</span><br data-v-24208a48><span class="line-number" data-v-24208a48>9</span><br data-v-24208a48><span class="line-number" data-v-24208a48>10</span><br data-v-24208a48><span class="line-number" data-v-24208a48>11</span><br data-v-24208a48><span class="line-number" data-v-24208a48>12</span><br data-v-24208a48><span class="line-number" data-v-24208a48>13</span><br data-v-24208a48><span class="line-number" data-v-24208a48>14</span><br data-v-24208a48><span class="line-number" data-v-24208a48>15</span><br data-v-24208a48><span class="line-number" data-v-24208a48>16</span><br data-v-24208a48><span class="line-number" data-v-24208a48>17</span><br data-v-24208a48><span class="line-number" data-v-24208a48>18</span><br data-v-24208a48><span class="line-number" data-v-24208a48>19</span><br data-v-24208a48><span class="line-number" data-v-24208a48>20</span><br data-v-24208a48><span class="line-number" data-v-24208a48>21</span><br data-v-24208a48><span class="line-number" data-v-24208a48>22</span><br data-v-24208a48><span class="line-number" data-v-24208a48>23</span><br data-v-24208a48></div></div><p data-v-24208a48>这里创建了两个state，然后通过expensive函数，执行一次昂贵的计算，拿到count对应的某个值。我们可以看到：无论是修改count还是val，由于组件的重新渲染，都会触发expensive的执行(能够在控制台看到，即使修改val，也会打印)；但是这里的昂贵计算只依赖于count的值，在val修改的时候，是没有必要再次计算的。在这种情况下，我们就可以使用useMemo，只在count的值修改时，执行expensive计算：</p> <div class="language-jsx line-numbers-mode" data-v-24208a48><pre class="language-jsx" data-v-24208a48><code data-v-24208a48><span class="token keyword" data-v-24208a48>export</span> <span class="token keyword" data-v-24208a48>default</span> <span class="token keyword" data-v-24208a48>function</span> <span class="token function" data-v-24208a48>WithMemo</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span> <span class="token punctuation" data-v-24208a48>{</span>
    <span class="token keyword" data-v-24208a48>const</span> <span class="token punctuation" data-v-24208a48>[</span>count<span class="token punctuation" data-v-24208a48>,</span> setCount<span class="token punctuation" data-v-24208a48>]</span> <span class="token operator" data-v-24208a48>=</span> <span class="token function" data-v-24208a48>useState</span><span class="token punctuation" data-v-24208a48>(</span><span class="token number" data-v-24208a48>1</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>;</span>
    <span class="token keyword" data-v-24208a48>const</span> <span class="token punctuation" data-v-24208a48>[</span>val<span class="token punctuation" data-v-24208a48>,</span> setValue<span class="token punctuation" data-v-24208a48>]</span> <span class="token operator" data-v-24208a48>=</span> <span class="token function" data-v-24208a48>useState</span><span class="token punctuation" data-v-24208a48>(</span><span class="token string" data-v-24208a48>''</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>;</span>
    <span class="token keyword" data-v-24208a48>const</span> expensive <span class="token operator" data-v-24208a48>=</span> <span class="token function" data-v-24208a48>useMemo</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span> <span class="token operator" data-v-24208a48>=&gt;</span> <span class="token punctuation" data-v-24208a48>{</span>
        console<span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>log</span><span class="token punctuation" data-v-24208a48>(</span><span class="token string" data-v-24208a48>'compute'</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>;</span>
        <span class="token keyword" data-v-24208a48>let</span> sum <span class="token operator" data-v-24208a48>=</span> <span class="token number" data-v-24208a48>0</span><span class="token punctuation" data-v-24208a48>;</span>
        <span class="token keyword" data-v-24208a48>for</span> <span class="token punctuation" data-v-24208a48>(</span><span class="token keyword" data-v-24208a48>let</span> i <span class="token operator" data-v-24208a48>=</span> <span class="token number" data-v-24208a48>0</span><span class="token punctuation" data-v-24208a48>;</span> i <span class="token operator" data-v-24208a48>&lt;</span> count <span class="token operator" data-v-24208a48>*</span> <span class="token number" data-v-24208a48>100</span><span class="token punctuation" data-v-24208a48>;</span> i<span class="token operator" data-v-24208a48>++</span><span class="token punctuation" data-v-24208a48>)</span> <span class="token punctuation" data-v-24208a48>{</span>
            sum <span class="token operator" data-v-24208a48>+=</span> i<span class="token punctuation" data-v-24208a48>;</span>
        <span class="token punctuation" data-v-24208a48>}</span>
        <span class="token keyword" data-v-24208a48>return</span> sum<span class="token punctuation" data-v-24208a48>;</span>
    <span class="token punctuation" data-v-24208a48>}</span><span class="token punctuation" data-v-24208a48>,</span> <span class="token punctuation" data-v-24208a48>[</span>count<span class="token punctuation" data-v-24208a48>]</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>;</span>
 
    <span class="token keyword" data-v-24208a48>return</span> <span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
        </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>h4</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token punctuation" data-v-24208a48>{</span>count<span class="token punctuation" data-v-24208a48>}</span><span class="token plain-text" data-v-24208a48>-</span><span class="token punctuation" data-v-24208a48>{</span>expensive<span class="token punctuation" data-v-24208a48>}</span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>h4</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
        </span><span class="token punctuation" data-v-24208a48>{</span>val<span class="token punctuation" data-v-24208a48>}</span><span class="token plain-text" data-v-24208a48>
        </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
            </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>button</span> <span class="token attr-name" data-v-24208a48>onClick</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span> <span class="token operator" data-v-24208a48>=&gt;</span> <span class="token function" data-v-24208a48>setCount</span><span class="token punctuation" data-v-24208a48>(</span>count <span class="token operator" data-v-24208a48>+</span> <span class="token number" data-v-24208a48>1</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>}</span></span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>+c1</span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>button</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
            </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>input</span> <span class="token attr-name" data-v-24208a48>value</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span>val<span class="token punctuation" data-v-24208a48>}</span></span> <span class="token attr-name" data-v-24208a48>onChange</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span><span class="token parameter" data-v-24208a48>event</span> <span class="token operator" data-v-24208a48>=&gt;</span> <span class="token function" data-v-24208a48>setValue</span><span class="token punctuation" data-v-24208a48>(</span>event<span class="token punctuation" data-v-24208a48>.</span>target<span class="token punctuation" data-v-24208a48>.</span>value<span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>}</span></span><span class="token punctuation" data-v-24208a48>/&gt;</span></span><span class="token plain-text" data-v-24208a48>
        </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
    </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token punctuation" data-v-24208a48>;</span>
<span class="token punctuation" data-v-24208a48>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-24208a48><span class="line-number" data-v-24208a48>1</span><br data-v-24208a48><span class="line-number" data-v-24208a48>2</span><br data-v-24208a48><span class="line-number" data-v-24208a48>3</span><br data-v-24208a48><span class="line-number" data-v-24208a48>4</span><br data-v-24208a48><span class="line-number" data-v-24208a48>5</span><br data-v-24208a48><span class="line-number" data-v-24208a48>6</span><br data-v-24208a48><span class="line-number" data-v-24208a48>7</span><br data-v-24208a48><span class="line-number" data-v-24208a48>8</span><br data-v-24208a48><span class="line-number" data-v-24208a48>9</span><br data-v-24208a48><span class="line-number" data-v-24208a48>10</span><br data-v-24208a48><span class="line-number" data-v-24208a48>11</span><br data-v-24208a48><span class="line-number" data-v-24208a48>12</span><br data-v-24208a48><span class="line-number" data-v-24208a48>13</span><br data-v-24208a48><span class="line-number" data-v-24208a48>14</span><br data-v-24208a48><span class="line-number" data-v-24208a48>15</span><br data-v-24208a48><span class="line-number" data-v-24208a48>16</span><br data-v-24208a48><span class="line-number" data-v-24208a48>17</span><br data-v-24208a48><span class="line-number" data-v-24208a48>18</span><br data-v-24208a48><span class="line-number" data-v-24208a48>19</span><br data-v-24208a48><span class="line-number" data-v-24208a48>20</span><br data-v-24208a48><span class="line-number" data-v-24208a48>21</span><br data-v-24208a48></div></div><p data-v-24208a48>上面我们可以看到，使用useMemo来执行昂贵的计算，然后将计算值返回，并且将count作为依赖值传递进去。这样，就只会在count改变的时候触发expensive执行，在修改val的时候，返回上一次缓存的值。</p> <h3 id="usecallback" data-v-24208a48><a href="#usecallback" class="header-anchor" data-v-24208a48>#</a> useCallback</h3> <p data-v-24208a48>讲完了useMemo，接下来是useCallback。useCallback跟useMemo比较类似，但它返回的是缓存的函数。useCallback会将我们传递给它的函数fnB返回，并且将这个结果缓存；当依赖a变更时，会返回新的函数。既然返回的是函数，我们无法很好的判断返回的函数是否变更，所以我们可以借助ES6新增的数据类型Set来判断，具体如下：</p> <div class="language-jsx line-numbers-mode" data-v-24208a48><pre class="language-jsx" data-v-24208a48><code data-v-24208a48><span class="token keyword" data-v-24208a48>import</span> React<span class="token punctuation" data-v-24208a48>,</span> <span class="token punctuation" data-v-24208a48>{</span> useState<span class="token punctuation" data-v-24208a48>,</span> useCallback <span class="token punctuation" data-v-24208a48>}</span> <span class="token keyword" data-v-24208a48>from</span> <span class="token string" data-v-24208a48>'react'</span><span class="token punctuation" data-v-24208a48>;</span>
<span class="token keyword" data-v-24208a48>const</span> set <span class="token operator" data-v-24208a48>=</span> <span class="token keyword" data-v-24208a48>new</span> <span class="token class-name" data-v-24208a48>Set</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>;</span>
<span class="token keyword" data-v-24208a48>export</span> <span class="token keyword" data-v-24208a48>default</span> <span class="token keyword" data-v-24208a48>function</span> <span class="token function" data-v-24208a48>Callback</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span> <span class="token punctuation" data-v-24208a48>{</span>
    <span class="token keyword" data-v-24208a48>const</span> <span class="token punctuation" data-v-24208a48>[</span>count<span class="token punctuation" data-v-24208a48>,</span> setCount<span class="token punctuation" data-v-24208a48>]</span> <span class="token operator" data-v-24208a48>=</span> <span class="token function" data-v-24208a48>useState</span><span class="token punctuation" data-v-24208a48>(</span><span class="token number" data-v-24208a48>1</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>;</span>
    <span class="token keyword" data-v-24208a48>const</span> <span class="token punctuation" data-v-24208a48>[</span>val<span class="token punctuation" data-v-24208a48>,</span> setVal<span class="token punctuation" data-v-24208a48>]</span> <span class="token operator" data-v-24208a48>=</span> <span class="token function" data-v-24208a48>useState</span><span class="token punctuation" data-v-24208a48>(</span><span class="token string" data-v-24208a48>''</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>;</span>
 
    <span class="token keyword" data-v-24208a48>const</span> callback <span class="token operator" data-v-24208a48>=</span> <span class="token function" data-v-24208a48>useCallback</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span> <span class="token operator" data-v-24208a48>=&gt;</span> <span class="token punctuation" data-v-24208a48>{</span>
        console<span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>log</span><span class="token punctuation" data-v-24208a48>(</span>count<span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>;</span>
    <span class="token punctuation" data-v-24208a48>}</span><span class="token punctuation" data-v-24208a48>,</span> <span class="token punctuation" data-v-24208a48>[</span>count<span class="token punctuation" data-v-24208a48>]</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>;</span>
    set<span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>add</span><span class="token punctuation" data-v-24208a48>(</span>callback<span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>;</span>
 
 
    <span class="token keyword" data-v-24208a48>return</span> <span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
        </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>h4</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token punctuation" data-v-24208a48>{</span>count<span class="token punctuation" data-v-24208a48>}</span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>h4</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
        </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>h4</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token punctuation" data-v-24208a48>{</span>set<span class="token punctuation" data-v-24208a48>.</span>size<span class="token punctuation" data-v-24208a48>}</span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>h4</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
        </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
            </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>button</span> <span class="token attr-name" data-v-24208a48>onClick</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span> <span class="token operator" data-v-24208a48>=&gt;</span> <span class="token function" data-v-24208a48>setCount</span><span class="token punctuation" data-v-24208a48>(</span>count <span class="token operator" data-v-24208a48>+</span> <span class="token number" data-v-24208a48>1</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>}</span></span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>+</span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>button</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
            </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>input</span> <span class="token attr-name" data-v-24208a48>value</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span>val<span class="token punctuation" data-v-24208a48>}</span></span> <span class="token attr-name" data-v-24208a48>onChange</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span><span class="token parameter" data-v-24208a48>event</span> <span class="token operator" data-v-24208a48>=&gt;</span> <span class="token function" data-v-24208a48>setVal</span><span class="token punctuation" data-v-24208a48>(</span>event<span class="token punctuation" data-v-24208a48>.</span>target<span class="token punctuation" data-v-24208a48>.</span>value<span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>}</span></span><span class="token punctuation" data-v-24208a48>/&gt;</span></span><span class="token plain-text" data-v-24208a48>
        </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
    </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token punctuation" data-v-24208a48>;</span>
<span class="token punctuation" data-v-24208a48>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-24208a48><span class="line-number" data-v-24208a48>1</span><br data-v-24208a48><span class="line-number" data-v-24208a48>2</span><br data-v-24208a48><span class="line-number" data-v-24208a48>3</span><br data-v-24208a48><span class="line-number" data-v-24208a48>4</span><br data-v-24208a48><span class="line-number" data-v-24208a48>5</span><br data-v-24208a48><span class="line-number" data-v-24208a48>6</span><br data-v-24208a48><span class="line-number" data-v-24208a48>7</span><br data-v-24208a48><span class="line-number" data-v-24208a48>8</span><br data-v-24208a48><span class="line-number" data-v-24208a48>9</span><br data-v-24208a48><span class="line-number" data-v-24208a48>10</span><br data-v-24208a48><span class="line-number" data-v-24208a48>11</span><br data-v-24208a48><span class="line-number" data-v-24208a48>12</span><br data-v-24208a48><span class="line-number" data-v-24208a48>13</span><br data-v-24208a48><span class="line-number" data-v-24208a48>14</span><br data-v-24208a48><span class="line-number" data-v-24208a48>15</span><br data-v-24208a48><span class="line-number" data-v-24208a48>16</span><br data-v-24208a48><span class="line-number" data-v-24208a48>17</span><br data-v-24208a48><span class="line-number" data-v-24208a48>18</span><br data-v-24208a48><span class="line-number" data-v-24208a48>19</span><br data-v-24208a48><span class="line-number" data-v-24208a48>20</span><br data-v-24208a48><span class="line-number" data-v-24208a48>21</span><br data-v-24208a48></div></div><p data-v-24208a48>我们可以看到，每次修改count，set.size就会+1，这说明useCallback依赖变量count，count变更时会返回新的函数；而val变更时，set.size不会变，说明返回的是缓存的旧版本函数。</p> <p data-v-24208a48>知道useCallback有什么样的特点，那有什么作用呢？使用场景是：有一个父组件，其中包含子组件，子组件接收一个函数作为props；通常而言，如果父组件更新了，子组件也会执行更新；但是大多数场景下，更新是没有必要的，我们可以借助useCallback来返回函数，然后把这个函数作为props传递给子组件；这样，子组件就能避免不必要的更新。</p> <div class="language-jsx line-numbers-mode" data-v-24208a48><pre class="language-jsx" data-v-24208a48><code data-v-24208a48><span class="token keyword" data-v-24208a48>import</span> React<span class="token punctuation" data-v-24208a48>,</span> <span class="token punctuation" data-v-24208a48>{</span> useState<span class="token punctuation" data-v-24208a48>,</span> useCallback<span class="token punctuation" data-v-24208a48>,</span> useEffect <span class="token punctuation" data-v-24208a48>}</span> <span class="token keyword" data-v-24208a48>from</span> <span class="token string" data-v-24208a48>'react'</span><span class="token punctuation" data-v-24208a48>;</span>
<span class="token keyword" data-v-24208a48>function</span> <span class="token function" data-v-24208a48>Parent</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span> <span class="token punctuation" data-v-24208a48>{</span>
    <span class="token keyword" data-v-24208a48>const</span> <span class="token punctuation" data-v-24208a48>[</span>count<span class="token punctuation" data-v-24208a48>,</span> setCount<span class="token punctuation" data-v-24208a48>]</span> <span class="token operator" data-v-24208a48>=</span> <span class="token function" data-v-24208a48>useState</span><span class="token punctuation" data-v-24208a48>(</span><span class="token number" data-v-24208a48>1</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>;</span>
    <span class="token keyword" data-v-24208a48>const</span> <span class="token punctuation" data-v-24208a48>[</span>val<span class="token punctuation" data-v-24208a48>,</span> setVal<span class="token punctuation" data-v-24208a48>]</span> <span class="token operator" data-v-24208a48>=</span> <span class="token function" data-v-24208a48>useState</span><span class="token punctuation" data-v-24208a48>(</span><span class="token string" data-v-24208a48>''</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>;</span>
 
    <span class="token keyword" data-v-24208a48>const</span> callback <span class="token operator" data-v-24208a48>=</span> <span class="token function" data-v-24208a48>useCallback</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span> <span class="token operator" data-v-24208a48>=&gt;</span> <span class="token punctuation" data-v-24208a48>{</span>
        <span class="token keyword" data-v-24208a48>return</span> count<span class="token punctuation" data-v-24208a48>;</span>
    <span class="token punctuation" data-v-24208a48>}</span><span class="token punctuation" data-v-24208a48>,</span> <span class="token punctuation" data-v-24208a48>[</span>count<span class="token punctuation" data-v-24208a48>]</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>;</span>
    <span class="token keyword" data-v-24208a48>return</span> <span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
        </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>h4</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token punctuation" data-v-24208a48>{</span>count<span class="token punctuation" data-v-24208a48>}</span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>h4</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
        </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span><span class="token class-name" data-v-24208a48>Child</span></span> <span class="token attr-name" data-v-24208a48>callback</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span>callback<span class="token punctuation" data-v-24208a48>}</span></span><span class="token punctuation" data-v-24208a48>/&gt;</span></span><span class="token plain-text" data-v-24208a48>
        </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
            </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>button</span> <span class="token attr-name" data-v-24208a48>onClick</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span> <span class="token operator" data-v-24208a48>=&gt;</span> <span class="token function" data-v-24208a48>setCount</span><span class="token punctuation" data-v-24208a48>(</span>count <span class="token operator" data-v-24208a48>+</span> <span class="token number" data-v-24208a48>1</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>}</span></span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>+</span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>button</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
            </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>input</span> <span class="token attr-name" data-v-24208a48>value</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span>val<span class="token punctuation" data-v-24208a48>}</span></span> <span class="token attr-name" data-v-24208a48>onChange</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span><span class="token parameter" data-v-24208a48>event</span> <span class="token operator" data-v-24208a48>=&gt;</span> <span class="token function" data-v-24208a48>setVal</span><span class="token punctuation" data-v-24208a48>(</span>event<span class="token punctuation" data-v-24208a48>.</span>target<span class="token punctuation" data-v-24208a48>.</span>value<span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>}</span></span><span class="token punctuation" data-v-24208a48>/&gt;</span></span><span class="token plain-text" data-v-24208a48>
        </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
    </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token punctuation" data-v-24208a48>;</span>
<span class="token punctuation" data-v-24208a48>}</span>
 
<span class="token keyword" data-v-24208a48>function</span> <span class="token function" data-v-24208a48>Child</span><span class="token punctuation" data-v-24208a48>(</span><span class="token parameter" data-v-24208a48><span class="token punctuation" data-v-24208a48>{</span> callback <span class="token punctuation" data-v-24208a48>}</span></span><span class="token punctuation" data-v-24208a48>)</span> <span class="token punctuation" data-v-24208a48>{</span>
    <span class="token keyword" data-v-24208a48>const</span> <span class="token punctuation" data-v-24208a48>[</span>count<span class="token punctuation" data-v-24208a48>,</span> setCount<span class="token punctuation" data-v-24208a48>]</span> <span class="token operator" data-v-24208a48>=</span> <span class="token function" data-v-24208a48>useState</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span> <span class="token operator" data-v-24208a48>=&gt;</span> <span class="token function" data-v-24208a48>callback</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>;</span>
    <span class="token function" data-v-24208a48>useEffect</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span> <span class="token operator" data-v-24208a48>=&gt;</span> <span class="token punctuation" data-v-24208a48>{</span>
        <span class="token function" data-v-24208a48>setCount</span><span class="token punctuation" data-v-24208a48>(</span><span class="token function" data-v-24208a48>callback</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>;</span>
    <span class="token punctuation" data-v-24208a48>}</span><span class="token punctuation" data-v-24208a48>,</span> <span class="token punctuation" data-v-24208a48>[</span>callback<span class="token punctuation" data-v-24208a48>]</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>;</span>
    <span class="token keyword" data-v-24208a48>return</span> <span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
        </span><span class="token punctuation" data-v-24208a48>{</span>count<span class="token punctuation" data-v-24208a48>}</span><span class="token plain-text" data-v-24208a48>
    </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span>
<span class="token punctuation" data-v-24208a48>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-24208a48><span class="line-number" data-v-24208a48>1</span><br data-v-24208a48><span class="line-number" data-v-24208a48>2</span><br data-v-24208a48><span class="line-number" data-v-24208a48>3</span><br data-v-24208a48><span class="line-number" data-v-24208a48>4</span><br data-v-24208a48><span class="line-number" data-v-24208a48>5</span><br data-v-24208a48><span class="line-number" data-v-24208a48>6</span><br data-v-24208a48><span class="line-number" data-v-24208a48>7</span><br data-v-24208a48><span class="line-number" data-v-24208a48>8</span><br data-v-24208a48><span class="line-number" data-v-24208a48>9</span><br data-v-24208a48><span class="line-number" data-v-24208a48>10</span><br data-v-24208a48><span class="line-number" data-v-24208a48>11</span><br data-v-24208a48><span class="line-number" data-v-24208a48>12</span><br data-v-24208a48><span class="line-number" data-v-24208a48>13</span><br data-v-24208a48><span class="line-number" data-v-24208a48>14</span><br data-v-24208a48><span class="line-number" data-v-24208a48>15</span><br data-v-24208a48><span class="line-number" data-v-24208a48>16</span><br data-v-24208a48><span class="line-number" data-v-24208a48>17</span><br data-v-24208a48><span class="line-number" data-v-24208a48>18</span><br data-v-24208a48><span class="line-number" data-v-24208a48>19</span><br data-v-24208a48><span class="line-number" data-v-24208a48>20</span><br data-v-24208a48><span class="line-number" data-v-24208a48>21</span><br data-v-24208a48><span class="line-number" data-v-24208a48>22</span><br data-v-24208a48><span class="line-number" data-v-24208a48>23</span><br data-v-24208a48><span class="line-number" data-v-24208a48>24</span><br data-v-24208a48><span class="line-number" data-v-24208a48>25</span><br data-v-24208a48><span class="line-number" data-v-24208a48>26</span><br data-v-24208a48><span class="line-number" data-v-24208a48>27</span><br data-v-24208a48></div></div><p data-v-24208a48>不仅是上面的例子，所有依赖本地状态或props来创建函数，需要使用到缓存函数的地方，都是useCallback的应用场景。useEffect、useMemo、useCallback都是自带闭包的。也就是说，每一次组件的渲染，其都会捕获当前组件函数上下文中的状态(state, props)，所以每一次这三种hooks的执行，反映的也都是当前的状态，你无法使用它们来捕获上一次的状态。对于这种情况，我们应该使用ref来访问。useCallback去进行性能优化可以归结为一下三点：</p> <ol data-v-24208a48><li data-v-24208a48>函数 functionA 在 useEffect 内部被调用，为了避免 useEffect 的频繁触发，所以我用useCallback将函数 functionA 包起来;</li> <li data-v-24208a48>函数 functionB 在另一个使用useCallback包裹的函数 functionC 中被调用,为了避免这个函数functionC频繁变更,所以我用useCallback将函数 functionB 包起来;</li> <li data-v-24208a48>当函数 functionD 被传递给子组件,为了避免子组件进行不必要的频繁渲染,所以我用useCallback将函数functionD 包起来</li></ol> <blockquote data-v-24208a48><p data-v-24208a48>在某些场景里需要在useEffect里调用一个函数,出于某些原因.你无法把这个函数移动到effect内部;</p></blockquote> <div class="language-jsx line-numbers-mode" data-v-24208a48><pre class="language-jsx" data-v-24208a48><code data-v-24208a48><span class="token keyword" data-v-24208a48>const</span> <span class="token function-variable function" data-v-24208a48>Example</span> <span class="token operator" data-v-24208a48>=</span> <span class="token punctuation" data-v-24208a48>(</span><span class="token parameter" data-v-24208a48><span class="token punctuation" data-v-24208a48>{</span> someProp <span class="token punctuation" data-v-24208a48>}</span></span><span class="token punctuation" data-v-24208a48>)</span> <span class="token operator" data-v-24208a48>=&gt;</span> <span class="token punctuation" data-v-24208a48>{</span>

 <span class="token keyword" data-v-24208a48>const</span> <span class="token function-variable function" data-v-24208a48>doSomething</span> <span class="token operator" data-v-24208a48>=</span> <span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span> <span class="token operator" data-v-24208a48>=&gt;</span> <span class="token punctuation" data-v-24208a48>{</span>
   console<span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>log</span><span class="token punctuation" data-v-24208a48>(</span>someProp<span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>;</span>
 <span class="token punctuation" data-v-24208a48>}</span>

 <span class="token function" data-v-24208a48>useEffect</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span> <span class="token operator" data-v-24208a48>=&gt;</span> <span class="token punctuation" data-v-24208a48>{</span>
   <span class="token function" data-v-24208a48>doSomething</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>;</span>
 <span class="token punctuation" data-v-24208a48>}</span><span class="token punctuation" data-v-24208a48>,</span> <span class="token punctuation" data-v-24208a48>[</span>doSomething<span class="token punctuation" data-v-24208a48>]</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>;</span> <span class="token comment" data-v-24208a48>// 🔴 这样不安全（它调用的 `doSomething` 函数使用了 `someProp`）</span>
<span class="token punctuation" data-v-24208a48>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-24208a48><span class="line-number" data-v-24208a48>1</span><br data-v-24208a48><span class="line-number" data-v-24208a48>2</span><br data-v-24208a48><span class="line-number" data-v-24208a48>3</span><br data-v-24208a48><span class="line-number" data-v-24208a48>4</span><br data-v-24208a48><span class="line-number" data-v-24208a48>5</span><br data-v-24208a48><span class="line-number" data-v-24208a48>6</span><br data-v-24208a48><span class="line-number" data-v-24208a48>7</span><br data-v-24208a48><span class="line-number" data-v-24208a48>8</span><br data-v-24208a48><span class="line-number" data-v-24208a48>9</span><br data-v-24208a48><span class="line-number" data-v-24208a48>10</span><br data-v-24208a48></div></div><p data-v-24208a48>因为useEffect中调用的 doSomething 函数使用了 someProp这个props,所以需要将doSomething放在useEffect的依赖列表里;而为了确保这个函数不会随着组件渲染而重新创建,我们需要用useCallback把doSomething包裹起来,如下:</p> <div class="language-jsx line-numbers-mode" data-v-24208a48><pre class="language-jsx" data-v-24208a48><code data-v-24208a48><span class="token keyword" data-v-24208a48>const</span> <span class="token function-variable function" data-v-24208a48>Example</span> <span class="token operator" data-v-24208a48>=</span> <span class="token punctuation" data-v-24208a48>(</span><span class="token parameter" data-v-24208a48><span class="token punctuation" data-v-24208a48>{</span> someProp <span class="token punctuation" data-v-24208a48>}</span></span><span class="token punctuation" data-v-24208a48>)</span> <span class="token operator" data-v-24208a48>=&gt;</span> <span class="token punctuation" data-v-24208a48>{</span>
  <span class="token comment" data-v-24208a48>// ✅ 用 useCallback 包裹以避免随渲染发生改变</span>
  <span class="token keyword" data-v-24208a48>const</span> doSomething <span class="token operator" data-v-24208a48>=</span> <span class="token function" data-v-24208a48>useCallback</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span> <span class="token operator" data-v-24208a48>=&gt;</span> <span class="token punctuation" data-v-24208a48>{</span>
    <span class="token comment" data-v-24208a48>// ... Does something with someProp ...</span>
  <span class="token punctuation" data-v-24208a48>}</span><span class="token punctuation" data-v-24208a48>,</span> <span class="token punctuation" data-v-24208a48>[</span>someProp<span class="token punctuation" data-v-24208a48>]</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>;</span> <span class="token comment" data-v-24208a48>// ✅ useCallback 的所有依赖都被指定了</span>

 <span class="token function" data-v-24208a48>useEffect</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span> <span class="token operator" data-v-24208a48>=&gt;</span> <span class="token punctuation" data-v-24208a48>{</span>
    <span class="token function" data-v-24208a48>doSomething</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>;</span>
  <span class="token punctuation" data-v-24208a48>}</span><span class="token punctuation" data-v-24208a48>,</span> <span class="token punctuation" data-v-24208a48>[</span>doSomething<span class="token punctuation" data-v-24208a48>]</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>;</span> <span class="token comment" data-v-24208a48>// ✅ useEffect 的所有依赖都被指定了</span>
<span class="token punctuation" data-v-24208a48>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-24208a48><span class="line-number" data-v-24208a48>1</span><br data-v-24208a48><span class="line-number" data-v-24208a48>2</span><br data-v-24208a48><span class="line-number" data-v-24208a48>3</span><br data-v-24208a48><span class="line-number" data-v-24208a48>4</span><br data-v-24208a48><span class="line-number" data-v-24208a48>5</span><br data-v-24208a48><span class="line-number" data-v-24208a48>6</span><br data-v-24208a48><span class="line-number" data-v-24208a48>7</span><br data-v-24208a48><span class="line-number" data-v-24208a48>8</span><br data-v-24208a48><span class="line-number" data-v-24208a48>9</span><br data-v-24208a48><span class="line-number" data-v-24208a48>10</span><br data-v-24208a48></div></div><blockquote data-v-24208a48><p data-v-24208a48>在某些情况下,你需要在useCallback包裹的函数中调用另一个函数,记得要给另一个函数也包上useCallback</p></blockquote> <div class="language-jsx line-numbers-mode" data-v-24208a48><pre class="language-jsx" data-v-24208a48><code data-v-24208a48><span class="token keyword" data-v-24208a48>const</span> <span class="token function-variable function" data-v-24208a48>Example</span> <span class="token operator" data-v-24208a48>=</span> <span class="token punctuation" data-v-24208a48>(</span><span class="token parameter" data-v-24208a48><span class="token punctuation" data-v-24208a48>{</span> prop1<span class="token punctuation" data-v-24208a48>,</span> prop2 <span class="token punctuation" data-v-24208a48>}</span></span><span class="token punctuation" data-v-24208a48>)</span> <span class="token operator" data-v-24208a48>=&gt;</span> <span class="token punctuation" data-v-24208a48>{</span>
 <span class="token comment" data-v-24208a48>// ✅ 用 useCallback 包裹以避免随渲染发生改变</span>
 <span class="token keyword" data-v-24208a48>const</span> something <span class="token operator" data-v-24208a48>=</span> <span class="token function" data-v-24208a48>useCallback</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span> <span class="token operator" data-v-24208a48>=&gt;</span> <span class="token punctuation" data-v-24208a48>{</span>
 <span class="token comment" data-v-24208a48>// ... Does something with prop2 ...</span>
 <span class="token punctuation" data-v-24208a48>}</span><span class="token punctuation" data-v-24208a48>,</span> <span class="token punctuation" data-v-24208a48>[</span>prop2<span class="token punctuation" data-v-24208a48>]</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>;</span> <span class="token comment" data-v-24208a48>// ✅ useCallback 的所有依赖都被指定了</span>
 
 <span class="token comment" data-v-24208a48>// ✅ 用 useCallback 包裹以避免随渲染发生改变</span>
 <span class="token keyword" data-v-24208a48>const</span> doSomething <span class="token operator" data-v-24208a48>=</span> <span class="token function" data-v-24208a48>useCallback</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span> <span class="token operator" data-v-24208a48>=&gt;</span> <span class="token punctuation" data-v-24208a48>{</span>
 	<span class="token function" data-v-24208a48>somethingOne</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>;</span>
   <span class="token comment" data-v-24208a48>// ... Does something with prop1 ...</span>
 <span class="token punctuation" data-v-24208a48>}</span><span class="token punctuation" data-v-24208a48>,</span> <span class="token punctuation" data-v-24208a48>[</span>prop1<span class="token punctuation" data-v-24208a48>,</span> somethingOne<span class="token punctuation" data-v-24208a48>]</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>;</span> <span class="token comment" data-v-24208a48>// ✅ useCallback 的所有依赖都被指定了</span>

<span class="token function" data-v-24208a48>useEffect</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span> <span class="token operator" data-v-24208a48>=&gt;</span> <span class="token punctuation" data-v-24208a48>{</span>
   <span class="token function" data-v-24208a48>doSomething</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>;</span>
 <span class="token punctuation" data-v-24208a48>}</span><span class="token punctuation" data-v-24208a48>,</span> <span class="token punctuation" data-v-24208a48>[</span>doSomething<span class="token punctuation" data-v-24208a48>]</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>;</span> <span class="token comment" data-v-24208a48>// ✅ useEffect 的所有依赖都被指定了</span>
<span class="token punctuation" data-v-24208a48>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-24208a48><span class="line-number" data-v-24208a48>1</span><br data-v-24208a48><span class="line-number" data-v-24208a48>2</span><br data-v-24208a48><span class="line-number" data-v-24208a48>3</span><br data-v-24208a48><span class="line-number" data-v-24208a48>4</span><br data-v-24208a48><span class="line-number" data-v-24208a48>5</span><br data-v-24208a48><span class="line-number" data-v-24208a48>6</span><br data-v-24208a48><span class="line-number" data-v-24208a48>7</span><br data-v-24208a48><span class="line-number" data-v-24208a48>8</span><br data-v-24208a48><span class="line-number" data-v-24208a48>9</span><br data-v-24208a48><span class="line-number" data-v-24208a48>10</span><br data-v-24208a48><span class="line-number" data-v-24208a48>11</span><br data-v-24208a48><span class="line-number" data-v-24208a48>12</span><br data-v-24208a48><span class="line-number" data-v-24208a48>13</span><br data-v-24208a48><span class="line-number" data-v-24208a48>14</span><br data-v-24208a48><span class="line-number" data-v-24208a48>15</span><br data-v-24208a48><span class="line-number" data-v-24208a48>16</span><br data-v-24208a48></div></div><blockquote data-v-24208a48><p data-v-24208a48>当函数 functionD 被传递给子组件:</p></blockquote> <div class="language-jsx line-numbers-mode" data-v-24208a48><pre class="language-jsx" data-v-24208a48><code data-v-24208a48><span class="token keyword" data-v-24208a48>const</span> <span class="token function-variable function" data-v-24208a48>ParentComp</span> <span class="token operator" data-v-24208a48>=</span> <span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span> <span class="token operator" data-v-24208a48>=&gt;</span> <span class="token punctuation" data-v-24208a48>{</span>
  <span class="token keyword" data-v-24208a48>const</span> <span class="token punctuation" data-v-24208a48>[</span> count<span class="token punctuation" data-v-24208a48>,</span> setCount <span class="token punctuation" data-v-24208a48>]</span> <span class="token operator" data-v-24208a48>=</span> <span class="token function" data-v-24208a48>useState</span><span class="token punctuation" data-v-24208a48>(</span><span class="token number" data-v-24208a48>0</span><span class="token punctuation" data-v-24208a48>)</span>
  <span class="token keyword" data-v-24208a48>const</span> <span class="token function-variable function" data-v-24208a48>increment</span> <span class="token operator" data-v-24208a48>=</span> <span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span> <span class="token operator" data-v-24208a48>=&gt;</span> <span class="token function" data-v-24208a48>setCount</span><span class="token punctuation" data-v-24208a48>(</span>count <span class="token operator" data-v-24208a48>+</span> <span class="token number" data-v-24208a48>1</span><span class="token punctuation" data-v-24208a48>)</span>
  <span class="token keyword" data-v-24208a48>const</span> <span class="token punctuation" data-v-24208a48>[</span> name<span class="token punctuation" data-v-24208a48>,</span> setName <span class="token punctuation" data-v-24208a48>]</span> <span class="token operator" data-v-24208a48>=</span> <span class="token function" data-v-24208a48>useState</span><span class="token punctuation" data-v-24208a48>(</span><span class="token string" data-v-24208a48>'hi~'</span><span class="token punctuation" data-v-24208a48>)</span>
  <span class="token keyword" data-v-24208a48>const</span> <span class="token function-variable function" data-v-24208a48>changeName</span> <span class="token operator" data-v-24208a48>=</span> <span class="token punctuation" data-v-24208a48>(</span><span class="token parameter" data-v-24208a48>newName</span><span class="token punctuation" data-v-24208a48>)</span> <span class="token operator" data-v-24208a48>=&gt;</span> <span class="token function" data-v-24208a48>setName</span><span class="token punctuation" data-v-24208a48>(</span>newName<span class="token punctuation" data-v-24208a48>)</span>

  <span class="token keyword" data-v-24208a48>return</span> <span class="token punctuation" data-v-24208a48>(</span>
    <span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
      </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>button</span> <span class="token attr-name" data-v-24208a48>onClick</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span>increment<span class="token punctuation" data-v-24208a48>}</span></span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>点击次数：</span><span class="token punctuation" data-v-24208a48>{</span>count<span class="token punctuation" data-v-24208a48>}</span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>button</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
      </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span><span class="token class-name" data-v-24208a48>ChildComp</span></span> <span class="token attr-name" data-v-24208a48>name</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span>name<span class="token punctuation" data-v-24208a48>}</span></span> <span class="token attr-name" data-v-24208a48>onClick</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span>changeName<span class="token punctuation" data-v-24208a48>}</span></span><span class="token punctuation" data-v-24208a48>/&gt;</span></span><span class="token plain-text" data-v-24208a48>
    </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span>
  <span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>;</span>
<span class="token punctuation" data-v-24208a48>}</span>

<span class="token keyword" data-v-24208a48>const</span> <span class="token function-variable function" data-v-24208a48>ChildComp</span> <span class="token operator" data-v-24208a48>=</span> <span class="token punctuation" data-v-24208a48>(</span><span class="token parameter" data-v-24208a48><span class="token punctuation" data-v-24208a48>{</span> name<span class="token punctuation" data-v-24208a48>,</span> onClick <span class="token punctuation" data-v-24208a48>}</span></span><span class="token punctuation" data-v-24208a48>)</span> <span class="token operator" data-v-24208a48>=&gt;</span> <span class="token punctuation" data-v-24208a48>{</span>
  console<span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>log</span><span class="token punctuation" data-v-24208a48>(</span><span class="token string" data-v-24208a48>'render child-comp ...'</span><span class="token punctuation" data-v-24208a48>)</span>
  <span class="token keyword" data-v-24208a48>return</span> <span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span></span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
    </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>Child Comp ... </span><span class="token punctuation" data-v-24208a48>{</span>name<span class="token punctuation" data-v-24208a48>}</span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
    </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>button</span> <span class="token attr-name" data-v-24208a48>onClick</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span> <span class="token operator" data-v-24208a48>=&gt;</span> <span class="token function" data-v-24208a48>onClick</span><span class="token punctuation" data-v-24208a48>(</span><span class="token string" data-v-24208a48>'hello'</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>}</span></span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>改变 name 值</span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>button</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
  </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span></span><span class="token punctuation" data-v-24208a48>&gt;</span></span>
<span class="token punctuation" data-v-24208a48>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-24208a48><span class="line-number" data-v-24208a48>1</span><br data-v-24208a48><span class="line-number" data-v-24208a48>2</span><br data-v-24208a48><span class="line-number" data-v-24208a48>3</span><br data-v-24208a48><span class="line-number" data-v-24208a48>4</span><br data-v-24208a48><span class="line-number" data-v-24208a48>5</span><br data-v-24208a48><span class="line-number" data-v-24208a48>6</span><br data-v-24208a48><span class="line-number" data-v-24208a48>7</span><br data-v-24208a48><span class="line-number" data-v-24208a48>8</span><br data-v-24208a48><span class="line-number" data-v-24208a48>9</span><br data-v-24208a48><span class="line-number" data-v-24208a48>10</span><br data-v-24208a48><span class="line-number" data-v-24208a48>11</span><br data-v-24208a48><span class="line-number" data-v-24208a48>12</span><br data-v-24208a48><span class="line-number" data-v-24208a48>13</span><br data-v-24208a48><span class="line-number" data-v-24208a48>14</span><br data-v-24208a48><span class="line-number" data-v-24208a48>15</span><br data-v-24208a48><span class="line-number" data-v-24208a48>16</span><br data-v-24208a48><span class="line-number" data-v-24208a48>17</span><br data-v-24208a48><span class="line-number" data-v-24208a48>18</span><br data-v-24208a48><span class="line-number" data-v-24208a48>19</span><br data-v-24208a48><span class="line-number" data-v-24208a48>20</span><br data-v-24208a48><span class="line-number" data-v-24208a48>21</span><br data-v-24208a48></div></div><p data-v-24208a48>我们先来看一下组件触发rerender的时机:</p> <ul data-v-24208a48><li data-v-24208a48>组件的state的属性改变时;</li> <li data-v-24208a48>组件的props的任意属性值改变时;</li> <li data-v-24208a48>父组件重新rerender时;</li></ul> <p data-v-24208a48>根据组件的从新渲染机制,当我点击父组件的button来增加次数时,纵使子组件的state和props没有任何变化,子组件依然会rerender,这显然不是我们所期待的,原因我们也清楚,因为父组件重新rerender (state变化,父组件rerender) 且 子组件的props的onClick属性发生了变化 (父组件rerender时,函数changeName重新生成);</p> <p data-v-24208a48>我们可以通过React.memo结合useCallback来解决子组件不必要rerender的问题</p> <ul data-v-24208a48><li data-v-24208a48>通过React.memo包裹子组件来解决因 父组件重新rerender 导致子组件rerender的问题;</li> <li data-v-24208a48>通过useCallback包裹函数changeName来解决因 子组件的props的onClick属性发生了变化 导致子组件rerender的问题;</li></ul> <div class="language-jsx line-numbers-mode" data-v-24208a48><pre class="language-jsx" data-v-24208a48><code data-v-24208a48><span class="token keyword" data-v-24208a48>const</span> <span class="token function-variable function" data-v-24208a48>ParentComp</span> <span class="token operator" data-v-24208a48>=</span> <span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span> <span class="token operator" data-v-24208a48>=&gt;</span> <span class="token punctuation" data-v-24208a48>{</span>
  <span class="token keyword" data-v-24208a48>const</span> <span class="token punctuation" data-v-24208a48>[</span> count<span class="token punctuation" data-v-24208a48>,</span> setCount <span class="token punctuation" data-v-24208a48>]</span> <span class="token operator" data-v-24208a48>=</span> <span class="token function" data-v-24208a48>useState</span><span class="token punctuation" data-v-24208a48>(</span><span class="token number" data-v-24208a48>0</span><span class="token punctuation" data-v-24208a48>)</span>
  <span class="token keyword" data-v-24208a48>const</span> <span class="token function-variable function" data-v-24208a48>increment</span> <span class="token operator" data-v-24208a48>=</span> <span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span> <span class="token operator" data-v-24208a48>=&gt;</span> <span class="token function" data-v-24208a48>setCount</span><span class="token punctuation" data-v-24208a48>(</span>count <span class="token operator" data-v-24208a48>+</span> <span class="token number" data-v-24208a48>1</span><span class="token punctuation" data-v-24208a48>)</span>
  <span class="token keyword" data-v-24208a48>const</span> <span class="token punctuation" data-v-24208a48>[</span> name<span class="token punctuation" data-v-24208a48>,</span> setName <span class="token punctuation" data-v-24208a48>]</span> <span class="token operator" data-v-24208a48>=</span> <span class="token function" data-v-24208a48>useState</span><span class="token punctuation" data-v-24208a48>(</span><span class="token string" data-v-24208a48>'hi~'</span><span class="token punctuation" data-v-24208a48>)</span>
   <span class="token keyword" data-v-24208a48>const</span> changeName <span class="token operator" data-v-24208a48>=</span> <span class="token function" data-v-24208a48>useCallback</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>(</span><span class="token parameter" data-v-24208a48>newName</span><span class="token punctuation" data-v-24208a48>)</span> <span class="token operator" data-v-24208a48>=&gt;</span> <span class="token function" data-v-24208a48>setName</span><span class="token punctuation" data-v-24208a48>(</span>newName<span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>,</span> <span class="token punctuation" data-v-24208a48>[</span><span class="token punctuation" data-v-24208a48>]</span><span class="token punctuation" data-v-24208a48>)</span> <span class="token comment" data-v-24208a48>// ✅ 通过useCallback将函数changeName包裹</span>
  <span class="token keyword" data-v-24208a48>return</span> <span class="token punctuation" data-v-24208a48>(</span>
    <span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
      </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>button</span> <span class="token attr-name" data-v-24208a48>onClick</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span>increment<span class="token punctuation" data-v-24208a48>}</span></span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>点击次数：</span><span class="token punctuation" data-v-24208a48>{</span>count<span class="token punctuation" data-v-24208a48>}</span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>button</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
      </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span><span class="token class-name" data-v-24208a48>ChildComp</span></span> <span class="token attr-name" data-v-24208a48>name</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span>name<span class="token punctuation" data-v-24208a48>}</span></span> <span class="token attr-name" data-v-24208a48>onClick</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span>changeName<span class="token punctuation" data-v-24208a48>}</span></span><span class="token punctuation" data-v-24208a48>/&gt;</span></span><span class="token plain-text" data-v-24208a48>
    </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span>
  <span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>;</span>
<span class="token punctuation" data-v-24208a48>}</span>

<span class="token keyword" data-v-24208a48>const</span> ChildComp <span class="token operator" data-v-24208a48>=</span> React<span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>memo</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>(</span><span class="token parameter" data-v-24208a48><span class="token punctuation" data-v-24208a48>{</span> name<span class="token punctuation" data-v-24208a48>,</span> onClick <span class="token punctuation" data-v-24208a48>}</span></span><span class="token punctuation" data-v-24208a48>)</span> <span class="token operator" data-v-24208a48>=&gt;</span> <span class="token punctuation" data-v-24208a48>{</span>  <span class="token comment" data-v-24208a48>// ✅ 通过React.memo 高阶组件将子组件包裹</span>
  console<span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>log</span><span class="token punctuation" data-v-24208a48>(</span><span class="token string" data-v-24208a48>'render child-comp ...'</span><span class="token punctuation" data-v-24208a48>)</span>
  <span class="token keyword" data-v-24208a48>return</span> <span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span></span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
    </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>Child Comp ... </span><span class="token punctuation" data-v-24208a48>{</span>name<span class="token punctuation" data-v-24208a48>}</span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
    </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>button</span> <span class="token attr-name" data-v-24208a48>onClick</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span> <span class="token operator" data-v-24208a48>=&gt;</span> <span class="token function" data-v-24208a48>onClick</span><span class="token punctuation" data-v-24208a48>(</span><span class="token string" data-v-24208a48>'hello'</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>}</span></span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>改变 name 值</span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>button</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
  </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span></span><span class="token punctuation" data-v-24208a48>&gt;</span></span>
<span class="token punctuation" data-v-24208a48>}</span><span class="token punctuation" data-v-24208a48>)</span>
</code></pre> <div class="line-numbers-wrapper" data-v-24208a48><span class="line-number" data-v-24208a48>1</span><br data-v-24208a48><span class="line-number" data-v-24208a48>2</span><br data-v-24208a48><span class="line-number" data-v-24208a48>3</span><br data-v-24208a48><span class="line-number" data-v-24208a48>4</span><br data-v-24208a48><span class="line-number" data-v-24208a48>5</span><br data-v-24208a48><span class="line-number" data-v-24208a48>6</span><br data-v-24208a48><span class="line-number" data-v-24208a48>7</span><br data-v-24208a48><span class="line-number" data-v-24208a48>8</span><br data-v-24208a48><span class="line-number" data-v-24208a48>9</span><br data-v-24208a48><span class="line-number" data-v-24208a48>10</span><br data-v-24208a48><span class="line-number" data-v-24208a48>11</span><br data-v-24208a48><span class="line-number" data-v-24208a48>12</span><br data-v-24208a48><span class="line-number" data-v-24208a48>13</span><br data-v-24208a48><span class="line-number" data-v-24208a48>14</span><br data-v-24208a48><span class="line-number" data-v-24208a48>15</span><br data-v-24208a48><span class="line-number" data-v-24208a48>16</span><br data-v-24208a48><span class="line-number" data-v-24208a48>17</span><br data-v-24208a48><span class="line-number" data-v-24208a48>18</span><br data-v-24208a48><span class="line-number" data-v-24208a48>19</span><br data-v-24208a48><span class="line-number" data-v-24208a48>20</span><br data-v-24208a48></div></div><div class="custom-block tip" data-v-24208a48><p class="custom-block-title" data-v-24208a48>温馨提示</p> <p data-v-24208a48>React.memo和useCallback缺一不可;此外，useCallback性能优化也是有成本的.我们在得知useCallback能够优化性能后,恨不得每个函数都要拿useCallback包裹一下;不过我们需要明白: useCallback这种memoized函数也是需要成本的,比如增加了额外的deps变化判断,再比如可能会获得更多的内存分配…; 因此性能优化带来的好处可能抵消不了它的成本; 打个比方就像你开车去10公里以外的小镇 和 你开车去隔壁的邻居家);</p></div> <h3 id="usememo当usecallback" data-v-24208a48><a href="#usememo当usecallback" class="header-anchor" data-v-24208a48>#</a> useMemo当useCallback</h3> <p data-v-24208a48>父组件:</p> <div class="language-jsx line-numbers-mode" data-v-24208a48><pre class="language-jsx" data-v-24208a48><code data-v-24208a48><span class="token keyword" data-v-24208a48>function</span> <span class="token function" data-v-24208a48>App</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span> <span class="token punctuation" data-v-24208a48>{</span>
  <span class="token keyword" data-v-24208a48>const</span> <span class="token punctuation" data-v-24208a48>[</span>name<span class="token punctuation" data-v-24208a48>,</span> setName<span class="token punctuation" data-v-24208a48>]</span> <span class="token operator" data-v-24208a48>=</span> <span class="token function" data-v-24208a48>useState</span><span class="token punctuation" data-v-24208a48>(</span><span class="token string" data-v-24208a48>'名称'</span><span class="token punctuation" data-v-24208a48>)</span>
  <span class="token keyword" data-v-24208a48>const</span> <span class="token punctuation" data-v-24208a48>[</span>content<span class="token punctuation" data-v-24208a48>,</span>setContent<span class="token punctuation" data-v-24208a48>]</span> <span class="token operator" data-v-24208a48>=</span> <span class="token function" data-v-24208a48>useState</span><span class="token punctuation" data-v-24208a48>(</span><span class="token string" data-v-24208a48>'内容'</span><span class="token punctuation" data-v-24208a48>)</span>
  <span class="token keyword" data-v-24208a48>return</span> <span class="token punctuation" data-v-24208a48>(</span>
      <span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span></span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
        </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>button</span> <span class="token attr-name" data-v-24208a48>onClick</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span> <span class="token operator" data-v-24208a48>=&gt;</span> <span class="token function" data-v-24208a48>setName</span><span class="token punctuation" data-v-24208a48>(</span><span class="token keyword" data-v-24208a48>new</span> <span class="token class-name" data-v-24208a48>Date</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>getTime</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>}</span></span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>name</span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>button</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
        </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>button</span> <span class="token attr-name" data-v-24208a48>onClick</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span> <span class="token operator" data-v-24208a48>=&gt;</span> <span class="token function" data-v-24208a48>setContent</span><span class="token punctuation" data-v-24208a48>(</span><span class="token keyword" data-v-24208a48>new</span> <span class="token class-name" data-v-24208a48>Date</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>getTime</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>}</span></span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>content</span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>button</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
        </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span><span class="token class-name" data-v-24208a48>Button</span></span> <span class="token attr-name" data-v-24208a48>name</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span>name<span class="token punctuation" data-v-24208a48>}</span></span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token punctuation" data-v-24208a48>{</span>content<span class="token punctuation" data-v-24208a48>}</span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span><span class="token class-name" data-v-24208a48>Button</span></span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
      </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span></span><span class="token punctuation" data-v-24208a48>&gt;</span></span>
  <span class="token punctuation" data-v-24208a48>)</span>
<span class="token punctuation" data-v-24208a48>}</span>

</code></pre> <div class="line-numbers-wrapper" data-v-24208a48><span class="line-number" data-v-24208a48>1</span><br data-v-24208a48><span class="line-number" data-v-24208a48>2</span><br data-v-24208a48><span class="line-number" data-v-24208a48>3</span><br data-v-24208a48><span class="line-number" data-v-24208a48>4</span><br data-v-24208a48><span class="line-number" data-v-24208a48>5</span><br data-v-24208a48><span class="line-number" data-v-24208a48>6</span><br data-v-24208a48><span class="line-number" data-v-24208a48>7</span><br data-v-24208a48><span class="line-number" data-v-24208a48>8</span><br data-v-24208a48><span class="line-number" data-v-24208a48>9</span><br data-v-24208a48><span class="line-number" data-v-24208a48>10</span><br data-v-24208a48><span class="line-number" data-v-24208a48>11</span><br data-v-24208a48><span class="line-number" data-v-24208a48>12</span><br data-v-24208a48></div></div><p data-v-24208a48>子组件：</p> <div class="language-jsx line-numbers-mode" data-v-24208a48><pre class="language-jsx" data-v-24208a48><code data-v-24208a48><span class="token keyword" data-v-24208a48>function</span> <span class="token function" data-v-24208a48>Button</span><span class="token punctuation" data-v-24208a48>(</span><span class="token parameter" data-v-24208a48><span class="token punctuation" data-v-24208a48>{</span> name<span class="token punctuation" data-v-24208a48>,</span> children <span class="token punctuation" data-v-24208a48>}</span></span><span class="token punctuation" data-v-24208a48>)</span> <span class="token punctuation" data-v-24208a48>{</span>
  <span class="token keyword" data-v-24208a48>function</span> <span class="token function" data-v-24208a48>changeName</span><span class="token punctuation" data-v-24208a48>(</span><span class="token parameter" data-v-24208a48>name</span><span class="token punctuation" data-v-24208a48>)</span> <span class="token punctuation" data-v-24208a48>{</span>
    console<span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>log</span><span class="token punctuation" data-v-24208a48>(</span><span class="token string" data-v-24208a48>'11'</span><span class="token punctuation" data-v-24208a48>)</span>
    <span class="token keyword" data-v-24208a48>return</span> name <span class="token operator" data-v-24208a48>+</span> <span class="token string" data-v-24208a48>'改变name的方法'</span>
  <span class="token punctuation" data-v-24208a48>}</span>

  <span class="token keyword" data-v-24208a48>const</span> otherName <span class="token operator" data-v-24208a48>=</span>  <span class="token function" data-v-24208a48>changeName</span><span class="token punctuation" data-v-24208a48>(</span>name<span class="token punctuation" data-v-24208a48>)</span>
  <span class="token keyword" data-v-24208a48>return</span> <span class="token punctuation" data-v-24208a48>(</span>
      <span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span></span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
        </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token punctuation" data-v-24208a48>{</span>otherName<span class="token punctuation" data-v-24208a48>}</span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
        </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token punctuation" data-v-24208a48>{</span>children<span class="token punctuation" data-v-24208a48>}</span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
      </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span></span><span class="token punctuation" data-v-24208a48>&gt;</span></span>

  <span class="token punctuation" data-v-24208a48>)</span>
<span class="token punctuation" data-v-24208a48>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-24208a48><span class="line-number" data-v-24208a48>1</span><br data-v-24208a48><span class="line-number" data-v-24208a48>2</span><br data-v-24208a48><span class="line-number" data-v-24208a48>3</span><br data-v-24208a48><span class="line-number" data-v-24208a48>4</span><br data-v-24208a48><span class="line-number" data-v-24208a48>5</span><br data-v-24208a48><span class="line-number" data-v-24208a48>6</span><br data-v-24208a48><span class="line-number" data-v-24208a48>7</span><br data-v-24208a48><span class="line-number" data-v-24208a48>8</span><br data-v-24208a48><span class="line-number" data-v-24208a48>9</span><br data-v-24208a48><span class="line-number" data-v-24208a48>10</span><br data-v-24208a48><span class="line-number" data-v-24208a48>11</span><br data-v-24208a48><span class="line-number" data-v-24208a48>12</span><br data-v-24208a48><span class="line-number" data-v-24208a48>13</span><br data-v-24208a48><span class="line-number" data-v-24208a48>14</span><br data-v-24208a48><span class="line-number" data-v-24208a48>15</span><br data-v-24208a48></div></div><p data-v-24208a48>注意我们打印console.log的方法，很显然的看出，当我们点击父组件的按钮的时候，子组件的name和children都会发生变化。不管我们是改变name或者content的值，我们发现 changeName的方法都会被调用。是不是意味着 我们本来只想修改content的值，但是由于name并没有发生变化，所以无需执行对应的changeName方法。但是发现他却执行了。 这是不是就意味着性能的损耗，做了无用功。</p> <p data-v-24208a48>优化之后的子组件：</p> <div class="language-jsx line-numbers-mode" data-v-24208a48><pre class="language-jsx" data-v-24208a48><code data-v-24208a48><span class="token keyword" data-v-24208a48>function</span> <span class="token function" data-v-24208a48>Button</span><span class="token punctuation" data-v-24208a48>(</span><span class="token parameter" data-v-24208a48><span class="token punctuation" data-v-24208a48>{</span> name<span class="token punctuation" data-v-24208a48>,</span> children <span class="token punctuation" data-v-24208a48>}</span></span><span class="token punctuation" data-v-24208a48>)</span> <span class="token punctuation" data-v-24208a48>{</span>
  <span class="token keyword" data-v-24208a48>function</span> <span class="token function" data-v-24208a48>changeName</span><span class="token punctuation" data-v-24208a48>(</span><span class="token parameter" data-v-24208a48>name</span><span class="token punctuation" data-v-24208a48>)</span> <span class="token punctuation" data-v-24208a48>{</span>
    console<span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>log</span><span class="token punctuation" data-v-24208a48>(</span><span class="token string" data-v-24208a48>'11'</span><span class="token punctuation" data-v-24208a48>)</span>
    <span class="token keyword" data-v-24208a48>return</span> name <span class="token operator" data-v-24208a48>+</span> <span class="token string" data-v-24208a48>'改变name的方法'</span>
  <span class="token punctuation" data-v-24208a48>}</span>

<span class="token keyword" data-v-24208a48>const</span> otherName <span class="token operator" data-v-24208a48>=</span>  <span class="token function" data-v-24208a48>useMemo</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token operator" data-v-24208a48>=&gt;</span><span class="token function" data-v-24208a48>changeName</span><span class="token punctuation" data-v-24208a48>(</span>name<span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>,</span><span class="token punctuation" data-v-24208a48>[</span>name<span class="token punctuation" data-v-24208a48>]</span><span class="token punctuation" data-v-24208a48>)</span>
  <span class="token keyword" data-v-24208a48>return</span> <span class="token punctuation" data-v-24208a48>(</span>
      <span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span></span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
        </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token punctuation" data-v-24208a48>{</span>otherName<span class="token punctuation" data-v-24208a48>}</span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
        </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token punctuation" data-v-24208a48>{</span>children<span class="token punctuation" data-v-24208a48>}</span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
      </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span></span><span class="token punctuation" data-v-24208a48>&gt;</span></span>

  <span class="token punctuation" data-v-24208a48>)</span>
<span class="token punctuation" data-v-24208a48>}</span>
<span class="token keyword" data-v-24208a48>export</span> <span class="token keyword" data-v-24208a48>default</span> Button
</code></pre> <div class="line-numbers-wrapper" data-v-24208a48><span class="line-number" data-v-24208a48>1</span><br data-v-24208a48><span class="line-number" data-v-24208a48>2</span><br data-v-24208a48><span class="line-number" data-v-24208a48>3</span><br data-v-24208a48><span class="line-number" data-v-24208a48>4</span><br data-v-24208a48><span class="line-number" data-v-24208a48>5</span><br data-v-24208a48><span class="line-number" data-v-24208a48>6</span><br data-v-24208a48><span class="line-number" data-v-24208a48>7</span><br data-v-24208a48><span class="line-number" data-v-24208a48>8</span><br data-v-24208a48><span class="line-number" data-v-24208a48>9</span><br data-v-24208a48><span class="line-number" data-v-24208a48>10</span><br data-v-24208a48><span class="line-number" data-v-24208a48>11</span><br data-v-24208a48><span class="line-number" data-v-24208a48>12</span><br data-v-24208a48><span class="line-number" data-v-24208a48>13</span><br data-v-24208a48><span class="line-number" data-v-24208a48>14</span><br data-v-24208a48><span class="line-number" data-v-24208a48>15</span><br data-v-24208a48><span class="line-number" data-v-24208a48>16</span><br data-v-24208a48></div></div><p data-v-24208a48>这个时候我们点击 改变content值的按钮，发现changeName 并没有被调用。但是点击改变name值按钮的时候，changeName被调用了。所以我们可以使用useMemo方法 避免无用方法的调用，当然一般我们changName里面可能会使用useState来改变state的值，那是不是就避免了组件的二次渲染。达到了优化性能的目的。</p> <div class="custom-block tip" data-v-24208a48><p class="custom-block-title" data-v-24208a48>温馨提示</p> <p data-v-24208a48>使用 function 的形式来声明组件，失去了shouldCompnentUpdate（在组件更新之前）这个生命周期，也就是说我们没有办法通过组件更新前条件来决定组件是否更新。
而且在函数组件中，也不再区分mount和update两个状态，这意味着函数组件的每一次调用都会执行内部的所有逻辑，就带来了非常大的性能损耗。
useMemo和useCallback都是解决上述性能问题的。</p></div> <h2 id="usecallback使用场景" data-v-24208a48><a href="#usecallback使用场景" class="header-anchor" data-v-24208a48>#</a> useCallback使用场景</h2> <p data-v-24208a48>我们再从另外的说法看下useCallback的使用场景：</p> <ul data-v-24208a48><li data-v-24208a48>函数被 useEffect 内部所使用，但为了避免频繁 useEffect 的频繁调用，所以我包一下；</li> <li data-v-24208a48>我只是为了解决 hooks lint 的提示报警，所以我包一下；</li> <li data-v-24208a48>因为有一个使用了 useCallback 的函数引用了我这个函数，所以我不得不包一下；</li> <li data-v-24208a48>当这个函数会被传递给子组件，为了避免子组件频繁渲染，使用 useCallback 包裹，保持引用不变；</li> <li data-v-24208a48>需要保存一个函数闭包结果，如配合 debounce、throttle 使用；</li> <li data-v-24208a48>我希望这个useCallback包裹但函数，但某个依赖项变化时，引用了我这个函数的所有 useEffect 都得重新执行一下；</li></ul> <h2 id="路由懒加载-路由监听器" data-v-24208a48><a href="#路由懒加载-路由监听器" class="header-anchor" data-v-24208a48>#</a> 路由懒加载，路由监听器</h2> <p data-v-24208a48>react路由懒加载，针对大型项目有很多页面，在配置路由的时候，如果没有对路由进行处理，一次性会加载大量路由，这对页面初始化很不友好，会延长页面初始化时间，所以我们想这用asyncRouter来按需加载页面路由。</p> <h3 id="传统路由" data-v-24208a48><a href="#传统路由" class="header-anchor" data-v-24208a48>#</a> 传统路由</h3> <p data-v-24208a48>如果我们没有用umi等框架，需要手动配置路由的时候，也许路由会这样配置。</p> <div class="language-jsx line-numbers-mode" data-v-24208a48><pre class="language-jsx" data-v-24208a48><code data-v-24208a48><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span><span class="token class-name" data-v-24208a48>Switch</span></span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
    </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span><span class="token class-name" data-v-24208a48>Route</span></span> <span class="token attr-name" data-v-24208a48>path</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span><span class="token string" data-v-24208a48>'/index'</span><span class="token punctuation" data-v-24208a48>}</span></span> <span class="token attr-name" data-v-24208a48>component</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span>Index<span class="token punctuation" data-v-24208a48>}</span></span> <span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span><span class="token class-name" data-v-24208a48>Route</span></span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
    </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span><span class="token class-name" data-v-24208a48>Route</span></span> <span class="token attr-name" data-v-24208a48>path</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span><span class="token string" data-v-24208a48>'/list'</span><span class="token punctuation" data-v-24208a48>}</span></span> <span class="token attr-name" data-v-24208a48>component</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span>List<span class="token punctuation" data-v-24208a48>}</span></span> <span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span><span class="token class-name" data-v-24208a48>Route</span></span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
    </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span><span class="token class-name" data-v-24208a48>Route</span></span> <span class="token attr-name" data-v-24208a48>path</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span><span class="token string" data-v-24208a48>'/detail'</span><span class="token punctuation" data-v-24208a48>}</span></span> <span class="token attr-name" data-v-24208a48>component</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span> Detail <span class="token punctuation" data-v-24208a48>}</span></span> <span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span><span class="token class-name" data-v-24208a48>Route</span></span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
    </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span><span class="token class-name" data-v-24208a48>Redirect</span></span> <span class="token attr-name" data-v-24208a48>from</span><span class="token attr-value" data-v-24208a48><span class="token punctuation attr-equals" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>'</span>/*<span class="token punctuation" data-v-24208a48>'</span></span> <span class="token attr-name" data-v-24208a48>to</span><span class="token attr-value" data-v-24208a48><span class="token punctuation attr-equals" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>'</span>/index<span class="token punctuation" data-v-24208a48>'</span></span> <span class="token punctuation" data-v-24208a48>/&gt;</span></span><span class="token plain-text" data-v-24208a48>
</span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span><span class="token class-name" data-v-24208a48>Switch</span></span><span class="token punctuation" data-v-24208a48>&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper" data-v-24208a48><span class="line-number" data-v-24208a48>1</span><br data-v-24208a48><span class="line-number" data-v-24208a48>2</span><br data-v-24208a48><span class="line-number" data-v-24208a48>3</span><br data-v-24208a48><span class="line-number" data-v-24208a48>4</span><br data-v-24208a48><span class="line-number" data-v-24208a48>5</span><br data-v-24208a48><span class="line-number" data-v-24208a48>6</span><br data-v-24208a48></div></div><p data-v-24208a48>或者用list保存路由信息，方便在进行路由拦截，或者配置路由菜单等。</p> <div class="language-jsx line-numbers-mode" data-v-24208a48><pre class="language-jsx" data-v-24208a48><code data-v-24208a48><span class="token keyword" data-v-24208a48>const</span> router <span class="token operator" data-v-24208a48>=</span> <span class="token punctuation" data-v-24208a48>[</span>
    <span class="token punctuation" data-v-24208a48>{</span>
        <span class="token string" data-v-24208a48>'path'</span><span class="token operator" data-v-24208a48>:</span> <span class="token string" data-v-24208a48>'/index'</span><span class="token punctuation" data-v-24208a48>,</span>
        <span class="token string" data-v-24208a48>'component'</span><span class="token operator" data-v-24208a48>:</span> Index
    <span class="token punctuation" data-v-24208a48>}</span><span class="token punctuation" data-v-24208a48>,</span>
    <span class="token punctuation" data-v-24208a48>{</span>
        <span class="token string" data-v-24208a48>'path'</span><span class="token operator" data-v-24208a48>:</span> <span class="token string" data-v-24208a48>'/list'</span>'<span class="token punctuation" data-v-24208a48>,</span>
        <span class="token string" data-v-24208a48>'component'</span><span class="token operator" data-v-24208a48>:</span> List
    <span class="token punctuation" data-v-24208a48>}</span><span class="token punctuation" data-v-24208a48>,</span>
    <span class="token punctuation" data-v-24208a48>{</span>
        <span class="token string" data-v-24208a48>'path'</span><span class="token operator" data-v-24208a48>:</span> <span class="token string" data-v-24208a48>'/detail'</span><span class="token punctuation" data-v-24208a48>,</span>
        <span class="token string" data-v-24208a48>'component'</span><span class="token operator" data-v-24208a48>:</span> Detail
    <span class="token punctuation" data-v-24208a48>}</span><span class="token punctuation" data-v-24208a48>,</span>
<span class="token punctuation" data-v-24208a48>]</span>
</code></pre> <div class="line-numbers-wrapper" data-v-24208a48><span class="line-number" data-v-24208a48>1</span><br data-v-24208a48><span class="line-number" data-v-24208a48>2</span><br data-v-24208a48><span class="line-number" data-v-24208a48>3</span><br data-v-24208a48><span class="line-number" data-v-24208a48>4</span><br data-v-24208a48><span class="line-number" data-v-24208a48>5</span><br data-v-24208a48><span class="line-number" data-v-24208a48>6</span><br data-v-24208a48><span class="line-number" data-v-24208a48>7</span><br data-v-24208a48><span class="line-number" data-v-24208a48>8</span><br data-v-24208a48><span class="line-number" data-v-24208a48>9</span><br data-v-24208a48><span class="line-number" data-v-24208a48>10</span><br data-v-24208a48><span class="line-number" data-v-24208a48>11</span><br data-v-24208a48><span class="line-number" data-v-24208a48>12</span><br data-v-24208a48><span class="line-number" data-v-24208a48>13</span><br data-v-24208a48><span class="line-number" data-v-24208a48>14</span><br data-v-24208a48></div></div><h3 id="asyncrouter懒加载-并实现路由监听" data-v-24208a48><a href="#asyncrouter懒加载-并实现路由监听" class="header-anchor" data-v-24208a48>#</a> asyncRouter懒加载,并实现路由监听</h3> <p data-v-24208a48>我们今天讲的这种react路由懒加载是基于import 函数路由懒加载， 众所周知 ，import 执行会返回一个Promise作为异步加载的手段。我们可以利用这点来实现react异步加载路由</p> <div class="language-jsx line-numbers-mode" data-v-24208a48><pre class="language-jsx" data-v-24208a48><code data-v-24208a48><span class="token keyword" data-v-24208a48>const</span> routerObserveQueue <span class="token operator" data-v-24208a48>=</span> <span class="token punctuation" data-v-24208a48>[</span><span class="token punctuation" data-v-24208a48>]</span> <span class="token comment" data-v-24208a48>/* 存放路由卫视钩子 */</span>
<span class="token comment" data-v-24208a48>/* 懒加载路由卫士钩子 */</span>
<span class="token keyword" data-v-24208a48>export</span> <span class="token keyword" data-v-24208a48>const</span> RouterHooks <span class="token operator" data-v-24208a48>=</span> <span class="token punctuation" data-v-24208a48>{</span>
  <span class="token comment" data-v-24208a48>/* 路由组件加载之前 */</span>
  <span class="token function-variable function" data-v-24208a48>beforeRouterComponentLoad</span><span class="token operator" data-v-24208a48>:</span> <span class="token keyword" data-v-24208a48>function</span><span class="token punctuation" data-v-24208a48>(</span><span class="token parameter" data-v-24208a48>callback</span><span class="token punctuation" data-v-24208a48>)</span> <span class="token punctuation" data-v-24208a48>{</span>
    routerObserveQueue<span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>push</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>{</span>
      type<span class="token operator" data-v-24208a48>:</span> <span class="token string" data-v-24208a48>'before'</span><span class="token punctuation" data-v-24208a48>,</span>
      callback
    <span class="token punctuation" data-v-24208a48>}</span><span class="token punctuation" data-v-24208a48>)</span>
  <span class="token punctuation" data-v-24208a48>}</span><span class="token punctuation" data-v-24208a48>,</span>
  <span class="token comment" data-v-24208a48>/* 路由组件加载之后 */</span>
  <span class="token function" data-v-24208a48>afterRouterComponentDidLoaded</span><span class="token punctuation" data-v-24208a48>(</span><span class="token parameter" data-v-24208a48>callback</span><span class="token punctuation" data-v-24208a48>)</span> <span class="token punctuation" data-v-24208a48>{</span>
    routerObserveQueue<span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>push</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>{</span>
      type<span class="token operator" data-v-24208a48>:</span> <span class="token string" data-v-24208a48>'after'</span><span class="token punctuation" data-v-24208a48>,</span>
      callback
    <span class="token punctuation" data-v-24208a48>}</span><span class="token punctuation" data-v-24208a48>)</span>
  <span class="token punctuation" data-v-24208a48>}</span>
<span class="token punctuation" data-v-24208a48>}</span>
<span class="token comment" data-v-24208a48>/* 路由懒加载HOC */</span>
<span class="token keyword" data-v-24208a48>export</span> <span class="token keyword" data-v-24208a48>default</span> <span class="token keyword" data-v-24208a48>function</span> <span class="token function" data-v-24208a48>AsyncRouter</span><span class="token punctuation" data-v-24208a48>(</span><span class="token parameter" data-v-24208a48>loadRouter</span><span class="token punctuation" data-v-24208a48>)</span> <span class="token punctuation" data-v-24208a48>{</span>
  <span class="token keyword" data-v-24208a48>return</span> <span class="token keyword" data-v-24208a48>class</span> <span class="token class-name" data-v-24208a48>Content</span> <span class="token keyword" data-v-24208a48>extends</span> <span class="token class-name" data-v-24208a48>React<span class="token punctuation" data-v-24208a48>.</span>Component</span> <span class="token punctuation" data-v-24208a48>{</span>
    <span class="token function" data-v-24208a48>constructor</span><span class="token punctuation" data-v-24208a48>(</span><span class="token parameter" data-v-24208a48>props</span><span class="token punctuation" data-v-24208a48>)</span> <span class="token punctuation" data-v-24208a48>{</span>
      <span class="token keyword" data-v-24208a48>super</span><span class="token punctuation" data-v-24208a48>(</span>props<span class="token punctuation" data-v-24208a48>)</span>
      <span class="token comment" data-v-24208a48>/* 触发每个路由加载之前钩子函数 */</span>
      <span class="token keyword" data-v-24208a48>this</span><span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>dispatchRouterQueue</span><span class="token punctuation" data-v-24208a48>(</span><span class="token string" data-v-24208a48>'before'</span><span class="token punctuation" data-v-24208a48>)</span>
    <span class="token punctuation" data-v-24208a48>}</span>
    state <span class="token operator" data-v-24208a48>=</span> <span class="token punctuation" data-v-24208a48>{</span>Component<span class="token operator" data-v-24208a48>:</span> <span class="token keyword" data-v-24208a48>null</span><span class="token punctuation" data-v-24208a48>}</span>
    <span class="token function" data-v-24208a48>dispatchRouterQueue</span><span class="token punctuation" data-v-24208a48>(</span><span class="token parameter" data-v-24208a48>type</span><span class="token punctuation" data-v-24208a48>)</span> <span class="token punctuation" data-v-24208a48>{</span>
      <span class="token keyword" data-v-24208a48>const</span> <span class="token punctuation" data-v-24208a48>{</span>history<span class="token punctuation" data-v-24208a48>}</span> <span class="token operator" data-v-24208a48>=</span> <span class="token keyword" data-v-24208a48>this</span><span class="token punctuation" data-v-24208a48>.</span>props
      routerObserveQueue<span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>forEach</span><span class="token punctuation" data-v-24208a48>(</span><span class="token parameter" data-v-24208a48>item</span> <span class="token operator" data-v-24208a48>=&gt;</span> <span class="token punctuation" data-v-24208a48>{</span>
        <span class="token keyword" data-v-24208a48>if</span> <span class="token punctuation" data-v-24208a48>(</span>item<span class="token punctuation" data-v-24208a48>.</span>type <span class="token operator" data-v-24208a48>===</span> type<span class="token punctuation" data-v-24208a48>)</span> item<span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>callback</span><span class="token punctuation" data-v-24208a48>(</span>history<span class="token punctuation" data-v-24208a48>)</span>
      <span class="token punctuation" data-v-24208a48>}</span><span class="token punctuation" data-v-24208a48>)</span>
    <span class="token punctuation" data-v-24208a48>}</span>
    <span class="token function" data-v-24208a48>componentDidMount</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span> <span class="token punctuation" data-v-24208a48>{</span>
      <span class="token keyword" data-v-24208a48>if</span> <span class="token punctuation" data-v-24208a48>(</span><span class="token keyword" data-v-24208a48>this</span><span class="token punctuation" data-v-24208a48>.</span>state<span class="token punctuation" data-v-24208a48>.</span>Component<span class="token punctuation" data-v-24208a48>)</span> <span class="token keyword" data-v-24208a48>return</span>
      <span class="token function" data-v-24208a48>loadRouter</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span>
        <span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>then</span><span class="token punctuation" data-v-24208a48>(</span><span class="token parameter" data-v-24208a48>module</span> <span class="token operator" data-v-24208a48>=&gt;</span> module<span class="token punctuation" data-v-24208a48>.</span>default<span class="token punctuation" data-v-24208a48>)</span>
        <span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>then</span><span class="token punctuation" data-v-24208a48>(</span><span class="token parameter" data-v-24208a48>Component</span> <span class="token operator" data-v-24208a48>=&gt;</span> <span class="token keyword" data-v-24208a48>this</span><span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>setState</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>{</span>Component<span class="token punctuation" data-v-24208a48>}</span><span class="token punctuation" data-v-24208a48>,</span>
          <span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span> <span class="token operator" data-v-24208a48>=&gt;</span> <span class="token punctuation" data-v-24208a48>{</span>
            <span class="token comment" data-v-24208a48>/* 触发每个路由加载之后钩子函数 */</span>
            <span class="token keyword" data-v-24208a48>this</span><span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>dispatchRouterQueue</span><span class="token punctuation" data-v-24208a48>(</span><span class="token string" data-v-24208a48>'after'</span><span class="token punctuation" data-v-24208a48>)</span>
          <span class="token punctuation" data-v-24208a48>}</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>)</span>
    <span class="token punctuation" data-v-24208a48>}</span>
    <span class="token function" data-v-24208a48>render</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span> <span class="token punctuation" data-v-24208a48>{</span>
      <span class="token keyword" data-v-24208a48>const</span> <span class="token punctuation" data-v-24208a48>{</span>Component<span class="token punctuation" data-v-24208a48>}</span> <span class="token operator" data-v-24208a48>=</span> <span class="token keyword" data-v-24208a48>this</span><span class="token punctuation" data-v-24208a48>.</span>state
      <span class="token keyword" data-v-24208a48>return</span> Component <span class="token operator" data-v-24208a48>?</span> <span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span><span class="token class-name" data-v-24208a48>Component</span></span> <span class="token spread" data-v-24208a48><span class="token punctuation" data-v-24208a48>{</span>
      <span class="token operator" data-v-24208a48>...</span><span class="token keyword" data-v-24208a48>this</span><span class="token punctuation" data-v-24208a48>.</span>props
      <span class="token punctuation" data-v-24208a48>}</span></span>
      <span class="token punctuation" data-v-24208a48>/&gt;</span></span> <span class="token operator" data-v-24208a48>:</span> <span class="token keyword" data-v-24208a48>null</span>
    <span class="token punctuation" data-v-24208a48>}</span>
  <span class="token punctuation" data-v-24208a48>}</span>
<span class="token punctuation" data-v-24208a48>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-24208a48><span class="line-number" data-v-24208a48>1</span><br data-v-24208a48><span class="line-number" data-v-24208a48>2</span><br data-v-24208a48><span class="line-number" data-v-24208a48>3</span><br data-v-24208a48><span class="line-number" data-v-24208a48>4</span><br data-v-24208a48><span class="line-number" data-v-24208a48>5</span><br data-v-24208a48><span class="line-number" data-v-24208a48>6</span><br data-v-24208a48><span class="line-number" data-v-24208a48>7</span><br data-v-24208a48><span class="line-number" data-v-24208a48>8</span><br data-v-24208a48><span class="line-number" data-v-24208a48>9</span><br data-v-24208a48><span class="line-number" data-v-24208a48>10</span><br data-v-24208a48><span class="line-number" data-v-24208a48>11</span><br data-v-24208a48><span class="line-number" data-v-24208a48>12</span><br data-v-24208a48><span class="line-number" data-v-24208a48>13</span><br data-v-24208a48><span class="line-number" data-v-24208a48>14</span><br data-v-24208a48><span class="line-number" data-v-24208a48>15</span><br data-v-24208a48><span class="line-number" data-v-24208a48>16</span><br data-v-24208a48><span class="line-number" data-v-24208a48>17</span><br data-v-24208a48><span class="line-number" data-v-24208a48>18</span><br data-v-24208a48><span class="line-number" data-v-24208a48>19</span><br data-v-24208a48><span class="line-number" data-v-24208a48>20</span><br data-v-24208a48><span class="line-number" data-v-24208a48>21</span><br data-v-24208a48><span class="line-number" data-v-24208a48>22</span><br data-v-24208a48><span class="line-number" data-v-24208a48>23</span><br data-v-24208a48><span class="line-number" data-v-24208a48>24</span><br data-v-24208a48><span class="line-number" data-v-24208a48>25</span><br data-v-24208a48><span class="line-number" data-v-24208a48>26</span><br data-v-24208a48><span class="line-number" data-v-24208a48>27</span><br data-v-24208a48><span class="line-number" data-v-24208a48>28</span><br data-v-24208a48><span class="line-number" data-v-24208a48>29</span><br data-v-24208a48><span class="line-number" data-v-24208a48>30</span><br data-v-24208a48><span class="line-number" data-v-24208a48>31</span><br data-v-24208a48><span class="line-number" data-v-24208a48>32</span><br data-v-24208a48><span class="line-number" data-v-24208a48>33</span><br data-v-24208a48><span class="line-number" data-v-24208a48>34</span><br data-v-24208a48><span class="line-number" data-v-24208a48>35</span><br data-v-24208a48><span class="line-number" data-v-24208a48>36</span><br data-v-24208a48><span class="line-number" data-v-24208a48>37</span><br data-v-24208a48><span class="line-number" data-v-24208a48>38</span><br data-v-24208a48><span class="line-number" data-v-24208a48>39</span><br data-v-24208a48><span class="line-number" data-v-24208a48>40</span><br data-v-24208a48><span class="line-number" data-v-24208a48>41</span><br data-v-24208a48><span class="line-number" data-v-24208a48>42</span><br data-v-24208a48><span class="line-number" data-v-24208a48>43</span><br data-v-24208a48><span class="line-number" data-v-24208a48>44</span><br data-v-24208a48><span class="line-number" data-v-24208a48>45</span><br data-v-24208a48><span class="line-number" data-v-24208a48>46</span><br data-v-24208a48><span class="line-number" data-v-24208a48>47</span><br data-v-24208a48><span class="line-number" data-v-24208a48>48</span><br data-v-24208a48><span class="line-number" data-v-24208a48>49</span><br data-v-24208a48><span class="line-number" data-v-24208a48>50</span><br data-v-24208a48><span class="line-number" data-v-24208a48>51</span><br data-v-24208a48><span class="line-number" data-v-24208a48>52</span><br data-v-24208a48></div></div><p data-v-24208a48>asyncRouter实际就是一个高级组件,将()=&gt;import()作为加载函数传进来，然后当外部Route加载当前组件的时候，在componentDidMount生命周期函数，加载真实的组件，并渲染组件，我们还可以写针对路由懒加载状态定制属于自己的路由监听器beforeRouterComponentLoad和afterRouterComponentDidLoaded，类似vue中 watch $route 功能。接下来我们看看如何使用。</p> <div class="language-jsx line-numbers-mode" data-v-24208a48><pre class="language-jsx" data-v-24208a48><code data-v-24208a48><span class="token keyword" data-v-24208a48>import</span> AsyncRouter <span class="token punctuation" data-v-24208a48>,</span><span class="token punctuation" data-v-24208a48>{</span> RouterHooks <span class="token punctuation" data-v-24208a48>}</span>  <span class="token keyword" data-v-24208a48>from</span> <span class="token string" data-v-24208a48>'./asyncRouter.jsx'</span>
<span class="token keyword" data-v-24208a48>const</span> <span class="token punctuation" data-v-24208a48>{</span> beforeRouterComponentLoad<span class="token punctuation" data-v-24208a48>}</span> <span class="token operator" data-v-24208a48>=</span> RouterHooks
<span class="token keyword" data-v-24208a48>const</span> Index <span class="token operator" data-v-24208a48>=</span> <span class="token function" data-v-24208a48>AsyncRouter</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token operator" data-v-24208a48>=&gt;</span><span class="token keyword" data-v-24208a48>import</span><span class="token punctuation" data-v-24208a48>(</span><span class="token string" data-v-24208a48>'../src/page/home/index'</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>)</span>
<span class="token keyword" data-v-24208a48>const</span> List <span class="token operator" data-v-24208a48>=</span> <span class="token function" data-v-24208a48>AsyncRouter</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token operator" data-v-24208a48>=&gt;</span><span class="token keyword" data-v-24208a48>import</span><span class="token punctuation" data-v-24208a48>(</span><span class="token string" data-v-24208a48>'../src/page/list'</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>)</span>
<span class="token keyword" data-v-24208a48>const</span> Detail <span class="token operator" data-v-24208a48>=</span> <span class="token function" data-v-24208a48>AsyncRouter</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token operator" data-v-24208a48>=&gt;</span><span class="token keyword" data-v-24208a48>import</span><span class="token punctuation" data-v-24208a48>(</span><span class="token string" data-v-24208a48>'../src/page/detail'</span><span class="token punctuation" data-v-24208a48>)</span><span class="token punctuation" data-v-24208a48>)</span>
<span class="token keyword" data-v-24208a48>const</span> <span class="token function-variable function" data-v-24208a48>index</span> <span class="token operator" data-v-24208a48>=</span> <span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span> <span class="token operator" data-v-24208a48>=&gt;</span> <span class="token punctuation" data-v-24208a48>{</span>
  <span class="token function" data-v-24208a48>useEffect</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>)</span><span class="token operator" data-v-24208a48>=&gt;</span><span class="token punctuation" data-v-24208a48>{</span>
    <span class="token comment" data-v-24208a48>/* 增加监听函数 */</span>  
    <span class="token function" data-v-24208a48>beforeRouterComponentLoad</span><span class="token punctuation" data-v-24208a48>(</span><span class="token punctuation" data-v-24208a48>(</span><span class="token parameter" data-v-24208a48>history</span><span class="token punctuation" data-v-24208a48>)</span><span class="token operator" data-v-24208a48>=&gt;</span><span class="token punctuation" data-v-24208a48>{</span>
      console<span class="token punctuation" data-v-24208a48>.</span><span class="token function" data-v-24208a48>log</span><span class="token punctuation" data-v-24208a48>(</span><span class="token string" data-v-24208a48>'当前激活的路由是'</span><span class="token punctuation" data-v-24208a48>,</span>history<span class="token punctuation" data-v-24208a48>.</span>location<span class="token punctuation" data-v-24208a48>.</span>pathname<span class="token punctuation" data-v-24208a48>)</span>
    <span class="token punctuation" data-v-24208a48>}</span><span class="token punctuation" data-v-24208a48>)</span>
  <span class="token punctuation" data-v-24208a48>}</span><span class="token punctuation" data-v-24208a48>,</span><span class="token punctuation" data-v-24208a48>[</span><span class="token punctuation" data-v-24208a48>]</span><span class="token punctuation" data-v-24208a48>)</span>
  <span class="token keyword" data-v-24208a48>return</span> <span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>div</span> <span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
    </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span>div</span> <span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
      </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span><span class="token class-name" data-v-24208a48>Router</span></span>  <span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
      </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span><span class="token class-name" data-v-24208a48>Meuns</span></span><span class="token punctuation" data-v-24208a48>/&gt;</span></span><span class="token plain-text" data-v-24208a48>
      </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span><span class="token class-name" data-v-24208a48>Switch</span></span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
          </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span><span class="token class-name" data-v-24208a48>Route</span></span> <span class="token attr-name" data-v-24208a48>path</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span><span class="token string" data-v-24208a48>'/index'</span><span class="token punctuation" data-v-24208a48>}</span></span> <span class="token attr-name" data-v-24208a48>component</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span>Index<span class="token punctuation" data-v-24208a48>}</span></span> <span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span><span class="token class-name" data-v-24208a48>Route</span></span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
          </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span><span class="token class-name" data-v-24208a48>Route</span></span> <span class="token attr-name" data-v-24208a48>path</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span><span class="token string" data-v-24208a48>'/list'</span><span class="token punctuation" data-v-24208a48>}</span></span> <span class="token attr-name" data-v-24208a48>component</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span>List<span class="token punctuation" data-v-24208a48>}</span></span> <span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span><span class="token class-name" data-v-24208a48>Route</span></span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
          </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span><span class="token class-name" data-v-24208a48>Route</span></span> <span class="token attr-name" data-v-24208a48>path</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span><span class="token string" data-v-24208a48>'/detail'</span><span class="token punctuation" data-v-24208a48>}</span></span> <span class="token attr-name" data-v-24208a48>component</span><span class="token script language-javascript" data-v-24208a48><span class="token script-punctuation punctuation" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>{</span> Detail <span class="token punctuation" data-v-24208a48>}</span></span> <span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span><span class="token class-name" data-v-24208a48>Route</span></span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
          </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;</span><span class="token class-name" data-v-24208a48>Redirect</span></span> <span class="token attr-name" data-v-24208a48>from</span><span class="token attr-value" data-v-24208a48><span class="token punctuation attr-equals" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>'</span>/*<span class="token punctuation" data-v-24208a48>'</span></span> <span class="token attr-name" data-v-24208a48>to</span><span class="token attr-value" data-v-24208a48><span class="token punctuation attr-equals" data-v-24208a48>=</span><span class="token punctuation" data-v-24208a48>'</span>/index<span class="token punctuation" data-v-24208a48>'</span></span> <span class="token punctuation" data-v-24208a48>/&gt;</span></span><span class="token plain-text" data-v-24208a48>
       </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span><span class="token class-name" data-v-24208a48>Switch</span></span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
      </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span><span class="token class-name" data-v-24208a48>Router</span></span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
    </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span><span class="token plain-text" data-v-24208a48>
  </span><span class="token tag" data-v-24208a48><span class="token tag" data-v-24208a48><span class="token punctuation" data-v-24208a48>&lt;/</span>div</span><span class="token punctuation" data-v-24208a48>&gt;</span></span>
<span class="token punctuation" data-v-24208a48>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-24208a48><span class="line-number" data-v-24208a48>1</span><br data-v-24208a48><span class="line-number" data-v-24208a48>2</span><br data-v-24208a48><span class="line-number" data-v-24208a48>3</span><br data-v-24208a48><span class="line-number" data-v-24208a48>4</span><br data-v-24208a48><span class="line-number" data-v-24208a48>5</span><br data-v-24208a48><span class="line-number" data-v-24208a48>6</span><br data-v-24208a48><span class="line-number" data-v-24208a48>7</span><br data-v-24208a48><span class="line-number" data-v-24208a48>8</span><br data-v-24208a48><span class="line-number" data-v-24208a48>9</span><br data-v-24208a48><span class="line-number" data-v-24208a48>10</span><br data-v-24208a48><span class="line-number" data-v-24208a48>11</span><br data-v-24208a48><span class="line-number" data-v-24208a48>12</span><br data-v-24208a48><span class="line-number" data-v-24208a48>13</span><br data-v-24208a48><span class="line-number" data-v-24208a48>14</span><br data-v-24208a48><span class="line-number" data-v-24208a48>15</span><br data-v-24208a48><span class="line-number" data-v-24208a48>16</span><br data-v-24208a48><span class="line-number" data-v-24208a48>17</span><br data-v-24208a48><span class="line-number" data-v-24208a48>18</span><br data-v-24208a48><span class="line-number" data-v-24208a48>19</span><br data-v-24208a48><span class="line-number" data-v-24208a48>20</span><br data-v-24208a48><span class="line-number" data-v-24208a48>21</span><br data-v-24208a48><span class="line-number" data-v-24208a48>22</span><br data-v-24208a48><span class="line-number" data-v-24208a48>23</span><br data-v-24208a48><span class="line-number" data-v-24208a48>24</span><br data-v-24208a48><span class="line-number" data-v-24208a48>25</span><br data-v-24208a48><span class="line-number" data-v-24208a48>26</span><br data-v-24208a48></div></div><p data-v-24208a48>效果:</p> <p data-v-24208a48><img src="/vuebloger/img/post/qwert.gif" alt="" data-v-24208a48></p></div> <div class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">10/6/2021, 10:23:05 AM</span></div></div> <!----> </div> <!----></div><div class="global-ui"></div></div>
    <script src="/vuebloger/assets/js/app.d19f2dda.js" defer></script><script src="/vuebloger/assets/js/5.82db9be2.js" defer></script><script src="/vuebloger/assets/js/1.b1b3586e.js" defer></script><script src="/vuebloger/assets/js/61.503d35d8.js" defer></script><script src="/vuebloger/assets/js/44.845ecfff.js" defer></script>
  </body>
</html>
